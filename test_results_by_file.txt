[1/156] PASSED: tests/benchmarks/test_contextual_performance.py
  Tests: 6 (P:6 F:0 S:0)
[2/156] FAILED: tests/benchmarks/test_late_chunking_performance.py
  Tests: 13 (P:3 F:10 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/benchmarks/test_late_chunking_performance.py::test_document_embedding_speed FAILED [ 12%]
tests/benchmarks/test_late_chunking_performance.py::test_embedding_chunking_speed FAILED [ 25%]
tests/benchmarks/test_late_chunking_performance.py::test_semantic_boundary_speed FAILED [ 37%]
tests/benchmarks/test_late_chunking_performance.py::test_end_to_end_latency PASSED [ 50%]
tests/benchmarks/test_late_chunking_performance.py::test_coherence_analysis_overhead PASSED [ 62%]
tests/benchmarks/test_late_chunking_performance.py::test_batch_processing_speed PASSED [ 75%]
tests/benchmarks/test_late_chunking_performance.py::test_adaptive_chunking_speed FAILED [ 87%]
tests/benchmarks/test_late_chunking_performance.py::test_memory_efficiency FAILED [100%]

=================================== FAILURES ===================================
________________________ test_document_embedding_speed _________________________
tests/benchmarks/test_late_chunking_performance.py:51: in test_document_embedding_speed
    doc_emb = strategy.document_embedder.embed_document(document, "perf_test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 17:40:57.780065175 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513][m
________________________ test_embedding_chunking_speed _________________________
tests/benchmarks/test_late_chunking_performance.py:72: in test_embedding_chunking_speed
    doc_emb = strategy.document_embedder.embed_document(document, "perf_test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 17:40:59.929878097 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526][m
_________________________ test_semantic_boundary_speed _________________________
tests/benchmarks/test_late_chunking_performance.py:97: in test_semantic_boundary_speed
    doc_emb = strategy.document_embedder.embed_document(document, "perf_test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 17:41:02.033447430 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513][m
_________________________ test_adaptive_chunking_speed _________________________
tests/benchmarks/test_late_chunking_performance.py:205: in test_adaptive_chunking_speed
    doc_emb = strategy.document_embedder.embed_document(document, "perf_test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 17:41:14.151891672 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526][m
____________________________ test_memory_efficiency ____________________________
tests/benchmarks/test_late_chunking_performance.py:230: in test_memory_efficiency
    doc_emb = strategy.document_embedder.embed_document(document, "memory_test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 17:41:16.368713731 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513][m
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

tests/benchmarks/test_late_chunking_performance.py:37
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:37: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:58
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:58: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:83
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:83: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:107
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:107: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:129
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:129: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:165
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:165: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:190
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:190: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:215
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:215: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    104    39%   22-23, 28-29, 41, 48, 94, 106-107, 123-193, 213-234, 263, 277-278, 282, 286-289, 304-306, 328-362, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27      5    81%   59, 82-96
rag_factory/strategies/late_chunking/document_embedder.py             88     33    62%   36, 81-85, 123, 196-204, 225-248, 265-272
rag_factory/strategies/late_chunking/embedding_chunker.py            112     57    49%   49, 52-57, 68-98, 121-131, 164, 177-178, 185-240, 284
rag_factory/strategies/late_chunking/models.py                        63      0   100%
rag_factory/strategies/late_chunking/strategy.py                      49      8    84%   48, 124-133, 138, 143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     57    40%   39-40, 53-64, 93-94, 100-101, 105-114, 129, 144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   8991    19%
=========================== short test summary info ============================
FAILED tests/benchmarks/test_late_chunking_performance.py::test_document_embedding_speed - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
FAILED tests/benchmarks/test_late_chunking_performance.py::test_embedding_chunking_speed - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526]
FAILED tests/benchmarks/test_late_chunking_performance.py::test_semantic_boundary_speed - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
FAILED tests/benchmarks/test_late_chunking_performance.py::test_adaptive_chunking_speed - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526]
FAILED tests/benchmarks/test_late_chunking_performance.py::test_memory_efficiency - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
================== 5 failed, 3 passed, 13 warnings in 26.14s ===================

[3/156] FAILED: tests/benchmarks/test_model_comparison_performance.py
  Tests: 12 (P:0 F:12 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 6 items

tests/benchmarks/test_model_comparison_performance.py::test_model_loading_speed FAILED [ 16%]
tests/benchmarks/test_model_comparison_performance.py::test_model_loading_cached FAILED [ 33%]
tests/benchmarks/test_model_comparison_performance.py::test_inference_speed FAILED [ 50%]
tests/benchmarks/test_model_comparison_performance.py::test_batch_size_comparison FAILED [ 66%]
tests/benchmarks/test_model_comparison_performance.py::test_embedding_quality FAILED [ 83%]
tests/benchmarks/test_model_comparison_performance.py::test_memory_efficiency FAILED [100%]

=================================== FAILURES ===================================
___________________________ test_model_loading_speed ___________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:23: in test_model_loading_speed
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
__________________________ test_model_loading_cached ___________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:45: in test_model_loading_cached
    loader.load_model(config)
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
_____________________________ test_inference_speed _____________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:71: in test_inference_speed
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
__________________________ test_batch_size_comparison __________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:110: in test_batch_size_comparison
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
____________________________ test_embedding_quality ____________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:138: in test_embedding_quality
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
____________________________ test_memory_efficiency ____________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:181: in test_memory_efficiency
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

tests/benchmarks/test_model_comparison_performance.py:8
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:8: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_model_comparison_performance.py:30
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:30: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_model_comparison_performance.py:56
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:56: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_model_comparison_performance.py:93
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:93: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_model_comparison_performance.py:126
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:126: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_model_comparison_performance.py:168
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:168: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      0   100%
rag_factory/models/embedding/__init__.py                               4      0   100%
rag_factory/models/embedding/loader.py                               179    140    22%   8, 16-18, 23-25, 65-66, 70-80, 85-88, 94-97, 109-114, 118-135, 139-166, 175-191, 200-235, 244-313, 322-341, 350-367
rag_factory/models/embedding/models.py                                47      0   100%
rag_factory/models/embedding/registry.py                             128    110    14%   30-34, 38-61, 65-76, 88-100, 112-125, 145-164, 176-192, 210-220, 231-241, 252-263, 273-282
rag_factory/models/evaluation/__init__.py                              3      0   100%
rag_factory/models/evaluation/ab_testing.py                           97     80    18%   10-12, 33-34, 42-45, 56-60, 77-88, 106-216, 234-257, 273-279
rag_factory/models/evaluation/models.py                               29      0   100%
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9132    17%
=========================== short test summary info ============================
FAILED tests/benchmarks/test_model_comparison_performance.py::test_model_loading_speed - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/benchmarks/test_model_comparison_performance.py::test_model_loading_cached - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/benchmarks/test_model_comparison_performance.py::test_inference_speed - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/benchmarks/test_model_comparison_performance.py::test_batch_size_comparison - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/benchmarks/test_model_comparison_performance.py::test_embedding_quality - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/benchmarks/test_model_comparison_performance.py::test_memory_efficiency - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
======================== 6 failed, 8 warnings in 9.18s =========================

[4/156] PASSED: tests/integration/cli/test_benchmark_integration.py
  Tests: 1 (P:1 F:0 S:0)
[5/156] PASSED: tests/integration/cli/test_config_validation_integration.py
  Tests: 2 (P:2 F:0 S:0)
[6/156] PASSED: tests/integration/cli/test_index_query_flow.py
  Tests: 11 (P:11 F:0 S:0)
[7/156] PASSED: tests/integration/database/test_database_integration.py
  Tests: 14 (P:13 F:0 S:1)
[8/156] PASSED: tests/integration/database/test_migration_integration.py
  Tests: 4 (P:4 F:0 S:0)
[9/156] ALL_SKIPPED: tests/integration/documentation/test_documentation_integration.py
  Tests: 6 (P:0 F:0 S:6)
[10/156] PASSED: tests/integration/evaluation/test_evaluation_integration.py
  Tests: 7 (P:7 F:0 S:0)
[11/156] FAILED: tests/integration/models/test_fine_tuned_embeddings_integration.py
  Tests: 7 (P:3 F:4 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 5 items

tests/integration/models/test_fine_tuned_embeddings_integration.py::test_register_and_load_model FAILED [ 20%]
tests/integration/models/test_fine_tuned_embeddings_integration.py::test_ab_testing_workflow PASSED [ 40%]
tests/integration/models/test_fine_tuned_embeddings_integration.py::test_model_registry_persistence_workflow PASSED [ 60%]
tests/integration/models/test_fine_tuned_embeddings_integration.py::test_model_comparison_workflow FAILED [ 80%]
tests/integration/models/test_fine_tuned_embeddings_integration.py::test_multiple_models_registry PASSED [100%]

=================================== FAILURES ===================================
_________________________ test_register_and_load_model _________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/integration/models/test_fine_tuned_embeddings_integration.py:45: in test_register_and_load_model
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
________________________ test_model_comparison_workflow ________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/integration/models/test_fine_tuned_embeddings_integration.py:182: in test_model_comparison_workflow
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      0   100%
rag_factory/models/embedding/__init__.py                               4      0   100%
rag_factory/models/embedding/loader.py                               179    140    22%   8, 16-18, 23-25, 65-66, 70-80, 85-88, 94-97, 109-114, 118-135, 139-166, 175-191, 200-235, 244-313, 322-341, 350-367
rag_factory/models/embedding/models.py                                47      0   100%
rag_factory/models/embedding/registry.py                             128     36    72%   47-50, 57-59, 75-76, 97, 113, 117, 120, 153, 159, 177, 180-187, 212, 253, 259, 263, 273-282
rag_factory/models/evaluation/__init__.py                              3      0   100%
rag_factory/models/evaluation/ab_testing.py                           97     18    81%   10-12, 57, 78-79, 107, 115, 127, 187, 240, 253, 255, 273-279
rag_factory/models/evaluation/models.py                               29      0   100%
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   8996    19%
=========================== short test summary info ============================
FAILED tests/integration/models/test_fine_tuned_embeddings_integration.py::test_register_and_load_model - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/integration/models/test_fine_tuned_embeddings_integration.py::test_model_comparison_workflow - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
=================== 2 failed, 3 passed, 2 warnings in 7.27s ====================

[12/156] PASSED: tests/integration/observability/test_monitoring_integration.py
  Tests: 11 (P:11 F:0 S:0)
[13/156] FAILED: tests/integration/repositories/test_repository_integration.py
  Tests: 24 (P:10 F:14 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 19 items

tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_complete_document_lifecycle FAILED [  5%]
tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_document_deduplication PASSED [ 10%]
tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_document_pagination FAILED [ 15%]
tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_document_status_filtering FAILED [ 21%]
tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_bulk_operations PASSED [ 26%]
tests/integration/repositories/test_repository_integration.py::TestChunkRepositoryIntegration::test_complete_chunk_lifecycle FAILED [ 31%]
tests/integration/repositories/test_repository_integration.py::TestChunkRepositoryIntegration::test_chunk_document_relationship PASSED [ 36%]
tests/integration/repositories/test_repository_integration.py::TestChunkRepositoryIntegration::test_cascade_delete PASSED [ 42%]
tests/integration/repositories/test_repository_integration.py::TestChunkRepositoryIntegration::test_bulk_chunk_operations PASSED [ 47%]
tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_similarity_search FAILED [ 52%]
tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_threshold FAILED [ 57%]
tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_document_filter FAILED [ 63%]
tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_metadata_filter ERROR [ 68%]
tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_identical_embedding ERROR [ 73%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_commit PASSED [ 78%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback PASSED [ 84%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_multiple_operations_in_transaction PASSED [ 89%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_context_manager PASSED [ 94%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback_on_error PASSED [100%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback_on_error ERROR [100%]

==================================== ERRORS ====================================
_ ERROR at setup of TestVectorSearchIntegration.test_vector_search_with_metadata_filter _
file /mnt/MCPProyects/ragTools/tests/integration/repositories/test_repository_integration.py, line 391
      def test_vector_search_with_metadata_filter(self, db_session, document):
E       fixture 'document' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, clean_database, cov, db_config, db_connection, db_engine, db_service, db_session, doctest_namespace, document_with_chunks, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, no_cover, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, subtests, test_db_config, test_db_url, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/mnt/MCPProyects/ragTools/tests/integration/repositories/test_repository_integration.py:391
_ ERROR at setup of TestVectorSearchIntegration.test_vector_search_identical_embedding _
file /mnt/MCPProyects/ragTools/tests/integration/repositories/test_repository_integration.py, line 421
      def test_vector_search_identical_embedding(self, db_session, document):
E       fixture 'document' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, clean_database, cov, db_config, db_connection, db_engine, db_service, db_session, doctest_namespace, document_with_chunks, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, no_cover, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, subtests, test_db_config, test_db_url, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/mnt/MCPProyects/ragTools/tests/integration/repositories/test_repository_integration.py:421
_ ERROR at teardown of TestRepositoryTransactions.test_transaction_rollback_on_error _
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.DependentObjectsStillExist: cannot drop table chunks because other objects depend on it
E   DETAIL:  view chunk_hierarchy_validation depends on table chunks
E   HINT:  Use DROP ... CASCADE to drop the dependent objects too.

The above exception was the direct cause of the following exception:
tests/conftest.py:138: in db_engine
    Base.metadata.drop_all(engine)
venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5856: in drop_all
    bind._run_ddl_visitor(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:1075: in visit_metadata
    self.traverse_single(
venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:1142: in visit_table
    DropTable(table)._invoke_with(self.connection)
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:315: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.InternalError: (psycopg2.errors.DependentObjectsStillExist) cannot drop table chunks because other objects depend on it
E   DETAIL:  view chunk_hierarchy_validation depends on table chunks
E   HINT:  Use DROP ... CASCADE to drop the dependent objects too.
E   
E   [SQL: 
E   DROP TABLE chunks]
E   (Background on this error at: https://sqlalche.me/e/20/2j85)
=================================== FAILURES ===================================
______ TestDocumentRepositoryIntegration.test_complete_document_lifecycle ______
tests/integration/repositories/test_repository_integration.py:29: in test_complete_document_lifecycle
    doc = repo.create(
rag_factory/repositories/document.py:100: in create
    raise DuplicateEntityError("Document", "content_hash", content_hash)
E   rag_factory.repositories.exceptions.DuplicateEntityError: Document with content_hash=abc123 already exists
__________ TestDocumentRepositoryIntegration.test_document_pagination __________
tests/integration/repositories/test_repository_integration.py:94: in test_document_pagination
    assert len(page2) == 5
E   AssertionError: assert 6 == 5
E    +  where 6 = len([<Document(id=f96b74ed-c270-425b-8a39-be0566f36049, filename='test4.txt', status='pending', chunks=0)>, <Document(id=c12e5cb5-e70b-48fd-9b2f-35aad0c0ea5e, filename='test3.txt', status='pending', chunks=0)>, <Document(id=788da368-c6e2-4e0f-90c8-8740c35538f6, filename='test2.txt', status='pending', chunks=0)>, <Document(id=60c6d7a8-b2ea-4600-b164-5af26ead9be7, filename='test1.txt', status='pending', chunks=0)>, <Document(id=466163b9-0a55-46bb-afea-c14eccf6240f, filename='test0.txt', status='pending', chunks=0)>, <Document(id=d617be57-003c-4f42-84d6-147a69b968f2, filename='test.txt', status='pending', chunks=0)>])
_______ TestDocumentRepositoryIntegration.test_document_status_filtering _______
tests/integration/repositories/test_repository_integration.py:121: in test_document_status_filtering
    assert len(pending) == 1
E   AssertionError: assert 2 == 1
E    +  where 2 = len([<Document(id=d617be57-003c-4f42-84d6-147a69b968f2, filename='test.txt', status='pending', chunks=0)>, <Document(id=ba391e6a-0e5b-4293-b7f6-31951ae0c198, filename='test3.txt', status='pending', chunks=0)>])
_________ TestChunkRepositoryIntegration.test_complete_chunk_lifecycle _________
tests/integration/repositories/test_repository_integration.py:196: in test_complete_chunk_lifecycle
    assert retrieved.embedding == new_embedding
E   ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()
__________ TestVectorSearchIntegration.test_vector_similarity_search ___________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.SyntaxError: syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^

The above exception was the direct cause of the following exception:
rag_factory/repositories/chunk.py:309: in search_similar
    results = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2308: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2199: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.0, 'top_k': 5}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:
tests/integration/repositories/test_repository_integration.py:338: in test_vector_similarity_search
    results = repo.search_similar(base_embedding, top_k=5)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/repositories/chunk.py:335: in search_similar
    raise DatabaseConnectionError(f"Vector search failed: {str(e)}")
E   rag_factory.repositories.exceptions.DatabaseConnectionError: Vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.0, 'top_k': 5}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
________ TestVectorSearchIntegration.test_vector_search_with_threshold _________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.SyntaxError: syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^

The above exception was the direct cause of the following exception:
rag_factory/repositories/chunk.py:309: in search_similar
    results = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2308: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2199: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.8, 'top_k': 10}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:
tests/integration/repositories/test_repository_integration.py:356: in test_vector_search_with_threshold
    results = repo.search_similar(base_embedding, top_k=10, threshold=0.8)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/repositories/chunk.py:335: in search_similar
    raise DatabaseConnectionError(f"Vector search failed: {str(e)}")
E   rag_factory.repositories.exceptions.DatabaseConnectionError: Vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.8, 'top_k': 10}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_____ TestVectorSearchIntegration.test_vector_search_with_document_filter ______
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.SyntaxError: syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^

The above exception was the direct cause of the following exception:
rag_factory/repositories/chunk.py:385: in search_similar_with_filter
    results = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2308: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2199: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND document_id IN ('2fa69dc6-eed0-4afd-89d6-fb569a7771ab')
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.0, 'top_k': 10}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:
tests/integration/repositories/test_repository_integration.py:380: in test_vector_search_with_document_filter
    results = chunk_repo.search_similar_with_filter(
rag_factory/repositories/chunk.py:409: in search_similar_with_filter
    raise DatabaseConnectionError(f"Filtered vector search failed: {str(e)}")
E   rag_factory.repositories.exceptions.DatabaseConnectionError: Filtered vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND document_id IN ('2fa69dc6-eed0-4afd-89d6-fb569a7771ab')
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.0, 'top_k': 10}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

tests/integration/repositories/test_repository_integration.py: 583 warnings
  /mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:3592: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback_on_error
  /mnt/MCPProyects/ragTools/tests/conftest.py:231: SAWarning: transaction already deassociated from connection
    transaction.rollback()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     13    85%   34, 42-45, 52, 69, 73, 77, 81, 85, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     11    74%   53, 70, 87, 103, 116-118, 136-139
rag_factory/repositories/chunk.py                                    203    130    36%   44-45, 75-76, 94-95, 131-133, 169-171, 187-202, 223, 229-231, 259-261, 288, 290, 315-332, 363, 365, 367, 390-406, 435-493, 508-518, 532-540, 556-562, 576-582, 596-606, 623-645, 658-689
rag_factory/repositories/document.py                                  93     31    67%   45-46, 67-68, 113-118, 154-156, 174, 180, 185-187, 225, 231-233, 253-255, 278-279, 292-293, 311-312
rag_factory/repositories/exceptions.py                                18      3    83%   34-36
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9090    18%
=========================== short test summary info ============================
FAILED tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_complete_document_lifecycle - rag_factory.repositories.exceptions.DuplicateEntityError: Document with content_hash=abc123 already exists
FAILED tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_document_pagination - AssertionError: assert 6 == 5
 +  where 6 = len([<Document(id=f96b74ed-c270-425b-8a39-be0566f36049, filename='test4.txt', status='pending', chunks=0)>, <Document(id=c12e5cb5-e70b-48fd-9b2f-35aad0c0ea5e, filename='test3.txt', status='pending', chunks=0)>, <Document(id=788da368-c6e2-4e0f-90c8-8740c35538f6, filename='test2.txt', status='pending', chunks=0)>, <Document(id=60c6d7a8-b2ea-4600-b164-5af26ead9be7, filename='test1.txt', status='pending', chunks=0)>, <Document(id=466163b9-0a55-46bb-afea-c14eccf6240f, filename='test0.txt', status='pending', chunks=0)>, <Document(id=d617be57-003c-4f42-84d6-147a69b968f2, filename='test.txt', status='pending', chunks=0)>])
FAILED tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_document_status_filtering - AssertionError: assert 2 == 1
 +  where 2 = len([<Document(id=d617be57-003c-4f42-84d6-147a69b968f2, filename='test.txt', status='pending', chunks=0)>, <Document(id=ba391e6a-0e5b-4293-b7f6-31951ae0c198, filename='test3.txt', status='pending', chunks=0)>])
FAILED tests/integration/repositories/test_repository_integration.py::TestChunkRepositoryIntegration::test_complete_chunk_lifecycle - ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()
FAILED tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_similarity_search - rag_factory.repositories.exceptions.DatabaseConnectionError: Vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
LINE 4:                        1 - (embedding <=> :embedding::vector...
                                                  ^

[SQL: 
                SELECT chunk_id, document_id, chunk_index, text, embedding,
                       metadata, created_at, updated_at,
                       1 - (embedding <=> :embedding::vector) as similarity
                FROM chunks
                WHERE embedding IS NOT NULL
                  AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
                ORDER BY embedding <=> :embedding::vector
                LIMIT %(top_k)s
            ]
[parameters: {'threshold': 0.0, 'top_k': 5}]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_threshold - rag_factory.repositories.exceptions.DatabaseConnectionError: Vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
LINE 4:                        1 - (embedding <=> :embedding::vector...
                                                  ^

[SQL: 
                SELECT chunk_id, document_id, chunk_index, text, embedding,
                       metadata, created_at, updated_at,
                       1 - (embedding <=> :embedding::vector) as similarity
                FROM chunks
                WHERE embedding IS NOT NULL
                  AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
                ORDER BY embedding <=> :embedding::vector
                LIMIT %(top_k)s
            ]
[parameters: {'threshold': 0.8, 'top_k': 10}]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_document_filter - rag_factory.repositories.exceptions.DatabaseConnectionError: Filtered vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
LINE 4:                        1 - (embedding <=> :embedding::vector...
                                                  ^

[SQL: 
                SELECT chunk_id, document_id, chunk_index, text, embedding,
                       metadata, created_at, updated_at,
                       1 - (embedding <=> :embedding::vector) as similarity
                FROM chunks
                WHERE embedding IS NOT NULL
                  AND document_id IN ('2fa69dc6-eed0-4afd-89d6-fb569a7771ab')
                  AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
                ORDER BY embedding <=> :embedding::vector
                LIMIT %(top_k)s
            ]
[parameters: {'threshold': 0.0, 'top_k': 10}]
(Background on this error at: https://sqlalche.me/e/20/f405)
ERROR tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_metadata_filter
ERROR tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_identical_embedding
ERROR tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback_on_error - sqlalchemy.exc.InternalError: (psycopg2.errors.DependentObjectsStillExist) cannot drop table chunks because other objects depend on it
DETAIL:  view chunk_hierarchy_validation depends on table chunks
HINT:  Use DROP ... CASCADE to drop the dependent objects too.

[SQL: 
DROP TABLE chunks]
(Background on this error at: https://sqlalche.me/e/20/2j85)
============ 7 failed, 10 passed, 587 warnings, 3 errors in 13.30s =============

[14/156] FAILED: tests/integration/services/test_embedding_integration.py
  Tests: 15 (P:0 F:14 S:1)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/integration/services/test_embedding_integration.py::test_openai_full_workflow FAILED [ 12%]
tests/integration/services/test_embedding_integration.py::test_cohere_full_workflow SKIPPED [ 25%]
tests/integration/services/test_embedding_integration.py::test_local_embedding_provider FAILED [ 37%]
tests/integration/services/test_embedding_integration.py::test_large_batch_processing FAILED [ 50%]
tests/integration/services/test_embedding_integration.py::test_concurrent_embedding_requests FAILED [ 62%]
tests/integration/services/test_embedding_integration.py::test_cache_persistence_across_batches FAILED [ 75%]
tests/integration/services/test_embedding_integration.py::test_error_handling FAILED [ 87%]
tests/integration/services/test_embedding_integration.py::test_onnx_provider_compatibility FAILED [100%]

=================================== FAILURES ===================================
__________________________ test_openai_full_workflow ___________________________
venv/lib/python3.12/site-packages/tenacity/__init__.py:480: in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
rag_factory/services/embedding/providers/openai.py:88: in get_embeddings
    response = self.client.embeddings.create(
venv/lib/python3.12/site-packages/openai/resources/embeddings.py:132: in create
    return self._post(
venv/lib/python3.12/site-packages/openai/_base_client.py:1259: in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/openai/_base_client.py:1047: in request
    raise self._make_status_error_from_response(err.response) from None
E   openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:
tests/integration/services/test_embedding_integration.py:35: in test_openai_full_workflow
    result1 = service.embed(["Hello, world!"])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/embedding/service.py:162: in embed
    batch_result = self.provider.get_embeddings(batch)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/tenacity/__init__.py:338: in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/tenacity/__init__.py:477: in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/tenacity/__init__.py:378: in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/tenacity/__init__.py:421: in exc_check
    raise retry_exc from fut.exception()
E   tenacity.RetryError: RetryError[<Future at 0x7dc9e14a4e30 state=finished raised AuthenticationError>]
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.embedding.providers.openai:openai.py:107 OpenAI embedding error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
ERROR    rag_factory.services.embedding.providers.openai:openai.py:107 OpenAI embedding error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
ERROR    rag_factory.services.embedding.providers.openai:openai.py:107 OpenAI embedding error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
ERROR    rag_factory.services.embedding.service:service.py:178 Error generating embeddings: RetryError[<Future at 0x7dc9e14a4e30 state=finished raised AuthenticationError>]
________________________ test_local_embedding_provider _________________________
tests/integration/services/test_embedding_integration.py:84: in test_local_embedding_provider
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
_________________________ test_large_batch_processing __________________________
tests/integration/services/test_embedding_integration.py:108: in test_large_batch_processing
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
______________________ test_concurrent_embedding_requests ______________________
tests/integration/services/test_embedding_integration.py:139: in test_concurrent_embedding_requests
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
____________________ test_cache_persistence_across_batches _____________________
tests/integration/services/test_embedding_integration.py:169: in test_cache_persistence_across_batches
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
_____________________________ test_error_handling ______________________________
tests/integration/services/test_embedding_integration.py:203: in test_error_handling
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
_______________________ test_onnx_provider_compatibility _______________________
tests/integration/services/test_embedding_integration.py:222: in test_onnx_provider_compatibility
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     22    49%   46-55, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29      4    86%   51, 57, 63, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     20    61%   10-20, 54, 64, 70, 93-97, 116, 143-144
rag_factory/services/embedding/rate_limiter.py                        20      3    85%   34, 50-51
rag_factory/services/embedding/service.py                            100     38    62%   88, 118, 134-136, 143-145, 163-175, 181-198, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9205    17%
=========================== short test summary info ============================
FAILED tests/integration/services/test_embedding_integration.py::test_openai_full_workflow - tenacity.RetryError: RetryError[<Future at 0x7dc9e14a4e30 state=finished raised AuthenticationError>]
FAILED tests/integration/services/test_embedding_integration.py::test_local_embedding_provider - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
FAILED tests/integration/services/test_embedding_integration.py::test_large_batch_processing - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
FAILED tests/integration/services/test_embedding_integration.py::test_concurrent_embedding_requests - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
FAILED tests/integration/services/test_embedding_integration.py::test_cache_persistence_across_batches - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
FAILED tests/integration/services/test_embedding_integration.py::test_error_handling - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
FAILED tests/integration/services/test_embedding_integration.py::test_onnx_provider_compatibility - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
================== 7 failed, 1 skipped, 2 warnings in 10.34s ===================

[15/156] PASSED: tests/integration/services/test_fine_tuned_onnx_integration.py
  Tests: 1 (P:1 F:0 S:0)
[16/156] FAILED: tests/integration/services/test_llm_integration.py
  Tests: 9 (P:0 F:2 S:7)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/integration/services/test_llm_integration.py::test_full_llm_workflow SKIPPED [ 12%]
tests/integration/services/test_llm_integration.py::test_streaming_response SKIPPED [ 25%]
tests/integration/services/test_llm_integration.py::test_local_ollama_provider SKIPPED [ 37%]
tests/integration/services/test_llm_integration.py::test_prompt_template_with_real_llm SKIPPED [ 50%]
tests/integration/services/test_llm_integration.py::test_openai_provider FAILED [ 62%]
tests/integration/services/test_llm_integration.py::test_concurrent_llm_requests SKIPPED [ 75%]
tests/integration/services/test_llm_integration.py::test_cost_tracking SKIPPED [ 87%]
tests/integration/services/test_llm_integration.py::test_token_counting SKIPPED [100%]

=================================== FAILURES ===================================
_____________________________ test_openai_provider _____________________________
tests/integration/services/test_llm_integration.py:156: in test_openai_provider
    assert response.content
E   AssertionError: assert ''
E    +  where '' = LLMResponse(content='', model='qwen3-zero-coder-reasoning-v2-0.8b-neo-ex', provider='openai', prompt_tokens=15, completion_tokens=20, total_tokens=35, cost=0.0, latency=2.020237684249878, metadata={'finish_reason': 'length'}).content
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20      3    85%   32, 50-51
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23      6    74%   46-48, 51-53
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     42    24%   22-24, 37-67, 93-122, 142-143, 157, 165, 174, 185-196
rag_factory/services/llm/providers/openai.py                          57     20    65%   56, 62, 101-105, 133-158, 189-194, 202, 210
rag_factory/services/llm/service.py                                   66     25    62%   68, 94, 127-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27      4    85%   56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9206    17%
=========================== short test summary info ============================
FAILED tests/integration/services/test_llm_integration.py::test_openai_provider - AssertionError: assert ''
 +  where '' = LLMResponse(content='', model='qwen3-zero-coder-reasoning-v2-0.8b-neo-ex', provider='openai', prompt_tokens=15, completion_tokens=20, total_tokens=35, cost=0.0, latency=2.020237684249878, metadata={'finish_reason': 'length'}).content
=================== 1 failed, 7 skipped, 2 warnings in 6.37s ===================

[17/156] PASSED: tests/integration/services/test_lm_studio_connection.py
  Tests: 2 (P:2 F:0 S:0)
[18/156] FAILED: tests/integration/services/test_onnx_embeddings_integration.py
  Tests: 11 (P:9 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 10 items

tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_embed_single_document PASSED [ 10%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_embed_multiple_documents PASSED [ 20%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_semantic_similarity PASSED [ 30%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_batch_consistency PASSED [ 40%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_empty_input PASSED [ 50%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_long_text_handling PASSED [ 60%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_special_characters PASSED [ 70%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_performance_target FAILED [ 80%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_provider_metadata PASSED [ 90%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_result_metadata PASSED [100%]

=================================== FAILURES ===================================
____________ TestONNXEmbeddingsIntegration.test_performance_target _____________
tests/integration/services/test_onnx_embeddings_integration.py:167: in test_performance_target
    assert avg_time < 0.1, f"Average time {avg_time*1000:.2f}ms exceeds 100ms target"
E   AssertionError: Average time 3447.96ms exceeds 100ms target
E   assert np.float64(3.4479624807005167) < 0.1
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     35    70%   18-19, 24-25, 92, 99, 121, 145, 150-154, 165, 177-182, 248-250, 273, 289-308
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171     81    53%   22-23, 28-29, 41, 48, 91-94, 100-101, 106-107, 123-193, 213-234, 263, 277-278, 282, 286-289, 304-306, 346, 353-356, 449-450, 464, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9169    17%
=========================== short test summary info ============================
FAILED tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_performance_target - AssertionError: Average time 3447.96ms exceeds 100ms target
assert np.float64(3.4479624807005167) < 0.1
============= 1 failed, 9 passed, 2 warnings in 161.67s (0:02:41) ==============

[19/156] FAILED: tests/integration/services/test_service_implementations.py
  Tests: 20 (P:17 F:2 S:1)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 19 items

tests/integration/services/test_service_implementations.py::TestONNXServices::test_onnx_embedding_service_implements_interface PASSED [  5%]
tests/integration/services/test_service_implementations.py::TestONNXServices::test_onnx_embedding_service_basic_functionality PASSED [ 10%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_anthropic_llm_service_implements_interface PASSED [ 15%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_anthropic_llm_service_basic_functionality PASSED [ 21%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_openai_llm_service_implements_interface PASSED [ 26%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_openai_embedding_service_implements_interface PASSED [ 31%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_cohere_reranking_service_implements_interface PASSED [ 36%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_cohere_reranking_service_basic_functionality PASSED [ 42%]
tests/integration/services/test_service_implementations.py::TestDatabaseServices::test_neo4j_graph_service_implements_interface PASSED [ 47%]
tests/integration/services/test_service_implementations.py::TestDatabaseServices::test_neo4j_graph_service_basic_functionality SKIPPED [ 52%]
tests/integration/services/test_service_implementations.py::TestDatabaseServices::test_postgresql_database_service_implements_interface PASSED [ 57%]
tests/integration/services/test_service_implementations.py::TestDatabaseServices::test_postgresql_database_service_basic_functionality FAILED [ 63%]
tests/integration/services/test_service_implementations.py::TestLocalServices::test_cosine_reranking_service_implements_interface PASSED [ 68%]
tests/integration/services/test_service_implementations.py::TestLocalServices::test_cosine_reranking_service_basic_functionality PASSED [ 73%]
tests/integration/services/test_service_implementations.py::TestInterfaceCompliance::test_all_llm_services_implement_interface PASSED [ 78%]
tests/integration/services/test_service_implementations.py::TestInterfaceCompliance::test_all_embedding_services_implement_interface PASSED [ 84%]
tests/integration/services/test_service_implementations.py::TestInterfaceCompliance::test_all_reranking_services_implement_interface PASSED [ 89%]
tests/integration/services/test_service_implementations.py::TestInterfaceCompliance::test_all_graph_services_implement_interface PASSED [ 94%]
tests/integration/services/test_service_implementations.py::TestInterfaceCompliance::test_all_database_services_implement_interface PASSED [100%]

=================================== FAILURES ===================================
__ TestDatabaseServices.test_postgresql_database_service_basic_functionality ___
tests/integration/services/test_service_implementations.py:217: in test_postgresql_database_service_basic_functionality
    await service.store_chunks(chunks)
rag_factory/services/database/postgres.py:155: in store_chunks
    pool = await self._get_pool()
           ^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/database/postgres.py:98: in _get_pool
    self._pool = await asyncpg.create_pool(
E   TypeError: object AsyncMock can't be used in 'await' expression
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     10    63%   118-141
rag_factory/services/api/cohere.py                                    30      7    77%   14-15, 50, 83, 111-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     57    37%   17-18, 73, 109-111, 115-139, 153, 157-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32      7    78%   13-14, 46, 79, 114-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29      9    69%   61, 63, 65, 93, 110-121
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9236    16%
=========================== short test summary info ============================
FAILED tests/integration/services/test_service_implementations.py::TestDatabaseServices::test_postgresql_database_service_basic_functionality - TypeError: object AsyncMock can't be used in 'await' expression
============= 1 failed, 17 passed, 1 skipped, 2 warnings in 5.76s ==============

[20/156] FAILED: tests/integration/services/test_service_integration.py
  Tests: 2 (P:0 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 2 items

tests/integration/services/test_service_integration.py::test_rag_workflow ERROR [ 50%]
tests/integration/services/test_service_integration.py::test_embedding_database_consistency FAILED [100%]

==================================== ERRORS ====================================
_____________________ ERROR at setup of test_rag_workflow ______________________
tests/integration/services/test_service_integration.py:54: in llm_service
    with patch("rag_factory.services.llm.service.AnthropicProvider") as mock_provider_cls:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'rag_factory.services.llm.service' from '/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py'> does not have the attribute 'AnthropicProvider'
=================================== FAILURES ===================================
_____________________ test_embedding_database_consistency ______________________
tests/integration/services/test_service_integration.py:158: in test_embedding_database_consistency
    await db_service.store_chunks([chunk])
rag_factory/services/database/postgres.py:157: in store_chunks
    async with pool.acquire() as conn:
E   TypeError: 'coroutine' object does not support the asynchronous context manager protocol
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

tests/integration/services/test_service_integration.py::test_embedding_database_consistency
  /mnt/MCPProyects/ragTools/rag_factory/services/database/postgres.py:157: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    async with pool.acquire() as conn:
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     56    38%   17-18, 73, 98-109, 115-139, 153, 159-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29      7    76%   43, 56-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     74    26%   88, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23      4    83%   48, 51-53
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9258    16%
=========================== short test summary info ============================
FAILED tests/integration/services/test_service_integration.py::test_embedding_database_consistency - TypeError: 'coroutine' object does not support the asynchronous context manager protocol
ERROR tests/integration/services/test_service_integration.py::test_rag_workflow - AttributeError: <module 'rag_factory.services.llm.service' from '/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py'> does not have the attribute 'AnthropicProvider'
==================== 1 failed, 3 warnings, 1 error in 5.73s ====================

[21/156] FAILED: tests/integration/strategies/test_base_integration.py
  Tests: 10 (P:0 F:10 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 5 items

tests/integration/strategies/test_base_integration.py::test_strategy_full_lifecycle FAILED [ 20%]
tests/integration/strategies/test_base_integration.py::test_multiple_strategies_implement_interface FAILED [ 40%]
tests/integration/strategies/test_base_integration.py::test_async_retrieve_works FAILED [ 60%]
tests/integration/strategies/test_base_integration.py::test_strategy_error_handling FAILED [ 80%]
tests/integration/strategies/test_base_integration.py::test_strategy_configuration_override FAILED [100%]

=================================== FAILURES ===================================
_________________________ test_strategy_full_lifecycle _________________________
tests/integration/strategies/test_base_integration.py:62: in test_strategy_full_lifecycle
    strategy = DummyStrategy()
               ^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
_________________ test_multiple_strategies_implement_interface _________________
tests/integration/strategies/test_base_integration.py:113: in test_multiple_strategies_implement_interface
    strategies = [StrategyA(), StrategyB()]
                  ^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class StrategyA without an implementation for abstract method 'requires_services'
__________________________ test_async_retrieve_works ___________________________
tests/integration/strategies/test_base_integration.py:154: in test_async_retrieve_works
    strategy = AsyncStrategy()
               ^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class AsyncStrategy without an implementation for abstract method 'requires_services'
_________________________ test_strategy_error_handling _________________________
tests/integration/strategies/test_base_integration.py:186: in test_strategy_error_handling
    strategy = ErrorStrategy()
               ^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class ErrorStrategy without an implementation for abstract method 'requires_services'
_____________________ test_strategy_configuration_override _____________________
tests/integration/strategies/test_base_integration.py:221: in test_strategy_configuration_override
    strategy = ConfigurableStrategy()
               ^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class ConfigurableStrategy without an implementation for abstract method 'requires_services'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9295    16%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_base_integration.py::test_strategy_full_lifecycle - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_base_integration.py::test_multiple_strategies_implement_interface - TypeError: Can't instantiate abstract class StrategyA without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_base_integration.py::test_async_retrieve_works - TypeError: Can't instantiate abstract class AsyncStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_base_integration.py::test_strategy_error_handling - TypeError: Can't instantiate abstract class ErrorStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_base_integration.py::test_strategy_configuration_override - TypeError: Can't instantiate abstract class ConfigurableStrategy without an implementation for abstract method 'requires_services'
======================== 5 failed, 2 warnings in 3.84s =========================

[22/156] PASSED: tests/integration/strategies/test_chunking_integration.py
  Tests: 12 (P:12 F:0 S:0)
[23/156] FAILED: tests/integration/strategies/test_contextual_integration.py
  Tests: 12 (P:0 F:12 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 6 items

tests/integration/strategies/test_contextual_integration.py::test_contextual_retrieval_complete_workflow FAILED [ 16%]
tests/integration/strategies/test_contextual_integration.py::test_cost_tracking_accuracy FAILED [ 33%]
tests/integration/strategies/test_contextual_integration.py::test_retrieval_with_different_formats FAILED [ 50%]
tests/integration/strategies/test_contextual_integration.py::test_error_recovery FAILED [ 66%]
tests/integration/strategies/test_contextual_integration.py::test_synchronous_indexing FAILED [ 83%]
tests/integration/strategies/test_contextual_integration.py::test_large_document_processing FAILED [100%]

=================================== FAILURES ===================================
_________________ test_contextual_retrieval_complete_workflow __________________
tests/integration/strategies/test_contextual_integration.py:85: in test_contextual_retrieval_complete_workflow
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
_________________________ test_cost_tracking_accuracy __________________________
tests/integration/strategies/test_contextual_integration.py:142: in test_cost_tracking_accuracy
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
____________________ test_retrieval_with_different_formats _____________________
tests/integration/strategies/test_contextual_integration.py:181: in test_retrieval_with_different_formats
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
_____________________________ test_error_recovery ______________________________
tests/integration/strategies/test_contextual_integration.py:222: in test_error_recovery
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
__________________________ test_synchronous_indexing ___________________________
tests/integration/strategies/test_contextual_integration.py:247: in test_synchronous_indexing
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
________________________ test_large_document_processing ________________________
tests/integration/strategies/test_contextual_integration.py:282: in test_large_document_processing
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  86     71    17%   41-43, 60-73, 85-91, 109-129, 146-162, 179-200, 217-257
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         63     39    38%   51-64, 72, 93-140, 157, 170, 191-199, 215-242, 247, 252, 261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9161    17%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_contextual_integration.py::test_contextual_retrieval_complete_workflow - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
FAILED tests/integration/strategies/test_contextual_integration.py::test_cost_tracking_accuracy - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
FAILED tests/integration/strategies/test_contextual_integration.py::test_retrieval_with_different_formats - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
FAILED tests/integration/strategies/test_contextual_integration.py::test_error_recovery - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
FAILED tests/integration/strategies/test_contextual_integration.py::test_synchronous_indexing - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
FAILED tests/integration/strategies/test_contextual_integration.py::test_large_document_processing - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
======================== 6 failed, 3 warnings in 4.62s =========================

[24/156] PASSED: tests/integration/strategies/test_hierarchical_indexing.py
  Tests: 14 (P:14 F:0 S:0)
[25/156] FAILED: tests/integration/strategies/test_hierarchical_integration.py
  Tests: 8 (P:0 F:8 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 4 items

tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_end_to_end_workflow FAILED [ 25%]
tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_expansion_strategy_comparison FAILED [ 50%]
tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_hierarchy_validation FAILED [ 75%]
tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_multiple_documents FAILED [100%]

=================================== FAILURES ===================================
_____________ TestHierarchicalIntegration.test_end_to_end_workflow _____________
tests/integration/strategies/test_hierarchical_integration.py:92: in test_end_to_end_workflow
    strategy = HierarchicalRAGStrategy(
E   TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
________ TestHierarchicalIntegration.test_expansion_strategy_comparison ________
tests/integration/strategies/test_hierarchical_integration.py:128: in test_expansion_strategy_comparison
    strategy = HierarchicalRAGStrategy(
E   TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
____________ TestHierarchicalIntegration.test_hierarchy_validation _____________
tests/integration/strategies/test_hierarchical_integration.py:165: in test_hierarchy_validation
    strategy = HierarchicalRAGStrategy(
E   TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
_____________ TestHierarchicalIntegration.test_multiple_documents ______________
tests/integration/strategies/test_hierarchical_integration.py:181: in test_multiple_documents
    strategy = HierarchicalRAGStrategy(
E   TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      0   100%
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     65    18%   35-36, 49-75, 92-93, 113-149, 167-201, 220, 249-281, 310-335
rag_factory/strategies/hierarchical/models.py                         58      0   100%
rag_factory/strategies/hierarchical/parent_retriever.py               89     77    13%   38-40, 56-92, 103-113, 130-149, 166-196, 213-227, 250-257, 268-278
rag_factory/strategies/hierarchical/strategy.py                       63     48    24%   45-70, 83, 94-126, 144-152, 180-214, 228, 242-243, 259-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9191    17%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_end_to_end_workflow - TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_expansion_strategy_comparison - TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_hierarchy_validation - TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_multiple_documents - TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
======================== 4 failed, 2 warnings in 4.21s =========================

[26/156] PASSED: tests/integration/strategies/test_in_memory_indexing.py
  Tests: 12 (P:12 F:0 S:0)
[27/156] FAILED: tests/integration/strategies/test_keyword_indexing.py
  Tests: 0 (P:0 F:0 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 6 items

tests/integration/strategies/test_keyword_indexing.py::test_capabilities ERROR [ 16%]
tests/integration/strategies/test_keyword_indexing.py::test_dependencies ERROR [ 33%]
tests/integration/strategies/test_keyword_indexing.py::test_process_success ERROR [ 50%]
tests/integration/strategies/test_keyword_indexing.py::test_process_no_chunks ERROR [ 66%]
tests/integration/strategies/test_keyword_indexing.py::test_process_empty_text ERROR [ 83%]
tests/integration/strategies/test_keyword_indexing.py::test_process_stop_words_only ERROR [100%]

==================================== ERRORS ====================================
_____________________ ERROR at setup of test_capabilities ______________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
_____________________ ERROR at setup of test_dependencies ______________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
____________________ ERROR at setup of test_process_success ____________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
___________________ ERROR at setup of test_process_no_chunks ___________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
__________________ ERROR at setup of test_process_empty_text ___________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
________________ ERROR at setup of test_process_stop_words_only ________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     31    22%   40, 51, 75-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9286    16%
=========================== short test summary info ============================
ERROR tests/integration/strategies/test_keyword_indexing.py::test_capabilities - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
ERROR tests/integration/strategies/test_keyword_indexing.py::test_dependencies - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
ERROR tests/integration/strategies/test_keyword_indexing.py::test_process_success - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
ERROR tests/integration/strategies/test_keyword_indexing.py::test_process_no_chunks - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
ERROR tests/integration/strategies/test_keyword_indexing.py::test_process_empty_text - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
ERROR tests/integration/strategies/test_keyword_indexing.py::test_process_stop_words_only - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
======================== 2 warnings, 6 errors in 9.46s =========================

[1/156] PASSED: tests/benchmarks/test_contextual_performance.py
  Tests: 6 (P:6 F:0 S:0)
[2/156] FAILED: tests/benchmarks/test_late_chunking_performance.py
  Tests: 14 (P:2 F:12 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/benchmarks/test_late_chunking_performance.py::test_document_embedding_speed FAILED [ 12%]
tests/benchmarks/test_late_chunking_performance.py::test_embedding_chunking_speed FAILED [ 25%]
tests/benchmarks/test_late_chunking_performance.py::test_semantic_boundary_speed FAILED [ 37%]
tests/benchmarks/test_late_chunking_performance.py::test_end_to_end_latency FAILED [ 50%]
tests/benchmarks/test_late_chunking_performance.py::test_coherence_analysis_overhead PASSED [ 62%]
tests/benchmarks/test_late_chunking_performance.py::test_batch_processing_speed PASSED [ 75%]
tests/benchmarks/test_late_chunking_performance.py::test_adaptive_chunking_speed FAILED [ 87%]
tests/benchmarks/test_late_chunking_performance.py::test_memory_efficiency FAILED [100%]

=================================== FAILURES ===================================
________________________ test_document_embedding_speed _________________________
tests/benchmarks/test_late_chunking_performance.py:51: in test_document_embedding_speed
    doc_emb = strategy.document_embedder.embed_document(document, "perf_test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 17:57:53.903904597 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513][m
________________________ test_embedding_chunking_speed _________________________
tests/benchmarks/test_late_chunking_performance.py:72: in test_embedding_chunking_speed
    doc_emb = strategy.document_embedder.embed_document(document, "perf_test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 17:57:56.952094022 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526][m
_________________________ test_semantic_boundary_speed _________________________
tests/benchmarks/test_late_chunking_performance.py:97: in test_semantic_boundary_speed
    doc_emb = strategy.document_embedder.embed_document(document, "perf_test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 17:58:26.862332816 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513][m
___________________________ test_end_to_end_latency ____________________________
tests/benchmarks/test_late_chunking_performance.py:126: in test_end_to_end_latency
    assert duration < 10.0, f"Too slow: {duration:.2f}s"
E   AssertionError: Too slow: 16.18s
E   assert 16.177143812179565 < 10.0
----------------------------- Captured stdout call -----------------------------

End-to-end late chunking: 16.177s
_________________________ test_adaptive_chunking_speed _________________________
tests/benchmarks/test_late_chunking_performance.py:205: in test_adaptive_chunking_speed
    doc_emb = strategy.document_embedder.embed_document(document, "perf_test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 17:59:08.889770479 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526][m
____________________________ test_memory_efficiency ____________________________
tests/benchmarks/test_late_chunking_performance.py:230: in test_memory_efficiency
    doc_emb = strategy.document_embedder.embed_document(document, "memory_test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 17:59:12.673339618 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513][m
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

tests/benchmarks/test_late_chunking_performance.py:37
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:37: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:58
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:58: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:83
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:83: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:107
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:107: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:129
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:129: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:165
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:165: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:190
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:190: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_late_chunking_performance.py:215
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_late_chunking_performance.py:215: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    104    39%   22-23, 28-29, 41, 48, 94, 106-107, 123-193, 213-234, 263, 277-278, 282, 286-289, 304-306, 328-362, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27      5    81%   59, 82-96
rag_factory/strategies/late_chunking/document_embedder.py             88     33    62%   36, 81-85, 123, 196-204, 225-248, 265-272
rag_factory/strategies/late_chunking/embedding_chunker.py            112     57    49%   49, 52-57, 68-98, 121-131, 164, 177-178, 185-240, 284
rag_factory/strategies/late_chunking/models.py                        63      0   100%
rag_factory/strategies/late_chunking/strategy.py                      49      8    84%   48, 124-133, 138, 143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     57    40%   39-40, 53-64, 93-94, 100-101, 105-114, 129, 144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   8991    19%
=========================== short test summary info ============================
FAILED tests/benchmarks/test_late_chunking_performance.py::test_document_embedding_speed - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
FAILED tests/benchmarks/test_late_chunking_performance.py::test_embedding_chunking_speed - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526]
FAILED tests/benchmarks/test_late_chunking_performance.py::test_semantic_boundary_speed - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
FAILED tests/benchmarks/test_late_chunking_performance.py::test_end_to_end_latency - AssertionError: Too slow: 16.18s
assert 16.177143812179565 < 10.0
FAILED tests/benchmarks/test_late_chunking_performance.py::test_adaptive_chunking_speed - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=85664 must be within the inclusive range [-30527,30526]
FAILED tests/benchmarks/test_late_chunking_performance.py::test_memory_efficiency - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/position_embeddings/Gather' Status Message: indices element out of data bounds, idx=514 must be within the inclusive range [-514,513]
============= 6 failed, 2 passed, 13 warnings in 87.37s (0:01:27) ==============

[3/156] FAILED: tests/benchmarks/test_model_comparison_performance.py
  Tests: 12 (P:0 F:12 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 6 items

tests/benchmarks/test_model_comparison_performance.py::test_model_loading_speed FAILED [ 16%]
tests/benchmarks/test_model_comparison_performance.py::test_model_loading_cached FAILED [ 33%]
tests/benchmarks/test_model_comparison_performance.py::test_inference_speed FAILED [ 50%]
tests/benchmarks/test_model_comparison_performance.py::test_batch_size_comparison FAILED [ 66%]
tests/benchmarks/test_model_comparison_performance.py::test_embedding_quality FAILED [ 83%]
tests/benchmarks/test_model_comparison_performance.py::test_memory_efficiency FAILED [100%]

=================================== FAILURES ===================================
___________________________ test_model_loading_speed ___________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:23: in test_model_loading_speed
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
__________________________ test_model_loading_cached ___________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:45: in test_model_loading_cached
    loader.load_model(config)
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
_____________________________ test_inference_speed _____________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:71: in test_inference_speed
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
__________________________ test_batch_size_comparison __________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:110: in test_batch_size_comparison
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
____________________________ test_embedding_quality ____________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:138: in test_embedding_quality
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
____________________________ test_memory_efficiency ____________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/benchmarks/test_model_comparison_performance.py:181: in test_memory_efficiency
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

tests/benchmarks/test_model_comparison_performance.py:8
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:8: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_model_comparison_performance.py:30
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:30: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_model_comparison_performance.py:56
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:56: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_model_comparison_performance.py:93
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:93: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_model_comparison_performance.py:126
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:126: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

tests/benchmarks/test_model_comparison_performance.py:168
  /mnt/MCPProyects/ragTools/tests/benchmarks/test_model_comparison_performance.py:168: PytestUnknownMarkWarning: Unknown pytest.mark.benchmark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.benchmark

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      0   100%
rag_factory/models/embedding/__init__.py                               4      0   100%
rag_factory/models/embedding/loader.py                               179    140    22%   8, 16-18, 23-25, 65-66, 70-80, 85-88, 94-97, 109-114, 118-135, 139-166, 175-191, 200-235, 244-313, 322-341, 350-367
rag_factory/models/embedding/models.py                                47      0   100%
rag_factory/models/embedding/registry.py                             128    110    14%   30-34, 38-61, 65-76, 88-100, 112-125, 145-164, 176-192, 210-220, 231-241, 252-263, 273-282
rag_factory/models/evaluation/__init__.py                              3      0   100%
rag_factory/models/evaluation/ab_testing.py                           97     80    18%   10-12, 33-34, 42-45, 56-60, 77-88, 106-216, 234-257, 273-279
rag_factory/models/evaluation/models.py                               29      0   100%
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9132    17%
=========================== short test summary info ============================
FAILED tests/benchmarks/test_model_comparison_performance.py::test_model_loading_speed - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/benchmarks/test_model_comparison_performance.py::test_model_loading_cached - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/benchmarks/test_model_comparison_performance.py::test_inference_speed - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/benchmarks/test_model_comparison_performance.py::test_batch_size_comparison - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/benchmarks/test_model_comparison_performance.py::test_embedding_quality - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/benchmarks/test_model_comparison_performance.py::test_memory_efficiency - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
======================== 6 failed, 8 warnings in 9.07s =========================

[4/156] PASSED: tests/integration/cli/test_benchmark_integration.py
  Tests: 1 (P:1 F:0 S:0)
[5/156] PASSED: tests/integration/cli/test_config_validation_integration.py
  Tests: 2 (P:2 F:0 S:0)
[6/156] PASSED: tests/integration/cli/test_index_query_flow.py
  Tests: 11 (P:11 F:0 S:0)
[7/156] PASSED: tests/integration/database/test_database_integration.py
  Tests: 14 (P:13 F:0 S:1)
[8/156] PASSED: tests/integration/database/test_migration_integration.py
  Tests: 4 (P:4 F:0 S:0)
[9/156] ALL_SKIPPED: tests/integration/documentation/test_documentation_integration.py
  Tests: 6 (P:0 F:0 S:6)
[10/156] PASSED: tests/integration/evaluation/test_evaluation_integration.py
  Tests: 7 (P:7 F:0 S:0)
[11/156] FAILED: tests/integration/models/test_fine_tuned_embeddings_integration.py
  Tests: 7 (P:3 F:4 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 5 items

tests/integration/models/test_fine_tuned_embeddings_integration.py::test_register_and_load_model FAILED [ 20%]
tests/integration/models/test_fine_tuned_embeddings_integration.py::test_ab_testing_workflow PASSED [ 40%]
tests/integration/models/test_fine_tuned_embeddings_integration.py::test_model_registry_persistence_workflow PASSED [ 60%]
tests/integration/models/test_fine_tuned_embeddings_integration.py::test_model_comparison_workflow FAILED [ 80%]
tests/integration/models/test_fine_tuned_embeddings_integration.py::test_multiple_models_registry PASSED [100%]

=================================== FAILURES ===================================
_________________________ test_register_and_load_model _________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/integration/models/test_fine_tuned_embeddings_integration.py:45: in test_register_and_load_model
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
________________________ test_model_comparison_workflow ________________________
rag_factory/models/embedding/loader.py:102: in _load_sentence_transformer
    from sentence_transformers import SentenceTransformer
E   ModuleNotFoundError: No module named 'sentence_transformers'

During handling of the above exception, another exception occurred:
tests/integration/models/test_fine_tuned_embeddings_integration.py:182: in test_model_comparison_workflow
    model = loader.load_model(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:82: in load_model
    model = self._load_fallback(config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:93: in _load_fallback
    return self._load_sentence_transformer(config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/models/embedding/loader.py:104: in _load_sentence_transformer
    raise ImportError(
E   ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      0   100%
rag_factory/models/embedding/__init__.py                               4      0   100%
rag_factory/models/embedding/loader.py                               179    140    22%   8, 16-18, 23-25, 65-66, 70-80, 85-88, 94-97, 109-114, 118-135, 139-166, 175-191, 200-235, 244-313, 322-341, 350-367
rag_factory/models/embedding/models.py                                47      0   100%
rag_factory/models/embedding/registry.py                             128     36    72%   47-50, 57-59, 75-76, 97, 113, 117, 120, 153, 159, 177, 180-187, 212, 253, 259, 263, 273-282
rag_factory/models/evaluation/__init__.py                              3      0   100%
rag_factory/models/evaluation/ab_testing.py                           97     18    81%   10-12, 57, 78-79, 107, 115, 127, 187, 240, 253, 255, 273-279
rag_factory/models/evaluation/models.py                               29      0   100%
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   8996    19%
=========================== short test summary info ============================
FAILED tests/integration/models/test_fine_tuned_embeddings_integration.py::test_register_and_load_model - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
FAILED tests/integration/models/test_fine_tuned_embeddings_integration.py::test_model_comparison_workflow - ImportError: sentence-transformers is required for SENTENCE_TRANSFORMERS format. Install with: pip install sentence-transformers
=================== 2 failed, 3 passed, 2 warnings in 8.21s ====================

[12/156] PASSED: tests/integration/observability/test_monitoring_integration.py
  Tests: 11 (P:11 F:0 S:0)
[13/156] FAILED: tests/integration/repositories/test_repository_integration.py
  Tests: 24 (P:10 F:14 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 19 items

tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_complete_document_lifecycle FAILED [  5%]
tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_document_deduplication PASSED [ 10%]
tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_document_pagination FAILED [ 15%]
tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_document_status_filtering FAILED [ 21%]
tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_bulk_operations PASSED [ 26%]
tests/integration/repositories/test_repository_integration.py::TestChunkRepositoryIntegration::test_complete_chunk_lifecycle FAILED [ 31%]
tests/integration/repositories/test_repository_integration.py::TestChunkRepositoryIntegration::test_chunk_document_relationship PASSED [ 36%]
tests/integration/repositories/test_repository_integration.py::TestChunkRepositoryIntegration::test_cascade_delete PASSED [ 42%]
tests/integration/repositories/test_repository_integration.py::TestChunkRepositoryIntegration::test_bulk_chunk_operations PASSED [ 47%]
tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_similarity_search FAILED [ 52%]
tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_threshold FAILED [ 57%]
tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_document_filter FAILED [ 63%]
tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_metadata_filter ERROR [ 68%]
tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_identical_embedding ERROR [ 73%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_commit PASSED [ 78%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback PASSED [ 84%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_multiple_operations_in_transaction PASSED [ 89%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_context_manager PASSED [ 94%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback_on_error PASSED [100%]
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback_on_error ERROR [100%]

==================================== ERRORS ====================================
_ ERROR at setup of TestVectorSearchIntegration.test_vector_search_with_metadata_filter _
file /mnt/MCPProyects/ragTools/tests/integration/repositories/test_repository_integration.py, line 391
      def test_vector_search_with_metadata_filter(self, db_session, document):
E       fixture 'document' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, clean_database, cov, db_config, db_connection, db_engine, db_service, db_session, doctest_namespace, document_with_chunks, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, no_cover, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, subtests, test_db_config, test_db_url, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/mnt/MCPProyects/ragTools/tests/integration/repositories/test_repository_integration.py:391
_ ERROR at setup of TestVectorSearchIntegration.test_vector_search_identical_embedding _
file /mnt/MCPProyects/ragTools/tests/integration/repositories/test_repository_integration.py, line 421
      def test_vector_search_identical_embedding(self, db_session, document):
E       fixture 'document' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, clean_database, cov, db_config, db_connection, db_engine, db_service, db_session, doctest_namespace, document_with_chunks, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, no_cover, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, subtests, test_db_config, test_db_url, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/mnt/MCPProyects/ragTools/tests/integration/repositories/test_repository_integration.py:421
_ ERROR at teardown of TestRepositoryTransactions.test_transaction_rollback_on_error _
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.DependentObjectsStillExist: cannot drop table chunks because other objects depend on it
E   DETAIL:  view chunk_hierarchy_validation depends on table chunks
E   HINT:  Use DROP ... CASCADE to drop the dependent objects too.

The above exception was the direct cause of the following exception:
tests/conftest.py:138: in db_engine
    Base.metadata.drop_all(engine)
venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5856: in drop_all
    bind._run_ddl_visitor(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:1075: in visit_metadata
    self.traverse_single(
venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:1142: in visit_table
    DropTable(table)._invoke_with(self.connection)
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:315: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.InternalError: (psycopg2.errors.DependentObjectsStillExist) cannot drop table chunks because other objects depend on it
E   DETAIL:  view chunk_hierarchy_validation depends on table chunks
E   HINT:  Use DROP ... CASCADE to drop the dependent objects too.
E   
E   [SQL: 
E   DROP TABLE chunks]
E   (Background on this error at: https://sqlalche.me/e/20/2j85)
=================================== FAILURES ===================================
______ TestDocumentRepositoryIntegration.test_complete_document_lifecycle ______
tests/integration/repositories/test_repository_integration.py:29: in test_complete_document_lifecycle
    doc = repo.create(
rag_factory/repositories/document.py:100: in create
    raise DuplicateEntityError("Document", "content_hash", content_hash)
E   rag_factory.repositories.exceptions.DuplicateEntityError: Document with content_hash=abc123 already exists
__________ TestDocumentRepositoryIntegration.test_document_pagination __________
tests/integration/repositories/test_repository_integration.py:94: in test_document_pagination
    assert len(page2) == 5
E   AssertionError: assert 6 == 5
E    +  where 6 = len([<Document(id=9e403d29-ae75-4e41-9f5b-39fa110b97c7, filename='test4.txt', status='pending', chunks=0)>, <Document(id=9bfe91a9-ade9-47d4-b8ec-27c3203b7217, filename='test3.txt', status='pending', chunks=0)>, <Document(id=0810ad52-5c8d-47ff-91d6-6113923ca208, filename='test2.txt', status='pending', chunks=0)>, <Document(id=4850ea73-1f72-4121-a300-16bcc9adf177, filename='test1.txt', status='pending', chunks=0)>, <Document(id=8c1f2f38-875e-41b0-a687-2751cbd60e15, filename='test0.txt', status='pending', chunks=0)>, <Document(id=3851962a-88a5-4a52-bdfd-fbbd7ab8f21c, filename='test.txt', status='pending', chunks=0)>])
_______ TestDocumentRepositoryIntegration.test_document_status_filtering _______
tests/integration/repositories/test_repository_integration.py:121: in test_document_status_filtering
    assert len(pending) == 1
E   AssertionError: assert 2 == 1
E    +  where 2 = len([<Document(id=3851962a-88a5-4a52-bdfd-fbbd7ab8f21c, filename='test.txt', status='pending', chunks=0)>, <Document(id=f3149e96-65c0-470e-9c55-7a1d2f8b2774, filename='test3.txt', status='pending', chunks=0)>])
_________ TestChunkRepositoryIntegration.test_complete_chunk_lifecycle _________
tests/integration/repositories/test_repository_integration.py:196: in test_complete_chunk_lifecycle
    assert retrieved.embedding == new_embedding
E   ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()
__________ TestVectorSearchIntegration.test_vector_similarity_search ___________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.SyntaxError: syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^

The above exception was the direct cause of the following exception:
rag_factory/repositories/chunk.py:309: in search_similar
    results = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2308: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2199: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.0, 'top_k': 5}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:
tests/integration/repositories/test_repository_integration.py:338: in test_vector_similarity_search
    results = repo.search_similar(base_embedding, top_k=5)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/repositories/chunk.py:335: in search_similar
    raise DatabaseConnectionError(f"Vector search failed: {str(e)}")
E   rag_factory.repositories.exceptions.DatabaseConnectionError: Vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.0, 'top_k': 5}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
________ TestVectorSearchIntegration.test_vector_search_with_threshold _________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.SyntaxError: syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^

The above exception was the direct cause of the following exception:
rag_factory/repositories/chunk.py:309: in search_similar
    results = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2308: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2199: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.8, 'top_k': 10}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:
tests/integration/repositories/test_repository_integration.py:356: in test_vector_search_with_threshold
    results = repo.search_similar(base_embedding, top_k=10, threshold=0.8)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/repositories/chunk.py:335: in search_similar
    raise DatabaseConnectionError(f"Vector search failed: {str(e)}")
E   rag_factory.repositories.exceptions.DatabaseConnectionError: Vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.8, 'top_k': 10}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
_____ TestVectorSearchIntegration.test_vector_search_with_document_filter ______
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.SyntaxError: syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^

The above exception was the direct cause of the following exception:
rag_factory/repositories/chunk.py:385: in search_similar_with_filter
    results = self.session.execute(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2308: in execute
    return self._execute_internal(
venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2199: in _execute_internal
    result = conn.execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND document_id IN ('73dc58e4-984d-4f70-8afc-50cb95eaf4e0')
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.0, 'top_k': 10}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:
tests/integration/repositories/test_repository_integration.py:380: in test_vector_search_with_document_filter
    results = chunk_repo.search_similar_with_filter(
rag_factory/repositories/chunk.py:409: in search_similar_with_filter
    raise DatabaseConnectionError(f"Filtered vector search failed: {str(e)}")
E   rag_factory.repositories.exceptions.DatabaseConnectionError: Filtered vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
E   LINE 4:                        1 - (embedding <=> :embedding::vector...
E                                                     ^
E   
E   [SQL: 
E                   SELECT chunk_id, document_id, chunk_index, text, embedding,
E                          metadata, created_at, updated_at,
E                          1 - (embedding <=> :embedding::vector) as similarity
E                   FROM chunks
E                   WHERE embedding IS NOT NULL
E                     AND document_id IN ('73dc58e4-984d-4f70-8afc-50cb95eaf4e0')
E                     AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
E                   ORDER BY embedding <=> :embedding::vector
E                   LIMIT %(top_k)s
E               ]
E   [parameters: {'threshold': 0.0, 'top_k': 10}]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

tests/integration/repositories/test_repository_integration.py: 583 warnings
  /mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:3592: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback
tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback_on_error
  /mnt/MCPProyects/ragTools/tests/conftest.py:231: SAWarning: transaction already deassociated from connection
    transaction.rollback()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     13    85%   34, 42-45, 52, 69, 73, 77, 81, 85, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     11    74%   53, 70, 87, 103, 116-118, 136-139
rag_factory/repositories/chunk.py                                    203    130    36%   44-45, 75-76, 94-95, 131-133, 169-171, 187-202, 223, 229-231, 259-261, 288, 290, 315-332, 363, 365, 367, 390-406, 435-493, 508-518, 532-540, 556-562, 576-582, 596-606, 623-645, 658-689
rag_factory/repositories/document.py                                  93     31    67%   45-46, 67-68, 113-118, 154-156, 174, 180, 185-187, 225, 231-233, 253-255, 278-279, 292-293, 311-312
rag_factory/repositories/exceptions.py                                18      3    83%   34-36
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9090    18%
=========================== short test summary info ============================
FAILED tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_complete_document_lifecycle - rag_factory.repositories.exceptions.DuplicateEntityError: Document with content_hash=abc123 already exists
FAILED tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_document_pagination - AssertionError: assert 6 == 5
 +  where 6 = len([<Document(id=9e403d29-ae75-4e41-9f5b-39fa110b97c7, filename='test4.txt', status='pending', chunks=0)>, <Document(id=9bfe91a9-ade9-47d4-b8ec-27c3203b7217, filename='test3.txt', status='pending', chunks=0)>, <Document(id=0810ad52-5c8d-47ff-91d6-6113923ca208, filename='test2.txt', status='pending', chunks=0)>, <Document(id=4850ea73-1f72-4121-a300-16bcc9adf177, filename='test1.txt', status='pending', chunks=0)>, <Document(id=8c1f2f38-875e-41b0-a687-2751cbd60e15, filename='test0.txt', status='pending', chunks=0)>, <Document(id=3851962a-88a5-4a52-bdfd-fbbd7ab8f21c, filename='test.txt', status='pending', chunks=0)>])
FAILED tests/integration/repositories/test_repository_integration.py::TestDocumentRepositoryIntegration::test_document_status_filtering - AssertionError: assert 2 == 1
 +  where 2 = len([<Document(id=3851962a-88a5-4a52-bdfd-fbbd7ab8f21c, filename='test.txt', status='pending', chunks=0)>, <Document(id=f3149e96-65c0-470e-9c55-7a1d2f8b2774, filename='test3.txt', status='pending', chunks=0)>])
FAILED tests/integration/repositories/test_repository_integration.py::TestChunkRepositoryIntegration::test_complete_chunk_lifecycle - ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()
FAILED tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_similarity_search - rag_factory.repositories.exceptions.DatabaseConnectionError: Vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
LINE 4:                        1 - (embedding <=> :embedding::vector...
                                                  ^

[SQL: 
                SELECT chunk_id, document_id, chunk_index, text, embedding,
                       metadata, created_at, updated_at,
                       1 - (embedding <=> :embedding::vector) as similarity
                FROM chunks
                WHERE embedding IS NOT NULL
                  AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
                ORDER BY embedding <=> :embedding::vector
                LIMIT %(top_k)s
            ]
[parameters: {'threshold': 0.0, 'top_k': 5}]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_threshold - rag_factory.repositories.exceptions.DatabaseConnectionError: Vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
LINE 4:                        1 - (embedding <=> :embedding::vector...
                                                  ^

[SQL: 
                SELECT chunk_id, document_id, chunk_index, text, embedding,
                       metadata, created_at, updated_at,
                       1 - (embedding <=> :embedding::vector) as similarity
                FROM chunks
                WHERE embedding IS NOT NULL
                  AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
                ORDER BY embedding <=> :embedding::vector
                LIMIT %(top_k)s
            ]
[parameters: {'threshold': 0.8, 'top_k': 10}]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_document_filter - rag_factory.repositories.exceptions.DatabaseConnectionError: Filtered vector search failed: (psycopg2.errors.SyntaxError) syntax error at or near ":"
LINE 4:                        1 - (embedding <=> :embedding::vector...
                                                  ^

[SQL: 
                SELECT chunk_id, document_id, chunk_index, text, embedding,
                       metadata, created_at, updated_at,
                       1 - (embedding <=> :embedding::vector) as similarity
                FROM chunks
                WHERE embedding IS NOT NULL
                  AND document_id IN ('73dc58e4-984d-4f70-8afc-50cb95eaf4e0')
                  AND 1 - (embedding <=> :embedding::vector) >= %(threshold)s
                ORDER BY embedding <=> :embedding::vector
                LIMIT %(top_k)s
            ]
[parameters: {'threshold': 0.0, 'top_k': 10}]
(Background on this error at: https://sqlalche.me/e/20/f405)
ERROR tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_with_metadata_filter
ERROR tests/integration/repositories/test_repository_integration.py::TestVectorSearchIntegration::test_vector_search_identical_embedding
ERROR tests/integration/repositories/test_repository_integration.py::TestRepositoryTransactions::test_transaction_rollback_on_error - sqlalchemy.exc.InternalError: (psycopg2.errors.DependentObjectsStillExist) cannot drop table chunks because other objects depend on it
DETAIL:  view chunk_hierarchy_validation depends on table chunks
HINT:  Use DROP ... CASCADE to drop the dependent objects too.

[SQL: 
DROP TABLE chunks]
(Background on this error at: https://sqlalche.me/e/20/2j85)
============ 7 failed, 10 passed, 587 warnings, 3 errors in 13.35s =============

[14/156] FAILED: tests/integration/services/test_embedding_integration.py
  Tests: 15 (P:0 F:14 S:1)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/integration/services/test_embedding_integration.py::test_openai_full_workflow FAILED [ 12%]
tests/integration/services/test_embedding_integration.py::test_cohere_full_workflow SKIPPED [ 25%]
tests/integration/services/test_embedding_integration.py::test_local_embedding_provider FAILED [ 37%]
tests/integration/services/test_embedding_integration.py::test_large_batch_processing FAILED [ 50%]
tests/integration/services/test_embedding_integration.py::test_concurrent_embedding_requests FAILED [ 62%]
tests/integration/services/test_embedding_integration.py::test_cache_persistence_across_batches FAILED [ 75%]
tests/integration/services/test_embedding_integration.py::test_error_handling FAILED [ 87%]
tests/integration/services/test_embedding_integration.py::test_onnx_provider_compatibility FAILED [100%]

=================================== FAILURES ===================================
__________________________ test_openai_full_workflow ___________________________
venv/lib/python3.12/site-packages/tenacity/__init__.py:480: in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
rag_factory/services/embedding/providers/openai.py:88: in get_embeddings
    response = self.client.embeddings.create(
venv/lib/python3.12/site-packages/openai/resources/embeddings.py:132: in create
    return self._post(
venv/lib/python3.12/site-packages/openai/_base_client.py:1259: in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/openai/_base_client.py:1047: in request
    raise self._make_status_error_from_response(err.response) from None
E   openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:
tests/integration/services/test_embedding_integration.py:35: in test_openai_full_workflow
    result1 = service.embed(["Hello, world!"])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/embedding/service.py:162: in embed
    batch_result = self.provider.get_embeddings(batch)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/tenacity/__init__.py:338: in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/tenacity/__init__.py:477: in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/tenacity/__init__.py:378: in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/tenacity/__init__.py:421: in exc_check
    raise retry_exc from fut.exception()
E   tenacity.RetryError: RetryError[<Future at 0x770867c9cdd0 state=finished raised AuthenticationError>]
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.embedding.providers.openai:openai.py:107 OpenAI embedding error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
ERROR    rag_factory.services.embedding.providers.openai:openai.py:107 OpenAI embedding error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
ERROR    rag_factory.services.embedding.providers.openai:openai.py:107 OpenAI embedding error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
ERROR    rag_factory.services.embedding.service:service.py:178 Error generating embeddings: RetryError[<Future at 0x770867c9cdd0 state=finished raised AuthenticationError>]
________________________ test_local_embedding_provider _________________________
tests/integration/services/test_embedding_integration.py:84: in test_local_embedding_provider
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
_________________________ test_large_batch_processing __________________________
tests/integration/services/test_embedding_integration.py:108: in test_large_batch_processing
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
______________________ test_concurrent_embedding_requests ______________________
tests/integration/services/test_embedding_integration.py:139: in test_concurrent_embedding_requests
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
____________________ test_cache_persistence_across_batches _____________________
tests/integration/services/test_embedding_integration.py:169: in test_cache_persistence_across_batches
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
_____________________________ test_error_handling ______________________________
tests/integration/services/test_embedding_integration.py:203: in test_error_handling
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
_______________________ test_onnx_provider_compatibility _______________________
tests/integration/services/test_embedding_integration.py:222: in test_onnx_provider_compatibility
    config = EmbeddingServiceConfig(
<string>:10: in __init__
    ???
rag_factory/services/embedding/config.py:43: in __post_init__
    raise ValueError(
E   ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     22    49%   46-55, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29      4    86%   51, 57, 63, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     20    61%   10-20, 54, 64, 70, 93-97, 116, 143-144
rag_factory/services/embedding/rate_limiter.py                        20      3    85%   34, 50-51
rag_factory/services/embedding/service.py                            100     38    62%   88, 118, 134-136, 143-145, 163-175, 181-198, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9205    17%
=========================== short test summary info ============================
FAILED tests/integration/services/test_embedding_integration.py::test_openai_full_workflow - tenacity.RetryError: RetryError[<Future at 0x770867c9cdd0 state=finished raised AuthenticationError>]
FAILED tests/integration/services/test_embedding_integration.py::test_local_embedding_provider - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
FAILED tests/integration/services/test_embedding_integration.py::test_large_batch_processing - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
FAILED tests/integration/services/test_embedding_integration.py::test_concurrent_embedding_requests - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
FAILED tests/integration/services/test_embedding_integration.py::test_cache_persistence_across_batches - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
FAILED tests/integration/services/test_embedding_integration.py::test_error_handling - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
FAILED tests/integration/services/test_embedding_integration.py::test_onnx_provider_compatibility - ValueError: Invalid provider: onnx-local. Must be one of ['openai', 'cohere', 'local']
================== 7 failed, 1 skipped, 2 warnings in 11.16s ===================

[15/156] PASSED: tests/integration/services/test_fine_tuned_onnx_integration.py
  Tests: 1 (P:1 F:0 S:0)
[16/156] FAILED: tests/integration/services/test_llm_integration.py
  Tests: 9 (P:0 F:2 S:7)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/integration/services/test_llm_integration.py::test_full_llm_workflow SKIPPED [ 12%]
tests/integration/services/test_llm_integration.py::test_streaming_response SKIPPED [ 25%]
tests/integration/services/test_llm_integration.py::test_local_ollama_provider SKIPPED [ 37%]
tests/integration/services/test_llm_integration.py::test_prompt_template_with_real_llm SKIPPED [ 50%]
tests/integration/services/test_llm_integration.py::test_openai_provider FAILED [ 62%]
tests/integration/services/test_llm_integration.py::test_concurrent_llm_requests SKIPPED [ 75%]
tests/integration/services/test_llm_integration.py::test_cost_tracking SKIPPED [ 87%]
tests/integration/services/test_llm_integration.py::test_token_counting SKIPPED [100%]

=================================== FAILURES ===================================
_____________________________ test_openai_provider _____________________________
tests/integration/services/test_llm_integration.py:156: in test_openai_provider
    assert response.content
E   AssertionError: assert ''
E    +  where '' = LLMResponse(content='', model='qwen3-zero-coder-reasoning-v2-0.8b-neo-ex', provider='openai', prompt_tokens=15, completion_tokens=20, total_tokens=35, cost=0.0, latency=3.007067918777466, metadata={'finish_reason': 'length'}).content
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20      3    85%   32, 50-51
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23      6    74%   46-48, 51-53
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     42    24%   22-24, 37-67, 93-122, 142-143, 157, 165, 174, 185-196
rag_factory/services/llm/providers/openai.py                          57     20    65%   56, 62, 101-105, 133-158, 189-194, 202, 210
rag_factory/services/llm/service.py                                   66     25    62%   68, 94, 127-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27      4    85%   56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9206    17%
=========================== short test summary info ============================
FAILED tests/integration/services/test_llm_integration.py::test_openai_provider - AssertionError: assert ''
 +  where '' = LLMResponse(content='', model='qwen3-zero-coder-reasoning-v2-0.8b-neo-ex', provider='openai', prompt_tokens=15, completion_tokens=20, total_tokens=35, cost=0.0, latency=3.007067918777466, metadata={'finish_reason': 'length'}).content
=================== 1 failed, 7 skipped, 2 warnings in 7.68s ===================

[17/156] PASSED: tests/integration/services/test_lm_studio_connection.py
  Tests: 2 (P:2 F:0 S:0)
[18/156] FAILED: tests/integration/services/test_onnx_embeddings_integration.py
  Tests: 11 (P:9 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 10 items

tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_embed_single_document PASSED [ 10%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_embed_multiple_documents PASSED [ 20%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_semantic_similarity PASSED [ 30%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_batch_consistency PASSED [ 40%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_empty_input PASSED [ 50%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_long_text_handling PASSED [ 60%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_special_characters PASSED [ 70%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_performance_target FAILED [ 80%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_provider_metadata PASSED [ 90%]
tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_result_metadata PASSED [100%]

=================================== FAILURES ===================================
____________ TestONNXEmbeddingsIntegration.test_performance_target _____________
tests/integration/services/test_onnx_embeddings_integration.py:167: in test_performance_target
    assert avg_time < 0.1, f"Average time {avg_time*1000:.2f}ms exceeds 100ms target"
E   AssertionError: Average time 3212.24ms exceeds 100ms target
E   assert np.float64(3.212241521499891) < 0.1
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     35    70%   18-19, 24-25, 92, 99, 121, 145, 150-154, 165, 177-182, 248-250, 273, 289-308
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171     81    53%   22-23, 28-29, 41, 48, 91-94, 100-101, 106-107, 123-193, 213-234, 263, 277-278, 282, 286-289, 304-306, 346, 353-356, 449-450, 464, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9169    17%
=========================== short test summary info ============================
FAILED tests/integration/services/test_onnx_embeddings_integration.py::TestONNXEmbeddingsIntegration::test_performance_target - AssertionError: Average time 3212.24ms exceeds 100ms target
assert np.float64(3.212241521499891) < 0.1
============= 1 failed, 9 passed, 2 warnings in 100.82s (0:01:40) ==============

[19/156] FAILED: tests/integration/services/test_service_implementations.py
  Tests: 20 (P:17 F:2 S:1)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 19 items

tests/integration/services/test_service_implementations.py::TestONNXServices::test_onnx_embedding_service_implements_interface PASSED [  5%]
tests/integration/services/test_service_implementations.py::TestONNXServices::test_onnx_embedding_service_basic_functionality PASSED [ 10%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_anthropic_llm_service_implements_interface PASSED [ 15%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_anthropic_llm_service_basic_functionality PASSED [ 21%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_openai_llm_service_implements_interface PASSED [ 26%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_openai_embedding_service_implements_interface PASSED [ 31%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_cohere_reranking_service_implements_interface PASSED [ 36%]
tests/integration/services/test_service_implementations.py::TestAPIServices::test_cohere_reranking_service_basic_functionality PASSED [ 42%]
tests/integration/services/test_service_implementations.py::TestDatabaseServices::test_neo4j_graph_service_implements_interface PASSED [ 47%]
tests/integration/services/test_service_implementations.py::TestDatabaseServices::test_neo4j_graph_service_basic_functionality SKIPPED [ 52%]
tests/integration/services/test_service_implementations.py::TestDatabaseServices::test_postgresql_database_service_implements_interface PASSED [ 57%]
tests/integration/services/test_service_implementations.py::TestDatabaseServices::test_postgresql_database_service_basic_functionality FAILED [ 63%]
tests/integration/services/test_service_implementations.py::TestLocalServices::test_cosine_reranking_service_implements_interface PASSED [ 68%]
tests/integration/services/test_service_implementations.py::TestLocalServices::test_cosine_reranking_service_basic_functionality PASSED [ 73%]
tests/integration/services/test_service_implementations.py::TestInterfaceCompliance::test_all_llm_services_implement_interface PASSED [ 78%]
tests/integration/services/test_service_implementations.py::TestInterfaceCompliance::test_all_embedding_services_implement_interface PASSED [ 84%]
tests/integration/services/test_service_implementations.py::TestInterfaceCompliance::test_all_reranking_services_implement_interface PASSED [ 89%]
tests/integration/services/test_service_implementations.py::TestInterfaceCompliance::test_all_graph_services_implement_interface PASSED [ 94%]
tests/integration/services/test_service_implementations.py::TestInterfaceCompliance::test_all_database_services_implement_interface PASSED [100%]

=================================== FAILURES ===================================
__ TestDatabaseServices.test_postgresql_database_service_basic_functionality ___
tests/integration/services/test_service_implementations.py:217: in test_postgresql_database_service_basic_functionality
    await service.store_chunks(chunks)
rag_factory/services/database/postgres.py:155: in store_chunks
    pool = await self._get_pool()
           ^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/database/postgres.py:98: in _get_pool
    self._pool = await asyncpg.create_pool(
E   TypeError: object AsyncMock can't be used in 'await' expression
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     10    63%   118-141
rag_factory/services/api/cohere.py                                    30      7    77%   14-15, 50, 83, 111-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     57    37%   17-18, 73, 109-111, 115-139, 153, 157-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32      7    78%   13-14, 46, 79, 114-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29      9    69%   61, 63, 65, 93, 110-121
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9236    16%
=========================== short test summary info ============================
FAILED tests/integration/services/test_service_implementations.py::TestDatabaseServices::test_postgresql_database_service_basic_functionality - TypeError: object AsyncMock can't be used in 'await' expression
============= 1 failed, 17 passed, 1 skipped, 2 warnings in 3.79s ==============

[20/156] FAILED: tests/integration/services/test_service_integration.py
  Tests: 2 (P:0 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 2 items

tests/integration/services/test_service_integration.py::test_rag_workflow ERROR [ 50%]
tests/integration/services/test_service_integration.py::test_embedding_database_consistency FAILED [100%]

==================================== ERRORS ====================================
_____________________ ERROR at setup of test_rag_workflow ______________________
tests/integration/services/test_service_integration.py:54: in llm_service
    with patch("rag_factory.services.llm.service.AnthropicProvider") as mock_provider_cls:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'rag_factory.services.llm.service' from '/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py'> does not have the attribute 'AnthropicProvider'
=================================== FAILURES ===================================
_____________________ test_embedding_database_consistency ______________________
tests/integration/services/test_service_integration.py:158: in test_embedding_database_consistency
    await db_service.store_chunks([chunk])
rag_factory/services/database/postgres.py:157: in store_chunks
    async with pool.acquire() as conn:
E   TypeError: 'coroutine' object does not support the asynchronous context manager protocol
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

tests/integration/services/test_service_integration.py::test_embedding_database_consistency
  /mnt/MCPProyects/ragTools/rag_factory/services/database/postgres.py:157: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    async with pool.acquire() as conn:
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     56    38%   17-18, 73, 98-109, 115-139, 153, 159-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29      7    76%   43, 56-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     74    26%   88, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23      4    83%   48, 51-53
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9258    16%
=========================== short test summary info ============================
FAILED tests/integration/services/test_service_integration.py::test_embedding_database_consistency - TypeError: 'coroutine' object does not support the asynchronous context manager protocol
ERROR tests/integration/services/test_service_integration.py::test_rag_workflow - AttributeError: <module 'rag_factory.services.llm.service' from '/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py'> does not have the attribute 'AnthropicProvider'
==================== 1 failed, 3 warnings, 1 error in 3.88s ====================

[21/156] FAILED: tests/integration/strategies/test_base_integration.py
  Tests: 10 (P:0 F:10 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 5 items

tests/integration/strategies/test_base_integration.py::test_strategy_full_lifecycle FAILED [ 20%]
tests/integration/strategies/test_base_integration.py::test_multiple_strategies_implement_interface FAILED [ 40%]
tests/integration/strategies/test_base_integration.py::test_async_retrieve_works FAILED [ 60%]
tests/integration/strategies/test_base_integration.py::test_strategy_error_handling FAILED [ 80%]
tests/integration/strategies/test_base_integration.py::test_strategy_configuration_override FAILED [100%]

=================================== FAILURES ===================================
_________________________ test_strategy_full_lifecycle _________________________
tests/integration/strategies/test_base_integration.py:62: in test_strategy_full_lifecycle
    strategy = DummyStrategy()
               ^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
_________________ test_multiple_strategies_implement_interface _________________
tests/integration/strategies/test_base_integration.py:113: in test_multiple_strategies_implement_interface
    strategies = [StrategyA(), StrategyB()]
                  ^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class StrategyA without an implementation for abstract method 'requires_services'
__________________________ test_async_retrieve_works ___________________________
tests/integration/strategies/test_base_integration.py:154: in test_async_retrieve_works
    strategy = AsyncStrategy()
               ^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class AsyncStrategy without an implementation for abstract method 'requires_services'
_________________________ test_strategy_error_handling _________________________
tests/integration/strategies/test_base_integration.py:186: in test_strategy_error_handling
    strategy = ErrorStrategy()
               ^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class ErrorStrategy without an implementation for abstract method 'requires_services'
_____________________ test_strategy_configuration_override _____________________
tests/integration/strategies/test_base_integration.py:221: in test_strategy_configuration_override
    strategy = ConfigurableStrategy()
               ^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class ConfigurableStrategy without an implementation for abstract method 'requires_services'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9295    16%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_base_integration.py::test_strategy_full_lifecycle - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_base_integration.py::test_multiple_strategies_implement_interface - TypeError: Can't instantiate abstract class StrategyA without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_base_integration.py::test_async_retrieve_works - TypeError: Can't instantiate abstract class AsyncStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_base_integration.py::test_strategy_error_handling - TypeError: Can't instantiate abstract class ErrorStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_base_integration.py::test_strategy_configuration_override - TypeError: Can't instantiate abstract class ConfigurableStrategy without an implementation for abstract method 'requires_services'
======================== 5 failed, 2 warnings in 3.84s =========================

[22/156] PASSED: tests/integration/strategies/test_chunking_integration.py
  Tests: 12 (P:12 F:0 S:0)
[23/156] FAILED: tests/integration/strategies/test_contextual_integration.py
  Tests: 12 (P:0 F:12 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 6 items

tests/integration/strategies/test_contextual_integration.py::test_contextual_retrieval_complete_workflow FAILED [ 16%]
tests/integration/strategies/test_contextual_integration.py::test_cost_tracking_accuracy FAILED [ 33%]
tests/integration/strategies/test_contextual_integration.py::test_retrieval_with_different_formats FAILED [ 50%]
tests/integration/strategies/test_contextual_integration.py::test_error_recovery FAILED [ 66%]
tests/integration/strategies/test_contextual_integration.py::test_synchronous_indexing FAILED [ 83%]
tests/integration/strategies/test_contextual_integration.py::test_large_document_processing FAILED [100%]

=================================== FAILURES ===================================
_________________ test_contextual_retrieval_complete_workflow __________________
tests/integration/strategies/test_contextual_integration.py:85: in test_contextual_retrieval_complete_workflow
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
_________________________ test_cost_tracking_accuracy __________________________
tests/integration/strategies/test_contextual_integration.py:142: in test_cost_tracking_accuracy
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
____________________ test_retrieval_with_different_formats _____________________
tests/integration/strategies/test_contextual_integration.py:181: in test_retrieval_with_different_formats
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
_____________________________ test_error_recovery ______________________________
tests/integration/strategies/test_contextual_integration.py:222: in test_error_recovery
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
__________________________ test_synchronous_indexing ___________________________
tests/integration/strategies/test_contextual_integration.py:247: in test_synchronous_indexing
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
________________________ test_large_document_processing ________________________
tests/integration/strategies/test_contextual_integration.py:282: in test_large_document_processing
    strategy = ContextualRetrievalStrategy(
E   TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  86     71    17%   41-43, 60-73, 85-91, 109-129, 146-162, 179-200, 217-257
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         63     39    38%   51-64, 72, 93-140, 157, 170, 191-199, 215-242, 247, 252, 261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9161    17%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_contextual_integration.py::test_contextual_retrieval_complete_workflow - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
FAILED tests/integration/strategies/test_contextual_integration.py::test_cost_tracking_accuracy - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
FAILED tests/integration/strategies/test_contextual_integration.py::test_retrieval_with_different_formats - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
FAILED tests/integration/strategies/test_contextual_integration.py::test_error_recovery - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
FAILED tests/integration/strategies/test_contextual_integration.py::test_synchronous_indexing - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
FAILED tests/integration/strategies/test_contextual_integration.py::test_large_document_processing - TypeError: Can't instantiate abstract class ContextualRetrievalStrategy without an implementation for abstract method 'aretrieve'
======================== 6 failed, 3 warnings in 4.11s =========================

[24/156] PASSED: tests/integration/strategies/test_hierarchical_indexing.py
  Tests: 14 (P:14 F:0 S:0)
[25/156] FAILED: tests/integration/strategies/test_hierarchical_integration.py
  Tests: 8 (P:0 F:8 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 4 items

tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_end_to_end_workflow FAILED [ 25%]
tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_expansion_strategy_comparison FAILED [ 50%]
tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_hierarchy_validation FAILED [ 75%]
tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_multiple_documents FAILED [100%]

=================================== FAILURES ===================================
_____________ TestHierarchicalIntegration.test_end_to_end_workflow _____________
tests/integration/strategies/test_hierarchical_integration.py:92: in test_end_to_end_workflow
    strategy = HierarchicalRAGStrategy(
E   TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
________ TestHierarchicalIntegration.test_expansion_strategy_comparison ________
tests/integration/strategies/test_hierarchical_integration.py:128: in test_expansion_strategy_comparison
    strategy = HierarchicalRAGStrategy(
E   TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
____________ TestHierarchicalIntegration.test_hierarchy_validation _____________
tests/integration/strategies/test_hierarchical_integration.py:165: in test_hierarchy_validation
    strategy = HierarchicalRAGStrategy(
E   TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
_____________ TestHierarchicalIntegration.test_multiple_documents ______________
tests/integration/strategies/test_hierarchical_integration.py:181: in test_multiple_documents
    strategy = HierarchicalRAGStrategy(
E   TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      0   100%
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     65    18%   35-36, 49-75, 92-93, 113-149, 167-201, 220, 249-281, 310-335
rag_factory/strategies/hierarchical/models.py                         58      0   100%
rag_factory/strategies/hierarchical/parent_retriever.py               89     77    13%   38-40, 56-92, 103-113, 130-149, 166-196, 213-227, 250-257, 268-278
rag_factory/strategies/hierarchical/strategy.py                       63     48    24%   45-70, 83, 94-126, 144-152, 180-214, 228, 242-243, 259-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9191    17%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_end_to_end_workflow - TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_expansion_strategy_comparison - TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_hierarchy_validation - TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/strategies/test_hierarchical_integration.py::TestHierarchicalIntegration::test_multiple_documents - TypeError: Can't instantiate abstract class HierarchicalRAGStrategy without an implementation for abstract method 'requires_services'
======================== 4 failed, 2 warnings in 4.27s =========================

[26/156] PASSED: tests/integration/strategies/test_in_memory_indexing.py
  Tests: 12 (P:12 F:0 S:0)
[27/156] FAILED: tests/integration/strategies/test_keyword_indexing.py
  Tests: 0 (P:0 F:0 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 6 items

tests/integration/strategies/test_keyword_indexing.py::test_capabilities ERROR [ 16%]
tests/integration/strategies/test_keyword_indexing.py::test_dependencies ERROR [ 33%]
tests/integration/strategies/test_keyword_indexing.py::test_process_success ERROR [ 50%]
tests/integration/strategies/test_keyword_indexing.py::test_process_no_chunks ERROR [ 66%]
tests/integration/strategies/test_keyword_indexing.py::test_process_empty_text ERROR [ 83%]
tests/integration/strategies/test_keyword_indexing.py::test_process_stop_words_only ERROR [100%]

==================================== ERRORS ====================================
_____________________ ERROR at setup of test_capabilities ______________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
_____________________ ERROR at setup of test_dependencies ______________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
____________________ ERROR at setup of test_process_success ____________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
___________________ ERROR at setup of test_process_no_chunks ___________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
__________________ ERROR at setup of test_process_empty_text ___________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
________________ ERROR at setup of test_process_stop_words_only ________________
tests/integration/strategies/test_keyword_indexing.py:19: in strategy_dependencies
    return StrategyDependencies(
E   TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     31    22%   40, 51, 75-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9286    16%
=========================== short test summary info ============================
ERROR tests/integration/strategies/test_keyword_indexing.py::test_capabilities - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
ERROR tests/integration/strategies/test_keyword_indexing.py::test_dependencies - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
ERROR tests/integration/strategies/test_keyword_indexing.py::test_process_success - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
ERROR tests/integration/strategies/test_keyword_indexing.py::test_process_no_chunks - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
ERROR tests/integration/strategies/test_keyword_indexing.py::test_process_empty_text - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
ERROR tests/integration/strategies/test_keyword_indexing.py::test_process_stop_words_only - TypeError: StrategyDependencies.__init__() got an unexpected keyword argument 'reranking_service'
======================== 2 warnings, 6 errors in 8.15s =========================

[28/156] FAILED: tests/integration/strategies/test_knowledge_graph_integration.py
  Tests: 8 (P:0 F:8 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 4 items

tests/integration/strategies/test_knowledge_graph_integration.py::test_knowledge_graph_workflow FAILED [ 25%]
tests/integration/strategies/test_knowledge_graph_integration.py::test_hybrid_retrieval FAILED [ 50%]
tests/integration/strategies/test_knowledge_graph_integration.py::test_relationship_queries FAILED [ 75%]
tests/integration/strategies/test_knowledge_graph_integration.py::test_graph_statistics FAILED [100%]

=================================== FAILURES ===================================
________________________ test_knowledge_graph_workflow _________________________
tests/integration/strategies/test_knowledge_graph_integration.py:91: in test_knowledge_graph_workflow
    strategy = KnowledgeGraphRAGStrategy(
E   TypeError: KnowledgeGraphRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
____________________________ test_hybrid_retrieval _____________________________
tests/integration/strategies/test_knowledge_graph_integration.py:122: in test_hybrid_retrieval
    strategy = KnowledgeGraphRAGStrategy(
E   TypeError: KnowledgeGraphRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
__________________________ test_relationship_queries ___________________________
tests/integration/strategies/test_knowledge_graph_integration.py:148: in test_relationship_queries
    strategy = KnowledgeGraphRAGStrategy(
E   TypeError: KnowledgeGraphRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
____________________________ test_graph_statistics _____________________________
tests/integration/strategies/test_knowledge_graph_integration.py:172: in test_graph_statistics
    strategy = KnowledgeGraphRAGStrategy(
E   TypeError: KnowledgeGraphRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      0   100%
rag_factory/strategies/knowledge_graph/config.py                      21      2    90%   128-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     56    20%   34-36, 53-74, 89, 96-119, 128-166, 178-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31      9    71%   25, 35, 48, 66, 86, 99, 109, 114, 124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     45    20%   35-42, 61-97, 101-108, 117-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     80    18%   23-25, 29-38, 42-53, 60, 68-87, 96-152, 161-168, 172-182, 186-189, 193-196
rag_factory/strategies/knowledge_graph/models.py                      53      0   100%
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     50    19%   35-37, 56-85, 93-122, 132-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     49    33%   44-63, 75, 94-154, 179-201, 210-220, 224, 228, 232, 237, 242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9119    18%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_knowledge_graph_integration.py::test_knowledge_graph_workflow - TypeError: KnowledgeGraphRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
FAILED tests/integration/strategies/test_knowledge_graph_integration.py::test_hybrid_retrieval - TypeError: KnowledgeGraphRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
FAILED tests/integration/strategies/test_knowledge_graph_integration.py::test_relationship_queries - TypeError: KnowledgeGraphRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
FAILED tests/integration/strategies/test_knowledge_graph_integration.py::test_graph_statistics - TypeError: KnowledgeGraphRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
======================== 4 failed, 2 warnings in 5.57s =========================

[29/156] FAILED: tests/integration/strategies/test_late_chunking_integration.py
  Tests: 15 (P:3 F:12 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 9 items

tests/integration/strategies/test_late_chunking_integration.py::test_late_chunking_workflow FAILED [ 11%]
tests/integration/strategies/test_late_chunking_integration.py::test_fixed_size_chunking_integration PASSED [ 22%]
tests/integration/strategies/test_late_chunking_integration.py::test_adaptive_chunking_integration FAILED [ 33%]
tests/integration/strategies/test_late_chunking_integration.py::test_multiple_documents FAILED [ 44%]
tests/integration/strategies/test_late_chunking_integration.py::test_strategy_properties PASSED [ 55%]
tests/integration/strategies/test_late_chunking_integration.py::test_coherence_scores_computed PASSED [ 66%]
tests/integration/strategies/test_late_chunking_integration.py::test_short_document FAILED [ 77%]
tests/integration/strategies/test_late_chunking_integration.py::test_chunk_embeddings_valid FAILED [ 88%]
tests/integration/strategies/test_late_chunking_integration.py::test_embedding_quality FAILED [100%]

=================================== FAILURES ===================================
_________________________ test_late_chunking_workflow __________________________
tests/integration/strategies/test_late_chunking_integration.py:70: in test_late_chunking_workflow
    strategy.index_document(document, "ml_doc")
rag_factory/strategies/late_chunking/strategy.py:71: in index_document
    doc_embedding = self.document_embedder.embed_document(document, document_id)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=30828 must be within the inclusive range [-30527,30526]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 18:13:40.367274088 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=30828 must be within the inclusive range [-30527,30526][m
______________________ test_adaptive_chunking_integration ______________________
tests/integration/strategies/test_late_chunking_integration.py:130: in test_adaptive_chunking_integration
    strategy.index_document(document, "python_doc")
rag_factory/strategies/late_chunking/strategy.py:71: in index_document
    doc_embedding = self.document_embedder.embed_document(document, document_id)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=33045 must be within the inclusive range [-30527,30526]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 18:13:45.950315697 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=33045 must be within the inclusive range [-30527,30526][m
___________________________ test_multiple_documents ____________________________
tests/integration/strategies/test_late_chunking_integration.py:158: in test_multiple_documents
    strategy.index_document(text, doc_id)
rag_factory/strategies/late_chunking/strategy.py:71: in index_document
    doc_embedding = self.document_embedder.embed_document(document, document_id)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=30828 must be within the inclusive range [-30527,30526]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 18:13:48.136996025 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=30828 must be within the inclusive range [-30527,30526][m
_____________________________ test_short_document ______________________________
tests/integration/strategies/test_late_chunking_integration.py:222: in test_short_document
    assert len(test_vector_store.chunks) >= 1
E   assert 0 >= 1
E    +  where 0 = len([])
E    +    where [] = <tests.integration.strategies.test_late_chunking_integration.MockVectorStore object at 0x7a0aa2d87d70>.chunks
_________________________ test_chunk_embeddings_valid __________________________
tests/integration/strategies/test_late_chunking_integration.py:237: in test_chunk_embeddings_valid
    strategy.index_document(document, "embed_test")
rag_factory/strategies/late_chunking/strategy.py:71: in index_document
    doc_embedding = self.document_embedder.embed_document(document, document_id)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=40188 must be within the inclusive range [-30527,30526]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 18:14:03.474548096 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=40188 must be within the inclusive range [-30527,30526][m
____________________________ test_embedding_quality ____________________________
tests/integration/strategies/test_late_chunking_integration.py:260: in test_embedding_quality
    strategy.index_document(text, "quality_test")
rag_factory/strategies/late_chunking/strategy.py:71: in index_document
    doc_embedding = self.document_embedder.embed_document(document, document_id)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/late_chunking/document_embedder.py:92: in embed_document
    outputs = self.session.run(
venv/lib/python3.12/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:287: in run
    return self._sess.run(output_names, input_feed, run_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=39935 must be within the inclusive range [-30527,30526]
----------------------------- Captured stderr call -----------------------------
[1;31m2025-12-11 18:14:18.894827475 [E:onnxruntime:, sequential_executor.cc:572 ExecuteKernel] Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=39935 must be within the inclusive range [-30527,30526][m
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    104    39%   22-23, 28-29, 41, 48, 94, 106-107, 123-193, 213-234, 263, 277-278, 282, 286-289, 304-306, 328-362, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     12    56%   41-43, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py             88     34    61%   36, 81-85, 123, 196-204, 225-248, 265-272, 287
rag_factory/strategies/late_chunking/embedding_chunker.py            112     41    63%   52-57, 122-125, 133-139, 164, 177-178, 185-240, 284
rag_factory/strategies/late_chunking/models.py                        63      0   100%
rag_factory/strategies/late_chunking/strategy.py                      49      8    84%   48, 86-87, 124-133
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     57    40%   39-40, 53-64, 93-94, 100-101, 105-114, 129, 144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   8983    19%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_late_chunking_integration.py::test_late_chunking_workflow - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=30828 must be within the inclusive range [-30527,30526]
FAILED tests/integration/strategies/test_late_chunking_integration.py::test_adaptive_chunking_integration - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=33045 must be within the inclusive range [-30527,30526]
FAILED tests/integration/strategies/test_late_chunking_integration.py::test_multiple_documents - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=30828 must be within the inclusive range [-30527,30526]
FAILED tests/integration/strategies/test_late_chunking_integration.py::test_short_document - assert 0 >= 1
 +  where 0 = len([])
 +    where [] = <tests.integration.strategies.test_late_chunking_integration.MockVectorStore object at 0x7a0aa2d87d70>.chunks
FAILED tests/integration/strategies/test_late_chunking_integration.py::test_chunk_embeddings_valid - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=40188 must be within the inclusive range [-30527,30526]
FAILED tests/integration/strategies/test_late_chunking_integration.py::test_embedding_quality - onnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Non-zero status code returned while running Gather node. Name:'/embeddings/word_embeddings/Gather' Status Message: indices element out of data bounds, idx=39935 must be within the inclusive range [-30527,30526]
=================== 6 failed, 3 passed, 5 warnings in 47.80s ===================

[30/156] FAILED: tests/integration/strategies/test_multi_query_integration.py
  Tests: 17 (P:0 F:16 S:1)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 9 items

tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_multi_query_complete_workflow FAILED [ 11%]
tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_multi_query_async_workflow FAILED [ 22%]
tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_variant_diversity FAILED [ 33%]
tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_performance_requirements FAILED [ 44%]
tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_fallback_on_failure FAILED [ 55%]
tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_ranking_strategy_comparison FAILED [ 66%]
tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_deduplication_across_variants FAILED [ 77%]
tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_strategy_properties FAILED [ 88%]
tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryRealLLM::test_with_real_llm SKIPPED [100%]

=================================== FAILURES ===================================
_________ TestMultiQueryIntegration.test_multi_query_complete_workflow _________
tests/integration/strategies/test_multi_query_integration.py:67: in test_multi_query_complete_workflow
    strategy = MultiQueryRAGStrategy(
E   TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
__________ TestMultiQueryIntegration.test_multi_query_async_workflow ___________
tests/integration/strategies/test_multi_query_integration.py:94: in test_multi_query_async_workflow
    strategy = MultiQueryRAGStrategy(
E   TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
_______________ TestMultiQueryIntegration.test_variant_diversity _______________
tests/integration/strategies/test_multi_query_integration.py:111: in test_variant_diversity
    strategy = MultiQueryRAGStrategy(
E   TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
___________ TestMultiQueryIntegration.test_performance_requirements ____________
tests/integration/strategies/test_multi_query_integration.py:135: in test_performance_requirements
    strategy = MultiQueryRAGStrategy(
E   TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
______________ TestMultiQueryIntegration.test_fallback_on_failure ______________
tests/integration/strategies/test_multi_query_integration.py:158: in test_fallback_on_failure
    strategy = MultiQueryRAGStrategy(
E   TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
__________ TestMultiQueryIntegration.test_ranking_strategy_comparison __________
tests/integration/strategies/test_multi_query_integration.py:180: in test_ranking_strategy_comparison
    strategy_max = MultiQueryRAGStrategy(
E   TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
_________ TestMultiQueryIntegration.test_deduplication_across_variants _________
tests/integration/strategies/test_multi_query_integration.py:215: in test_deduplication_across_variants
    strategy = MultiQueryRAGStrategy(
E   TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
______________ TestMultiQueryIntegration.test_strategy_properties ______________
tests/integration/strategies/test_multi_query_integration.py:234: in test_strategy_properties
    strategy = MultiQueryRAGStrategy(
E   TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      0   100%
rag_factory/strategies/multi_query/config.py                          36      0   100%
rag_factory/strategies/multi_query/deduplicator.py                    87     77    11%   26-27, 41-100, 116-176, 188-197
rag_factory/strategies/multi_query/parallel_executor.py               52     41    21%   27-28, 42-86, 105-135, 147-163
rag_factory/strategies/multi_query/prompts.py                         10      5    50%   74-84
rag_factory/strategies/multi_query/ranker.py                          80     68    15%   24, 35-70, 81-84, 98-103, 116-126, 141-177, 189-201
rag_factory/strategies/multi_query/strategy.py                        62     39    37%   43-53, 57, 73-103, 107, 111, 124-140, 151-158, 170, 175
rag_factory/strategies/multi_query/variant_generator.py               62     48    23%   27-28, 47-79, 90, 107-129, 141-154, 171-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9177    17%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_multi_query_complete_workflow - TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
FAILED tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_multi_query_async_workflow - TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
FAILED tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_variant_diversity - TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
FAILED tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_performance_requirements - TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
FAILED tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_fallback_on_failure - TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
FAILED tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_ranking_strategy_comparison - TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
FAILED tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_deduplication_across_variants - TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
FAILED tests/integration/strategies/test_multi_query_integration.py::TestMultiQueryIntegration::test_strategy_properties - TypeError: MultiQueryRAGStrategy.__init__() got an unexpected keyword argument 'vector_store_service'
=================== 8 failed, 1 skipped, 2 warnings in 4.75s ===================

[31/156] FAILED: tests/integration/strategies/test_query_expansion_integration.py
  Tests: 20 (P:2 F:18 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 11 items

tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_keyword_expansion_real_llm FAILED [  9%]
tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_query_reformulation FAILED [ 18%]
tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_question_generation FAILED [ 27%]
tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_hyde_expansion FAILED [ 36%]
tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_multi_query_generation PASSED [ 45%]
tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_expansion_performance FAILED [ 54%]
tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_cache_functionality FAILED [ 63%]
tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_ab_testing_functionality FAILED [ 72%]
tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_domain_context FAILED [ 81%]
tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_error_handling_fallback PASSED [ 90%]
tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_stats_tracking FAILED [100%]

=================================== FAILURES ===================================
________ TestQueryExpansionIntegration.test_keyword_expansion_real_llm _________
tests/integration/strategies/test_query_expansion_integration.py:60: in test_keyword_expansion_real_llm
    assert len(result.primary_expansion.expanded_query) > len(result.original_query)
E   AssertionError: assert 16 > 16
E    +  where 16 = len('machine learning')
E    +    where 'machine learning' = ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}).expanded_query
E    +      where ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='machine learning', expanded_queries=[ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}), execution_time_ms=6790.1294231414795, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 33, 478317), metadata={'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}).primary_expansion
E    +  and   16 = len('machine learning')
E    +    where 'machine learning' = ExpansionResult(original_query='machine learning', expanded_queries=[ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}), execution_time_ms=6790.1294231414795, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 33, 478317), metadata={'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}).original_query
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]
____________ TestQueryExpansionIntegration.test_query_reformulation ____________
tests/integration/strategies/test_query_expansion_integration.py:81: in test_query_reformulation
    assert result.primary_expansion.expanded_query != vague_query
E   AssertionError: assert 'how does it work' != 'how does it work'
E    +  where 'how does it work' = ExpandedQuery(original_query='how does it work', expanded_query='how does it work', expansion_strategy=<ExpansionStrategy.REFORMULATION: 'reformulation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]'}).expanded_query
E    +    where ExpandedQuery(original_query='how does it work', expanded_query='how does it work', expansion_strategy=<ExpansionStrategy.REFORMULATION: 'reformulation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='how does it work', expanded_queries=[ExpandedQuery(original_query='how does it work', expanded_query='how does it work', expansion_strategy=<ExpansionStrategy.REFORMULATION: 'reformulation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='how does it work', expanded_query='how does it work', expansion_strategy=<ExpansionStrategy.REFORMULATION: 'reformulation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]'}), execution_time_ms=3712.6522064208984, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 37, 777751), metadata={'error': 'RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]'}).primary_expansion
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]
____________ TestQueryExpansionIntegration.test_question_generation ____________
tests/integration/strategies/test_query_expansion_integration.py:99: in test_question_generation
    assert result.primary_expansion.expanded_query != "python tutorial"
E   AssertionError: assert 'python tutorial' != 'python tutorial'
E    +  where 'python tutorial' = ExpandedQuery(original_query='python tutorial', expanded_query='python tutorial', expansion_strategy=<ExpansionStrategy.QUESTION_GENERATION: 'question_generation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]'}).expanded_query
E    +    where ExpandedQuery(original_query='python tutorial', expanded_query='python tutorial', expansion_strategy=<ExpansionStrategy.QUESTION_GENERATION: 'question_generation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='python tutorial', expanded_queries=[ExpandedQuery(original_query='python tutorial', expanded_query='python tutorial', expansion_strategy=<ExpansionStrategy.QUESTION_GENERATION: 'question_generation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='python tutorial', expanded_query='python tutorial', expansion_strategy=<ExpansionStrategy.QUESTION_GENERATION: 'question_generation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]'}), execution_time_ms=3660.7134342193604, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 41, 555676), metadata={'error': 'RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]'}).primary_expansion
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]
______________ TestQueryExpansionIntegration.test_hyde_expansion _______________
tests/integration/strategies/test_query_expansion_integration.py:125: in test_hyde_expansion
    assert len(result.primary_expansion.expanded_query) > 50
E   AssertionError: assert 30 > 50
E    +  where 30 = len('What is the capital of France?')
E    +    where 'What is the capital of France?' = ExpandedQuery(original_query='What is the capital of France?', expanded_query='What is the capital of France?', expansion_strategy=<ExpansionStrategy.HYDE: 'hyde'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]'}).expanded_query
E    +      where ExpandedQuery(original_query='What is the capital of France?', expanded_query='What is the capital of France?', expansion_strategy=<ExpansionStrategy.HYDE: 'hyde'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='What is the capital of France?', expanded_queries=[ExpandedQuery(original_query='What is the capital of France?', expanded_query='What is the capital of France?', expansion_strategy=<ExpansionStrategy.HYDE: 'hyde'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='What is the capital of France?', expanded_query='What is the capital of France?', expansion_strategy=<ExpansionStrategy.HYDE: 'hyde'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]'}), execution_time_ms=3632.526636123657, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 45, 300345), metadata={'error': 'RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]'}).primary_expansion
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/hyde_expander.py", line 57, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]
___________ TestQueryExpansionIntegration.test_expansion_performance ___________
tests/integration/strategies/test_query_expansion_integration.py:166: in test_expansion_performance
    assert result.execution_time_ms < 1000, \
E   AssertionError: Expansion took 3663.5289192199707ms (expected <1000ms)
E   assert 3663.5289192199707 < 1000
E    +  where 3663.5289192199707 = ExpansionResult(original_query='artificial intelligence', expanded_queries=[ExpandedQuery(original_query='artificial intelligence', expanded_query='artificial intelligence', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f204101a0 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='artificial intelligence', expanded_query='artificial intelligence', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f204101a0 state=finished raised AuthenticationError>]'}), execution_time_ms=3663.5289192199707, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 52, 817230), metadata={'error': 'RetryError[<Future at 0x706f204101a0 state=finished raised AuthenticationError>]'}).execution_time_ms
----------------------------- Captured stdout call -----------------------------

Expansion took 3664ms
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f204101a0 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f204101a0 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f204101a0 state=finished raised AuthenticationError>]
____________ TestQueryExpansionIntegration.test_cache_functionality ____________
tests/integration/strategies/test_query_expansion_integration.py:187: in test_cache_functionality
    assert result2.cache_hit is True
E   AssertionError: assert False is True
E    +  where False = ExpansionResult(original_query='neural networks', expanded_queries=[ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203fb4d0 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203fb4d0 state=finished raised AuthenticationError>]'}), execution_time_ms=3724.9040603637695, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 16, 0, 388165), metadata={'error': 'RetryError[<Future at 0x706f203fb4d0 state=finished raised AuthenticationError>]'}).cache_hit
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f204132c0 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f204132c0 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f204132c0 state=finished raised AuthenticationError>]
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f203fb4d0 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f203fb4d0 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f203fb4d0 state=finished raised AuthenticationError>]
_________ TestQueryExpansionIntegration.test_ab_testing_functionality __________
tests/integration/strategies/test_query_expansion_integration.py:217: in test_ab_testing_functionality
    assert result_expanded.primary_expansion.expanded_query != result_original.primary_expansion.expanded_query
E   AssertionError: assert 'neural networks' != 'neural networks'
E    +  where 'neural networks' = ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]'}).expanded_query
E    +    where ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='neural networks', expanded_queries=[ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]'}), execution_time_ms=3654.6194553375244, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 16, 4, 225876), metadata={'error': 'RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]'}).primary_expansion
E    +  and   'neural networks' = ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True}).expanded_query
E    +    where ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True}) = ExpansionResult(original_query='neural networks', expanded_queries=[ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True})], primary_expansion=ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True}), execution_time_ms=0.007152557373046875, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 16, 4, 225904), metadata={'expansion_disabled': True}).primary_expansion
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]
______________ TestQueryExpansionIntegration.test_domain_context _______________
tests/integration/strategies/test_query_expansion_integration.py:242: in test_domain_context
    assert result.primary_expansion.expanded_query != "diagnosis"
E   AssertionError: assert 'diagnosis' != 'diagnosis'
E    +  where 'diagnosis' = ExpandedQuery(original_query='diagnosis', expanded_query='diagnosis', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]'}).expanded_query
E    +    where ExpandedQuery(original_query='diagnosis', expanded_query='diagnosis', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='diagnosis', expanded_queries=[ExpandedQuery(original_query='diagnosis', expanded_query='diagnosis', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='diagnosis', expanded_query='diagnosis', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]'}), execution_time_ms=3678.182601928711, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 16, 8, 28630), metadata={'error': 'RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]'}).primary_expansion
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]
______________ TestQueryExpansionIntegration.test_stats_tracking _______________
tests/integration/strategies/test_query_expansion_integration.py:289: in test_stats_tracking
    assert stats["cache_hits"] >= 1
E   assert 0 >= 1
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f20410860 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f20410860 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f20410860 state=finished raised AuthenticationError>]
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f20282ed0 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f20282ed0 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f20282ed0 state=finished raised AuthenticationError>]
ERROR    rag_factory.services.llm.service:service.py:128 Error in LLM completion: RetryError[<Future at 0x706f2066a840 state=finished raised AuthenticationError>]
ERROR    rag_factory.strategies.query_expansion.expander_service:expander_service.py:139 Query expansion failed: RetryError[<Future at 0x706f2066a840 state=finished raised AuthenticationError>]
Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/providers/openai.py", line 90, in complete
    response = self.client.chat.completions.create(**api_params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_utils/_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/resources/chat/completions/completions.py", line 1189, in create
    return self._post(
           ^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/openai/_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: lm-studio. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/expander_service.py", line 108, in expand
    expanded_query = self.expander.expand(query)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/query_expansion/llm_expander.py", line 56, in expand
    response = self.llm_service.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/rag_factory/services/llm/service.py", line 109, in complete
    response = self.provider.complete(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
           ^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/tenacity/__init__.py", line 421, in exc_check
    raise retry_exc from fut.exception()
tenacity.RetryError: RetryError[<Future at 0x706f2066a840 state=finished raised AuthenticationError>]
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20      3    85%   32, 50-51
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23      6    74%   46-48, 51-53
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     42    24%   22-24, 37-67, 93-122, 142-143, 157, 165, 174, 185-196
rag_factory/services/llm/providers/openai.py                          57     30    47%   56, 60, 91-110, 133-158, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     28    58%   68, 94, 114-125, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27      6    78%   24-26, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66      7    89%   103, 115, 118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     34    35%   42-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     26    71%   97-99, 109-136, 159-173, 235-239, 247, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19      3    84%   48, 63-65
rag_factory/strategies/query_expansion/llm_expander.py                23      4    83%   62-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      1    92%   29
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9143    17%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_keyword_expansion_real_llm - AssertionError: assert 16 > 16
 +  where 16 = len('machine learning')
 +    where 'machine learning' = ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}).expanded_query
 +      where ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='machine learning', expanded_queries=[ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}), execution_time_ms=6790.1294231414795, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 33, 478317), metadata={'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}).primary_expansion
 +  and   16 = len('machine learning')
 +    where 'machine learning' = ExpansionResult(original_query='machine learning', expanded_queries=[ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='machine learning', expanded_query='machine learning', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}), execution_time_ms=6790.1294231414795, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 33, 478317), metadata={'error': 'RetryError[<Future at 0x706f2076b260 state=finished raised AuthenticationError>]'}).original_query
FAILED tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_query_reformulation - AssertionError: assert 'how does it work' != 'how does it work'
 +  where 'how does it work' = ExpandedQuery(original_query='how does it work', expanded_query='how does it work', expansion_strategy=<ExpansionStrategy.REFORMULATION: 'reformulation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]'}).expanded_query
 +    where ExpandedQuery(original_query='how does it work', expanded_query='how does it work', expansion_strategy=<ExpansionStrategy.REFORMULATION: 'reformulation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='how does it work', expanded_queries=[ExpandedQuery(original_query='how does it work', expanded_query='how does it work', expansion_strategy=<ExpansionStrategy.REFORMULATION: 'reformulation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='how does it work', expanded_query='how does it work', expansion_strategy=<ExpansionStrategy.REFORMULATION: 'reformulation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]'}), execution_time_ms=3712.6522064208984, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 37, 777751), metadata={'error': 'RetryError[<Future at 0x706f20282600 state=finished raised AuthenticationError>]'}).primary_expansion
FAILED tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_question_generation - AssertionError: assert 'python tutorial' != 'python tutorial'
 +  where 'python tutorial' = ExpandedQuery(original_query='python tutorial', expanded_query='python tutorial', expansion_strategy=<ExpansionStrategy.QUESTION_GENERATION: 'question_generation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]'}).expanded_query
 +    where ExpandedQuery(original_query='python tutorial', expanded_query='python tutorial', expansion_strategy=<ExpansionStrategy.QUESTION_GENERATION: 'question_generation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='python tutorial', expanded_queries=[ExpandedQuery(original_query='python tutorial', expanded_query='python tutorial', expansion_strategy=<ExpansionStrategy.QUESTION_GENERATION: 'question_generation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='python tutorial', expanded_query='python tutorial', expansion_strategy=<ExpansionStrategy.QUESTION_GENERATION: 'question_generation'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]'}), execution_time_ms=3660.7134342193604, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 41, 555676), metadata={'error': 'RetryError[<Future at 0x706f2066b0b0 state=finished raised AuthenticationError>]'}).primary_expansion
FAILED tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_hyde_expansion - AssertionError: assert 30 > 50
 +  where 30 = len('What is the capital of France?')
 +    where 'What is the capital of France?' = ExpandedQuery(original_query='What is the capital of France?', expanded_query='What is the capital of France?', expansion_strategy=<ExpansionStrategy.HYDE: 'hyde'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]'}).expanded_query
 +      where ExpandedQuery(original_query='What is the capital of France?', expanded_query='What is the capital of France?', expansion_strategy=<ExpansionStrategy.HYDE: 'hyde'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='What is the capital of France?', expanded_queries=[ExpandedQuery(original_query='What is the capital of France?', expanded_query='What is the capital of France?', expansion_strategy=<ExpansionStrategy.HYDE: 'hyde'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='What is the capital of France?', expanded_query='What is the capital of France?', expansion_strategy=<ExpansionStrategy.HYDE: 'hyde'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]'}), execution_time_ms=3632.526636123657, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 45, 300345), metadata={'error': 'RetryError[<Future at 0x706f2066a090 state=finished raised AuthenticationError>]'}).primary_expansion
FAILED tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_expansion_performance - AssertionError: Expansion took 3663.5289192199707ms (expected <1000ms)
assert 3663.5289192199707 < 1000
 +  where 3663.5289192199707 = ExpansionResult(original_query='artificial intelligence', expanded_queries=[ExpandedQuery(original_query='artificial intelligence', expanded_query='artificial intelligence', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f204101a0 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='artificial intelligence', expanded_query='artificial intelligence', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f204101a0 state=finished raised AuthenticationError>]'}), execution_time_ms=3663.5289192199707, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 15, 52, 817230), metadata={'error': 'RetryError[<Future at 0x706f204101a0 state=finished raised AuthenticationError>]'}).execution_time_ms
FAILED tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_cache_functionality - AssertionError: assert False is True
 +  where False = ExpansionResult(original_query='neural networks', expanded_queries=[ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203fb4d0 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203fb4d0 state=finished raised AuthenticationError>]'}), execution_time_ms=3724.9040603637695, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 16, 0, 388165), metadata={'error': 'RetryError[<Future at 0x706f203fb4d0 state=finished raised AuthenticationError>]'}).cache_hit
FAILED tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_ab_testing_functionality - AssertionError: assert 'neural networks' != 'neural networks'
 +  where 'neural networks' = ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]'}).expanded_query
 +    where ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='neural networks', expanded_queries=[ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]'}), execution_time_ms=3654.6194553375244, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 16, 4, 225876), metadata={'error': 'RetryError[<Future at 0x706f203f8ad0 state=finished raised AuthenticationError>]'}).primary_expansion
 +  and   'neural networks' = ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True}).expanded_query
 +    where ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True}) = ExpansionResult(original_query='neural networks', expanded_queries=[ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True})], primary_expansion=ExpandedQuery(original_query='neural networks', expanded_query='neural networks', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True}), execution_time_ms=0.007152557373046875, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 16, 4, 225904), metadata={'expansion_disabled': True}).primary_expansion
FAILED tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_domain_context - AssertionError: assert 'diagnosis' != 'diagnosis'
 +  where 'diagnosis' = ExpandedQuery(original_query='diagnosis', expanded_query='diagnosis', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]'}).expanded_query
 +    where ExpandedQuery(original_query='diagnosis', expanded_query='diagnosis', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]'}) = ExpansionResult(original_query='diagnosis', expanded_queries=[ExpandedQuery(original_query='diagnosis', expanded_query='diagnosis', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]'})], primary_expansion=ExpandedQuery(original_query='diagnosis', expanded_query='diagnosis', expansion_strategy=<ExpansionStrategy.KEYWORD: 'keyword'>, added_terms=[], reasoning=None, confidence=1.0, metadata={'passthrough': True, 'error': 'RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]'}), execution_time_ms=3678.182601928711, cache_hit=False, llm_used=None, timestamp=datetime.datetime(2025, 12, 11, 18, 16, 8, 28630), metadata={'error': 'RetryError[<Future at 0x706f203f8b90 state=finished raised AuthenticationError>]'}).primary_expansion
FAILED tests/integration/strategies/test_query_expansion_integration.py::TestQueryExpansionIntegration::test_stats_tracking - assert 0 >= 1
=================== 9 failed, 2 passed, 2 warnings in 56.31s ===================

[32/156] PASSED: tests/integration/strategies/test_reranking_integration.py
  Tests: 9 (P:8 F:0 S:1)
[33/156] PASSED: tests/integration/strategies/test_self_reflective_integration.py
  Tests: 4 (P:3 F:0 S:1)
[34/156] PASSED: tests/integration/strategies/test_vector_embedding_indexing.py
  Tests: 5 (P:5 F:0 S:0)
[35/156] FAILED: tests/integration/test_config_integration.py
  Tests: 10 (P:6 F:4 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/integration/test_config_integration.py::test_load_validate_use_config PASSED [ 12%]
tests/integration/test_config_integration.py::test_multi_environment_configuration PASSED [ 25%]
tests/integration/test_config_integration.py::test_config_with_factory FAILED [ 37%]
tests/integration/test_config_integration.py::test_config_with_pipeline FAILED [ 50%]
tests/integration/test_config_integration.py::test_complete_real_world_scenario PASSED [ 62%]
tests/integration/test_config_integration.py::test_config_export_and_reimport PASSED [ 75%]
tests/integration/test_config_integration.py::test_json_configuration_integration PASSED [ 87%]
tests/integration/test_config_integration.py::test_deeply_nested_configuration_access PASSED [100%]

=================================== FAILURES ===================================
___________________________ test_config_with_factory ___________________________
tests/integration/test_config_integration.py:176: in test_config_with_factory
    strategy = RAGFactory.create_strategy(
rag_factory/factory.py:202: in create_strategy
    if name not in self._registry:
                   ^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute '_registry'
__________________________ test_config_with_pipeline ___________________________
tests/integration/test_config_integration.py:218: in test_config_with_pipeline
    pipeline = StrategyPipeline.from_config(pipeline_config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/pipeline.py:496: in from_config
    strategy = factory.create_strategy(
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class TestIntegrationStrategy without an implementation for abstract method 'requires_services'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     50    68%   136, 222, 231-232, 248, 259-266, 275, 358, 367, 389, 395, 416-440, 450-451, 464-469, 479, 497, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    132    29%   144, 165-170, 203-204, 222, 226-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    108    31%   160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 501-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9227    17%
=========================== short test summary info ============================
FAILED tests/integration/test_config_integration.py::test_config_with_factory - AttributeError: 'str' object has no attribute '_registry'
FAILED tests/integration/test_config_integration.py::test_config_with_pipeline - TypeError: Can't instantiate abstract class TestIntegrationStrategy without an implementation for abstract method 'requires_services'
=================== 2 failed, 6 passed, 2 warnings in 3.93s ====================

[36/156] PASSED: tests/integration/test_factory_consistency.py
  Tests: 8 (P:8 F:0 S:0)
[37/156] FAILED: tests/integration/test_factory_integration.py
  Tests: 21 (P:1 F:20 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 11 items

tests/integration/test_factory_integration.py::test_register_create_use_strategy FAILED [  9%]
tests/integration/test_factory_integration.py::test_create_multiple_different_strategies FAILED [ 18%]
tests/integration/test_factory_integration.py::test_create_multiple_instances_of_same_strategy FAILED [ 27%]
tests/integration/test_factory_integration.py::test_dependency_injection PASSED [ 36%]
tests/integration/test_factory_integration.py::test_config_file_with_yaml FAILED [ 45%]
tests/integration/test_factory_integration.py::test_config_file_with_json FAILED [ 54%]
tests/integration/test_factory_integration.py::test_factory_error_recovery FAILED [ 63%]
tests/integration/test_factory_integration.py::test_factory_state_after_failed_creation FAILED [ 72%]
tests/integration/test_factory_integration.py::test_decorator_integration FAILED [ 81%]
tests/integration/test_factory_integration.py::test_full_rag_workflow FAILED [ 90%]
tests/integration/test_factory_integration.py::test_async_retrieve_integration FAILED [100%]

=================================== FAILURES ===================================
______________________ test_register_create_use_strategy _______________________
tests/integration/test_factory_integration.py:226: in test_register_create_use_strategy
    strategy = factory.create_strategy("dummy", config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
__________________ test_create_multiple_different_strategies ___________________
tests/integration/test_factory_integration.py:263: in test_create_multiple_different_strategies
    strategy_a = factory.create_strategy("strategy_a")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class StrategyA without an implementation for abstract method 'requires_services'
_______________ test_create_multiple_instances_of_same_strategy ________________
tests/integration/test_factory_integration.py:288: in test_create_multiple_instances_of_same_strategy
    strategy1 = factory.create_strategy("dummy", config1)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
__________________________ test_config_file_with_yaml __________________________
tests/integration/test_factory_integration.py:346: in test_config_file_with_yaml
    strategy = factory.create_from_config(str(config_file))
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:324: in create_from_config
    return self.create_strategy(strategy_name, config_dict)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
__________________________ test_config_file_with_json __________________________
tests/integration/test_factory_integration.py:372: in test_config_file_with_json
    strategy = factory.create_from_config(str(config_file))
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:324: in create_from_config
    return self.create_strategy(strategy_name, config_dict)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
_________________________ test_factory_error_recovery __________________________
tests/integration/test_factory_integration.py:390: in test_factory_error_recovery
    factory.create_strategy("broken", {"chunk_size": 512})
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class BrokenStrategy without an implementation for abstract method 'requires_services'
___________________ test_factory_state_after_failed_creation ___________________
tests/integration/test_factory_integration.py:408: in test_factory_state_after_failed_creation
    factory.create_strategy("dummy", {"chunk_size": -100})
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
__________________________ test_decorator_integration __________________________
tests/integration/test_factory_integration.py:458: in test_decorator_integration
    strategy = new_factory.create_strategy("decorated_strategy")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DecoratedStrategy without an implementation for abstract method 'requires_services'
____________________________ test_full_rag_workflow ____________________________
tests/integration/test_factory_integration.py:469: in test_full_rag_workflow
    strategy = factory.create_strategy("dummy", config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
_______________________ test_async_retrieve_integration ________________________
tests/integration/test_factory_integration.py:503: in test_async_retrieve_integration
    strategy = factory.create_strategy("dummy", {"top_k": 5})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    114    39%   144, 165-170, 203-204, 222, 226-230, 256-270, 303, 313, 319, 347-348, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9268    16%
=========================== short test summary info ============================
FAILED tests/integration/test_factory_integration.py::test_register_create_use_strategy - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_factory_integration.py::test_create_multiple_different_strategies - TypeError: Can't instantiate abstract class StrategyA without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_factory_integration.py::test_create_multiple_instances_of_same_strategy - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_factory_integration.py::test_config_file_with_yaml - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_factory_integration.py::test_config_file_with_json - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_factory_integration.py::test_factory_error_recovery - TypeError: Can't instantiate abstract class BrokenStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_factory_integration.py::test_factory_state_after_failed_creation - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_factory_integration.py::test_decorator_integration - TypeError: Can't instantiate abstract class DecoratedStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_factory_integration.py::test_full_rag_workflow - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_factory_integration.py::test_async_retrieve_integration - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
=================== 10 failed, 1 passed, 2 warnings in 4.66s ===================

[38/156] FAILED: tests/integration/test_package_integration.py
  Tests: 6 (P:1 F:4 S:1)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 4 items

tests/integration/test_package_integration.py::TestPackageInstallation::test_package_installable FAILED [ 25%]
tests/integration/test_package_integration.py::TestSmokeTest::test_basic_usage_smoke_test PASSED [ 50%]
tests/integration/test_package_integration.py::TestFullWorkflow::test_full_workflow_with_installed_package FAILED [ 75%]
tests/integration/test_package_integration.py::TestBuildAndDistribution::test_package_can_be_built SKIPPED [100%]

=================================== FAILURES ===================================
_______________ TestPackageInstallation.test_package_installable _______________
tests/integration/test_package_integration.py:50: in test_package_installable
    assert result.returncode == 0
E   assert 1 == 0
E    +  where 1 = CompletedProcess(args=['/tmp/pytest-of-admindevmac/pytest-49/test_package_installable0/venv/bin/python', '-c', 'import rag_factory; print(rag_factory.__version__)'], returncode=1, stdout='', stderr='Traceback (most recent call last):\n  File "<string>", line 1, in <module>\n  File "/mnt/MCPProyects/ragTools/rag_factory/__init__.py", line 12, in <module>\n    from rag_factory.factory import (\n  File "/mnt/MCPProyects/ragTools/rag_factory/factory.py", line 33, in <module>\n    from rag_factory.strategies.base import IRAGStrategy, StrategyConfig\n  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/__init__.py", line 3, in <module>\n    from rag_factory.strategies.base import (\n  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/base.py", line 34, in <module>\n    from rag_factory.services.dependencies import StrategyDependencies, ServiceDependency\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/__init__.py", line 28, in <module>\n    from rag_factory.services.onnx import (\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/onnx/__init__.py", line 7, in <module>\n    from rag_factory.services.onnx.embedding import ONNXEmbeddingService\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/onnx/embedding.py", line 12, in <module>\n    from rag_factory.services.embedding.providers.onnx_local import ONNXLocalProvider\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/embedding/__init__.py", line 3, in <module>\n    from .service import EmbeddingService\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/embedding/service.py", line 11, in <module>\n    from .providers import OpenAIProvider, CohereProvider, LocalProvider, ONNXLocalProvider\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/embedding/providers/__init__.py", line 6, in <module>\n    from .onnx_local import ONNXLocalProvider\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/embedding/providers/onnx_local.py", line 12, in <module>\n    import numpy as np\nModuleNotFoundError: No module named \'numpy\'\n').returncode
----------------------------- Captured stdout call -----------------------------
Obtaining file:///mnt/MCPProyects/ragTools
  Installing build dependencies: started
  Installing build dependencies: finished with status 'done'
  Checking if build backend supports build_editable: started
  Checking if build backend supports build_editable: finished with status 'done'
  Getting requirements to build editable: started
  Getting requirements to build editable: finished with status 'done'
  Preparing editable metadata (pyproject.toml): started
  Preparing editable metadata (pyproject.toml): finished with status 'done'
Collecting pydantic>=2.0.0 (from rag-factory==0.1.0)
  Using cached pydantic-2.12.5-py3-none-any.whl.metadata (90 kB)
Collecting pyyaml>=6.0 (from rag-factory==0.1.0)
  Using cached pyyaml-6.0.3-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (2.4 kB)
Collecting annotated-types>=0.6.0 (from pydantic>=2.0.0->rag-factory==0.1.0)
  Using cached annotated_types-0.7.0-py3-none-any.whl.metadata (15 kB)
Collecting pydantic-core==2.41.5 (from pydantic>=2.0.0->rag-factory==0.1.0)
  Using cached pydantic_core-2.41.5-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (7.3 kB)
Collecting typing-extensions>=4.14.1 (from pydantic>=2.0.0->rag-factory==0.1.0)
  Using cached typing_extensions-4.15.0-py3-none-any.whl.metadata (3.3 kB)
Collecting typing-inspection>=0.4.2 (from pydantic>=2.0.0->rag-factory==0.1.0)
  Using cached typing_inspection-0.4.2-py3-none-any.whl.metadata (2.6 kB)
Using cached pydantic-2.12.5-py3-none-any.whl (463 kB)
Using cached pydantic_core-2.41.5-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.1 MB)
Using cached pyyaml-6.0.3-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (807 kB)
Using cached annotated_types-0.7.0-py3-none-any.whl (13 kB)
Using cached typing_extensions-4.15.0-py3-none-any.whl (44 kB)
Using cached typing_inspection-0.4.2-py3-none-any.whl (14 kB)
Building wheels for collected packages: rag-factory
  Building editable for rag-factory (pyproject.toml): started
  Building editable for rag-factory (pyproject.toml): finished with status 'done'
  Created wheel for rag-factory: filename=rag_factory-0.1.0-0.editable-py3-none-any.whl size=6329 sha256=367c125a57dd8624a53da69a28cfcdee520fd5240eae85a316c12f24fdc0b02d
  Stored in directory: /tmp/pip-ephem-wheel-cache-f624we_w/wheels/08/27/d0/02501a029db205cc4e40972294db0f3cd8ac5253539696b270
Successfully built rag-factory
Installing collected packages: typing-extensions, pyyaml, annotated-types, typing-inspection, pydantic-core, pydantic, rag-factory
Successfully installed annotated-types-0.7.0 pydantic-2.12.5 pydantic-core-2.41.5 pyyaml-6.0.3 rag-factory-0.1.0 typing-extensions-4.15.0 typing-inspection-0.4.2
__________ TestFullWorkflow.test_full_workflow_with_installed_package __________
tests/integration/test_package_integration.py:138: in test_full_workflow_with_installed_package
    strategy = factory.create_strategy("test")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     96    38%   134-139, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    132    29%   144, 165-170, 203-204, 222, 226-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    114    27%   160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     10    82%   81, 83, 85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9276    16%
=========================== short test summary info ============================
FAILED tests/integration/test_package_integration.py::TestPackageInstallation::test_package_installable - assert 1 == 0
 +  where 1 = CompletedProcess(args=['/tmp/pytest-of-admindevmac/pytest-49/test_package_installable0/venv/bin/python', '-c', 'import rag_factory; print(rag_factory.__version__)'], returncode=1, stdout='', stderr='Traceback (most recent call last):\n  File "<string>", line 1, in <module>\n  File "/mnt/MCPProyects/ragTools/rag_factory/__init__.py", line 12, in <module>\n    from rag_factory.factory import (\n  File "/mnt/MCPProyects/ragTools/rag_factory/factory.py", line 33, in <module>\n    from rag_factory.strategies.base import IRAGStrategy, StrategyConfig\n  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/__init__.py", line 3, in <module>\n    from rag_factory.strategies.base import (\n  File "/mnt/MCPProyects/ragTools/rag_factory/strategies/base.py", line 34, in <module>\n    from rag_factory.services.dependencies import StrategyDependencies, ServiceDependency\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/__init__.py", line 28, in <module>\n    from rag_factory.services.onnx import (\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/onnx/__init__.py", line 7, in <module>\n    from rag_factory.services.onnx.embedding import ONNXEmbeddingService\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/onnx/embedding.py", line 12, in <module>\n    from rag_factory.services.embedding.providers.onnx_local import ONNXLocalProvider\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/embedding/__init__.py", line 3, in <module>\n    from .service import EmbeddingService\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/embedding/service.py", line 11, in <module>\n    from .providers import OpenAIProvider, CohereProvider, LocalProvider, ONNXLocalProvider\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/embedding/providers/__init__.py", line 6, in <module>\n    from .onnx_local import ONNXLocalProvider\n  File "/mnt/MCPProyects/ragTools/rag_factory/services/embedding/providers/onnx_local.py", line 12, in <module>\n    import numpy as np\nModuleNotFoundError: No module named \'numpy\'\n').returncode
FAILED tests/integration/test_package_integration.py::TestFullWorkflow::test_full_workflow_with_installed_package - TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
============= 2 failed, 1 passed, 1 skipped, 2 warnings in 29.99s ==============

[39/156] FAILED: tests/integration/test_pipeline_integration.py
  Tests: 14 (P:0 F:14 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 7 items

tests/integration/test_pipeline_integration.py::test_three_strategy_pipeline FAILED [ 14%]
tests/integration/test_pipeline_integration.py::test_parallel_faster_than_sequential FAILED [ 28%]
tests/integration/test_pipeline_integration.py::test_pipeline_continues_after_non_critical_failure FAILED [ 42%]
tests/integration/test_pipeline_integration.py::test_load_pipeline_from_yaml FAILED [ 57%]
tests/integration/test_pipeline_integration.py::test_async_sequential_execution FAILED [ 71%]
tests/integration/test_pipeline_integration.py::test_async_fallback_execution FAILED [ 85%]
tests/integration/test_pipeline_integration.py::test_parallel_execution_with_failures FAILED [100%]

=================================== FAILURES ===================================
_________________________ test_three_strategy_pipeline _________________________
tests/integration/test_pipeline_integration.py:79: in test_three_strategy_pipeline
    strategy1 = TestStrategy("S1")
                ^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
_____________________ test_parallel_faster_than_sequential _____________________
tests/integration/test_pipeline_integration.py:102: in test_parallel_faster_than_sequential
    strategy1 = TestStrategy("S1", delay=0.1)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
______________ test_pipeline_continues_after_non_critical_failure ______________
tests/integration/test_pipeline_integration.py:162: in test_pipeline_continues_after_non_critical_failure
    required_strategy = TestStrategy("Required")
                        ^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
_________________________ test_load_pipeline_from_yaml _________________________
tests/integration/test_pipeline_integration.py:260: in test_load_pipeline_from_yaml
    pipeline = StrategyPipeline.from_config(config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/pipeline.py:496: in from_config
    strategy = factory.create_strategy(
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class StrategyA without an implementation for abstract method 'requires_services'
_______________________ test_async_sequential_execution ________________________
tests/integration/test_pipeline_integration.py:275: in test_async_sequential_execution
    strategy1 = TestStrategy("Async1", delay=0.05)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
________________________ test_async_fallback_execution _________________________
tests/integration/test_pipeline_integration.py:327: in test_async_fallback_execution
    fallback_strategy = TestStrategy("Fallback")
                        ^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
____________________ test_parallel_execution_with_failures _____________________
tests/integration/test_pipeline_integration.py:368: in test_parallel_execution_with_failures
    working_strategy = TestStrategy("Working")
                       ^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    132    29%   144, 165-170, 203-204, 222, 226-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    108    31%   160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 501-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9276    16%
=========================== short test summary info ============================
FAILED tests/integration/test_pipeline_integration.py::test_three_strategy_pipeline - TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_pipeline_integration.py::test_parallel_faster_than_sequential - TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_pipeline_integration.py::test_pipeline_continues_after_non_critical_failure - TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_pipeline_integration.py::test_load_pipeline_from_yaml - TypeError: Can't instantiate abstract class StrategyA without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_pipeline_integration.py::test_async_sequential_execution - TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_pipeline_integration.py::test_async_fallback_execution - TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
FAILED tests/integration/test_pipeline_integration.py::test_parallel_execution_with_failures - TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
======================== 7 failed, 2 warnings in 4.11s =========================

[40/156] PASSED: tests/integration/test_tokenization_integration.py
  Tests: 16 (P:16 F:0 S:0)
[41/156] PASSED: tests/unit/cli/test_benchmark_command.py
  Tests: 5 (P:5 F:0 S:0)
[42/156] FAILED: tests/unit/cli/test_check_consistency_command.py
  Tests: 12 (P:10 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 11 items

tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_command_help PASSED [  9%]
tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_all_strategies_consistent PASSED [ 18%]
tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_strategies_with_warnings PASSED [ 27%]
tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_type_filter_indexing PASSED [ 36%]
tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_type_filter_retrieval PASSED [ 45%]
tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_invalid_type_filter PASSED [ 54%]
tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_strategy_filter PASSED [ 63%]
tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_verbose_mode PASSED [ 72%]
tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_config_file_loading FAILED [ 81%]
tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_system_error_returns_exit_code_1 PASSED [ 90%]
tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_strategies_with_errors PASSED [100%]

=================================== FAILURES ===================================
_____________ TestCheckConsistencyCommand.test_config_file_loading _____________
tests/unit/cli/test_check_consistency_command.py:220: in test_config_file_loading
    mock_validate_config.assert_called_once_with("config.yaml")
/usr/lib/python3.12/unittest/mock.py:955: in assert_called_once_with
    raise AssertionError(msg)
E   AssertionError: Expected 'validate_config_file' to be called once. Called 0 times.
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38      2    95%   77, 111
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61      0   100%
rag_factory/cli/formatters/output.py                                  20      6    70%   23-24, 63-64, 74, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30      8    73%   26-28, 49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9209    17%
=========================== short test summary info ============================
FAILED tests/unit/cli/test_check_consistency_command.py::TestCheckConsistencyCommand::test_config_file_loading - AssertionError: Expected 'validate_config_file' to be called once. Called 0 times.
=================== 1 failed, 10 passed, 2 warnings in 5.34s ===================

[43/156] PASSED: tests/unit/cli/test_config_validation_command.py
  Tests: 6 (P:6 F:0 S:0)
[44/156] PASSED: tests/unit/cli/test_consistency_formatter.py
  Tests: 10 (P:10 F:0 S:0)
[45/156] PASSED: tests/unit/cli/test_formatters.py
  Tests: 19 (P:19 F:0 S:0)
[46/156] PASSED: tests/unit/cli/test_index_command.py
  Tests: 5 (P:5 F:0 S:0)
[47/156] PASSED: tests/unit/cli/test_list_strategies_command.py
  Tests: 5 (P:5 F:0 S:0)
[48/156] PASSED: tests/unit/cli/test_query_command.py
  Tests: 5 (P:5 F:0 S:0)
[49/156] FAILED: tests/unit/cli/test_repl_command.py
  Tests: 5 (P:3 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 4 items

tests/unit/cli/test_repl_command.py::TestREPLCommand::test_repl_start PASSED [ 25%]
tests/unit/cli/test_repl_command.py::TestREPLCommand::test_repl_with_config PASSED [ 50%]
tests/unit/cli/test_repl_command.py::TestREPLSession::test_repl_session_init FAILED [ 75%]
tests/unit/cli/test_repl_command.py::TestREPLSession::test_repl_set_command PASSED [100%]

=================================== FAILURES ===================================
____________________ TestREPLSession.test_repl_session_init ____________________
/usr/lib/python3.12/unittest/mock.py:1387: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'rag_factory.cli.commands.repl' from '/mnt/MCPProyects/ragTools/rag_factory/cli/commands/repl.py'> does not have the attribute 'validate_config_file'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    109    29%   35-40, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 204-208, 212-221, 257-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      6    70%   43-44, 63-64, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9269    16%
=========================== short test summary info ============================
FAILED tests/unit/cli/test_repl_command.py::TestREPLSession::test_repl_session_init - AttributeError: <module 'rag_factory.cli.commands.repl' from '/mnt/MCPProyects/ragTools/rag_factory/cli/commands/repl.py'> does not have the attribute 'validate_config_file'
=================== 1 failed, 3 passed, 2 warnings in 4.95s ====================

[50/156] PASSED: tests/unit/cli/test_validate_pipeline_command.py
  Tests: 8 (P:8 F:0 S:0)
[51/156] PASSED: tests/unit/cli/test_validation_formatter.py
  Tests: 14 (P:14 F:0 S:0)
[52/156] PASSED: tests/unit/cli/test_validation.py
  Tests: 17 (P:17 F:0 S:0)
[53/156] PASSED: tests/unit/config/test_env_validator.py
  Tests: 19 (P:19 F:0 S:0)
[54/156] PASSED: tests/unit/core/test_capabilities.py
  Tests: 19 (P:19 F:0 S:0)
[55/156] PASSED: tests/unit/core/test_factory_validation.py
  Tests: 7 (P:7 F:0 S:0)
[56/156] PASSED: tests/unit/core/test_indexing_interface.py
  Tests: 27 (P:27 F:0 S:0)
[57/156] PASSED: tests/unit/core/test_pipeline.py
  Tests: 9 (P:9 F:0 S:0)
[58/156] PASSED: tests/unit/core/test_retrieval_interface.py
  Tests: 14 (P:14 F:0 S:0)
[59/156] PASSED: tests/unit/database/test_batch_operations.py
  Tests: 2 (P:2 F:0 S:0)
[60/156] FAILED: tests/unit/database/test_connection.py
  Tests: 15 (P:13 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 14 items

tests/unit/database/test_connection.py::TestDatabaseConnection::test_connection_initialization PASSED [  7%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_connection_with_default_config PASSED [ 14%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_session_context_manager_commit PASSED [ 21%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_session_context_manager_rollback PASSED [ 28%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_health_check_success PASSED [ 35%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_health_check_failure PASSED [ 42%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_get_pool_status PASSED [ 50%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_create_tables PASSED [ 57%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_drop_tables FAILED [ 64%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_context_manager PASSED [ 71%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_multiple_sessions PASSED [ 78%]
tests/unit/database/test_connection.py::TestDatabaseConnection::test_pool_configuration PASSED [ 85%]
tests/unit/database/test_connection.py::TestDatabaseConnectionEvents::test_on_connect_event PASSED [ 92%]
tests/unit/database/test_connection.py::TestDatabaseConnectionEvents::test_on_checkout_event PASSED [100%]

=================================== FAILURES ===================================
___________________ TestDatabaseConnection.test_drop_tables ____________________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.DependentObjectsStillExist: cannot drop table chunks because other objects depend on it
E   DETAIL:  view chunk_hierarchy_validation depends on table chunks
E   HINT:  Use DROP ... CASCADE to drop the dependent objects too.

The above exception was the direct cause of the following exception:
tests/unit/database/test_connection.py:87: in test_drop_tables
    db_connection.drop_tables()
rag_factory/database/connection.py:179: in drop_tables
    Base.metadata.drop_all(bind=self.engine)
venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5856: in drop_all
    bind._run_ddl_visitor(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:1075: in visit_metadata
    self.traverse_single(
venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:1142: in visit_table
    DropTable(table)._invoke_with(self.connection)
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:315: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.InternalError: (psycopg2.errors.DependentObjectsStillExist) cannot drop table chunks because other objects depend on it
E   DETAIL:  view chunk_hierarchy_validation depends on table chunks
E   HINT:  Use DROP ... CASCADE to drop the dependent objects too.
E   
E   [SQL: 
E   DROP TABLE chunks]
E   (Background on this error at: https://sqlalche.me/e/20/2j85)
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.database.connection:connection.py:182 Failed to drop database tables: (psycopg2.errors.DependentObjectsStillExist) cannot drop table chunks because other objects depend on it
DETAIL:  view chunk_hierarchy_validation depends on table chunks
HINT:  Use DROP ... CASCADE to drop the dependent objects too.

[SQL: 
DROP TABLE chunks]
(Background on this error at: https://sqlalche.me/e/20/2j85)
---------------------------- Captured log teardown -----------------------------
ERROR    rag_factory.database.connection:connection.py:182 Failed to drop database tables: (psycopg2.errors.DependentObjectsStillExist) cannot drop table chunks because other objects depend on it
DETAIL:  view chunk_hierarchy_validation depends on table chunks
HINT:  Use DROP ... CASCADE to drop the dependent objects too.

[SQL: 
DROP TABLE chunks]
(Background on this error at: https://sqlalche.me/e/20/2j85)
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80      7    91%   168-170, 180, 212-214
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9248    16%
=========================== short test summary info ============================
FAILED tests/unit/database/test_connection.py::TestDatabaseConnection::test_drop_tables - sqlalchemy.exc.InternalError: (psycopg2.errors.DependentObjectsStillExist) cannot drop table chunks because other objects depend on it
DETAIL:  view chunk_hierarchy_validation depends on table chunks
HINT:  Use DROP ... CASCADE to drop the dependent objects too.

[SQL: 
DROP TABLE chunks]
(Background on this error at: https://sqlalche.me/e/20/2j85)
=================== 1 failed, 13 passed, 2 warnings in 7.52s ===================

[61/156] PASSED: tests/unit/database/test_migrations.py
  Tests: 7 (P:7 F:0 S:0)
[62/156] FAILED: tests/unit/database/test_models.py
  Tests: 22 (P:20 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 21 items

tests/unit/database/test_models.py::TestDocumentModel::test_document_model_has_required_columns PASSED [  4%]
tests/unit/database/test_models.py::TestDocumentModel::test_document_creation PASSED [  9%]
tests/unit/database/test_models.py::TestDocumentModel::test_document_default_values PASSED [ 14%]
tests/unit/database/test_models.py::TestDocumentModel::test_document_metadata_accepts_json PASSED [ 19%]
tests/unit/database/test_models.py::TestDocumentModel::test_document_status_values PASSED [ 23%]
tests/unit/database/test_models.py::TestDocumentModel::test_document_repr PASSED [ 28%]
tests/unit/database/test_models.py::TestDocumentModel::test_document_persistence FAILED [ 33%]
tests/unit/database/test_models.py::TestChunkModel::test_chunk_model_has_required_columns PASSED [ 38%]
tests/unit/database/test_models.py::TestChunkModel::test_chunk_creation PASSED [ 42%]
tests/unit/database/test_models.py::TestChunkModel::test_chunk_creation_with_embedding PASSED [ 47%]
tests/unit/database/test_models.py::TestChunkModel::test_chunk_default_values PASSED [ 52%]
tests/unit/database/test_models.py::TestChunkModel::test_chunk_metadata_accepts_json PASSED [ 57%]
tests/unit/database/test_models.py::TestChunkModel::test_chunk_repr PASSED [ 61%]
tests/unit/database/test_models.py::TestChunkModel::test_chunk_repr_without_embedding PASSED [ 66%]
tests/unit/database/test_models.py::TestChunkModel::test_chunk_persistence PASSED [ 71%]
tests/unit/database/test_models.py::TestModelRelationships::test_foreign_key_relationship PASSED [ 76%]
tests/unit/database/test_models.py::TestModelRelationships::test_document_chunks_relationship PASSED [ 80%]
tests/unit/database/test_models.py::TestModelRelationships::test_chunk_document_relationship PASSED [ 85%]
tests/unit/database/test_models.py::TestModelRelationships::test_cascade_delete PASSED [ 90%]
tests/unit/database/test_models.py::TestModelIndexes::test_document_indexes PASSED [ 95%]
tests/unit/database/test_models.py::TestModelIndexes::test_chunk_indexes PASSED [100%]
tests/unit/database/test_models.py::TestModelIndexes::test_chunk_indexes ERROR [100%]

==================================== ERRORS ====================================
___________ ERROR at teardown of TestModelIndexes.test_chunk_indexes ___________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.DependentObjectsStillExist: cannot drop table chunks because other objects depend on it
E   DETAIL:  view chunk_hierarchy_validation depends on table chunks
E   HINT:  Use DROP ... CASCADE to drop the dependent objects too.

The above exception was the direct cause of the following exception:
tests/conftest.py:138: in db_engine
    Base.metadata.drop_all(engine)
venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:5856: in drop_all
    bind._run_ddl_visitor(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:1075: in visit_metadata
    self.traverse_single(
venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
           ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:1142: in visit_table
    DropTable(table)._invoke_with(self.connection)
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:315: in _invoke_with
    return bind.execute(self)
           ^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.InternalError: (psycopg2.errors.DependentObjectsStillExist) cannot drop table chunks because other objects depend on it
E   DETAIL:  view chunk_hierarchy_validation depends on table chunks
E   HINT:  Use DROP ... CASCADE to drop the dependent objects too.
E   
E   [SQL: 
E   DROP TABLE chunks]
E   (Background on this error at: https://sqlalche.me/e/20/2j85)
=================================== FAILURES ===================================
_________________ TestDocumentModel.test_document_persistence __________________
tests/unit/database/test_models.py:127: in test_document_persistence
    assert retrieved.total_chunks == 5
E   AssertionError: assert 0 == 5
E    +  where 0 = <Document(id=3851962a-88a5-4a52-bdfd-fbbd7ab8f21c, filename='test.txt', status='pending', chunks=0)>.total_chunks
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

tests/unit/database/test_models.py: 26 warnings
  /mnt/MCPProyects/ragTools/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:3592: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     10    88%   34, 42-45, 52, 69, 73, 77, 81, 85
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9273    16%
=========================== short test summary info ============================
FAILED tests/unit/database/test_models.py::TestDocumentModel::test_document_persistence - AssertionError: assert 0 == 5
 +  where 0 = <Document(id=3851962a-88a5-4a52-bdfd-fbbd7ab8f21c, filename='test.txt', status='pending', chunks=0)>.total_chunks
ERROR tests/unit/database/test_models.py::TestModelIndexes::test_chunk_indexes - sqlalchemy.exc.InternalError: (psycopg2.errors.DependentObjectsStillExist) cannot drop table chunks because other objects depend on it
DETAIL:  view chunk_hierarchy_validation depends on table chunks
HINT:  Use DROP ... CASCADE to drop the dependent objects too.

[SQL: 
DROP TABLE chunks]
(Background on this error at: https://sqlalche.me/e/20/2j85)
============== 1 failed, 20 passed, 28 warnings, 1 error in 6.05s ==============

[63/156] PASSED: tests/unit/database/test_pgvector.py
  Tests: 3 (P:3 F:0 S:0)
[64/156] PASSED: tests/unit/database/test_vector_indexing.py
  Tests: 4 (P:4 F:0 S:0)
[65/156] FAILED: tests/unit/documentation/test_code_examples.py
  Tests: 7 (P:2 F:4 S:1)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 5 items

tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_all_code_examples_have_valid_syntax FAILED [ 20%]
tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_strategy_examples_have_imports PASSED [ 40%]
tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_configuration_examples_valid SKIPPED [ 60%]
tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_quick_start_example_complete PASSED [ 80%]
tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_no_placeholder_code FAILED [100%]

=================================== FAILURES ===================================
__________ TestCodeExamples.test_all_code_examples_have_valid_syntax ___________
tests/unit/documentation/test_code_examples.py:40: in test_all_code_examples_have_valid_syntax
    examples = self.extract_python_examples(md_file)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/unit/documentation/test_code_examples.py:28: in extract_python_examples
    content = f.read()
              ^^^^^^^^
<frozen codecs>:322: in decode
    ???
E   UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 579: invalid start byte
__________________ TestCodeExamples.test_no_placeholder_code ___________________
tests/unit/documentation/test_code_examples.py:125: in test_no_placeholder_code
    examples = self.extract_python_examples(md_file)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/unit/documentation/test_code_examples.py:28: in extract_python_examples
    content = f.read()
              ^^^^^^^^
<frozen codecs>:322: in decode
    ???
E   UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 579: invalid start byte
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9295    16%
=========================== short test summary info ============================
FAILED tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_all_code_examples_have_valid_syntax - UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 579: invalid start byte
FAILED tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_no_placeholder_code - UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 579: invalid start byte
============== 2 failed, 2 passed, 1 skipped, 2 warnings in 4.29s ==============

[66/156] FAILED: tests/unit/documentation/test_documentation_completeness.py
  Tests: 9 (P:7 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/unit/documentation/test_documentation_completeness.py::TestDocumentationCompleteness::test_required_doc_files_exist PASSED [ 12%]
tests/unit/documentation/test_documentation_completeness.py::TestDocumentationCompleteness::test_all_strategies_documented PASSED [ 25%]
tests/unit/documentation/test_documentation_completeness.py::TestDocumentationCompleteness::test_all_public_classes_documented PASSED [ 37%]
tests/unit/documentation/test_documentation_completeness.py::TestDocumentationCompleteness::test_all_public_methods_documented PASSED [ 50%]
tests/unit/documentation/test_documentation_completeness.py::TestDocumentationCompleteness::test_documentation_completeness_score PASSED [ 62%]
tests/unit/documentation/test_documentation_completeness.py::TestDocumentationCompleteness::test_mkdocs_config_valid FAILED [ 75%]
tests/unit/documentation/test_documentation_completeness.py::TestDocumentationCompleteness::test_readme_exists PASSED [ 87%]
tests/unit/documentation/test_documentation_completeness.py::TestDocumentationCompleteness::test_changelog_exists PASSED [100%]

=================================== FAILURES ===================================
____________ TestDocumentationCompleteness.test_mkdocs_config_valid ____________
tests/unit/documentation/test_documentation_completeness.py:201: in test_mkdocs_config_valid
    config = yaml.safe_load(f)
             ^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/yaml/__init__.py:125: in safe_load
    return load(stream, SafeLoader)
           ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/yaml/__init__.py:81: in load
    return loader.get_single_data()
           ^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/yaml/constructor.py:51: in get_single_data
    return self.construct_document(node)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/yaml/constructor.py:60: in construct_document
    for dummy in generator:
venv/lib/python3.12/site-packages/yaml/constructor.py:413: in construct_yaml_map
    value = self.construct_mapping(node)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/yaml/constructor.py:218: in construct_mapping
    return super().construct_mapping(node, deep=deep)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/yaml/constructor.py:143: in construct_mapping
    value = self.construct_object(value_node, deep=deep)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/yaml/constructor.py:100: in construct_object
    data = constructor(self, node)
           ^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/yaml/constructor.py:427: in construct_undefined
    raise ConstructorError(None, None,
E   yaml.constructor.ConstructorError: could not determine a constructor for the tag 'tag:yaml.org,2002:python/name:pymdownx.superfences.fence_code_format'
E     in "/mnt/MCPProyects/ragTools/mkdocs.yml", line 61, column 19
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9295    16%
=========================== short test summary info ============================
FAILED tests/unit/documentation/test_documentation_completeness.py::TestDocumentationCompleteness::test_mkdocs_config_valid - yaml.constructor.ConstructorError: could not determine a constructor for the tag 'tag:yaml.org,2002:python/name:pymdownx.superfences.fence_code_format'
  in "/mnt/MCPProyects/ragTools/mkdocs.yml", line 61, column 19
=================== 1 failed, 7 passed, 2 warnings in 8.81s ====================

[67/156] FAILED: tests/unit/documentation/test_links.py
  Tests: 7 (P:0 F:6 S:1)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 4 items

tests/unit/documentation/test_links.py::TestDocumentationLinks::test_no_broken_internal_links FAILED [ 25%]
tests/unit/documentation/test_links.py::TestDocumentationLinks::test_all_diagrams_valid FAILED [ 50%]
tests/unit/documentation/test_links.py::TestDocumentationLinks::test_no_todo_links FAILED [ 75%]
tests/unit/documentation/test_links.py::TestDocumentationLinks::test_external_links_valid SKIPPED [100%]

=================================== FAILURES ===================================
_____________ TestDocumentationLinks.test_no_broken_internal_links _____________
tests/unit/documentation/test_links.py:39: in test_no_broken_internal_links
    links = self.extract_links(md_file)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/unit/documentation/test_links.py:27: in extract_links
    content = f.read()
              ^^^^^^^^
<frozen codecs>:322: in decode
    ???
E   UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 579: invalid start byte
________________ TestDocumentationLinks.test_all_diagrams_valid ________________
tests/unit/documentation/test_links.py:72: in test_all_diagrams_valid
    content = f.read()
              ^^^^^^^^
<frozen codecs>:322: in decode
    ???
E   UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 579: invalid start byte
__________________ TestDocumentationLinks.test_no_todo_links ___________________
tests/unit/documentation/test_links.py:109: in test_no_todo_links
    links = self.extract_links(md_file)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/unit/documentation/test_links.py:27: in extract_links
    content = f.read()
              ^^^^^^^^
<frozen codecs>:322: in decode
    ???
E   UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 579: invalid start byte
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9295    16%
=========================== short test summary info ============================
FAILED tests/unit/documentation/test_links.py::TestDocumentationLinks::test_no_broken_internal_links - UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 579: invalid start byte
FAILED tests/unit/documentation/test_links.py::TestDocumentationLinks::test_all_diagrams_valid - UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 579: invalid start byte
FAILED tests/unit/documentation/test_links.py::TestDocumentationLinks::test_no_todo_links - UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 579: invalid start byte
=================== 3 failed, 1 skipped, 2 warnings in 4.35s ===================

[68/156] PASSED: tests/unit/evaluation/test_benchmark_suite.py
  Tests: 15 (P:15 F:0 S:0)
[69/156] PASSED: tests/unit/evaluation/test_comparison.py
  Tests: 14 (P:14 F:0 S:0)
[70/156] PASSED: tests/unit/evaluation/test_dataset_loader.py
  Tests: 14 (P:14 F:0 S:0)
[71/156] PASSED: tests/unit/evaluation/test_export.py
  Tests: 12 (P:12 F:0 S:0)
[72/156] PASSED: tests/unit/evaluation/test_retrieval_metrics.py
  Tests: 22 (P:22 F:0 S:0)
[73/156] PASSED: tests/unit/evaluation/test_statistical_testing.py
  Tests: 21 (P:21 F:0 S:0)
[74/156] PASSED: tests/unit/examples/test_examples_imports.py
  Tests: 7 (P:7 F:0 S:0)
[75/156] PASSED: tests/unit/examples/test_examples_syntax.py
  Tests: 8 (P:8 F:0 S:0)
[76/156] PASSED: tests/unit/examples/test_requirements.py
  Tests: 8 (P:8 F:0 S:0)
[77/156] PASSED: tests/unit/models/embedding/test_registry.py
  Tests: 22 (P:22 F:0 S:0)
[78/156] PASSED: tests/unit/models/evaluation/test_ab_testing.py
  Tests: 17 (P:17 F:0 S:0)
[79/156] PASSED: tests/unit/observability/test_cost_calculator.py
  Tests: 17 (P:17 F:0 S:0)
[80/156] PASSED: tests/unit/observability/test_filters.py
  Tests: 20 (P:20 F:0 S:0)
[81/156] PASSED: tests/unit/observability/test_logger.py
  Tests: 20 (P:20 F:0 S:0)
[82/156] PASSED: tests/unit/observability/test_metrics_collector.py
  Tests: 28 (P:28 F:0 S:0)
[83/156] PASSED: tests/unit/observability/test_performance_monitor.py
  Tests: 13 (P:13 F:0 S:0)
[84/156] PASSED: tests/unit/repositories/test_chunk_repository.py
  Tests: 32 (P:32 F:0 S:0)
[85/156] PASSED: tests/unit/repositories/test_document_repository.py
  Tests: 25 (P:25 F:0 S:0)
[86/156] PASSED: tests/unit/repositories/test_exceptions.py
  Tests: 12 (P:12 F:0 S:0)
[87/156] FAILED: tests/unit/services/embeddings/test_onnx_local.py
  Tests: 21 (P:17 F:4 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 19 items

tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_initialization PASSED [  5%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_initialization_with_custom_config PASSED [ 10%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_get_embeddings_single_text PASSED [ 15%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_get_embeddings_multiple_texts PASSED [ 21%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_get_embeddings_empty_list PASSED [ 26%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_embedding_normalization PASSED [ 31%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_tokenization_with_tiktoken FAILED [ 36%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_tokenization_simple_fallback FAILED [ 42%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_get_dimensions PASSED [ 47%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_get_max_batch_size PASSED [ 52%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_get_model_name PASSED [ 57%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_calculate_cost PASSED [ 63%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_known_models PASSED [ 68%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_missing_onnx_runtime PASSED [ 73%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_missing_huggingface_hub PASSED [ 78%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_model_download_failure PASSED [ 84%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_session_creation_failure PASSED [ 89%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_embedding_error_handling PASSED [ 94%]
tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_batch_processing PASSED [100%]

=================================== FAILURES ===================================
____________ TestONNXLocalProvider.test_tokenization_with_tiktoken _____________
tests/unit/services/embeddings/test_onnx_local.py:143: in test_tokenization_with_tiktoken
    if mock_provider.tokenizer_type == "tiktoken":
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'ONNXLocalProvider' object has no attribute 'tokenizer_type'
------------------------------ Captured log setup ------------------------------
WARNING  rag_factory.services.embedding.providers.onnx_local:onnx_local.py:177 No tokenizer.json found in /
WARNING  rag_factory.services.embedding.providers.onnx_local:onnx_local.py:180 Could not load tokenizer: tokenizer.json not found
WARNING  rag_factory.services.embedding.providers.onnx_local:onnx_local.py:181 Falling back to basic tokenizer (may not work correctly)
___________ TestONNXLocalProvider.test_tokenization_simple_fallback ____________
tests/unit/services/embeddings/test_onnx_local.py:164: in test_tokenization_simple_fallback
    result = mock_provider.get_embeddings(["Test document"])
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/embedding/providers/onnx_local.py:213: in get_embeddings
    input_ids, attention_mask = self._tokenize(texts)
                                ^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/embedding/providers/onnx_local.py:294: in _tokenize
    tokens = self.tokenizer.encode(text)
             ^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'encode'
------------------------------ Captured log setup ------------------------------
WARNING  rag_factory.services.embedding.providers.onnx_local:onnx_local.py:177 No tokenizer.json found in /
WARNING  rag_factory.services.embedding.providers.onnx_local:onnx_local.py:180 Could not load tokenizer: tokenizer.json not found
WARNING  rag_factory.services.embedding.providers.onnx_local:onnx_local.py:181 Falling back to basic tokenizer (may not work correctly)
------------------------------ Captured log call -------------------------------
ERROR    rag_factory.services.embedding.providers.onnx_local:onnx_local.py:249 ONNX embedding error: 'NoneType' object has no attribute 'encode'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     26    78%   18-19, 24-25, 121, 145, 150-154, 165, 175, 263-283, 298
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    137    20%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 449-450, 464, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     59    38%   39-40, 53-64, 93-94, 100-101, 105-114, 129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9202    17%
=========================== short test summary info ============================
FAILED tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_tokenization_with_tiktoken - AttributeError: 'ONNXLocalProvider' object has no attribute 'tokenizer_type'
FAILED tests/unit/services/embeddings/test_onnx_local.py::TestONNXLocalProvider::test_tokenization_simple_fallback - AttributeError: 'NoneType' object has no attribute 'encode'
=================== 2 failed, 17 passed, 2 warnings in 5.07s ===================

[88/156] PASSED: tests/unit/services/embedding/test_cache.py
  Tests: 10 (P:10 F:0 S:0)
[89/156] FAILED: tests/unit/services/embedding/test_onnx_local_provider.py
  Tests: 11 (P:9 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 10 items

tests/unit/services/embedding/test_onnx_local_provider.py::test_provider_not_available_raises_error PASSED [ 10%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_provider_initialization PASSED [ 20%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_get_embeddings PASSED [ 30%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_calculate_cost_is_zero PASSED [ 40%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_known_model_dimensions PASSED [ 50%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_unknown_model_uses_output_shape PASSED [ 60%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_custom_batch_size PASSED [ 70%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_model_loading_failure PASSED [ 80%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_get_model_name PASSED [ 90%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_mean_pooling FAILED [100%]

=================================== FAILURES ===================================
______________________________ test_mean_pooling _______________________________
tests/unit/services/embedding/test_onnx_local_provider.py:306: in test_mean_pooling
    result = provider._mean_pooling(token_embeddings, attention_mask)
             ^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'ONNXLocalProvider' object has no attribute '_mean_pooling'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     32    72%   18-19, 24-25, 99, 121, 145, 154, 165, 177-182, 201, 248-250, 273, 289-308
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    137    20%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 449-450, 464, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9222    17%
=========================== short test summary info ============================
FAILED tests/unit/services/embedding/test_onnx_local_provider.py::test_mean_pooling - AttributeError: 'ONNXLocalProvider' object has no attribute '_mean_pooling'
=================== 1 failed, 9 passed, 2 warnings in 4.09s ====================

[90/156] PASSED: tests/unit/services/embedding/test_openai_provider.py
  Tests: 9 (P:9 F:0 S:0)
[91/156] PASSED: tests/unit/services/embedding/test_rate_limiter.py
  Tests: 7 (P:7 F:0 S:0)
[92/156] PASSED: tests/unit/services/embedding/test_service.py
  Tests: 14 (P:14 F:0 S:0)
[93/156] PASSED: tests/unit/services/llm/test_anthropic_provider.py
  Tests: 10 (P:10 F:0 S:0)
[94/156] PASSED: tests/unit/services/llm/test_ollama_provider.py
  Tests: 10 (P:10 F:0 S:0)
[95/156] PASSED: tests/unit/services/llm/test_openai_provider.py
  Tests: 10 (P:10 F:0 S:0)
[96/156] PASSED: tests/unit/services/llm/test_prompt_template.py
  Tests: 13 (P:13 F:0 S:0)
[97/156] PASSED: tests/unit/services/llm/test_service.py
  Tests: 14 (P:14 F:0 S:0)
[98/156] PASSED: tests/unit/services/test_consistency.py
  Tests: 16 (P:16 F:0 S:0)
[99/156] FAILED: tests/unit/services/test_database_service.py
  Tests: 18 (P:2 F:16 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 10 items

tests/unit/services/test_database_service.py::test_service_initialization PASSED [ 10%]
tests/unit/services/test_database_service.py::test_ensure_table FAILED   [ 20%]
tests/unit/services/test_database_service.py::test_store_chunks FAILED   [ 30%]
tests/unit/services/test_database_service.py::test_store_empty_chunks PASSED [ 40%]
tests/unit/services/test_database_service.py::test_search_chunks FAILED  [ 50%]
tests/unit/services/test_database_service.py::test_get_chunk FAILED      [ 60%]
tests/unit/services/test_database_service.py::test_get_chunk_not_found FAILED [ 70%]
tests/unit/services/test_database_service.py::test_get_chunks_for_documents FAILED [ 80%]
tests/unit/services/test_database_service.py::test_close FAILED          [ 90%]
tests/unit/services/test_database_service.py::test_context_manager FAILED [100%]

=================================== FAILURES ===================================
______________________________ test_ensure_table _______________________________
tests/unit/services/test_database_service.py:58: in test_ensure_table
    await service._get_pool()
rag_factory/services/database/postgres.py:98: in _get_pool
    self._pool = await asyncpg.create_pool(
venv/lib/python3.12/site-packages/asyncpg/pool.py:439: in _async__init__
    await self._initialize()
venv/lib/python3.12/site-packages/asyncpg/pool.py:466: in _initialize
    await first_ch.connect()
venv/lib/python3.12/site-packages/asyncpg/pool.py:153: in connect
    self._con = await self._pool._get_new_connection()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/pool.py:538: in _get_new_connection
    con = await self._connect(
venv/lib/python3.12/site-packages/asyncpg/connection.py:2443: in connect
    return await connect_utils._connect(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1249: in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1218: in _connect
    conn = await _connect_addr(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1054: in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1099: in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:969: in _create_ssl_connection
    tr, pr = await loop.create_connection(
/usr/lib/python3.12/asyncio/base_events.py:1122: in create_connection
    raise exceptions[0]
/usr/lib/python3.12/asyncio/base_events.py:1104: in create_connection
    sock = await self._connect_sock(
/usr/lib/python3.12/asyncio/base_events.py:1007: in _connect_sock
    await self.sock_connect(sock, address)
/usr/lib/python3.12/asyncio/selector_events.py:651: in sock_connect
    return await fut
           ^^^^^^^^^
/usr/lib/python3.12/asyncio/selector_events.py:691: in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
E   ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
______________________________ test_store_chunks _______________________________
tests/unit/services/test_database_service.py:81: in test_store_chunks
    await service.store_chunks(chunks)
rag_factory/services/database/postgres.py:155: in store_chunks
    pool = await self._get_pool()
           ^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/database/postgres.py:98: in _get_pool
    self._pool = await asyncpg.create_pool(
venv/lib/python3.12/site-packages/asyncpg/pool.py:439: in _async__init__
    await self._initialize()
venv/lib/python3.12/site-packages/asyncpg/pool.py:466: in _initialize
    await first_ch.connect()
venv/lib/python3.12/site-packages/asyncpg/pool.py:153: in connect
    self._con = await self._pool._get_new_connection()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/pool.py:538: in _get_new_connection
    con = await self._connect(
venv/lib/python3.12/site-packages/asyncpg/connection.py:2443: in connect
    return await connect_utils._connect(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1249: in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1218: in _connect
    conn = await _connect_addr(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1054: in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1099: in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:969: in _create_ssl_connection
    tr, pr = await loop.create_connection(
/usr/lib/python3.12/asyncio/base_events.py:1122: in create_connection
    raise exceptions[0]
/usr/lib/python3.12/asyncio/base_events.py:1104: in create_connection
    sock = await self._connect_sock(
/usr/lib/python3.12/asyncio/base_events.py:1007: in _connect_sock
    await self.sock_connect(sock, address)
/usr/lib/python3.12/asyncio/selector_events.py:651: in sock_connect
    return await fut
           ^^^^^^^^^
/usr/lib/python3.12/asyncio/selector_events.py:691: in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
E   ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
______________________________ test_search_chunks ______________________________
tests/unit/services/test_database_service.py:113: in test_search_chunks
    results = await service.search_chunks([0.1, 0.2, 0.3], top_k=5)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/database/postgres.py:209: in search_chunks
    pool = await self._get_pool()
           ^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/database/postgres.py:98: in _get_pool
    self._pool = await asyncpg.create_pool(
venv/lib/python3.12/site-packages/asyncpg/pool.py:439: in _async__init__
    await self._initialize()
venv/lib/python3.12/site-packages/asyncpg/pool.py:466: in _initialize
    await first_ch.connect()
venv/lib/python3.12/site-packages/asyncpg/pool.py:153: in connect
    self._con = await self._pool._get_new_connection()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/pool.py:538: in _get_new_connection
    con = await self._connect(
venv/lib/python3.12/site-packages/asyncpg/connection.py:2443: in connect
    return await connect_utils._connect(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1249: in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1218: in _connect
    conn = await _connect_addr(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1054: in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1099: in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:969: in _create_ssl_connection
    tr, pr = await loop.create_connection(
/usr/lib/python3.12/asyncio/base_events.py:1122: in create_connection
    raise exceptions[0]
/usr/lib/python3.12/asyncio/base_events.py:1104: in create_connection
    sock = await self._connect_sock(
/usr/lib/python3.12/asyncio/base_events.py:1007: in _connect_sock
    await self.sock_connect(sock, address)
/usr/lib/python3.12/asyncio/selector_events.py:651: in sock_connect
    return await fut
           ^^^^^^^^^
/usr/lib/python3.12/asyncio/selector_events.py:691: in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
E   ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
________________________________ test_get_chunk ________________________________
tests/unit/services/test_database_service.py:137: in test_get_chunk
    chunk = await service.get_chunk("1")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/database/postgres.py:256: in get_chunk
    pool = await self._get_pool()
           ^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/database/postgres.py:98: in _get_pool
    self._pool = await asyncpg.create_pool(
venv/lib/python3.12/site-packages/asyncpg/pool.py:439: in _async__init__
    await self._initialize()
venv/lib/python3.12/site-packages/asyncpg/pool.py:466: in _initialize
    await first_ch.connect()
venv/lib/python3.12/site-packages/asyncpg/pool.py:153: in connect
    self._con = await self._pool._get_new_connection()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/pool.py:538: in _get_new_connection
    con = await self._connect(
venv/lib/python3.12/site-packages/asyncpg/connection.py:2443: in connect
    return await connect_utils._connect(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1249: in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1218: in _connect
    conn = await _connect_addr(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1054: in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1099: in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:969: in _create_ssl_connection
    tr, pr = await loop.create_connection(
/usr/lib/python3.12/asyncio/base_events.py:1122: in create_connection
    raise exceptions[0]
/usr/lib/python3.12/asyncio/base_events.py:1104: in create_connection
    sock = await self._connect_sock(
/usr/lib/python3.12/asyncio/base_events.py:1007: in _connect_sock
    await self.sock_connect(sock, address)
/usr/lib/python3.12/asyncio/selector_events.py:651: in sock_connect
    return await fut
           ^^^^^^^^^
/usr/lib/python3.12/asyncio/selector_events.py:691: in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
E   ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
___________________________ test_get_chunk_not_found ___________________________
tests/unit/services/test_database_service.py:151: in test_get_chunk_not_found
    await service.get_chunk("999")
rag_factory/services/database/postgres.py:256: in get_chunk
    pool = await self._get_pool()
           ^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/database/postgres.py:98: in _get_pool
    self._pool = await asyncpg.create_pool(
venv/lib/python3.12/site-packages/asyncpg/pool.py:439: in _async__init__
    await self._initialize()
venv/lib/python3.12/site-packages/asyncpg/pool.py:466: in _initialize
    await first_ch.connect()
venv/lib/python3.12/site-packages/asyncpg/pool.py:153: in connect
    self._con = await self._pool._get_new_connection()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/pool.py:538: in _get_new_connection
    con = await self._connect(
venv/lib/python3.12/site-packages/asyncpg/connection.py:2443: in connect
    return await connect_utils._connect(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1249: in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1218: in _connect
    conn = await _connect_addr(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1054: in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1099: in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:969: in _create_ssl_connection
    tr, pr = await loop.create_connection(
/usr/lib/python3.12/asyncio/base_events.py:1122: in create_connection
    raise exceptions[0]
/usr/lib/python3.12/asyncio/base_events.py:1104: in create_connection
    sock = await self._connect_sock(
/usr/lib/python3.12/asyncio/base_events.py:1007: in _connect_sock
    await self.sock_connect(sock, address)
/usr/lib/python3.12/asyncio/selector_events.py:651: in sock_connect
    return await fut
           ^^^^^^^^^
/usr/lib/python3.12/asyncio/selector_events.py:691: in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
E   ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
________________________ test_get_chunks_for_documents _________________________
tests/unit/services/test_database_service.py:171: in test_get_chunks_for_documents
    chunks = await service.get_chunks_for_documents(["doc1"])
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/database/postgres.py:289: in get_chunks_for_documents
    pool = await self._get_pool()
           ^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/database/postgres.py:98: in _get_pool
    self._pool = await asyncpg.create_pool(
venv/lib/python3.12/site-packages/asyncpg/pool.py:439: in _async__init__
    await self._initialize()
venv/lib/python3.12/site-packages/asyncpg/pool.py:466: in _initialize
    await first_ch.connect()
venv/lib/python3.12/site-packages/asyncpg/pool.py:153: in connect
    self._con = await self._pool._get_new_connection()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/pool.py:538: in _get_new_connection
    con = await self._connect(
venv/lib/python3.12/site-packages/asyncpg/connection.py:2443: in connect
    return await connect_utils._connect(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1249: in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1218: in _connect
    conn = await _connect_addr(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1054: in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1099: in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:969: in _create_ssl_connection
    tr, pr = await loop.create_connection(
/usr/lib/python3.12/asyncio/base_events.py:1122: in create_connection
    raise exceptions[0]
/usr/lib/python3.12/asyncio/base_events.py:1104: in create_connection
    sock = await self._connect_sock(
/usr/lib/python3.12/asyncio/base_events.py:1007: in _connect_sock
    await self.sock_connect(sock, address)
/usr/lib/python3.12/asyncio/selector_events.py:651: in sock_connect
    return await fut
           ^^^^^^^^^
/usr/lib/python3.12/asyncio/selector_events.py:691: in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
E   ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
__________________________________ test_close __________________________________
tests/unit/services/test_database_service.py:185: in test_close
    await service._get_pool()
rag_factory/services/database/postgres.py:98: in _get_pool
    self._pool = await asyncpg.create_pool(
venv/lib/python3.12/site-packages/asyncpg/pool.py:439: in _async__init__
    await self._initialize()
venv/lib/python3.12/site-packages/asyncpg/pool.py:466: in _initialize
    await first_ch.connect()
venv/lib/python3.12/site-packages/asyncpg/pool.py:153: in connect
    self._con = await self._pool._get_new_connection()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/pool.py:538: in _get_new_connection
    con = await self._connect(
venv/lib/python3.12/site-packages/asyncpg/connection.py:2443: in connect
    return await connect_utils._connect(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1249: in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1218: in _connect
    conn = await _connect_addr(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1054: in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1099: in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:969: in _create_ssl_connection
    tr, pr = await loop.create_connection(
/usr/lib/python3.12/asyncio/base_events.py:1122: in create_connection
    raise exceptions[0]
/usr/lib/python3.12/asyncio/base_events.py:1104: in create_connection
    sock = await self._connect_sock(
/usr/lib/python3.12/asyncio/base_events.py:1007: in _connect_sock
    await self.sock_connect(sock, address)
/usr/lib/python3.12/asyncio/selector_events.py:651: in sock_connect
    return await fut
           ^^^^^^^^^
/usr/lib/python3.12/asyncio/selector_events.py:691: in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
E   ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
_____________________________ test_context_manager _____________________________
tests/unit/services/test_database_service.py:200: in test_context_manager
    await s._get_pool()
rag_factory/services/database/postgres.py:98: in _get_pool
    self._pool = await asyncpg.create_pool(
venv/lib/python3.12/site-packages/asyncpg/pool.py:439: in _async__init__
    await self._initialize()
venv/lib/python3.12/site-packages/asyncpg/pool.py:466: in _initialize
    await first_ch.connect()
venv/lib/python3.12/site-packages/asyncpg/pool.py:153: in connect
    self._con = await self._pool._get_new_connection()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/pool.py:538: in _get_new_connection
    con = await self._connect(
venv/lib/python3.12/site-packages/asyncpg/connection.py:2443: in connect
    return await connect_utils._connect(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1249: in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1218: in _connect
    conn = await _connect_addr(
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1054: in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:1099: in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/asyncpg/connect_utils.py:969: in _create_ssl_connection
    tr, pr = await loop.create_connection(
/usr/lib/python3.12/asyncio/base_events.py:1122: in create_connection
    raise exceptions[0]
/usr/lib/python3.12/asyncio/base_events.py:1104: in create_connection
    sock = await self._connect_sock(
/usr/lib/python3.12/asyncio/base_events.py:1007: in _connect_sock
    await self.sock_connect(sock, address)
/usr/lib/python3.12/asyncio/selector_events.py:651: in sock_connect
    return await fut
           ^^^^^^^^^
/usr/lib/python3.12/asyncio/selector_events.py:691: in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
E   ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     49    46%   17-18, 73, 109-111, 115-139, 157-185, 212-242, 258-271, 287, 291-301, 333-351, 359-361
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9273    16%
=========================== short test summary info ============================
FAILED tests/unit/services/test_database_service.py::test_ensure_table - ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
FAILED tests/unit/services/test_database_service.py::test_store_chunks - ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
FAILED tests/unit/services/test_database_service.py::test_search_chunks - ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
FAILED tests/unit/services/test_database_service.py::test_get_chunk - ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
FAILED tests/unit/services/test_database_service.py::test_get_chunk_not_found - ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
FAILED tests/unit/services/test_database_service.py::test_get_chunks_for_documents - ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
FAILED tests/unit/services/test_database_service.py::test_close - ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
FAILED tests/unit/services/test_database_service.py::test_context_manager - ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
=================== 8 failed, 2 passed, 2 warnings in 12.92s ===================

[100/156] PASSED: tests/unit/services/test_dependencies.py
  Tests: 17 (P:17 F:0 S:0)
[101/156] PASSED: tests/unit/services/test_graph_interface.py
  Tests: 6 (P:6 F:0 S:0)
[102/156] FAILED: tests/unit/services/test_interfaces.py
  Tests: 22 (P:20 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 21 items

tests/unit/services/test_interfaces.py::test_illm_service_requires_implementation PASSED [  4%]
tests/unit/services/test_interfaces.py::test_illm_service_requires_complete_method PASSED [  9%]
tests/unit/services/test_interfaces.py::test_illm_service_requires_stream_complete_method PASSED [ 14%]
tests/unit/services/test_interfaces.py::test_illm_service_mock_implementation PASSED [ 19%]
tests/unit/services/test_interfaces.py::test_illm_service_has_docstring PASSED [ 23%]
tests/unit/services/test_interfaces.py::test_iembedding_service_requires_implementation PASSED [ 28%]
tests/unit/services/test_interfaces.py::test_iembedding_service_requires_embed_method PASSED [ 33%]
tests/unit/services/test_interfaces.py::test_iembedding_service_mock_implementation PASSED [ 38%]
tests/unit/services/test_interfaces.py::test_iembedding_service_has_docstring PASSED [ 42%]
tests/unit/services/test_interfaces.py::test_igraph_service_requires_implementation PASSED [ 47%]
tests/unit/services/test_interfaces.py::test_igraph_service_requires_create_node_method PASSED [ 52%]
tests/unit/services/test_interfaces.py::test_igraph_service_mock_implementation PASSED [ 57%]
tests/unit/services/test_interfaces.py::test_igraph_service_has_docstring PASSED [ 61%]
tests/unit/services/test_interfaces.py::test_ireranking_service_requires_implementation PASSED [ 66%]
tests/unit/services/test_interfaces.py::test_ireranking_service_mock_implementation PASSED [ 71%]
tests/unit/services/test_interfaces.py::test_ireranking_service_has_docstring PASSED [ 76%]
tests/unit/services/test_interfaces.py::test_idatabase_service_requires_implementation PASSED [ 80%]
tests/unit/services/test_interfaces.py::test_idatabase_service_requires_store_chunks_method PASSED [ 85%]
tests/unit/services/test_interfaces.py::test_idatabase_service_mock_implementation FAILED [ 90%]
tests/unit/services/test_interfaces.py::test_idatabase_service_has_docstring PASSED [ 95%]
tests/unit/services/test_interfaces.py::test_all_interfaces_have_type_hints PASSED [100%]

=================================== FAILURES ===================================
__________________ test_idatabase_service_mock_implementation __________________
tests/unit/services/test_interfaces.py:371: in test_idatabase_service_mock_implementation
    service = MockDatabaseService()
              ^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class MockDatabaseService without an implementation for abstract methods 'get_chunks_for_documents', 'store_chunks_with_hierarchy'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9295    16%
=========================== short test summary info ============================
FAILED tests/unit/services/test_interfaces.py::test_idatabase_service_mock_implementation - TypeError: Can't instantiate abstract class MockDatabaseService without an implementation for abstract methods 'get_chunks_for_documents', 'store_chunks_with_hierarchy'
=================== 1 failed, 20 passed, 2 warnings in 4.01s ===================

[103/156] PASSED: tests/unit/services/test_reranking_interface.py
  Tests: 4 (P:4 F:0 S:0)
[104/156] PASSED: tests/unit/services/utils/test_onnx_utils.py
  Tests: 17 (P:17 F:0 S:0)
[105/156] PASSED: tests/unit/strategies/agentic/test_agent.py
  Tests: 16 (P:16 F:0 S:0)
[106/156] PASSED: tests/unit/strategies/agentic/test_query_analyzer.py
  Tests: 16 (P:16 F:0 S:0)
[107/156] FAILED: tests/unit/strategies/agentic/test_strategy.py
  Tests: 19 (P:3 F:16 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 11 items

tests/unit/strategies/agentic/test_strategy.py::test_config_defaults PASSED [  9%]
tests/unit/strategies/agentic/test_strategy.py::test_config_custom_values PASSED [ 18%]
tests/unit/strategies/agentic/test_strategy.py::test_config_validation PASSED [ 27%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_initialization FAILED [ 36%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_initialization_with_config FAILED [ 45%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_retrieve FAILED [ 54%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_retrieve_with_query_analysis FAILED [ 63%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_fallback_on_error FAILED [ 72%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_no_fallback_raises_error FAILED [ 81%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_get_stats FAILED [ 90%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_top_k_limit FAILED [100%]

=================================== FAILURES ===================================
_________________________ test_strategy_initialization _________________________
tests/unit/strategies/agentic/test_strategy.py:92: in test_strategy_initialization
    strategy = AgenticRAGStrategy(
E   TypeError: AgenticRAGStrategy.__init__() takes 3 positional arguments but 5 were given
___________________ test_strategy_initialization_with_config ___________________
tests/unit/strategies/agentic/test_strategy.py:117: in test_strategy_initialization_with_config
    strategy = AgenticRAGStrategy(
E   TypeError: AgenticRAGStrategy.__init__() got multiple values for argument 'config'
____________________________ test_strategy_retrieve ____________________________
tests/unit/strategies/agentic/test_strategy.py:136: in test_strategy_retrieve
    strategy = AgenticRAGStrategy(
E   TypeError: AgenticRAGStrategy.__init__() takes 3 positional arguments but 5 were given
__________________ test_strategy_retrieve_with_query_analysis __________________
tests/unit/strategies/agentic/test_strategy.py:173: in test_strategy_retrieve_with_query_analysis
    strategy = AgenticRAGStrategy(
E   TypeError: AgenticRAGStrategy.__init__() got multiple values for argument 'config'
_______________________ test_strategy_fallback_on_error ________________________
tests/unit/strategies/agentic/test_strategy.py:202: in test_strategy_fallback_on_error
    strategy = AgenticRAGStrategy(
E   TypeError: AgenticRAGStrategy.__init__() got multiple values for argument 'config'
____________________ test_strategy_no_fallback_raises_error ____________________
tests/unit/strategies/agentic/test_strategy.py:226: in test_strategy_no_fallback_raises_error
    strategy = AgenticRAGStrategy(
E   TypeError: AgenticRAGStrategy.__init__() got multiple values for argument 'config'
___________________________ test_strategy_get_stats ____________________________
tests/unit/strategies/agentic/test_strategy.py:247: in test_strategy_get_stats
    strategy = AgenticRAGStrategy(
E   TypeError: AgenticRAGStrategy.__init__() takes 3 positional arguments but 5 were given
__________________________ test_strategy_top_k_limit ___________________________
tests/unit/strategies/agentic/test_strategy.py:270: in test_strategy_top_k_limit
    strategy = AgenticRAGStrategy(
E   TypeError: AgenticRAGStrategy.__init__() takes 3 positional arguments but 5 were given
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    203    177    13%   40-45, 68-76, 90-95, 120-133, 155-171, 187-202, 221-231, 250-261, 287-335, 362-409, 435-493, 508-518, 532-540, 556-562, 576-582, 596-606, 623-645, 658-689
rag_factory/repositories/document.py                                  93     74    20%   41-46, 63-68, 98-118, 140-156, 172-187, 206, 223-233, 247-255, 272-279, 290-293, 307-312
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                              151    130    14%   31-36, 45, 57, 66-90, 109-111, 123-161, 190-214, 230-265, 276-293, 310-331, 339-346, 357-368, 381-420
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            76     53    30%   48-64, 76, 87-95, 107, 119, 132, 145-185, 197-221, 230, 239, 247
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9051    18%
=========================== short test summary info ============================
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_initialization - TypeError: AgenticRAGStrategy.__init__() takes 3 positional arguments but 5 were given
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_initialization_with_config - TypeError: AgenticRAGStrategy.__init__() got multiple values for argument 'config'
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_retrieve - TypeError: AgenticRAGStrategy.__init__() takes 3 positional arguments but 5 were given
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_retrieve_with_query_analysis - TypeError: AgenticRAGStrategy.__init__() got multiple values for argument 'config'
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_fallback_on_error - TypeError: AgenticRAGStrategy.__init__() got multiple values for argument 'config'
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_no_fallback_raises_error - TypeError: AgenticRAGStrategy.__init__() got multiple values for argument 'config'
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_get_stats - TypeError: AgenticRAGStrategy.__init__() takes 3 positional arguments but 5 were given
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_top_k_limit - TypeError: AgenticRAGStrategy.__init__() takes 3 positional arguments but 5 were given
=================== 8 failed, 3 passed, 3 warnings in 4.46s ====================

[108/156] PASSED: tests/unit/strategies/agentic/test_tools.py
  Tests: 11 (P:11 F:0 S:0)
[109/156] PASSED: tests/unit/strategies/chunking/test_docling_chunker.py
  Tests: 6 (P:4 F:0 S:2)
[110/156] PASSED: tests/unit/strategies/chunking/test_fixed_size_chunker.py
  Tests: 13 (P:13 F:0 S:0)
[111/156] PASSED: tests/unit/strategies/chunking/test_hybrid_chunker.py
  Tests: 12 (P:12 F:0 S:0)
[112/156] PASSED: tests/unit/strategies/chunking/test_semantic_chunker.py
  Tests: 14 (P:14 F:0 S:0)
[113/156] PASSED: tests/unit/strategies/chunking/test_structural_chunker.py
  Tests: 15 (P:15 F:0 S:0)
[114/156] PASSED: tests/unit/strategies/contextual/test_batch_processor.py
  Tests: 7 (P:7 F:0 S:0)
[115/156] PASSED: tests/unit/strategies/contextual/test_context_generator.py
  Tests: 9 (P:9 F:0 S:0)
[116/156] PASSED: tests/unit/strategies/contextual/test_cost_tracker.py
  Tests: 9 (P:9 F:0 S:0)
[117/156] PASSED: tests/unit/strategies/contextual/test_storage.py
  Tests: 8 (P:8 F:0 S:0)
[118/156] PASSED: tests/unit/strategies/fine_tuned/test_ab_testing.py
  Tests: 3 (P:3 F:0 S:0)
[119/156] PASSED: tests/unit/strategies/fine_tuned/test_custom_loader.py
  Tests: 3 (P:3 F:0 S:0)
[120/156] PASSED: tests/unit/strategies/fine_tuned/test_model_registry.py
  Tests: 5 (P:5 F:0 S:0)
[121/156] PASSED: tests/unit/strategies/hierarchical/test_hierarchy_builder.py
  Tests: 14 (P:14 F:0 S:0)
[122/156] PASSED: tests/unit/strategies/hierarchical/test_parent_retriever.py
  Tests: 8 (P:8 F:0 S:0)
[123/156] PASSED: tests/unit/strategies/indexing/test_context_aware.py
  Tests: 9 (P:9 F:0 S:0)
[124/156] PASSED: tests/unit/strategies/knowledge_graph/test_entity_extractor.py
  Tests: 6 (P:6 F:0 S:0)
[125/156] PASSED: tests/unit/strategies/knowledge_graph/test_hybrid_retriever.py
  Tests: 7 (P:7 F:0 S:0)
[126/156] PASSED: tests/unit/strategies/knowledge_graph/test_memory_graph_store.py
  Tests: 8 (P:8 F:0 S:0)
[127/156] PASSED: tests/unit/strategies/late_chunking/test_coherence_analyzer.py
  Tests: 7 (P:7 F:0 S:0)
[128/156] PASSED: tests/unit/strategies/late_chunking/test_document_embedder.py
  Tests: 13 (P:13 F:0 S:0)
[129/156] PASSED: tests/unit/strategies/late_chunking/test_embedding_chunker.py
  Tests: 12 (P:12 F:0 S:0)
[130/156] PASSED: tests/unit/strategies/multi_query/test_deduplicator.py
  Tests: 7 (P:7 F:0 S:0)
[131/156] PASSED: tests/unit/strategies/multi_query/test_parallel_executor.py
  Tests: 6 (P:6 F:0 S:0)
[132/156] PASSED: tests/unit/strategies/multi_query/test_ranker.py
  Tests: 7 (P:7 F:0 S:0)
[133/156] PASSED: tests/unit/strategies/multi_query/test_variant_generator.py
  Tests: 7 (P:7 F:0 S:0)
[134/156] PASSED: tests/unit/strategies/query_expansion/test_base.py
  Tests: 13 (P:13 F:0 S:0)
[135/156] PASSED: tests/unit/strategies/query_expansion/test_expander_service.py
  Tests: 15 (P:15 F:0 S:0)
[136/156] PASSED: tests/unit/strategies/query_expansion/test_llm_expander.py
  Tests: 11 (P:11 F:0 S:0)
[137/156] PASSED: tests/unit/strategies/query_expansion/test_prompts.py
  Tests: 12 (P:12 F:0 S:0)
[138/156] PASSED: tests/unit/strategies/reranking/test_base.py
  Tests: 14 (P:14 F:0 S:0)
[139/156] PASSED: tests/unit/strategies/reranking/test_cache.py
  Tests: 13 (P:13 F:0 S:0)
[140/156] PASSED: tests/unit/strategies/reranking/test_cosine_reranker.py
  Tests: 17 (P:17 F:0 S:0)
[141/156] PASSED: tests/unit/strategies/reranking/test_cross_encoder_reranker.py
  Tests: 10 (P:1 F:0 S:9)
[142/156] PASSED: tests/unit/strategies/reranking/test_metrics.py
  Tests: 36 (P:36 F:0 S:0)
[143/156] PASSED: tests/unit/strategies/reranking/test_reranker_selector.py
  Tests: 21 (P:21 F:0 S:0)
[144/156] PASSED: tests/unit/strategies/reranking/test_reranker_service.py
  Tests: 16 (P:16 F:0 S:0)
[145/156] PASSED: tests/unit/strategies/self_reflective/test_grader.py
  Tests: 8 (P:8 F:0 S:0)
[146/156] PASSED: tests/unit/strategies/self_reflective/test_refiner.py
  Tests: 8 (P:8 F:0 S:0)
[147/156] PASSED: tests/unit/strategies/self_reflective/test_strategy.py
  Tests: 8 (P:8 F:0 S:0)
[148/156] FAILED: tests/unit/strategies/test_base.py
  Tests: 19 (P:13 F:6 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 16 items

tests/unit/strategies/test_base.py::test_interface_is_abstract PASSED    [  6%]
tests/unit/strategies/test_base.py::test_interface_requires_all_abstract_methods PASSED [ 12%]
tests/unit/strategies/test_base.py::test_strategy_config_defaults PASSED [ 18%]
tests/unit/strategies/test_base.py::test_strategy_config_custom_values PASSED [ 25%]
tests/unit/strategies/test_base.py::test_strategy_config_validation PASSED [ 31%]
tests/unit/strategies/test_base.py::test_chunk_creation PASSED           [ 37%]
tests/unit/strategies/test_base.py::test_chunk_serialization PASSED      [ 43%]
tests/unit/strategies/test_base.py::test_prepared_data_creation PASSED   [ 50%]
tests/unit/strategies/test_base.py::test_query_result_creation PASSED    [ 56%]
tests/unit/strategies/test_base.py::test_minimal_concrete_implementation FAILED [ 62%]
tests/unit/strategies/test_base.py::test_concrete_implementation_initialize FAILED [ 68%]
tests/unit/strategies/test_base.py::test_type_hints_present PASSED       [ 75%]
tests/unit/strategies/test_base.py::test_async_method_signature PASSED   [ 81%]
tests/unit/strategies/test_base.py::test_initialize_type_hints FAILED    [ 87%]
tests/unit/strategies/test_base.py::test_prepare_data_type_hints PASSED  [ 93%]
tests/unit/strategies/test_base.py::test_process_query_type_hints PASSED [100%]

=================================== FAILURES ===================================
_____________________ test_minimal_concrete_implementation _____________________
tests/unit/strategies/test_base.py:171: in test_minimal_concrete_implementation
    strategy = MinimalStrategy()
               ^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class MinimalStrategy without an implementation for abstract method 'requires_services'
___________________ test_concrete_implementation_initialize ____________________
tests/unit/strategies/test_base.py:193: in test_concrete_implementation_initialize
    strategy = TestStrategy()
               ^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
__________________________ test_initialize_type_hints __________________________
tests/unit/strategies/test_base.py:213: in test_initialize_type_hints
    sig = inspect.signature(IRAGStrategy.initialize)
                            ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: type object 'IRAGStrategy' has no attribute 'initialize'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    141    25%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55      7    87%   169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9289    16%
=========================== short test summary info ============================
FAILED tests/unit/strategies/test_base.py::test_minimal_concrete_implementation - TypeError: Can't instantiate abstract class MinimalStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/strategies/test_base.py::test_concrete_implementation_initialize - TypeError: Can't instantiate abstract class TestStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/strategies/test_base.py::test_initialize_type_hints - AttributeError: type object 'IRAGStrategy' has no attribute 'initialize'
=================== 3 failed, 13 passed, 2 warnings in 3.80s ===================

[149/156] PASSED: tests/unit/strategies/test_base_strategy_di.py
  Tests: 10 (P:10 F:0 S:0)
[150/156] PASSED: tests/unit/test_config.py
  Tests: 38 (P:38 F:0 S:0)
[151/156] PASSED: tests/unit/test_factory_di.py
  Tests: 22 (P:22 F:0 S:0)
[152/156] PASSED: tests/unit/test_factory.py
  Tests: 29 (P:29 F:0 S:0)
[153/156] PASSED: tests/unit/test_package.py
  Tests: 12 (P:12 F:0 S:0)
[154/156] FAILED: tests/unit/test_pipeline.py
  Tests: 47 (P:1 F:46 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 24 items

tests/unit/test_pipeline.py::test_pipeline_can_be_created PASSED         [  4%]
tests/unit/test_pipeline.py::test_pipeline_add_stage FAILED              [  8%]
tests/unit/test_pipeline.py::test_pipeline_chaining FAILED               [ 12%]
tests/unit/test_pipeline.py::test_sequential_execution_order FAILED      [ 16%]
tests/unit/test_pipeline.py::test_sequential_execution_collects_results FAILED [ 20%]
tests/unit/test_pipeline.py::test_parallel_execution FAILED              [ 25%]
tests/unit/test_pipeline.py::test_strategy_error_caught FAILED           [ 29%]
tests/unit/test_pipeline.py::test_fallback_strategy_executed FAILED      [ 33%]
tests/unit/test_pipeline.py::test_duplicate_results_removed FAILED       [ 37%]
tests/unit/test_pipeline.py::test_results_sorted_by_score FAILED         [ 41%]
tests/unit/test_pipeline.py::test_performance_metrics_collected FAILED   [ 45%]
tests/unit/test_pipeline.py::test_from_config_creates_pipeline FAILED    [ 50%]
tests/unit/test_pipeline.py::test_cascade_mode_not_implemented FAILED    [ 54%]
tests/unit/test_pipeline.py::test_cascade_mode_not_implemented_async FAILED [ 58%]
tests/unit/test_pipeline.py::test_required_stage_failure_raises_exception FAILED [ 62%]
tests/unit/test_pipeline.py::test_required_stage_failure_raises_exception_async FAILED [ 66%]
tests/unit/test_pipeline.py::test_fallback_failure_when_required FAILED  [ 70%]
tests/unit/test_pipeline.py::test_fallback_failure_when_required_async FAILED [ 75%]
tests/unit/test_pipeline.py::test_parallel_required_stage_failure FAILED [ 79%]
tests/unit/test_pipeline.py::test_parallel_required_fallback_failure FAILED [ 83%]
tests/unit/test_pipeline.py::test_non_required_fallback_failure_continues FAILED [ 87%]
tests/unit/test_pipeline.py::test_non_required_fallback_failure_continues_async FAILED [ 91%]
tests/unit/test_pipeline.py::test_parallel_non_required_fallback_success FAILED [ 95%]
tests/unit/test_pipeline.py::test_parallel_non_required_both_fail FAILED [100%]

=================================== FAILURES ===================================
___________________________ test_pipeline_add_stage ____________________________
tests/unit/test_pipeline.py:59: in test_pipeline_add_stage
    strategy = DummyStrategy()
               ^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
____________________________ test_pipeline_chaining ____________________________
tests/unit/test_pipeline.py:115: in test_pipeline_chaining
    .add_stage(Strategy1(), "stage1")
               ^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
_______________________ test_sequential_execution_order ________________________
tests/unit/test_pipeline.py:175: in test_sequential_execution_order
    pipeline.add_stage(Strategy1(), "strategy1")
                       ^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
__________________ test_sequential_execution_collects_results __________________
tests/unit/test_pipeline.py:233: in test_sequential_execution_collects_results
    pipeline.add_stage(Strategy1(), "s1")
                       ^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
___________________________ test_parallel_execution ____________________________
tests/unit/test_pipeline.py:305: in test_parallel_execution
    pipeline.add_stage(SlowStrategy(), "slow")
                       ^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class SlowStrategy without an implementation for abstract method 'requires_services'
__________________________ test_strategy_error_caught __________________________
tests/unit/test_pipeline.py:368: in test_strategy_error_caught
    strategy=FailingStrategy(),
             ^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingStrategy without an implementation for abstract method 'requires_services'
_______________________ test_fallback_strategy_executed ________________________
tests/unit/test_pipeline.py:432: in test_fallback_strategy_executed
    PrimaryStrategy(),
    ^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class PrimaryStrategy without an implementation for abstract method 'requires_services'
________________________ test_duplicate_results_removed ________________________
tests/unit/test_pipeline.py:499: in test_duplicate_results_removed
    pipeline.add_stage(Strategy1(), "s1")
                       ^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
_________________________ test_results_sorted_by_score _________________________
tests/unit/test_pipeline.py:558: in test_results_sorted_by_score
    pipeline.add_stage(Strategy1(), "s1")
                       ^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
______________________ test_performance_metrics_collected ______________________
tests/unit/test_pipeline.py:595: in test_performance_metrics_collected
    pipeline.add_stage(Strategy1(), "s1")
                       ^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
______________________ test_from_config_creates_pipeline _______________________
tests/unit/test_pipeline.py:623: in test_from_config_creates_pipeline
    pipeline = StrategyPipeline.from_config(config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/pipeline.py:496: in from_config
    strategy = factory.create_strategy(
rag_factory/factory.py:217: in create_strategy
    strategy = strategy_class(config=strategy_config, dependencies=deps)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
______________________ test_cascade_mode_not_implemented _______________________
tests/unit/test_pipeline.py:633: in test_cascade_mode_not_implemented
    pipeline.add_stage(DummyStrategy(), "stage1")
                       ^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
___________________ test_cascade_mode_not_implemented_async ____________________
tests/unit/test_pipeline.py:643: in test_cascade_mode_not_implemented_async
    pipeline.add_stage(DummyStrategy(), "stage1")
                       ^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
_________________ test_required_stage_failure_raises_exception _________________
tests/unit/test_pipeline.py:676: in test_required_stage_failure_raises_exception
    pipeline.add_stage(FailingRequiredStrategy(), "required_failing")
                       ^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingRequiredStrategy without an implementation for abstract method 'requires_services'
______________ test_required_stage_failure_raises_exception_async ______________
tests/unit/test_pipeline.py:709: in test_required_stage_failure_raises_exception_async
    pipeline.add_stage(FailingRequiredAsyncStrategy(), "required_failing")
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingRequiredAsyncStrategy without an implementation for abstract method 'requires_services'
_____________________ test_fallback_failure_when_required ______________________
tests/unit/test_pipeline.py:765: in test_fallback_failure_when_required
    FailingPrimary(),
    ^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingPrimary without an implementation for abstract method 'requires_services'
__________________ test_fallback_failure_when_required_async ___________________
tests/unit/test_pipeline.py:825: in test_fallback_failure_when_required_async
    FailingPrimaryAsync(),
    ^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingPrimaryAsync without an implementation for abstract method 'requires_services'
_____________________ test_parallel_required_stage_failure _____________________
tests/unit/test_pipeline.py:861: in test_parallel_required_stage_failure
    pipeline.add_stage(FailingParallelRequired(), "failing_required")
                       ^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingParallelRequired without an implementation for abstract method 'requires_services'
___________________ test_parallel_required_fallback_failure ____________________
tests/unit/test_pipeline.py:918: in test_parallel_required_fallback_failure
    FailingParallelPrimary(),
    ^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingParallelPrimary without an implementation for abstract method 'requires_services'
_________________ test_non_required_fallback_failure_continues _________________
tests/unit/test_pipeline.py:979: in test_non_required_fallback_failure_continues
    strategy=FailingPrimaryNonReq(),
             ^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingPrimaryNonReq without an implementation for abstract method 'requires_services'
______________ test_non_required_fallback_failure_continues_async ______________
tests/unit/test_pipeline.py:1044: in test_non_required_fallback_failure_continues_async
    strategy=FailingPrimaryAsyncNonReq(),
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingPrimaryAsyncNonReq without an implementation for abstract method 'requires_services'
_________________ test_parallel_non_required_fallback_success __________________
tests/unit/test_pipeline.py:1109: in test_parallel_non_required_fallback_success
    strategy=FailingParallelPrimaryNonReq(),
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingParallelPrimaryNonReq without an implementation for abstract method 'requires_services'
_____________________ test_parallel_non_required_both_fail _____________________
tests/unit/test_pipeline.py:1175: in test_parallel_non_required_both_fail
    strategy=FailingParallelPrimaryBoth(),
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class FailingParallelPrimaryBoth without an implementation for abstract method 'requires_services'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         38     28    26%   64-113
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     153    132    14%   28-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-187, 191-208, 212-221, 254-261
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               30     10    67%   25-28, 48-49, 74-76, 80
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config.py                                                155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    132    29%   144, 165-170, 203-204, 222, 226-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715, 744-749
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           97     97     0%   3-279
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    108    31%   160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 501-507
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    203    203     0%   7-689
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              3      0   100%
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                             91     71    22%   17-18, 72-87, 97-111, 115-139, 152-185, 209-242, 256-271, 286-301, 333-351, 358-361, 365, 369
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               116     92    21%   18-19, 24-25, 89-184, 200-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             171    150    12%   22-23, 28-29, 40-48, 81-193, 213-234, 260-306, 328-362, 379-400, 420-435, 448-466, 480-492
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            76     76     0%   8-247
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  86     86     0%   8-257
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         63     63     0%   8-261
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       63     63     0%   9-275
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   29     21    28%   21, 30, 53-91
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    73     73     0%   8-242
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py             88     88     0%   8-287
rag_factory/strategies/late_chunking/embedding_chunker.py            112    112     0%   7-286
rag_factory/strategies/late_chunking/models.py                        63     63     0%   8-101
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        62     62     0%   3-175
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            91     70    23%   36-40, 55-58, 75-141, 152-173, 197-208, 226-227, 235-239, 247, 258-266, 276-277
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                23     14    39%   23-25, 39-67, 95
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              11055   9276    16%
=========================== short test summary info ============================
FAILED tests/unit/test_pipeline.py::test_pipeline_add_stage - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_pipeline_chaining - TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_sequential_execution_order - TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_sequential_execution_collects_results - TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_parallel_execution - TypeError: Can't instantiate abstract class SlowStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_strategy_error_caught - TypeError: Can't instantiate abstract class FailingStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_fallback_strategy_executed - TypeError: Can't instantiate abstract class PrimaryStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_duplicate_results_removed - TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_results_sorted_by_score - TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_performance_metrics_collected - TypeError: Can't instantiate abstract class Strategy1 without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_from_config_creates_pipeline - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_cascade_mode_not_implemented - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_cascade_mode_not_implemented_async - TypeError: Can't instantiate abstract class DummyStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_required_stage_failure_raises_exception - TypeError: Can't instantiate abstract class FailingRequiredStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_required_stage_failure_raises_exception_async - TypeError: Can't instantiate abstract class FailingRequiredAsyncStrategy without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_fallback_failure_when_required - TypeError: Can't instantiate abstract class FailingPrimary without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_fallback_failure_when_required_async - TypeError: Can't instantiate abstract class FailingPrimaryAsync without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_parallel_required_stage_failure - TypeError: Can't instantiate abstract class FailingParallelRequired without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_parallel_required_fallback_failure - TypeError: Can't instantiate abstract class FailingParallelPrimary without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_non_required_fallback_failure_continues - TypeError: Can't instantiate abstract class FailingPrimaryNonReq without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_non_required_fallback_failure_continues_async - TypeError: Can't instantiate abstract class FailingPrimaryAsyncNonReq without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_parallel_non_required_fallback_success - TypeError: Can't instantiate abstract class FailingParallelPrimaryNonReq without an implementation for abstract method 'requires_services'
FAILED tests/unit/test_pipeline.py::test_parallel_non_required_both_fail - TypeError: Can't instantiate abstract class FailingParallelPrimaryBoth without an implementation for abstract method 'requires_services'
=================== 23 failed, 1 passed, 2 warnings in 5.84s ===================

[155/156] PASSED: tests/unit/utils/test_token_counter.py
  Tests: 21 (P:21 F:0 S:0)
[156/156] PASSED: tests/unit/utils/test_tokenization.py
  Tests: 25 (P:25 F:0 S:0)
