========================================
Test Results - 2025-12-18 10:05:47
========================================
Environment Configuration:
  EMBEDDING_MODEL_NAME: Xenova/all-MiniLM-L6-v2
  EMBEDDING_MODEL_PATH: models/embeddings
  LM_STUDIO_BASE_URL: http://192.168.56.1:1234/v1
  LM_STUDIO_MODEL: phi-4-mini-instruct

Command: pytest tests/integration/registry/test_registry_integration.py tests/integration/database/test_migration_integration.py tests/integration/database/test_migration_validator_integration.py tests/integration/services/test_service_integration.py tests/integration/strategies/test_self_reflective_integration.py tests/integration/test_package_integration.py tests/test_mock_registry.py tests/unit/config/test_strategy_pair_manager.py tests/unit/database/test_batch_operations.py tests/unit/database/test_migrations.py tests/unit/database/test_pgvector.py tests/unit/documentation/test_code_examples.py tests/unit/documentation/test_links.py tests/unit/registry/test_service_factory.py tests/unit/services/embedding/test_onnx_local_provider.py tests/unit/services/llm/test_anthropic_provider.py tests/unit/services/llm/test_ollama_provider.py tests/unit/services/llm/test_openai_provider.py tests/unit/services/llm/test_service.py tests/unit/services/test_database_service.py tests/unit/strategies/indexing/test_context_aware.py tests/unit/test_package.py
========================================

============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 181 items

tests/integration/registry/test_registry_integration.py::TestRealServiceInstantiation::test_instantiate_onnx_embedding_service PASSED [  0%]
tests/integration/registry/test_registry_integration.py::TestRealServiceInstantiation::test_embedding_service_functionality PASSED [  1%]
tests/integration/registry/test_registry_integration.py::TestRealServiceInstantiation::test_multiple_service_instantiation FAILED [  1%]
tests/integration/registry/test_registry_integration.py::TestEnvironmentVariableResolution::test_env_var_resolution PASSED [  2%]
tests/integration/registry/test_registry_integration.py::TestEnvironmentVariableResolution::test_env_var_defaults PASSED [  2%]
tests/integration/registry/test_registry_integration.py::TestServiceLifecycle::test_context_manager_cleanup PASSED [  3%]
tests/integration/registry/test_registry_integration.py::TestServiceLifecycle::test_reload_service PASSED [  3%]
tests/integration/registry/test_registry_integration.py::TestServiceLifecycle::test_shutdown_cleanup PASSED [  4%]
tests/integration/registry/test_registry_integration.py::TestServiceSharing::test_service_instance_sharing PASSED [  4%]
tests/integration/registry/test_registry_integration.py::TestServiceSharing::test_service_sharing_memory_efficiency PASSED [  5%]
tests/integration/registry/test_registry_integration.py::TestErrorHandling::test_invalid_service_config FAILED [  6%]
tests/integration/registry/test_registry_integration.py::TestErrorHandling::test_missing_service_file PASSED [  6%]
tests/integration/registry/test_registry_integration.py::TestOpenAIServices::test_openai_llm_instantiation PASSED [  7%]
tests/integration/registry/test_registry_integration.py::TestOpenAIServices::test_openai_embedding_instantiation PASSED [  7%]
tests/integration/registry/test_registry_integration.py::TestConfigurationValidation::test_valid_configuration_loads PASSED [  8%]
tests/integration/registry/test_registry_integration.py::TestConfigurationValidation::test_configuration_warnings FAILED [  8%]
tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_real_migration_execution PASSED [  9%]
tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_migration_with_existing_data PASSED [  9%]
tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_rollback_functionality PASSED [ 10%]
tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_pgvector_extension_installed PASSED [ 11%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_no_migrations PASSED [ 11%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_partial_migrations PASSED [ 12%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_all_migrations PASSED [ 12%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_or_raise_success PASSED [ 13%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_or_raise_failure PASSED [ 13%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_get_current_revision PASSED [ 14%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_get_all_revisions PASSED [ 14%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_is_at_head PASSED [ 15%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_error_message_details PASSED [ 16%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_single_migration PASSED [ 16%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_nonexistent_migration PASSED [ 17%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_after_downgrade PASSED [ 17%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_multiple_validators_same_database PASSED [ 18%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validator_with_auto_discovered_config PASSED [ 18%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validate_empty_requirements PASSED [ 19%]
tests/integration/services/test_service_integration.py::test_rag_workflow FAILED [ 19%]
tests/integration/services/test_service_integration.py::test_embedding_database_consistency FAILED [ 20%]
tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_end_to_end_workflow FAILED [ 20%]
tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_retry_with_poor_results FAILED [ 21%]
tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_performance_within_limits FAILED [ 22%]
tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveWithLMStudio::test_with_real_llm FAILED [ 22%]
tests/integration/test_package_integration.py::TestPackageInstallation::test_package_installable PASSED [ 23%]
tests/integration/test_package_integration.py::TestSmokeTest::test_basic_usage_smoke_test FAILED [ 23%]
tests/integration/test_package_integration.py::TestFullWorkflow::test_full_workflow_with_installed_package FAILED [ 24%]
tests/integration/test_package_integration.py::TestBuildAndDistribution::test_package_can_be_built SKIPPED [ 24%]
tests/unit/config/test_strategy_pair_manager.py::test_load_pair_success PASSED [ 25%]
tests/unit/config/test_strategy_pair_manager.py::test_load_pair_compatibility_error PASSED [ 25%]
tests/unit/config/test_strategy_pair_manager.py::test_migration_error PASSED [ 26%]
tests/unit/config/test_strategy_pair_manager.py::test_db_context_creation PASSED [ 27%]
tests/unit/database/test_batch_operations.py::TestBatchOperations::test_batch_vector_insertion PASSED [ 27%]
tests/unit/database/test_batch_operations.py::TestBatchOperations::test_store_chunks_with_hierarchy PASSED [ 28%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_upgrade_to_head PASSED [ 28%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_downgrade PASSED [ 29%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_history PASSED [ 29%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_idempotency PASSED [ 30%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_get_current_version PASSED [ 30%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_creates_tables PASSED [ 31%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_creates_indexes PASSED [ 32%]
tests/unit/database/test_pgvector.py::TestPgVectorIntegration::test_cosine_similarity_search FAILED [ 32%]
tests/unit/database/test_pgvector.py::TestPgVectorIntegration::test_vector_storage_format PASSED [ 33%]
tests/unit/database/test_pgvector.py::TestPgVectorIntegration::test_empty_chunks_storage PASSED [ 33%]
tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_all_code_examples_have_valid_syntax FAILED [ 34%]
tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_strategy_examples_have_imports PASSED [ 34%]
tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_configuration_examples_valid SKIPPED [ 35%]
tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_quick_start_example_complete PASSED [ 35%]
tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_no_placeholder_code PASSED [ 36%]
tests/unit/documentation/test_links.py::TestDocumentationLinks::test_no_broken_internal_links FAILED [ 37%]
tests/unit/documentation/test_links.py::TestDocumentationLinks::test_all_diagrams_valid PASSED [ 37%]
tests/unit/documentation/test_links.py::TestDocumentationLinks::test_no_todo_links PASSED [ 38%]
tests/unit/documentation/test_links.py::TestDocumentationLinks::test_external_links_valid SKIPPED [ 38%]
tests/unit/registry/test_service_factory.py::TestServiceTypeDetection::test_is_llm_service PASSED [ 39%]
tests/unit/registry/test_service_factory.py::TestServiceTypeDetection::test_is_llm_service_missing_url PASSED [ 39%]
tests/unit/registry/test_service_factory.py::TestServiceTypeDetection::test_is_llm_service_missing_model PASSED [ 40%]
tests/unit/registry/test_service_factory.py::TestServiceTypeDetection::test_is_embedding_service PASSED [ 40%]
tests/unit/registry/test_service_factory.py::TestServiceTypeDetection::test_is_embedding_service_missing_provider PASSED [ 41%]
tests/unit/registry/test_service_factory.py::TestServiceTypeDetection::test_is_database_service_postgres PASSED [ 41%]
tests/unit/registry/test_service_factory.py::TestServiceTypeDetection::test_is_database_service_neo4j PASSED [ 42%]
tests/unit/registry/test_service_factory.py::TestServiceTypeDetection::test_is_database_service_unknown_type PASSED [ 43%]
tests/unit/registry/test_service_factory.py::TestLLMServiceCreation::test_create_llm_service_openai PASSED [ 43%]
tests/unit/registry/test_service_factory.py::TestLLMServiceCreation::test_create_llm_service_lm_studio PASSED [ 44%]
tests/unit/registry/test_service_factory.py::TestLLMServiceCreation::test_create_llm_service_with_defaults PASSED [ 44%]
tests/unit/registry/test_service_factory.py::TestEmbeddingServiceCreation::test_create_embedding_service_onnx PASSED [ 45%]
tests/unit/registry/test_service_factory.py::TestEmbeddingServiceCreation::test_create_embedding_service_onnx_with_defaults PASSED [ 45%]
tests/unit/registry/test_service_factory.py::TestEmbeddingServiceCreation::test_create_embedding_service_openai PASSED [ 46%]
tests/unit/registry/test_service_factory.py::TestEmbeddingServiceCreation::test_create_embedding_service_cohere_not_implemented PASSED [ 46%]
tests/unit/registry/test_service_factory.py::TestEmbeddingServiceCreation::test_create_embedding_service_unknown_provider PASSED [ 47%]
tests/unit/registry/test_service_factory.py::TestDatabaseServiceCreation::test_create_database_service_postgres_with_connection_string PASSED [ 48%]
tests/unit/registry/test_service_factory.py::TestDatabaseServiceCreation::test_create_database_service_postgres_with_components PASSED [ 48%]
tests/unit/registry/test_service_factory.py::TestDatabaseServiceCreation::test_create_database_service_postgres_with_defaults PASSED [ 49%]
tests/unit/registry/test_service_factory.py::TestDatabaseServiceCreation::test_create_database_service_neo4j PASSED [ 49%]
tests/unit/registry/test_service_factory.py::TestDatabaseServiceCreation::test_create_database_service_neo4j_with_defaults PASSED [ 50%]
tests/unit/registry/test_service_factory.py::TestDatabaseServiceCreation::test_create_database_service_unknown_type PASSED [ 50%]
tests/unit/registry/test_service_factory.py::TestServiceCreation::test_create_service_llm PASSED [ 51%]
tests/unit/registry/test_service_factory.py::TestServiceCreation::test_create_service_embedding PASSED [ 51%]
tests/unit/registry/test_service_factory.py::TestServiceCreation::test_create_service_database PASSED [ 52%]
tests/unit/registry/test_service_factory.py::TestServiceCreation::test_create_service_unknown_type PASSED [ 53%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_provider_not_available_raises_error PASSED [ 53%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_provider_initialization PASSED [ 54%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_get_embeddings PASSED [ 54%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_calculate_cost_is_zero PASSED [ 55%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_known_model_dimensions PASSED [ 55%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_unknown_model_uses_output_shape PASSED [ 56%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_custom_batch_size PASSED [ 56%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_model_loading_failure PASSED [ 57%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_get_model_name PASSED [ 58%]
tests/unit/services/embedding/test_onnx_local_provider.py::test_mean_pooling PASSED [ 58%]
tests/unit/services/llm/test_anthropic_provider.py::test_provider_initialization PASSED [ 59%]
tests/unit/services/llm/test_anthropic_provider.py::test_provider_invalid_model PASSED [ 59%]
tests/unit/services/llm/test_anthropic_provider.py::test_complete PASSED [ 60%]
tests/unit/services/llm/test_anthropic_provider.py::test_complete_with_system_message PASSED [ 60%]
tests/unit/services/llm/test_anthropic_provider.py::test_count_tokens PASSED [ 61%]
tests/unit/services/llm/test_anthropic_provider.py::test_calculate_cost PASSED [ 61%]
tests/unit/services/llm/test_anthropic_provider.py::test_get_model_name PASSED [ 62%]
tests/unit/services/llm/test_anthropic_provider.py::test_get_max_tokens PASSED [ 62%]
tests/unit/services/llm/test_anthropic_provider.py::test_stream PASSED   [ 63%]
tests/unit/services/llm/test_anthropic_provider.py::test_different_models PASSED [ 64%]
tests/unit/services/llm/test_ollama_provider.py::test_provider_initialization PASSED [ 64%]
tests/unit/services/llm/test_ollama_provider.py::test_provider_default_values PASSED [ 65%]
tests/unit/services/llm/test_ollama_provider.py::test_complete PASSED    [ 65%]
tests/unit/services/llm/test_ollama_provider.py::test_complete_with_system_message PASSED [ 66%]
tests/unit/services/llm/test_ollama_provider.py::test_count_tokens PASSED [ 66%]
tests/unit/services/llm/test_ollama_provider.py::test_calculate_cost PASSED [ 67%]
tests/unit/services/llm/test_ollama_provider.py::test_get_model_name PASSED [ 67%]
tests/unit/services/llm/test_ollama_provider.py::test_get_max_tokens PASSED [ 68%]
tests/unit/services/llm/test_ollama_provider.py::test_messages_to_prompt PASSED [ 69%]
tests/unit/services/llm/test_ollama_provider.py::test_stream PASSED      [ 69%]
tests/unit/services/llm/test_openai_provider.py::test_provider_initialization PASSED [ 70%]
tests/unit/services/llm/test_openai_provider.py::test_provider_invalid_model PASSED [ 70%]
tests/unit/services/llm/test_openai_provider.py::test_complete PASSED    [ 71%]
tests/unit/services/llm/test_openai_provider.py::test_complete_with_system_message PASSED [ 71%]
tests/unit/services/llm/test_openai_provider.py::test_count_tokens PASSED [ 72%]
tests/unit/services/llm/test_openai_provider.py::test_calculate_cost PASSED [ 72%]
tests/unit/services/llm/test_openai_provider.py::test_get_model_name PASSED [ 73%]
tests/unit/services/llm/test_openai_provider.py::test_get_max_tokens PASSED [ 74%]
tests/unit/services/llm/test_openai_provider.py::test_stream PASSED      [ 74%]
tests/unit/services/llm/test_openai_provider.py::test_different_models PASSED [ 75%]
tests/unit/services/llm/test_service.py::test_service_initialization PASSED [ 75%]
tests/unit/services/llm/test_service.py::test_complete_single_message PASSED [ 76%]
tests/unit/services/llm/test_service.py::test_complete_with_system_message PASSED [ 76%]
tests/unit/services/llm/test_service.py::test_complete_empty_messages_raises_error PASSED [ 77%]
tests/unit/services/llm/test_service.py::test_complete_with_temperature PASSED [ 77%]
tests/unit/services/llm/test_service.py::test_complete_with_max_tokens PASSED [ 78%]
tests/unit/services/llm/test_service.py::test_stats_tracking PASSED      [ 79%]
tests/unit/services/llm/test_service.py::test_count_tokens PASSED        [ 79%]
tests/unit/services/llm/test_service.py::test_estimate_cost PASSED       [ 80%]
tests/unit/services/llm/test_service.py::test_stream_messages PASSED     [ 80%]
tests/unit/services/llm/test_service.py::test_stream_with_callback PASSED [ 81%]
tests/unit/services/llm/test_service.py::test_stream_empty_messages_raises_error PASSED [ 81%]
tests/unit/services/llm/test_service.py::test_provider_error_handling PASSED [ 82%]
tests/unit/services/llm/test_service.py::test_rate_limiter_interaction PASSED [ 82%]
tests/unit/services/test_database_service.py::test_service_initialization PASSED [ 83%]
tests/unit/services/test_database_service.py::test_ensure_table PASSED   [ 83%]
tests/unit/services/test_database_service.py::test_store_chunks FAILED   [ 84%]
tests/unit/services/test_database_service.py::test_store_empty_chunks PASSED [ 85%]
tests/unit/services/test_database_service.py::test_search_chunks FAILED  [ 85%]
tests/unit/services/test_database_service.py::test_get_chunk PASSED      [ 86%]
tests/unit/services/test_database_service.py::test_get_chunk_not_found PASSED [ 86%]
tests/unit/services/test_database_service.py::test_get_chunks_for_documents PASSED [ 87%]
tests/unit/services/test_database_service.py::test_close PASSED          [ 87%]
tests/unit/services/test_database_service.py::test_context_manager PASSED [ 88%]
tests/unit/strategies/indexing/test_context_aware.py::test_capabilities FAILED [ 88%]
tests/unit/strategies/indexing/test_context_aware.py::test_requirements PASSED [ 89%]
tests/unit/strategies/indexing/test_context_aware.py::test_split_into_sentences PASSED [ 90%]
tests/unit/strategies/indexing/test_context_aware.py::test_create_windows PASSED [ 90%]
tests/unit/strategies/indexing/test_context_aware.py::test_find_boundaries PASSED [ 91%]
tests/unit/strategies/indexing/test_context_aware.py::test_create_chunks_respects_boundaries PASSED [ 91%]
tests/unit/strategies/indexing/test_context_aware.py::test_create_chunks_respects_min_size PASSED [ 92%]
tests/unit/strategies/indexing/test_context_aware.py::test_create_chunks_respects_max_size PASSED [ 92%]
tests/unit/strategies/indexing/test_context_aware.py::test_process_flow PASSED [ 93%]
tests/unit/test_package.py::TestImports::test_import_main_package PASSED [ 93%]
tests/unit/test_package.py::TestImports::test_import_factory FAILED      [ 94%]
tests/unit/test_package.py::TestImports::test_import_pipeline FAILED     [ 95%]
tests/unit/test_package.py::TestImports::test_import_config FAILED       [ 95%]
tests/unit/test_package.py::TestImports::test_import_base_strategy PASSED [ 96%]
tests/unit/test_package.py::TestImports::test_import_all_exports PASSED  [ 96%]
tests/unit/test_package.py::TestVersion::test_version_format PASSED      [ 97%]
tests/unit/test_package.py::TestVersion::test_version_accessible PASSED  [ 97%]
tests/unit/test_package.py::TestPackageStructure::test_strategies_subpackage_exists PASSED [ 98%]
tests/unit/test_package.py::TestPackageStructure::test_no_circular_imports FAILED [ 98%]
tests/unit/test_package.py::TestDependencies::test_required_dependencies_installed PASSED [ 99%]
tests/unit/test_package.py::TestDependencies::test_optional_dependencies_handled FAILED [100%]

=================================== FAILURES ===================================
_______ TestRealServiceInstantiation.test_multiple_service_instantiation _______

self = <rag_factory.registry.service_registry.ServiceRegistry object at 0x7162905687a0>
service_ref = 'embedding_local'

    def get(self, service_ref: str) -> Any:
        """Get or create a service instance.
    
        Args:
            service_ref: Service reference like "$llm1" or "llm1"
    
        Returns:
            Service instance implementing appropriate interface
    
        Raises:
            ServiceNotFoundError: If service not found in registry
            ServiceInstantiationError: If service creation fails
        """
        # Strip $ prefix if present
        service_name = service_ref.lstrip('$')
    
        # Return cached instance if exists
        if service_name in self._instances:
            logger.debug(f"Service '{service_name}' returned from cache")
            return self._instances[service_name]
    
        # Thread-safe instantiation
        with self._locks[service_name]:
            # Double-check after acquiring lock
            if service_name in self._instances:
                return self._instances[service_name]
    
            # Validate service exists
            if 'services' not in self.config:
                raise ServiceNotFoundError(
                    f"No services defined in registry configuration"
                )
    
            if service_name not in self.config['services']:
                available = list(self.config['services'].keys())
                raise ServiceNotFoundError(
                    f"Service '{service_name}' not found in registry. "
                    f"Available services: {available}"
                )
    
            # Get service configuration
            service_config = self.config['services'][service_name]
    
            # Create service instance
            logger.info(f"Instantiating service: {service_name}")
            start_time = time.time()
    
            try:
>               service_instance = self._factory.create_service(
                    service_name,
                    service_config
                )

rag_factory/registry/service_registry.py:137: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag_factory/registry/service_factory.py:48: in create_service
    return self._create_embedding_service(service_name, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/registry/service_factory.py:127: in _create_embedding_service
    return ONNXEmbeddingService(
rag_factory/services/onnx/embedding.py:68: in __init__
    self._provider = ONNXLocalProvider(config)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/embedding/providers/onnx_local.py:116: in __init__
    self.model_path = get_onnx_model_path(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

model_name = 'Xenova/all-MiniLM-L6-v2', cache_dir = PosixPath('models')
filename = 'model.onnx'

    def get_onnx_model_path(
        model_name: str,
        cache_dir: Optional[Path] = None,
        filename: str = "model.onnx",
    ) -> Path:
        """Get path to local ONNX model.
    
        This function checks:
        1. Local model paths (if model exists locally)
        2. Local cache directory
    
        Args:
            model_name: Model identifier or local path
            cache_dir: Directory for model caching
            filename: Name of the ONNX model file
    
        Returns:
            Path to ONNX model file
    
        Raises:
            FileNotFoundError: If model is not found locally
        """
        import os
    
        check_dependencies()
    
        # Check for environment variable configuration
        env_model_path = os.getenv("EMBEDDING_MODEL_PATH")
        env_model_name = os.getenv("EMBEDDING_MODEL_NAME")
    
        # Use environment variable for cache_dir if not specified
        if cache_dir is None:
            if env_model_path:
                cache_dir = Path(env_model_path)
            elif Path("models/embeddings").exists():
                cache_dir = Path("models/embeddings").resolve()
                logger.info(f"Using local project cache: {cache_dir}")
            else:
                # Default to standard location, but don't create it if we're not downloading
                cache_dir = Path.home() / ".cache" / "rag_factory" / "onnx_models"
    
        cache_dir = Path(cache_dir)
    
        # Use environment variable for model_name if it matches default
        if env_model_name and model_name == "Xenova/all-MiniLM-L6-v2":
            logger.info(f"Using model from EMBEDDING_MODEL_NAME env: {env_model_name}")
            model_name = env_model_name
    
        # Check if model_name is a local path
        potential_local_path = Path(model_name)
        if potential_local_path.exists() and potential_local_path.is_file():
            logger.info(f"Using local ONNX model: {potential_local_path}")
            return potential_local_path
    
        # Check if model exists in cache directory
        # Try both naming conventions: underscore (old) and double-dash (HF standard)
        model_dir_name_underscore = model_name.replace("/", "_")
        model_dir_name_dash = model_name.replace("/", "--")
    
        for model_dir_name in [model_dir_name_dash, model_dir_name_underscore]:
            local_model_dir = cache_dir / model_dir_name
    
            if local_model_dir.exists():
                # Look for ONNX files in the directory (recursively, Xenova models have onnx/ subdirectory)
                onnx_files = list(local_model_dir.rglob("*.onnx"))
                if onnx_files:
                    # Prefer the main model.onnx if available, otherwise use first one
                    main_model = next((f for f in onnx_files if f.name == "model.onnx"), onnx_files[0])
                    logger.info(f"Using cached ONNX model: {main_model}")
                    return main_model
    
        # Model not found locally
        error_msg = (
            f"ONNX model '{model_name}' not found locally.\n"
            f"Checked path: {cache_dir}\n"
            f"Automatic downloading is disabled. Please ensure the model is available directly in the infrastructure.\n"
            f"Set EMBEDDING_MODEL_PATH environment variable to the directory containing the model."
        )
>       raise FileNotFoundError(error_msg)
E       FileNotFoundError: ONNX model 'Xenova/all-MiniLM-L6-v2' not found locally.
E       Checked path: models
E       Automatic downloading is disabled. Please ensure the model is available directly in the infrastructure.
E       Set EMBEDDING_MODEL_PATH environment variable to the directory containing the model.

rag_factory/services/utils/onnx_utils.py:123: FileNotFoundError

During handling of the above exception, another exception occurred:

self = <tests.integration.registry.test_registry_integration.TestRealServiceInstantiation object at 0x7162909d67e0>
test_services_yaml_with_env = '/tmp/pytest-of-admindevmac/pytest-84/test_multiple_service_instanti0/services.yaml'

    def test_multiple_service_instantiation(self, test_services_yaml_with_env):
        """Test instantiating multiple services."""
        registry = ServiceRegistry(test_services_yaml_with_env)
    
        # Get both services
>       embedding = registry.get("embedding_local")
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/integration/registry/test_registry_integration.py:95: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <rag_factory.registry.service_registry.ServiceRegistry object at 0x7162905687a0>
service_ref = 'embedding_local'

    def get(self, service_ref: str) -> Any:
        """Get or create a service instance.
    
        Args:
            service_ref: Service reference like "$llm1" or "llm1"
    
        Returns:
            Service instance implementing appropriate interface
    
        Raises:
            ServiceNotFoundError: If service not found in registry
            ServiceInstantiationError: If service creation fails
        """
        # Strip $ prefix if present
        service_name = service_ref.lstrip('$')
    
        # Return cached instance if exists
        if service_name in self._instances:
            logger.debug(f"Service '{service_name}' returned from cache")
            return self._instances[service_name]
    
        # Thread-safe instantiation
        with self._locks[service_name]:
            # Double-check after acquiring lock
            if service_name in self._instances:
                return self._instances[service_name]
    
            # Validate service exists
            if 'services' not in self.config:
                raise ServiceNotFoundError(
                    f"No services defined in registry configuration"
                )
    
            if service_name not in self.config['services']:
                available = list(self.config['services'].keys())
                raise ServiceNotFoundError(
                    f"Service '{service_name}' not found in registry. "
                    f"Available services: {available}"
                )
    
            # Get service configuration
            service_config = self.config['services'][service_name]
    
            # Create service instance
            logger.info(f"Instantiating service: {service_name}")
            start_time = time.time()
    
            try:
                service_instance = self._factory.create_service(
                    service_name,
                    service_config
                )
                instantiation_time = time.time() - start_time
    
                logger.info(
                    f"Service '{service_name}' instantiated successfully "
                    f"in {instantiation_time:.2f}s"
                )
    
            except Exception as e:
                logger.error(f"Failed to instantiate service '{service_name}': {e}")
>               raise ServiceInstantiationError(
                    f"Service instantiation failed for '{service_name}': {e}"
                )
E               rag_factory.registry.exceptions.ServiceInstantiationError: Service instantiation failed for 'embedding_local': ONNX model 'Xenova/all-MiniLM-L6-v2' not found locally.
E               Checked path: models
E               Automatic downloading is disabled. Please ensure the model is available directly in the infrastructure.
E               Set EMBEDDING_MODEL_PATH environment variable to the directory containing the model.

rag_factory/registry/service_registry.py:150: ServiceInstantiationError
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.registry.service_registry:Loading service registry from: /tmp/pytest-of-admindevmac/pytest-84/test_multiple_service_instanti0/services.yaml
WARNING:rag_factory.registry.service_registry:WARNING: Potential plaintext secret in services.llm_local.api_key. Consider using environment variable: ${ENV_VAR}
INFO:rag_factory.registry.service_registry:Service registry loaded: 2 services available
INFO:rag_factory.registry.service_registry:Instantiating service: embedding_local
DEBUG:rag_factory.registry.service_factory:Creating embedding service: embedding_local
INFO:rag_factory.services.embedding.providers.onnx_local:Loading ONNX model: Xenova/all-MiniLM-L6-v2
INFO:rag_factory.services.utils.onnx_utils:Using model from EMBEDDING_MODEL_NAME env: Xenova/all-MiniLM-L6-v2
ERROR:rag_factory.registry.service_registry:Failed to instantiate service 'embedding_local': ONNX model 'Xenova/all-MiniLM-L6-v2' not found locally.
Checked path: models
Automatic downloading is disabled. Please ensure the model is available directly in the infrastructure.
Set EMBEDDING_MODEL_PATH environment variable to the directory containing the model.
------------------------------ Captured log call -------------------------------
INFO     rag_factory.registry.service_registry:service_registry.py:55 Loading service registry from: /tmp/pytest-of-admindevmac/pytest-84/test_multiple_service_instanti0/services.yaml
WARNING  rag_factory.registry.service_registry:service_registry.py:70 WARNING: Potential plaintext secret in services.llm_local.api_key. Consider using environment variable: ${ENV_VAR}
INFO     rag_factory.registry.service_registry:service_registry.py:75 Service registry loaded: 2 services available
INFO     rag_factory.registry.service_registry:service_registry.py:133 Instantiating service: embedding_local
DEBUG    rag_factory.registry.service_factory:service_factory.py:121 Creating embedding service: embedding_local
INFO     rag_factory.services.embedding.providers.onnx_local:onnx_local.py:111 Loading ONNX model: Xenova/all-MiniLM-L6-v2
INFO     rag_factory.services.utils.onnx_utils:onnx_utils.py:90 Using model from EMBEDDING_MODEL_NAME env: Xenova/all-MiniLM-L6-v2
ERROR    rag_factory.registry.service_registry:service_registry.py:149 Failed to instantiate service 'embedding_local': ONNX model 'Xenova/all-MiniLM-L6-v2' not found locally.
Checked path: models
Automatic downloading is disabled. Please ensure the model is available directly in the infrastructure.
Set EMBEDDING_MODEL_PATH environment variable to the directory containing the model.
________________ TestErrorHandling.test_invalid_service_config _________________

self = <rag_factory.config.validator.ConfigValidator object at 0x7162901985c0>
config = {'services': {'invalid_service': {'unknown_field': 'value'}}}
file_path = '/tmp/pytest-of-admindevmac/pytest-84/test_invalid_service_config0/services.yaml'

    def validate_services_yaml(
        self,
        config: Dict[str, Any],
        file_path: Optional[str] = None
    ) -> List[str]:
        """
        Validate services.yaml configuration.
    
        Args:
            config: Parsed YAML configuration
            file_path: Path to YAML file (for error messages)
    
        Returns:
            List of warning messages (empty if no warnings)
    
        Raises:
            ConfigValidationError: If validation fails
    
        Examples:
            >>> validator = ConfigValidator()
            >>> config = {
            ...     "services": {
            ...         "llm1": {
            ...             "name": "test-llm",
            ...             "type": "llm",
            ...             "url": "http://localhost:1234/v1",
            ...             "api_key": "${API_KEY}",
            ...             "model": "test-model"
            ...         }
            ...     }
            ... }
            >>> warnings = validator.validate_services_yaml(config)
            >>> len(warnings)
            0
        """
        try:
            # JSON Schema validation
>           jsonschema.validate(
                instance=config,
                schema=self._schemas["service_registry"]
            )

rag_factory/config/validator.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

instance = {'services': {'invalid_service': {'unknown_field': 'value'}}}
schema = {'$schema': 'http://json-schema.org/draft-07/schema#', 'definitions': {'database_service': {'properties': {'connection...tion': 'Schema version (semver)', 'pattern': '^\\d+\\.\\d+\\.\\d+$', 'type': 'string'}}, 'required': ['services'], ...}
cls = <class 'jsonschema.validators.Draft7Validator'>, args = (), kwargs = {}
validator = Draft7Validator(schema={'$schema': 'http://json-...ft-07/schema#', 'definitions': {'database_service': {'properties': ... (semver)', 'pattern': '^\\d+\\.\\d+\\.\\d+$', 'type': 'string'}}, 'required': ['services'], ...}, format_checker=None)
error = <ValidationError: "{'unknown_field': 'value'} is not valid under any of the given schemas">

    def validate(instance, schema, cls=None, *args, **kwargs):  # noqa: D417
        """
        Validate an instance under the given schema.
    
            >>> validate([2, 3, 4], {"maxItems": 2})
            Traceback (most recent call last):
                ...
            ValidationError: [2, 3, 4] is too long
    
        :func:`~jsonschema.validators.validate` will first verify that the
        provided schema is itself valid, since not doing so can lead to less
        obvious error messages and fail in less obvious or consistent ways.
    
        If you know you have a valid schema already, especially
        if you intend to validate multiple instances with
        the same schema, you likely would prefer using the
        `jsonschema.protocols.Validator.validate` method directly on a
        specific validator (e.g. ``Draft202012Validator.validate``).
    
    
        Arguments:
    
            instance:
    
                The instance to validate
    
            schema:
    
                The schema to validate with
    
            cls (jsonschema.protocols.Validator):
    
                The class that will be used to validate the instance.
    
        If the ``cls`` argument is not provided, two things will happen
        in accordance with the specification. First, if the schema has a
        :kw:`$schema` keyword containing a known meta-schema [#]_ then the
        proper validator will be used. The specification recommends that
        all schemas contain :kw:`$schema` properties for this reason. If no
        :kw:`$schema` property is found, the default validator class is the
        latest released draft.
    
        Any other provided positional and keyword arguments will be passed
        on when instantiating the ``cls``.
    
        Raises:
    
            `jsonschema.exceptions.ValidationError`:
    
                if the instance is invalid
    
            `jsonschema.exceptions.SchemaError`:
    
                if the schema itself is invalid
    
        .. rubric:: Footnotes
        .. [#] known by a validator registered with
            `jsonschema.validators.validates`
    
        """
        if cls is None:
            cls = validator_for(schema)
    
        cls.check_schema(schema)
        validator = cls(schema, *args, **kwargs)
        error = exceptions.best_match(validator.iter_errors(instance))
        if error is not None:
>           raise error
E           jsonschema.exceptions.ValidationError: {'unknown_field': 'value'} is not valid under any of the given schemas
E           
E           Failed validating 'oneOf' in schema['properties']['services']['patternProperties']['^[a-zA-Z0-9_]+$']:
E               {'oneOf': [{'$ref': '#/definitions/llm_service'},
E                          {'$ref': '#/definitions/embedding_service'},
E                          {'$ref': '#/definitions/database_service'}]}
E           
E           On instance['services']['invalid_service']:
E               {'unknown_field': 'value'}

venv/lib/python3.12/site-packages/jsonschema/validators.py:1332: ValidationError

During handling of the above exception, another exception occurred:

self = <rag_factory.registry.service_registry.ServiceRegistry object at 0x71629019bef0>

    def _load_config(self) -> None:
        """Load and validate services.yaml configuration."""
        logger.info(f"Loading service registry from: {self.config_path}")
    
        try:
            # Load YAML
            with open(self.config_path, 'r') as f:
                raw_config = yaml.safe_load(f)
    
            # Validate schema
>           warnings = self._validator.validate_services_yaml(
                raw_config,
                file_path=self.config_path
            )

rag_factory/registry/service_registry.py:63: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <rag_factory.config.validator.ConfigValidator object at 0x7162901985c0>
config = {'services': {'invalid_service': {'unknown_field': 'value'}}}
file_path = '/tmp/pytest-of-admindevmac/pytest-84/test_invalid_service_config0/services.yaml'

    def validate_services_yaml(
        self,
        config: Dict[str, Any],
        file_path: Optional[str] = None
    ) -> List[str]:
        """
        Validate services.yaml configuration.
    
        Args:
            config: Parsed YAML configuration
            file_path: Path to YAML file (for error messages)
    
        Returns:
            List of warning messages (empty if no warnings)
    
        Raises:
            ConfigValidationError: If validation fails
    
        Examples:
            >>> validator = ConfigValidator()
            >>> config = {
            ...     "services": {
            ...         "llm1": {
            ...             "name": "test-llm",
            ...             "type": "llm",
            ...             "url": "http://localhost:1234/v1",
            ...             "api_key": "${API_KEY}",
            ...             "model": "test-model"
            ...         }
            ...     }
            ... }
            >>> warnings = validator.validate_services_yaml(config)
            >>> len(warnings)
            0
        """
        try:
            # JSON Schema validation
            jsonschema.validate(
                instance=config,
                schema=self._schemas["service_registry"]
            )
        except jsonschema.ValidationError as e:
>           raise ConfigValidationError(
                message=f"Schema validation failed: {e.message}",
                file_path=file_path,
                field=".".join(str(p) for p in e.path)
            )
E           rag_factory.config.validator.ConfigValidationError: Schema validation failed: {'unknown_field': 'value'} is not valid under any of the given schemas
E           File: /tmp/pytest-of-admindevmac/pytest-84/test_invalid_service_config0/services.yaml
E           Field: services.invalid_service

rag_factory/config/validator.py:118: ConfigValidationError

During handling of the above exception, another exception occurred:

self = <tests.integration.registry.test_registry_integration.TestErrorHandling object at 0x7162909d7d10>
tmp_path = PosixPath('/tmp/pytest-of-admindevmac/pytest-84/test_invalid_service_config0')

        def test_invalid_service_config(self, tmp_path):
            """Test handling of invalid service configuration."""
            content = """
    services:
      invalid_service:
        unknown_field: "value"
    """
            services_file = tmp_path / "services.yaml"
            services_file.write_text(content)
    
>           registry = ServiceRegistry(str(services_file))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/integration/registry/test_registry_integration.py:230: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag_factory/registry/service_registry.py:51: in __init__
    self._load_config()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <rag_factory.registry.service_registry.ServiceRegistry object at 0x71629019bef0>

    def _load_config(self) -> None:
        """Load and validate services.yaml configuration."""
        logger.info(f"Loading service registry from: {self.config_path}")
    
        try:
            # Load YAML
            with open(self.config_path, 'r') as f:
                raw_config = yaml.safe_load(f)
    
            # Validate schema
            warnings = self._validator.validate_services_yaml(
                raw_config,
                file_path=self.config_path
            )
    
            # Print warnings
            for warning in warnings:
                logger.warning(warning)
    
            # Resolve environment variables
            self.config = EnvResolver.resolve(raw_config)
    
            logger.info(
                f"Service registry loaded: "
                f"{len(self.config.get('services', {}))} services available"
            )
    
        except FileNotFoundError:
            raise ServiceInstantiationError(
                f"Service registry configuration not found: {self.config_path}"
            )
        except Exception as e:
>           raise ServiceInstantiationError(
                f"Failed to load service registry: {e}"
            )
E           rag_factory.registry.exceptions.ServiceInstantiationError: Failed to load service registry: Schema validation failed: {'unknown_field': 'value'} is not valid under any of the given schemas
E           File: /tmp/pytest-of-admindevmac/pytest-84/test_invalid_service_config0/services.yaml
E           Field: services.invalid_service

rag_factory/registry/service_registry.py:85: ServiceInstantiationError
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.registry.service_registry:Loading service registry from: /tmp/pytest-of-admindevmac/pytest-84/test_invalid_service_config0/services.yaml
------------------------------ Captured log call -------------------------------
INFO     rag_factory.registry.service_registry:service_registry.py:55 Loading service registry from: /tmp/pytest-of-admindevmac/pytest-84/test_invalid_service_config0/services.yaml
___________ TestConfigurationValidation.test_configuration_warnings ____________

self = <rag_factory.config.validator.ConfigValidator object at 0x71628e5e1e20>
config = {'services': {'test_service': {'api_key': 'plaintext-secret', 'model': 'test-model', 'provider': 'onnx'}}}
file_path = '/tmp/pytest-of-admindevmac/pytest-84/test_configuration_warnings0/services.yaml'

    def validate_services_yaml(
        self,
        config: Dict[str, Any],
        file_path: Optional[str] = None
    ) -> List[str]:
        """
        Validate services.yaml configuration.
    
        Args:
            config: Parsed YAML configuration
            file_path: Path to YAML file (for error messages)
    
        Returns:
            List of warning messages (empty if no warnings)
    
        Raises:
            ConfigValidationError: If validation fails
    
        Examples:
            >>> validator = ConfigValidator()
            >>> config = {
            ...     "services": {
            ...         "llm1": {
            ...             "name": "test-llm",
            ...             "type": "llm",
            ...             "url": "http://localhost:1234/v1",
            ...             "api_key": "${API_KEY}",
            ...             "model": "test-model"
            ...         }
            ...     }
            ... }
            >>> warnings = validator.validate_services_yaml(config)
            >>> len(warnings)
            0
        """
        try:
            # JSON Schema validation
>           jsonschema.validate(
                instance=config,
                schema=self._schemas["service_registry"]
            )

rag_factory/config/validator.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

instance = {'services': {'test_service': {'api_key': 'plaintext-secret', 'model': 'test-model', 'provider': 'onnx'}}}
schema = {'$schema': 'http://json-schema.org/draft-07/schema#', 'definitions': {'database_service': {'properties': {'connection...tion': 'Schema version (semver)', 'pattern': '^\\d+\\.\\d+\\.\\d+$', 'type': 'string'}}, 'required': ['services'], ...}
cls = <class 'jsonschema.validators.Draft7Validator'>, args = (), kwargs = {}
validator = Draft7Validator(schema={'$schema': 'http://json-...ft-07/schema#', 'definitions': {'database_service': {'properties': ... (semver)', 'pattern': '^\\d+\\.\\d+\\.\\d+$', 'type': 'string'}}, 'required': ['services'], ...}, format_checker=None)
error = <ValidationError: "{'provider': 'onnx', 'model': 'test-model', 'api_key': 'plaintext-secret'} is not valid under any of the given schemas">

    def validate(instance, schema, cls=None, *args, **kwargs):  # noqa: D417
        """
        Validate an instance under the given schema.
    
            >>> validate([2, 3, 4], {"maxItems": 2})
            Traceback (most recent call last):
                ...
            ValidationError: [2, 3, 4] is too long
    
        :func:`~jsonschema.validators.validate` will first verify that the
        provided schema is itself valid, since not doing so can lead to less
        obvious error messages and fail in less obvious or consistent ways.
    
        If you know you have a valid schema already, especially
        if you intend to validate multiple instances with
        the same schema, you likely would prefer using the
        `jsonschema.protocols.Validator.validate` method directly on a
        specific validator (e.g. ``Draft202012Validator.validate``).
    
    
        Arguments:
    
            instance:
    
                The instance to validate
    
            schema:
    
                The schema to validate with
    
            cls (jsonschema.protocols.Validator):
    
                The class that will be used to validate the instance.
    
        If the ``cls`` argument is not provided, two things will happen
        in accordance with the specification. First, if the schema has a
        :kw:`$schema` keyword containing a known meta-schema [#]_ then the
        proper validator will be used. The specification recommends that
        all schemas contain :kw:`$schema` properties for this reason. If no
        :kw:`$schema` property is found, the default validator class is the
        latest released draft.
    
        Any other provided positional and keyword arguments will be passed
        on when instantiating the ``cls``.
    
        Raises:
    
            `jsonschema.exceptions.ValidationError`:
    
                if the instance is invalid
    
            `jsonschema.exceptions.SchemaError`:
    
                if the schema itself is invalid
    
        .. rubric:: Footnotes
        .. [#] known by a validator registered with
            `jsonschema.validators.validates`
    
        """
        if cls is None:
            cls = validator_for(schema)
    
        cls.check_schema(schema)
        validator = cls(schema, *args, **kwargs)
        error = exceptions.best_match(validator.iter_errors(instance))
        if error is not None:
>           raise error
E           jsonschema.exceptions.ValidationError: {'provider': 'onnx', 'model': 'test-model', 'api_key': 'plaintext-secret'} is not valid under any of the given schemas
E           
E           Failed validating 'oneOf' in schema['properties']['services']['patternProperties']['^[a-zA-Z0-9_]+$']:
E               {'oneOf': [{'$ref': '#/definitions/llm_service'},
E                          {'$ref': '#/definitions/embedding_service'},
E                          {'$ref': '#/definitions/database_service'}]}
E           
E           On instance['services']['test_service']:
E               {'provider': 'onnx',
E                'model': 'test-model',
E                'api_key': 'plaintext-secret'}

venv/lib/python3.12/site-packages/jsonschema/validators.py:1332: ValidationError

During handling of the above exception, another exception occurred:

self = <rag_factory.registry.service_registry.ServiceRegistry object at 0x71628e5e2210>

    def _load_config(self) -> None:
        """Load and validate services.yaml configuration."""
        logger.info(f"Loading service registry from: {self.config_path}")
    
        try:
            # Load YAML
            with open(self.config_path, 'r') as f:
                raw_config = yaml.safe_load(f)
    
            # Validate schema
>           warnings = self._validator.validate_services_yaml(
                raw_config,
                file_path=self.config_path
            )

rag_factory/registry/service_registry.py:63: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <rag_factory.config.validator.ConfigValidator object at 0x71628e5e1e20>
config = {'services': {'test_service': {'api_key': 'plaintext-secret', 'model': 'test-model', 'provider': 'onnx'}}}
file_path = '/tmp/pytest-of-admindevmac/pytest-84/test_configuration_warnings0/services.yaml'

    def validate_services_yaml(
        self,
        config: Dict[str, Any],
        file_path: Optional[str] = None
    ) -> List[str]:
        """
        Validate services.yaml configuration.
    
        Args:
            config: Parsed YAML configuration
            file_path: Path to YAML file (for error messages)
    
        Returns:
            List of warning messages (empty if no warnings)
    
        Raises:
            ConfigValidationError: If validation fails
    
        Examples:
            >>> validator = ConfigValidator()
            >>> config = {
            ...     "services": {
            ...         "llm1": {
            ...             "name": "test-llm",
            ...             "type": "llm",
            ...             "url": "http://localhost:1234/v1",
            ...             "api_key": "${API_KEY}",
            ...             "model": "test-model"
            ...         }
            ...     }
            ... }
            >>> warnings = validator.validate_services_yaml(config)
            >>> len(warnings)
            0
        """
        try:
            # JSON Schema validation
            jsonschema.validate(
                instance=config,
                schema=self._schemas["service_registry"]
            )
        except jsonschema.ValidationError as e:
>           raise ConfigValidationError(
                message=f"Schema validation failed: {e.message}",
                file_path=file_path,
                field=".".join(str(p) for p in e.path)
            )
E           rag_factory.config.validator.ConfigValidationError: Schema validation failed: {'provider': 'onnx', 'model': 'test-model', 'api_key': 'plaintext-secret'} is not valid under any of the given schemas
E           File: /tmp/pytest-of-admindevmac/pytest-84/test_configuration_warnings0/services.yaml
E           Field: services.test_service

rag_factory/config/validator.py:118: ConfigValidationError

During handling of the above exception, another exception occurred:

self = <tests.integration.registry.test_registry_integration.TestConfigurationValidation object at 0x716290820e30>
tmp_path = PosixPath('/tmp/pytest-of-admindevmac/pytest-84/test_configuration_warnings0')
caplog = <_pytest.logging.LogCaptureFixture object at 0x71628e528a10>

        def test_configuration_warnings(self, tmp_path, caplog):
            """Test that configuration warnings are logged."""
            import logging
            caplog.set_level(logging.WARNING)
    
            content = """
    services:
      test_service:
        provider: "onnx"
        model: "test-model"
        api_key: "plaintext-secret"  # Should trigger warning
    """
            services_file = tmp_path / "services.yaml"
            services_file.write_text(content)
    
>           registry = ServiceRegistry(str(services_file))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/integration/registry/test_registry_integration.py:332: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
rag_factory/registry/service_registry.py:51: in __init__
    self._load_config()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <rag_factory.registry.service_registry.ServiceRegistry object at 0x71628e5e2210>

    def _load_config(self) -> None:
        """Load and validate services.yaml configuration."""
        logger.info(f"Loading service registry from: {self.config_path}")
    
        try:
            # Load YAML
            with open(self.config_path, 'r') as f:
                raw_config = yaml.safe_load(f)
    
            # Validate schema
            warnings = self._validator.validate_services_yaml(
                raw_config,
                file_path=self.config_path
            )
    
            # Print warnings
            for warning in warnings:
                logger.warning(warning)
    
            # Resolve environment variables
            self.config = EnvResolver.resolve(raw_config)
    
            logger.info(
                f"Service registry loaded: "
                f"{len(self.config.get('services', {}))} services available"
            )
    
        except FileNotFoundError:
            raise ServiceInstantiationError(
                f"Service registry configuration not found: {self.config_path}"
            )
        except Exception as e:
>           raise ServiceInstantiationError(
                f"Failed to load service registry: {e}"
            )
E           rag_factory.registry.exceptions.ServiceInstantiationError: Failed to load service registry: Schema validation failed: {'provider': 'onnx', 'model': 'test-model', 'api_key': 'plaintext-secret'} is not valid under any of the given schemas
E           File: /tmp/pytest-of-admindevmac/pytest-84/test_configuration_warnings0/services.yaml
E           Field: services.test_service

rag_factory/registry/service_registry.py:85: ServiceInstantiationError
______________________________ test_rag_workflow _______________________________

embedding_service = <rag_factory.services.embedding.service.EmbeddingService object at 0x71628f47d6a0>
llm_service = <rag_factory.services.llm.service.LLMService object at 0x71628ef58200>
database_service = (<rag_factory.services.database.postgres.PostgresqlDatabaseService object at 0x71628eec4bc0>, <AsyncMock name='mock.__aenter__()' id='124668108097008'>)

    @pytest.mark.asyncio
    async def test_rag_workflow(embedding_service, llm_service, database_service):
        """Test full RAG workflow integration."""
        db_service, db_conn = database_service
    
        # 1. Embed document
        text = "Important document content"
        embedding_result = embedding_service.embed([text])
        embedding = embedding_result.embeddings[0]
    
        assert len(embedding) == 3
    
        # 2. Store in database
        chunk = {
            "chunk_id": "doc1",
            "text": text,
            "embedding": embedding,
            "metadata": {"source": "test"}
        }
        await db_service.store_chunks([chunk])
    
        db_conn.execute.assert_called()
    
        # 3. Retrieve relevant chunks (mock search)
        db_conn.fetch.return_value = [
            {
                "chunk_id": "doc1",
                "text": text,
                "metadata": '{"source": "test"}',
                "similarity": 0.95
            }
        ]
    
        query = "What is important?"
        query_embedding = embedding_service.embed([query]).embeddings[0]
        results = await db_service.search_chunks(query_embedding)
    
        assert len(results) == 1
>       assert results[0]["text"] == text
               ^^^^^^^^^^^^^^^^^^
E       TypeError: 'Chunk' object is not subscriptable

tests/integration/services/test_service_integration.py:136: TypeError
_____________________ test_embedding_database_consistency ______________________

embedding_service = <rag_factory.services.embedding.service.EmbeddingService object at 0x71628eee1ac0>
database_service = (<rag_factory.services.database.postgres.PostgresqlDatabaseService object at 0x71628eec6d20>, <AsyncMock name='mock.__aenter__()' id='124668115024064'>)

    @pytest.mark.asyncio
    async def test_embedding_database_consistency(embedding_service, database_service):
        """Test consistency between embedding dimensions and database storage."""
        db_service, db_conn = database_service
    
        # Get embedding dimension
        dim = embedding_service.provider.get_dimensions()
    
        # Create chunk with correct dimension
        embedding = [0.1] * dim
        chunk = {
            "chunk_id": "1",
            "text": "test",
            "embedding": embedding
        }
    
        await db_service.store_chunks([chunk])
    
        # Verify database received correct dimension vector
        call_args = db_conn.execute.call_args
        embedding_str = call_args[0][3] # 4th argument is embedding_str
        stored_dim = embedding_str.count(",") + 1
    
>       assert stored_dim == dim
E       assert 1 == 3

tests/integration/services/test_service_integration.py:171: AssertionError
____________ TestSelfReflectiveIntegration.test_end_to_end_workflow ____________

self = <tests.integration.strategies.test_self_reflective_integration.TestSelfReflectiveIntegration object at 0x71629098bc50>
mock_base_strategy = <Mock id='124668115237104'>
mock_llm_service = <Mock id='124668115225248'>

    def test_end_to_end_workflow(self, mock_base_strategy, mock_llm_service):
        """Test complete self-reflective retrieval workflow."""
        # Create strategy
>       strategy = SelfReflectiveRAGStrategy(
            base_retrieval_strategy=mock_base_strategy,
            llm_service=mock_llm_service,
            config={"grade_threshold": 4.0, "max_retries": 2}
        )
E       TypeError: SelfReflectiveRAGStrategy.__init__() got an unexpected keyword argument 'base_retrieval_strategy'

tests/integration/strategies/test_self_reflective_integration.py:80: TypeError
__________ TestSelfReflectiveIntegration.test_retry_with_poor_results __________

self = <tests.integration.strategies.test_self_reflective_integration.TestSelfReflectiveIntegration object at 0x716290988500>
mock_base_strategy = <Mock id='124668115236144'>
mock_llm_service = <Mock id='124668115236240'>

    def test_retry_with_poor_results(self, mock_base_strategy, mock_llm_service):
        """Test that retry is triggered for poor results."""
>       strategy = SelfReflectiveRAGStrategy(
            base_retrieval_strategy=mock_base_strategy,
            llm_service=mock_llm_service,
            config={"grade_threshold": 4.0, "max_retries": 2}
        )
E       TypeError: SelfReflectiveRAGStrategy.__init__() got an unexpected keyword argument 'base_retrieval_strategy'

tests/integration/strategies/test_self_reflective_integration.py:100: TypeError
_________ TestSelfReflectiveIntegration.test_performance_within_limits _________

self = <tests.integration.strategies.test_self_reflective_integration.TestSelfReflectiveIntegration object at 0x71629095f950>
mock_base_strategy = <Mock id='124668115229520'>
mock_llm_service = <Mock id='124668115229904'>

    def test_performance_within_limits(self, mock_base_strategy, mock_llm_service):
        """Test that self-reflective retrieval completes within timeout."""
        import time
    
>       strategy = SelfReflectiveRAGStrategy(
            base_retrieval_strategy=mock_base_strategy,
            llm_service=mock_llm_service,
            config={"grade_threshold": 4.0, "max_retries": 2, "timeout_seconds": 10}
        )
E       TypeError: SelfReflectiveRAGStrategy.__init__() got an unexpected keyword argument 'base_retrieval_strategy'

tests/integration/strategies/test_self_reflective_integration.py:119: TypeError
______________ TestSelfReflectiveWithLMStudio.test_with_real_llm _______________

self = <tests.integration.strategies.test_self_reflective_integration.TestSelfReflectiveWithLMStudio object at 0x71629095e900>
llm_service_from_env = <rag_factory.services.llm.service.LLMService object at 0x71628eb92660>

    def test_with_real_llm(self, llm_service_from_env):
        """Test with real LLM service from environment (LM Studio)."""
        from unittest.mock import Mock
    
        # Mock base strategy
        base_strategy = Mock()
        base_strategy.retrieve.return_value = [
            {"chunk_id": "c1", "text": "Sample result", "score": 0.9}
        ]
    
        # Create self-reflective strategy
>       strategy = SelfReflectiveRAGStrategy(
            base_retrieval_strategy=base_strategy,
            llm_service=llm_service_from_env,
            config={"grade_threshold": 4.0, "max_retries": 1}
        )
E       TypeError: SelfReflectiveRAGStrategy.__init__() got an unexpected keyword argument 'base_retrieval_strategy'

tests/integration/strategies/test_self_reflective_integration.py:149: TypeError
__________________ TestSmokeTest.test_basic_usage_smoke_test ___________________

self = <tests.integration.test_package_integration.TestSmokeTest object at 0x716290843770>

    def test_basic_usage_smoke_test(self) -> None:
        """Test basic usage works after import."""
>       from rag_factory import RAGFactory, StrategyPipeline, ConfigManager
E       ImportError: cannot import name 'RAGFactory' from 'rag_factory' (/mnt/MCPProyects/ragTools/rag_factory/__init__.py)

tests/integration/test_package_integration.py:60: ImportError
__________ TestFullWorkflow.test_full_workflow_with_installed_package __________

self = <tests.integration.test_package_integration.TestFullWorkflow object at 0x716290843aa0>

    def test_full_workflow_with_installed_package(self) -> None:
        """Test complete workflow using installed package."""
>       from rag_factory import RAGFactory, StrategyPipeline
E       ImportError: cannot import name 'RAGFactory' from 'rag_factory' (/mnt/MCPProyects/ragTools/rag_factory/__init__.py)

tests/integration/test_package_integration.py:90: ImportError
____________ TestPgVectorIntegration.test_cosine_similarity_search _____________

self = <tests.unit.database.test_pgvector.TestPgVectorIntegration object at 0x71629088f2c0>
mock_pool = (<MagicMock id='124668118994480'>, <AsyncMock name='mock.acquire().__aenter__()' id='124668111380624'>)

    @pytest.mark.asyncio
    async def test_cosine_similarity_search(self, mock_pool):
        """Test vector similarity search using cosine distance."""
        pool, conn = mock_pool
    
        with patch('rag_factory.services.database.postgres.ASYNCPG_AVAILABLE', True):
            service = PostgresqlDatabaseService(
                host="localhost",
                password="test"
            )
            service._pool = pool
    
            # Mock search results
            conn.fetch.return_value = [
                {
                    "chunk_id": "doc_0",
                    "text": "test 0",
                    "metadata": None,
                    "similarity": 0.95
                },
                {
                    "chunk_id": "doc_1",
                    "text": "test 1",
                    "metadata": None,
                    "similarity": 0.85
                }
            ]
    
            query_vec = [1.0, 0.0, 0.0]
            results = await service.search_chunks(query_vec, top_k=2)
    
            assert len(results) == 2
>           assert results[0]['chunk_id'] == 'doc_0'
                   ^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: 'Chunk' object is not subscriptable

tests/unit/database/test_pgvector.py:56: TypeError
__________ TestCodeExamples.test_all_code_examples_have_valid_syntax ___________

self = <test_code_examples.TestCodeExamples object at 0x71629088f710>
docs_root = PosixPath('/mnt/MCPProyects/ragTools/docs')

    def test_all_code_examples_have_valid_syntax(self, docs_root):
        """Test that all Python code examples have valid syntax."""
        errors = []
    
        for md_file in docs_root.rglob("*.md"):
            # Skip project planning documents (epics, stories, verification docs)
            # and internal/migration documentation
            file_str = str(md_file).lower()
            skip_patterns = ['epic', 'stor', 'verification', 'completion-summary',
                           'onnx', 'migration', 'project-plan', 'readme']
            if any(skip in file_str for skip in skip_patterns):
                continue
    
            examples = self.extract_python_examples(md_file)
    
            for i, code in enumerate(examples):
                try:
                    # Try to compile the code
                    compile(code, f"{md_file.name}:example_{i}", "exec")
                except SyntaxError as e:
                    errors.append(f"{md_file.name}:example_{i}: {e}")
    
>       assert len(errors) == 0, \
            f"Syntax errors in code examples:\n" + "\n".join(errors)
E       AssertionError: Syntax errors in code examples:
E         semantic-local-pair-guide.md:example_0: 'await' outside function (semantic-local-pair-guide.md:example_0, line 21)
E         environment-variables.md:example_3: invalid syntax (environment-variables.md:example_3, line 13)
E         QUICK-REFERENCE.md:example_2: unexpected indent (QUICK-REFERENCE.md:example_2, line 1)
E       assert 3 == 0
E        +  where 3 = len(["semantic-local-pair-guide.md:example_0: 'await' outside function (semantic-local-pair-guide.md:example_0, line 21)", 'environment-variables.md:example_3: invalid syntax (environment-variables.md:example_3, line 13)', 'QUICK-REFERENCE.md:example_2: unexpected indent (QUICK-REFERENCE.md:example_2, line 1)'])

tests/unit/documentation/test_code_examples.py:57: AssertionError
_____________ TestDocumentationLinks.test_no_broken_internal_links _____________

self = <test_links.TestDocumentationLinks object at 0x71629088cad0>
docs_root = PosixPath('/mnt/MCPProyects/ragTools/docs')

    def test_no_broken_internal_links(self, docs_root):
        """Test that all internal links are valid."""
        broken_links = []
    
        for md_file in docs_root.rglob("*.md"):
            links = self.extract_links(md_file)
    
            for text, link in links:
                # Skip external links
                if link.startswith("http"):
                    continue
    
                # Skip anchors
                if link.startswith("#"):
                    continue
    
                # Skip file:// links (used in implementation plan)
                if link.startswith("file://"):
                    continue
    
                # Resolve relative path
                target = (md_file.parent / link).resolve()
    
                if not target.exists():
                    broken_links.append(f"{md_file.name} -> {link}")
    
>       assert len(broken_links) == 0, \
            f"Broken internal links:\n" + "\n".join(broken_links)
E       AssertionError: Broken internal links:
E         MIGRATION_MANAGER_REMOVAL.md -> ../stories/epic-16/story-16.5-remove-migration-manager.md
E         README.md -> ./story-17.1-service-registry-configuration-schema.md
E         README.md -> ./story-17.2-service-registry-implementation.md
E         README.md -> ./story-17.4-migration-validator-alembic.md
E         README.md -> ./story-17.6-first-strategy-pair-testing.md
E         README.md -> ./story-17.7-remaining-strategy-pairs.md
E         README.md -> ./story-17.8-cli-validation-sample-docs.md
E         README.md -> ../../epics/epic-16-database-consolidation.md
E         README.md -> ../../epics/epic-16-database-consolidation.md
E         README.md -> ../../database/README.md
E         README.md -> ../../getting-started/installation.md
E       assert 11 == 0
E        +  where 11 = len(['MIGRATION_MANAGER_REMOVAL.md -> ../stories/epic-16/story-16.5-remove-migration-manager.md', 'README.md -> ./story-17.1-service-registry-configuration-schema.md', 'README.md -> ./story-17.2-service-registry-implementation.md', 'README.md -> ./story-17.4-migration-validator-alembic.md', 'README.md -> ./story-17.6-first-strategy-pair-testing.md', 'README.md -> ./story-17.7-remaining-strategy-pairs.md', ...])

tests/unit/documentation/test_links.py:60: AssertionError
______________________________ test_store_chunks _______________________________

service = <rag_factory.services.database.postgres.PostgresqlDatabaseService object at 0x71628e641910>
mock_pool = (<AsyncMock id='124668109624992'>, <AsyncMock id='124668109654592'>)

    @pytest.mark.asyncio
    async def test_store_chunks(service, mock_pool):
        """Test storing chunks."""
        pool, conn = mock_pool
    
        chunks = [
            {
                "chunk_id": "1",
                "text": "Hello",
                "embedding": [0.1, 0.2, 0.3],
                "metadata": {"source": "doc1"}
            }
        ]
    
        await service.store_chunks(chunks)
    
        conn.execute.assert_called()
        call_args = conn.execute.call_args
        assert "INSERT INTO chunks" in call_args[0][0]
        assert call_args[0][1] == "1"
        assert call_args[0][2] == "Hello"
>       assert call_args[0][3] == "[0.1,0.2,0.3]"
E       assert '{"source": "doc1"}' == '[0.1,0.2,0.3]'
E         
E         - [0.1,0.2,0.3]
E         + {"source": "doc1"}

tests/unit/services/test_database_service.py:107: AssertionError
______________________________ test_search_chunks ______________________________

service = <rag_factory.services.database.postgres.PostgresqlDatabaseService object at 0x71628e60a4b0>
mock_pool = (<AsyncMock id='124668109438800'>, <AsyncMock id='124668109392304'>)

    @pytest.mark.asyncio
    async def test_search_chunks(service, mock_pool):
        """Test searching chunks."""
        pool, conn = mock_pool
    
        # Mock search results
        conn.fetch.return_value = [
            {
                "chunk_id": "1",
                "text": "Hello",
                "metadata": '{"source": "doc1"}',
                "similarity": 0.95
            }
        ]
    
        results = await service.search_chunks([0.1, 0.2, 0.3], top_k=5)
    
        assert len(results) == 1
>       assert results[0]["chunk_id"] == "1"
               ^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: 'Chunk' object is not subscriptable

tests/unit/services/test_database_service.py:135: TypeError
______________________________ test_capabilities _______________________________

strategy = <rag_factory.strategies.indexing.context_aware.ContextAwareChunkingIndexing object at 0x71628e7fe7e0>

    def test_capabilities(strategy):
        """Test produces capabilities."""
>       assert strategy.produces() == {
            IndexCapability.CHUNKS,
            IndexCapability.DATABASE
        }
E       AssertionError: assert {<IndexCapabi...y.VECTORS: 1>} == {<IndexCapabi...DATABASE: 10>}
E         
E         Extra items in the left set:
E         <IndexCapability.VECTORS: 1>
E         
E         Full diff:
E           {
E         +     <IndexCapability.VECTORS: 1>,...
E         
E         ...Full output truncated (3 lines hidden), use '-vv' to show

tests/unit/strategies/indexing/test_context_aware.py:33: AssertionError
_______________________ TestImports.test_import_factory ________________________

self = <tests.unit.test_package.TestImports object at 0x716290199d00>

    def test_import_factory(self) -> None:
        """Test RAGFactory can be imported."""
>       from rag_factory import RAGFactory
E       ImportError: cannot import name 'RAGFactory' from 'rag_factory' (/mnt/MCPProyects/ragTools/rag_factory/__init__.py)

tests/unit/test_package.py:18: ImportError
_______________________ TestImports.test_import_pipeline _______________________

self = <tests.unit.test_package.TestImports object at 0x716290199730>

    def test_import_pipeline(self) -> None:
        """Test StrategyPipeline can be imported."""
>       from rag_factory import StrategyPipeline
E       ImportError: cannot import name 'StrategyPipeline' from 'rag_factory' (/mnt/MCPProyects/ragTools/rag_factory/__init__.py)

tests/unit/test_package.py:24: ImportError
________________________ TestImports.test_import_config ________________________

self = <tests.unit.test_package.TestImports object at 0x7162901994c0>

    def test_import_config(self) -> None:
        """Test ConfigManager can be imported."""
>       from rag_factory import ConfigManager
E       ImportError: cannot import name 'ConfigManager' from 'rag_factory' (/mnt/MCPProyects/ragTools/rag_factory/__init__.py)

tests/unit/test_package.py:30: ImportError
________________ TestPackageStructure.test_no_circular_imports _________________

self = <tests.unit.test_package.TestPackageStructure object at 0x71629019ae10>

    def test_no_circular_imports(self) -> None:
        """Test importing doesn't cause circular import errors."""
        try:
>           from rag_factory import RAGFactory
E           ImportError: cannot import name 'RAGFactory' from 'rag_factory' (/mnt/MCPProyects/ragTools/rag_factory/__init__.py)

tests/unit/test_package.py:81: ImportError

During handling of the above exception, another exception occurred:

self = <tests.unit.test_package.TestPackageStructure object at 0x71629019ae10>

    def test_no_circular_imports(self) -> None:
        """Test importing doesn't cause circular import errors."""
        try:
            from rag_factory import RAGFactory
            from rag_factory import StrategyPipeline
            from rag_factory import ConfigManager
            from rag_factory.strategies import IRAGStrategy
    
            # If we get here, no circular imports
            assert RAGFactory is not None
            assert StrategyPipeline is not None
            assert ConfigManager is not None
            assert IRAGStrategy is not None
        except ImportError as e:
>           pytest.fail(f"Circular import detected: {e}")
E           Failed: Circular import detected: cannot import name 'RAGFactory' from 'rag_factory' (/mnt/MCPProyects/ragTools/rag_factory/__init__.py)

tests/unit/test_package.py:92: Failed
_____________ TestDependencies.test_optional_dependencies_handled ______________

self = <tests.unit.test_package.TestDependencies object at 0x71629019b470>

    def test_optional_dependencies_handled(self) -> None:
        """Test package works without optional dependencies."""
        # Should not fail if optional dependencies missing
>       from rag_factory import RAGFactory
E       ImportError: cannot import name 'RAGFactory' from 'rag_factory' (/mnt/MCPProyects/ragTools/rag_factory/__init__.py)

tests/unit/test_package.py:111: ImportError
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

tests/integration/database/test_migration_validator_integration.py: 13 warnings
  /mnt/MCPProyects/ragTools/tests/integration/database/test_migration_validator_integration.py:50: RuntimeWarning: coroutine 'PostgresqlDatabaseService.close' was never awaited
    service.close()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validator_with_auto_discovered_config
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validate_empty_requirements
  /mnt/MCPProyects/ragTools/tests/integration/database/test_migration_validator_integration.py:336: RuntimeWarning: coroutine 'PostgresqlDatabaseService.close' was never awaited
    service.close()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                3      0   100%
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               31     10    68%   25-28, 48-49, 76-78, 82
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     21    60%   52, 81-86, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     23    78%   57-58, 66-70, 93, 114, 156-157, 191-196, 210-215, 274-275
rag_factory/config/validator.py                                       93     32    66%   70, 177-198, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     31    43%   55-57, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     18    53%   46-54, 66-77, 86-88, 118, 126, 139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    132    29%   144, 165-170, 209-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               62      0   100%
rag_factory/registry/service_registry.py                              91     14    85%   114, 118, 123-124, 188-192, 214-218
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    206    206     0%   7-670
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     27    41%   75-93, 117-140, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    181    159    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-406, 414-415, 430-510, 516-517, 521-546
rag_factory/services/database/migration_validator.py                  85      8    91%   88, 153, 168-170, 197, 202-204
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            177     55    69%   17-18, 26-27, 85, 91-103, 203-207, 211, 213, 217-218, 294-297, 356-381, 393, 472, 479-492, 547-565, 581-583
rag_factory/services/dependencies.py                                  41     19    54%   96-109, 134-140, 179-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29      7    76%   43, 56-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     33    71%   18-19, 114, 143-147, 158, 170-175, 194, 218-219, 248-250, 273, 289-308
rag_factory/services/embedding/providers/openai.py                    51     27    47%   10-20, 54, 64, 70, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20      8    60%   32, 45-53
rag_factory/services/embedding/service.py                            100     36    64%   88, 118, 129-141, 155, 171-179, 191-192, 220-222, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23      4    83%   48, 51-53
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57      2    96%   125, 139
rag_factory/services/llm/providers/ollama.py                          55      0   100%
rag_factory/services/llm/providers/openai.py                          57      5    91%   101-105, 187
rag_factory/services/llm/service.py                                   66      5    92%   68, 161, 173-175
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     12    59%   61, 65, 83-93, 110-121
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133     40    70%   22-23, 37, 77-84, 96-97, 142-146, 175, 189-190, 194, 198-201, 216-218, 258, 265-268, 361-362, 376, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            87     87     0%   8-284
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  91     91     0%   8-266
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         78     78     0%   8-298
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     108     11    90%   74, 81, 89-91, 115, 126-128, 162, 197
rag_factory/strategies/indexing/hierarchical.py                       90     73    19%   50, 63, 88-134, 156-185, 201-236, 253-278, 292-293
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   42     42     0%   8-157
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-129
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-221
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py            104    104     0%   8-318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    117     0%   7-300
rag_factory/strategies/late_chunking/models.py                        62     62     0%   8-100
rag_factory/strategies/late_chunking/strategy.py                      70     70     0%   8-215
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      7     0%   8-21
rag_factory/strategies/reranking/base.py                              68     68     0%   8-130
rag_factory/strategies/reranking/bge_reranker.py                      51     51     0%   8-151
rag_factory/strategies/reranking/cache.py                             48     48     0%   8-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     34     0%   8-119
rag_factory/strategies/reranking/cosine_reranker.py                   62     62     0%   8-249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     40     0%   8-124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115    115     0%   8-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    92     74    20%   38-53, 71-181, 192-206, 229-259, 264, 269
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              12307   9798    20%
=========================== short test summary info ============================
FAILED tests/integration/registry/test_registry_integration.py::TestRealServiceInstantiation::test_multiple_service_instantiation
FAILED tests/integration/registry/test_registry_integration.py::TestErrorHandling::test_invalid_service_config
FAILED tests/integration/registry/test_registry_integration.py::TestConfigurationValidation::test_configuration_warnings
FAILED tests/integration/services/test_service_integration.py::test_rag_workflow
FAILED tests/integration/services/test_service_integration.py::test_embedding_database_consistency
FAILED tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_end_to_end_workflow
FAILED tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_retry_with_poor_results
FAILED tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_performance_within_limits
FAILED tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveWithLMStudio::test_with_real_llm
FAILED tests/integration/test_package_integration.py::TestSmokeTest::test_basic_usage_smoke_test
FAILED tests/integration/test_package_integration.py::TestFullWorkflow::test_full_workflow_with_installed_package
FAILED tests/unit/database/test_pgvector.py::TestPgVectorIntegration::test_cosine_similarity_search
FAILED tests/unit/documentation/test_code_examples.py::TestCodeExamples::test_all_code_examples_have_valid_syntax
FAILED tests/unit/documentation/test_links.py::TestDocumentationLinks::test_no_broken_internal_links
FAILED tests/unit/services/test_database_service.py::test_store_chunks - asse...
FAILED tests/unit/services/test_database_service.py::test_search_chunks - Typ...
FAILED tests/unit/strategies/indexing/test_context_aware.py::test_capabilities
FAILED tests/unit/test_package.py::TestImports::test_import_factory - ImportE...
FAILED tests/unit/test_package.py::TestImports::test_import_pipeline - Import...
FAILED tests/unit/test_package.py::TestImports::test_import_config - ImportEr...
FAILED tests/unit/test_package.py::TestPackageStructure::test_no_circular_imports
FAILED tests/unit/test_package.py::TestDependencies::test_optional_dependencies_handled
====== 22 failed, 156 passed, 3 skipped, 17 warnings in 197.87s (0:03:17) ======

========================================
Test run completed at 2025-12-18 10:09:21
========================================
