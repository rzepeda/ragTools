[1/180] PASSED: tests/benchmarks/test_contextual_performance.py
  Tests: 6 (P:6 F:0 S:0)
[2/180] PASSED: tests/benchmarks/test_late_chunking_performance.py
  Tests: 8 (P:8 F:0 S:0)
[3/180] ALL_SKIPPED: tests/benchmarks/test_model_comparison_performance.py
  Tests: 6 (P:0 F:0 S:6)
[4/180] PASSED: tests/integration/cli/test_benchmark_integration.py
  Tests: 1 (P:1 F:0 S:0)
[5/180] PASSED: tests/integration/cli/test_config_validation_integration.py
  Tests: 2 (P:2 F:0 S:0)
[6/180] PASSED: tests/integration/cli/test_index_query_flow.py
  Tests: 11 (P:11 F:0 S:0)
[7/180] PASSED: tests/integration/config/test_config_integration.py
  Tests: 9 (P:9 F:0 S:0)
[8/180] PASSED: tests/integration/database/test_database_integration.py
  Tests: 14 (P:13 F:0 S:1)
[9/180] PASSED: tests/integration/database/test_migration_integration.py
  Tests: 4 (P:4 F:0 S:0)
[10/180] FAILED: tests/integration/database/test_migration_validator_integration.py
  Tests: 0 (P:0 F:0 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 15 items

tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_no_migrations ERROR [  6%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_partial_migrations ERROR [ 13%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_all_migrations ERROR [ 20%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_or_raise_success ERROR [ 26%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_or_raise_failure ERROR [ 33%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_get_current_revision ERROR [ 40%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_get_all_revisions ERROR [ 46%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_is_at_head ERROR [ 53%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_error_message_details ERROR [ 60%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_single_migration ERROR [ 66%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_nonexistent_migration ERROR [ 73%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_after_downgrade ERROR [ 80%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_multiple_validators_same_database ERROR [ 86%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validator_with_auto_discovered_config ERROR [ 93%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validate_empty_requirements ERROR [100%]

==================================== ERRORS ====================================
_ ERROR at setup of TestMigrationValidatorIntegration.test_validate_with_no_migrations _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorIntegration.test_validate_with_partial_migrations _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorIntegration.test_validate_with_all_migrations _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorIntegration.test_validate_or_raise_success _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorIntegration.test_validate_or_raise_failure _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorIntegration.test_get_current_revision _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
__ ERROR at setup of TestMigrationValidatorIntegration.test_get_all_revisions __
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_____ ERROR at setup of TestMigrationValidatorIntegration.test_is_at_head ______
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorIntegration.test_error_message_details _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorIntegration.test_validate_single_migration _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorIntegration.test_validate_nonexistent_migration _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorIntegration.test_validate_after_downgrade _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorIntegration.test_multiple_validators_same_database _
tests/integration/database/test_migration_validator_integration.py:45: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorEdgeCases.test_validator_with_auto_discovered_config _
tests/integration/database/test_migration_validator_integration.py:333: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
_ ERROR at setup of TestMigrationValidatorEdgeCases.test_validate_empty_requirements _
tests/integration/database/test_migration_validator_integration.py:333: in db_service
    service.engine = create_engine(test_db_url)
    ^^^^^^^^^^^^^^
E   AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               31     10    68%   25-28, 48-49, 76-78, 82
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          104     82    21%   40-72, 92-132, 147-195, 207-212, 226, 256-279
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/legacy_config.py                                         155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               61     45    26%   47-54, 62-65, 70-73, 78-80, 88-104, 116-142, 152-189
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    206    206     0%   7-670
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    181    159    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-406, 414-415, 430-510, 516-517, 521-546
rag_factory/services/database/migration_validator.py                  85     63    26%   29-30, 61-69, 81-88, 108-120, 137-141, 152-181, 192-204, 215-222, 234, 246-256, 268-271
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            141     97    31%   17-18, 26-27, 85, 91-103, 131-145, 149-173, 186-219, 243-276, 290-305, 320-335, 367-385, 399-422, 427, 464-482, 491-503, 507, 511
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               121     97    20%   18-19, 24-25, 89-184, 200-257, 268-315, 326, 334, 342, 355
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             173    152    12%   22-23, 28-29, 40-48, 81-197, 217-238, 264-310, 332-366, 383-404, 424-439, 452-470, 484-496
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            85     85     0%   8-282
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  91     91     0%   8-266
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         73     73     0%   8-284
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       71     71     0%   9-292
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-221
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    78     78     0%   8-254
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py            104    104     0%   8-318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    117     0%   7-300
rag_factory/strategies/late_chunking/models.py                        62     62     0%   8-100
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        66     66     0%   3-182
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           2      0   100%
rag_factory/strategies/retrieval/semantic_retriever.py                20      9    55%   23, 32, 61-81
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              12116  10112    17%
=========================== short test summary info ============================
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_no_migrations - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_partial_migrations - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_all_migrations - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_or_raise_success - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_or_raise_failure - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_get_current_revision - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_get_all_revisions - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_is_at_head - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_error_message_details - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_single_migration - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_nonexistent_migration - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_after_downgrade - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_multiple_validators_same_database - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validator_with_auto_discovered_config - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
ERROR tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validate_empty_requirements - AttributeError: property 'engine' of 'PostgresqlDatabaseService' object has no setter
======================== 2 warnings, 15 errors in 5.55s ========================

[11/180] PASSED: tests/integration/database/test_multi_context_isolation.py
  Tests: 10 (P:2 F:0 S:8)
[12/180] ALL_SKIPPED: tests/integration/documentation/test_documentation_integration.py
  Tests: 6 (P:0 F:0 S:6)
[13/180] PASSED: tests/integration/evaluation/test_evaluation_integration.py
  Tests: 7 (P:7 F:0 S:0)
[14/180] PASSED: tests/integration/models/test_fine_tuned_embeddings_integration.py
  Tests: 6 (P:6 F:0 S:0)
[15/180] PASSED: tests/integration/observability/test_monitoring_integration.py
  Tests: 11 (P:11 F:0 S:0)
[16/180] FAILED: tests/integration/registry/test_registry_integration.py
  Tests: 19 (P:13 F:6 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 16 items

tests/integration/registry/test_registry_integration.py::TestRealServiceInstantiation::test_instantiate_onnx_embedding_service PASSED [  6%]
tests/integration/registry/test_registry_integration.py::TestRealServiceInstantiation::test_embedding_service_functionality PASSED [ 12%]
tests/integration/registry/test_registry_integration.py::TestRealServiceInstantiation::test_multiple_service_instantiation FAILED [ 18%]
tests/integration/registry/test_registry_integration.py::TestEnvironmentVariableResolution::test_env_var_resolution PASSED [ 25%]
tests/integration/registry/test_registry_integration.py::TestEnvironmentVariableResolution::test_env_var_defaults PASSED [ 31%]
tests/integration/registry/test_registry_integration.py::TestServiceLifecycle::test_context_manager_cleanup PASSED [ 37%]
tests/integration/registry/test_registry_integration.py::TestServiceLifecycle::test_reload_service PASSED [ 43%]
tests/integration/registry/test_registry_integration.py::TestServiceLifecycle::test_shutdown_cleanup PASSED [ 50%]
tests/integration/registry/test_registry_integration.py::TestServiceSharing::test_service_instance_sharing PASSED [ 56%]
tests/integration/registry/test_registry_integration.py::TestServiceSharing::test_service_sharing_memory_efficiency PASSED [ 62%]
tests/integration/registry/test_registry_integration.py::TestErrorHandling::test_invalid_service_config FAILED [ 68%]
tests/integration/registry/test_registry_integration.py::TestErrorHandling::test_missing_service_file PASSED [ 75%]
tests/integration/registry/test_registry_integration.py::TestOpenAIServices::test_openai_llm_instantiation PASSED [ 81%]
tests/integration/registry/test_registry_integration.py::TestOpenAIServices::test_openai_embedding_instantiation PASSED [ 87%]
tests/integration/registry/test_registry_integration.py::TestConfigurationValidation::test_valid_configuration_loads PASSED [ 93%]
tests/integration/registry/test_registry_integration.py::TestConfigurationValidation::test_configuration_warnings FAILED [100%]

=================================== FAILURES ===================================
_______ TestRealServiceInstantiation.test_multiple_service_instantiation _______
venv/lib/python3.12/site-packages/huggingface_hub/utils/_http.py:402: in hf_raise_for_status
    response.raise_for_status()
venv/lib/python3.12/site-packages/requests/models.py:1026: in raise_for_status
    raise HTTPError(http_error_msg, response=self)
E   requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://huggingface.co/Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx

The above exception was the direct cause of the following exception:
rag_factory/services/utils/onnx_utils.py:163: in download_onnx_model
    model_file = hf_hub_download(
venv/lib/python3.12/site-packages/huggingface_hub/utils/_validators.py:114: in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/huggingface_hub/file_download.py:1007: in hf_hub_download
    return _hf_hub_download_to_cache_dir(
venv/lib/python3.12/site-packages/huggingface_hub/file_download.py:1070: in _hf_hub_download_to_cache_dir
    (url_to_download, etag, commit_hash, expected_size, xet_file_data, head_call_error) = _get_metadata_or_catch_error(
venv/lib/python3.12/site-packages/huggingface_hub/file_download.py:1543: in _get_metadata_or_catch_error
    metadata = get_hf_file_metadata(
venv/lib/python3.12/site-packages/huggingface_hub/utils/_validators.py:114: in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/huggingface_hub/file_download.py:1460: in get_hf_file_metadata
    r = _request_wrapper(
venv/lib/python3.12/site-packages/huggingface_hub/file_download.py:283: in _request_wrapper
    response = _request_wrapper(
venv/lib/python3.12/site-packages/huggingface_hub/file_download.py:307: in _request_wrapper
    hf_raise_for_status(response)
venv/lib/python3.12/site-packages/huggingface_hub/utils/_http.py:413: in hf_raise_for_status
    raise _format(EntryNotFoundError, message, response) from e
E   huggingface_hub.errors.EntryNotFoundError: 404 Client Error. (Request ID: Root=1-6940d35f-1f9d1982560db8e67460dd88;04ade036-1bcd-4ee3-9d47-6dcbe6ea61b6)
E   
E   Entry Not Found for url: https://huggingface.co/Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx.

During handling of the above exception, another exception occurred:
rag_factory/registry/service_registry.py:137: in get
    service_instance = self._factory.create_service(
rag_factory/registry/service_factory.py:50: in create_service
    return self._create_embedding_service(service_name, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/registry/service_factory.py:122: in _create_embedding_service
    return ONNXEmbeddingService(
rag_factory/services/onnx/embedding.py:68: in __init__
    self._provider = ONNXLocalProvider(config)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/services/embedding/providers/onnx_local.py:123: in __init__
    self.model_path = download_onnx_model(
rag_factory/services/utils/onnx_utils.py:197: in download_onnx_model
    raise ValueError(error_msg)
E   ValueError: Could not download ONNX model 'Xenova/all-MiniLM-L6-v2'.
E   Error: 404 Client Error. (Request ID: Root=1-6940d35f-1f9d1982560db8e67460dd88;04ade036-1bcd-4ee3-9d47-6dcbe6ea61b6)
E   
E   Entry Not Found for url: https://huggingface.co/Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx.
E   
E    Solutions:
E     2. Download model manually:
E        python scripts/download_embedding_model.py --model Xenova/all-MiniLM-L6-v2
E   
E     3. Use a different model:
E        python scripts/download_embedding_model.py --list

During handling of the above exception, another exception occurred:
tests/integration/registry/test_registry_integration.py:95: in test_multiple_service_instantiation
    embedding = registry.get("embedding_local")
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/registry/service_registry.py:150: in get
    raise ServiceInstantiationError(
E   rag_factory.registry.exceptions.ServiceInstantiationError: Service instantiation failed for 'embedding_local': Could not download ONNX model 'Xenova/all-MiniLM-L6-v2'.
E   Error: 404 Client Error. (Request ID: Root=1-6940d35f-1f9d1982560db8e67460dd88;04ade036-1bcd-4ee3-9d47-6dcbe6ea61b6)
E   
E   Entry Not Found for url: https://huggingface.co/Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx.
E   
E    Solutions:
E     2. Download model manually:
E        python scripts/download_embedding_model.py --model Xenova/all-MiniLM-L6-v2
E   
E     3. Use a different model:
E        python scripts/download_embedding_model.py --list
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.registry.service_registry:Loading service registry from: /tmp/pytest-of-admindevmac/pytest-6/test_multiple_service_instanti0/services.yaml
WARNING:rag_factory.registry.service_registry:WARNING: Potential plaintext secret in services.llm_local.api_key. Consider using environment variable: ${ENV_VAR}
INFO:rag_factory.registry.service_registry:Service registry loaded: 2 services available
INFO:rag_factory.registry.service_registry:Instantiating service: embedding_local
DEBUG:rag_factory.registry.service_factory:Creating embedding service: embedding_local
INFO:rag_factory.services.embedding.providers.onnx_local:Loading ONNX model: Xenova/all-MiniLM-L6-v2
INFO:rag_factory.services.utils.onnx_utils:Downloading ONNX model: Xenova/all-MiniLM-L6-v2
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): huggingface.co:443
DEBUG:urllib3.connectionpool:https://huggingface.co:443 "HEAD /Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx HTTP/1.1" 404 0
ERROR:rag_factory.services.utils.onnx_utils:Failed to download ONNX model 'Xenova/all-MiniLM-L6-v2': 404 Client Error. (Request ID: Root=1-6940d35f-1f9d1982560db8e67460dd88;04ade036-1bcd-4ee3-9d47-6dcbe6ea61b6)

Entry Not Found for url: https://huggingface.co/Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx.
ERROR:rag_factory.registry.service_registry:Failed to instantiate service 'embedding_local': Could not download ONNX model 'Xenova/all-MiniLM-L6-v2'.
Error: 404 Client Error. (Request ID: Root=1-6940d35f-1f9d1982560db8e67460dd88;04ade036-1bcd-4ee3-9d47-6dcbe6ea61b6)

Entry Not Found for url: https://huggingface.co/Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx.

 Solutions:
  2. Download model manually:
     python scripts/download_embedding_model.py --model Xenova/all-MiniLM-L6-v2

  3. Use a different model:
     python scripts/download_embedding_model.py --list

------------------------------ Captured log call -------------------------------
INFO     rag_factory.registry.service_registry:service_registry.py:55 Loading service registry from: /tmp/pytest-of-admindevmac/pytest-6/test_multiple_service_instanti0/services.yaml
WARNING  rag_factory.registry.service_registry:service_registry.py:70 WARNING: Potential plaintext secret in services.llm_local.api_key. Consider using environment variable: ${ENV_VAR}
INFO     rag_factory.registry.service_registry:service_registry.py:75 Service registry loaded: 2 services available
INFO     rag_factory.registry.service_registry:service_registry.py:133 Instantiating service: embedding_local
DEBUG    rag_factory.registry.service_factory:service_factory.py:116 Creating embedding service: embedding_local
INFO     rag_factory.services.embedding.providers.onnx_local:onnx_local.py:117 Loading ONNX model: Xenova/all-MiniLM-L6-v2
INFO     rag_factory.services.utils.onnx_utils:onnx_utils.py:128 Downloading ONNX model: Xenova/all-MiniLM-L6-v2
DEBUG    urllib3.connectionpool:connectionpool.py:1049 Starting new HTTPS connection (1): huggingface.co:443
DEBUG    urllib3.connectionpool:connectionpool.py:544 https://huggingface.co:443 "HEAD /Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx HTTP/1.1" 404 0
ERROR    rag_factory.services.utils.onnx_utils:onnx_utils.py:175 Failed to download ONNX model 'Xenova/all-MiniLM-L6-v2': 404 Client Error. (Request ID: Root=1-6940d35f-1f9d1982560db8e67460dd88;04ade036-1bcd-4ee3-9d47-6dcbe6ea61b6)

Entry Not Found for url: https://huggingface.co/Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx.
ERROR    rag_factory.registry.service_registry:service_registry.py:149 Failed to instantiate service 'embedding_local': Could not download ONNX model 'Xenova/all-MiniLM-L6-v2'.
Error: 404 Client Error. (Request ID: Root=1-6940d35f-1f9d1982560db8e67460dd88;04ade036-1bcd-4ee3-9d47-6dcbe6ea61b6)

Entry Not Found for url: https://huggingface.co/Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx.

 Solutions:
  2. Download model manually:
     python scripts/download_embedding_model.py --model Xenova/all-MiniLM-L6-v2

  3. Use a different model:
     python scripts/download_embedding_model.py --list
________________ TestErrorHandling.test_invalid_service_config _________________
rag_factory/config/validator.py:113: in validate_services_yaml
    jsonschema.validate(
venv/lib/python3.12/site-packages/jsonschema/validators.py:1332: in validate
    raise error
E   jsonschema.exceptions.ValidationError: {'unknown_field': 'value'} is not valid under any of the given schemas
E   
E   Failed validating 'oneOf' in schema['properties']['services']['patternProperties']['^[a-zA-Z0-9_]+$']:
E       {'oneOf': [{'$ref': '#/definitions/llm_service'},
E                  {'$ref': '#/definitions/embedding_service'},
E                  {'$ref': '#/definitions/database_service'}]}
E   
E   On instance['services']['invalid_service']:
E       {'unknown_field': 'value'}

During handling of the above exception, another exception occurred:
rag_factory/registry/service_registry.py:63: in _load_config
    warnings = self._validator.validate_services_yaml(
rag_factory/config/validator.py:118: in validate_services_yaml
    raise ConfigValidationError(
E   rag_factory.config.validator.ConfigValidationError: Schema validation failed: {'unknown_field': 'value'} is not valid under any of the given schemas
E   File: /tmp/pytest-of-admindevmac/pytest-6/test_invalid_service_config0/services.yaml
E   Field: services.invalid_service

During handling of the above exception, another exception occurred:
tests/integration/registry/test_registry_integration.py:230: in test_invalid_service_config
    registry = ServiceRegistry(str(services_file))
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/registry/service_registry.py:51: in __init__
    self._load_config()
rag_factory/registry/service_registry.py:85: in _load_config
    raise ServiceInstantiationError(
E   rag_factory.registry.exceptions.ServiceInstantiationError: Failed to load service registry: Schema validation failed: {'unknown_field': 'value'} is not valid under any of the given schemas
E   File: /tmp/pytest-of-admindevmac/pytest-6/test_invalid_service_config0/services.yaml
E   Field: services.invalid_service
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.registry.service_registry:Loading service registry from: /tmp/pytest-of-admindevmac/pytest-6/test_invalid_service_config0/services.yaml
------------------------------ Captured log call -------------------------------
INFO     rag_factory.registry.service_registry:service_registry.py:55 Loading service registry from: /tmp/pytest-of-admindevmac/pytest-6/test_invalid_service_config0/services.yaml
___________ TestConfigurationValidation.test_configuration_warnings ____________
rag_factory/config/validator.py:113: in validate_services_yaml
    jsonschema.validate(
venv/lib/python3.12/site-packages/jsonschema/validators.py:1332: in validate
    raise error
E   jsonschema.exceptions.ValidationError: {'provider': 'onnx', 'model': 'test-model', 'api_key': 'plaintext-secret'} is not valid under any of the given schemas
E   
E   Failed validating 'oneOf' in schema['properties']['services']['patternProperties']['^[a-zA-Z0-9_]+$']:
E       {'oneOf': [{'$ref': '#/definitions/llm_service'},
E                  {'$ref': '#/definitions/embedding_service'},
E                  {'$ref': '#/definitions/database_service'}]}
E   
E   On instance['services']['test_service']:
E       {'provider': 'onnx',
E        'model': 'test-model',
E        'api_key': 'plaintext-secret'}

During handling of the above exception, another exception occurred:
rag_factory/registry/service_registry.py:63: in _load_config
    warnings = self._validator.validate_services_yaml(
rag_factory/config/validator.py:118: in validate_services_yaml
    raise ConfigValidationError(
E   rag_factory.config.validator.ConfigValidationError: Schema validation failed: {'provider': 'onnx', 'model': 'test-model', 'api_key': 'plaintext-secret'} is not valid under any of the given schemas
E   File: /tmp/pytest-of-admindevmac/pytest-6/test_configuration_warnings0/services.yaml
E   Field: services.test_service

During handling of the above exception, another exception occurred:
tests/integration/registry/test_registry_integration.py:332: in test_configuration_warnings
    registry = ServiceRegistry(str(services_file))
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/registry/service_registry.py:51: in __init__
    self._load_config()
rag_factory/registry/service_registry.py:85: in _load_config
    raise ServiceInstantiationError(
E   rag_factory.registry.exceptions.ServiceInstantiationError: Failed to load service registry: Schema validation failed: {'provider': 'onnx', 'model': 'test-model', 'api_key': 'plaintext-secret'} is not valid under any of the given schemas
E   File: /tmp/pytest-of-admindevmac/pytest-6/test_configuration_warnings0/services.yaml
E   Field: services.test_service
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               31     10    68%   25-28, 48-49, 76-78, 82
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     21    60%   52, 81-86, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          104     82    21%   40-72, 92-132, 147-195, 207-212, 226, 256-279
rag_factory/config/validator.py                                       93     32    66%   70, 177-198, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/legacy_config.py                                         155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               61     27    56%   51-54, 65, 73, 78-80, 104, 133-142, 152-189
rag_factory/registry/service_registry.py                              91     14    85%   114, 118, 123-124, 188-192, 214-218
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    206    206     0%   7-670
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     27    41%   75-93, 117-140, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    181    159    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-406, 414-415, 430-510, 516-517, 521-546
rag_factory/services/database/migration_validator.py                  85     63    26%   29-30, 61-69, 81-88, 108-120, 137-141, 152-181, 192-204, 215-222, 234, 246-256, 268-271
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            141    112    21%   17-18, 26-27, 84-121, 131-145, 149-173, 186-219, 243-276, 290-305, 320-335, 367-385, 399-422, 427, 464-482, 491-503, 507, 511
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               121     67    45%   18-19, 24-25, 92, 99, 121, 145, 150-154, 165, 177-182, 200-257, 268-315, 334, 342, 355
rag_factory/services/embedding/providers/openai.py                    51     27    47%   10-20, 54, 64, 70, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     35    39%   56, 60, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     12    59%   61, 65, 83-93, 110-121
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             173     82    53%   22-23, 28-29, 41, 48, 91-94, 100-101, 106-107, 134-159, 170-172, 185, 217-238, 267, 281-282, 286, 290-293, 308-310, 350, 357-360, 424-439, 452-470, 484-496
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            85     85     0%   8-282
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  91     91     0%   8-266
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         73     73     0%   8-284
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       71     71     0%   9-292
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-221
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    78     78     0%   8-254
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py            104    104     0%   8-318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    117     0%   7-300
rag_factory/strategies/late_chunking/models.py                        62     62     0%   8-100
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        66     66     0%   3-182
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           2      0   100%
rag_factory/strategies/retrieval/semantic_retriever.py                20      9    55%   23, 32, 61-81
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              12116   9868    19%
=========================== short test summary info ============================
FAILED tests/integration/registry/test_registry_integration.py::TestRealServiceInstantiation::test_multiple_service_instantiation - rag_factory.registry.exceptions.ServiceInstantiationError: Service instantiation failed for 'embedding_local': Could not download ONNX model 'Xenova/all-MiniLM-L6-v2'.
Error: 404 Client Error. (Request ID: Root=1-6940d35f-1f9d1982560db8e67460dd88;04ade036-1bcd-4ee3-9d47-6dcbe6ea61b6)

Entry Not Found for url: https://huggingface.co/Xenova/all-MiniLM-L6-v2/resolve/main/model.onnx.

 Solutions:
  2. Download model manually:
     python scripts/download_embedding_model.py --model Xenova/all-MiniLM-L6-v2

  3. Use a different model:
     python scripts/download_embedding_model.py --list
FAILED tests/integration/registry/test_registry_integration.py::TestErrorHandling::test_invalid_service_config - rag_factory.registry.exceptions.ServiceInstantiationError: Failed to load service registry: Schema validation failed: {'unknown_field': 'value'} is not valid under any of the given schemas
File: /tmp/pytest-of-admindevmac/pytest-6/test_invalid_service_config0/services.yaml
Field: services.invalid_service
FAILED tests/integration/registry/test_registry_integration.py::TestConfigurationValidation::test_configuration_warnings - rag_factory.registry.exceptions.ServiceInstantiationError: Failed to load service registry: Schema validation failed: {'provider': 'onnx', 'model': 'test-model', 'api_key': 'plaintext-secret'} is not valid under any of the given schemas
File: /tmp/pytest-of-admindevmac/pytest-6/test_configuration_warnings0/services.yaml
Field: services.test_service
================== 3 failed, 13 passed, 2 warnings in 11.95s ===================

[17/180] PASSED: tests/integration/repositories/test_repository_integration.py
  Tests: 19 (P:19 F:0 S:0)
[18/180] PASSED: tests/integration/services/test_embedding_integration.py
  Tests: 8 (P:6 F:0 S:2)
[19/180] PASSED: tests/integration/services/test_fine_tuned_onnx_integration.py
  Tests: 1 (P:1 F:0 S:0)
[20/180] PASSED: tests/integration/services/test_llm_integration.py
  Tests: 8 (P:1 F:0 S:7)
[21/180] PASSED: tests/integration/services/test_lm_studio_connection.py
  Tests: 2 (P:2 F:0 S:0)
[22/180] PASSED: tests/integration/services/test_onnx_embeddings_integration.py
  Tests: 10 (P:10 F:0 S:0)
[23/180] PASSED: tests/integration/services/test_service_implementations.py
  Tests: 19 (P:18 F:0 S:1)
[24/180] PASSED: tests/integration/services/test_service_integration.py
  Tests: 2 (P:2 F:0 S:0)
[25/180] PASSED: tests/integration/strategies/test_base_integration.py
  Tests: 5 (P:5 F:0 S:0)
[26/180] PASSED: tests/integration/strategies/test_chunking_integration.py
  Tests: 12 (P:12 F:0 S:0)
[27/180] PASSED: tests/integration/strategies/test_contextual_integration.py
  Tests: 6 (P:6 F:0 S:0)
[28/180] PASSED: tests/integration/strategies/test_hierarchical_indexing.py
  Tests: 14 (P:14 F:0 S:0)
[29/180] PASSED: tests/integration/strategies/test_hierarchical_integration.py
  Tests: 4 (P:4 F:0 S:0)
[30/180] PASSED: tests/integration/strategies/test_in_memory_indexing.py
  Tests: 12 (P:12 F:0 S:0)
[31/180] PASSED: tests/integration/strategies/test_keyword_indexing.py
  Tests: 6 (P:6 F:0 S:0)
[32/180] PASSED: tests/integration/strategies/test_knowledge_graph_integration.py
  Tests: 4 (P:4 F:0 S:0)
[33/180] PASSED: tests/integration/strategies/test_late_chunking_integration.py
  Tests: 9 (P:9 F:0 S:0)
[34/180] PASSED: tests/integration/strategies/test_multi_query_integration.py
  Tests: 9 (P:9 F:0 S:0)
[35/180] PASSED: tests/integration/strategies/test_query_expansion_integration.py
  Tests: 11 (P:11 F:0 S:0)
[36/180] PASSED: tests/integration/strategies/test_reranking_integration.py
  Tests: 9 (P:8 F:0 S:1)
[37/180] PASSED: tests/integration/strategies/test_self_reflective_integration.py
  Tests: 4 (P:4 F:0 S:0)
[38/180] FAILED: tests/integration/strategies/test_vector_embedding_indexing.py
  Tests: 10 (P:0 F:10 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 5 items

tests/integration/strategies/test_vector_embedding_indexing.py::TestVectorEmbeddingIndexing::test_capabilities_and_dependencies FAILED [ 20%]
tests/integration/strategies/test_vector_embedding_indexing.py::TestVectorEmbeddingIndexing::test_process_success FAILED [ 40%]
tests/integration/strategies/test_vector_embedding_indexing.py::TestVectorEmbeddingIndexing::test_process_batching FAILED [ 60%]
tests/integration/strategies/test_vector_embedding_indexing.py::TestVectorEmbeddingIndexing::test_no_chunks_error FAILED [ 80%]
tests/integration/strategies/test_vector_embedding_indexing.py::TestVectorEmbeddingIndexing::test_service_error FAILED [100%]

=================================== FAILURES ===================================
________ TestVectorEmbeddingIndexing.test_capabilities_and_dependencies ________
tests/integration/strategies/test_vector_embedding_indexing.py:54: in test_capabilities_and_dependencies
    assert vector_embedding_strategy.produces() == {
E   assert {<IndexCapability.DATABASE: 10>, <IndexCapability.VECTORS: 1>, <IndexCapability.CHUNKS: 5>} == {<IndexCapability.DATABASE: 10>, <IndexCapability.VECTORS: 1>}
E     
E     Extra items in the left set:
E     <IndexCapability.CHUNKS: 5>
E     
E     Full diff:
E       {
E           <IndexCapability.VECTORS: 1>,
E     +     <IndexCapability.CHUNKS: 5>,
E           <IndexCapability.DATABASE: 10>,
E       }
_______________ TestVectorEmbeddingIndexing.test_process_success _______________
tests/integration/strategies/test_vector_embedding_indexing.py:77: in test_process_success
    mock_database_service.get_chunks_for_documents.assert_called_once_with(["doc1"])
/usr/lib/python3.12/unittest/mock.py:955: in assert_called_once_with
    raise AssertionError(msg)
E   AssertionError: Expected 'get_chunks_for_documents' to be called once. Called 0 times.
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.strategies.indexing.vector_embedding:Starting VectorEmbeddingIndexing.process with 1 documents
DEBUG:rag_factory.strategies.indexing.vector_embedding:Configuration: batch_size=2, chunk_size=512, overlap=50
INFO:rag_factory.strategies.indexing.vector_embedding:Using embedding service: AsyncMock
INFO:rag_factory.strategies.indexing.vector_embedding:Starting document chunking...
DEBUG:rag_factory.strategies.indexing.vector_embedding:_chunk_documents called with 1 documents, chunk_size=512, overlap=50
DEBUG:rag_factory.strategies.indexing.vector_embedding:Processing document 1/1: doc_id='doc1', text_length=0
DEBUG:rag_factory.strategies.indexing.vector_embedding:Skipping empty document: doc1
DEBUG:rag_factory.strategies.indexing.vector_embedding:_chunk_documents complete: total 0 chunks created
INFO:rag_factory.strategies.indexing.vector_embedding:Document chunking complete: created 0 chunks from 1 documents
WARNING:rag_factory.strategies.indexing.vector_embedding:No chunks created from documents (all empty?), returning empty result
------------------------------ Captured log call -------------------------------
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:55 Starting VectorEmbeddingIndexing.process with 1 documents
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:61 Configuration: batch_size=2, chunk_size=512, overlap=50
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:67 Using embedding service: AsyncMock
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:70 Starting document chunking...
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:137 _chunk_documents called with 1 documents, chunk_size=512, overlap=50
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:146 Processing document 1/1: doc_id='doc1', text_length=0
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:149 Skipping empty document: doc1
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:220 _chunk_documents complete: total 0 chunks created
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:72 Document chunking complete: created 0 chunks from 1 documents
WARNING  rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:76 No chunks created from documents (all empty?), returning empty result
______________ TestVectorEmbeddingIndexing.test_process_batching _______________
tests/integration/strategies/test_vector_embedding_indexing.py:114: in test_process_batching
    assert mock_embedding_service.embed_batch.call_count == 2
E   AssertionError: assert 0 == 2
E    +  where 0 = <AsyncMock name='mock.embed_batch' id='134244541542096'>.call_count
E    +    where <AsyncMock name='mock.embed_batch' id='134244541542096'> = <AsyncMock spec='IEmbeddingService' id='134244541541616'>.embed_batch
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.strategies.indexing.vector_embedding:Starting VectorEmbeddingIndexing.process with 1 documents
DEBUG:rag_factory.strategies.indexing.vector_embedding:Configuration: batch_size=1, chunk_size=512, overlap=50
INFO:rag_factory.strategies.indexing.vector_embedding:Using embedding service: AsyncMock
INFO:rag_factory.strategies.indexing.vector_embedding:Starting document chunking...
DEBUG:rag_factory.strategies.indexing.vector_embedding:_chunk_documents called with 1 documents, chunk_size=512, overlap=50
DEBUG:rag_factory.strategies.indexing.vector_embedding:Processing document 1/1: doc_id='doc1', text_length=0
DEBUG:rag_factory.strategies.indexing.vector_embedding:Skipping empty document: doc1
DEBUG:rag_factory.strategies.indexing.vector_embedding:_chunk_documents complete: total 0 chunks created
INFO:rag_factory.strategies.indexing.vector_embedding:Document chunking complete: created 0 chunks from 1 documents
WARNING:rag_factory.strategies.indexing.vector_embedding:No chunks created from documents (all empty?), returning empty result
------------------------------ Captured log call -------------------------------
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:55 Starting VectorEmbeddingIndexing.process with 1 documents
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:61 Configuration: batch_size=1, chunk_size=512, overlap=50
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:67 Using embedding service: AsyncMock
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:70 Starting document chunking...
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:137 _chunk_documents called with 1 documents, chunk_size=512, overlap=50
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:146 Processing document 1/1: doc_id='doc1', text_length=0
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:149 Skipping empty document: doc1
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:220 _chunk_documents complete: total 0 chunks created
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:72 Document chunking complete: created 0 chunks from 1 documents
WARNING  rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:76 No chunks created from documents (all empty?), returning empty result
_______________ TestVectorEmbeddingIndexing.test_no_chunks_error _______________
tests/integration/strategies/test_vector_embedding_indexing.py:127: in test_no_chunks_error
    with pytest.raises(ValueError, match="No chunks found"):
E   Failed: DID NOT RAISE <class 'ValueError'>
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.strategies.indexing.vector_embedding:Starting VectorEmbeddingIndexing.process with 1 documents
DEBUG:rag_factory.strategies.indexing.vector_embedding:Configuration: batch_size=2, chunk_size=512, overlap=50
INFO:rag_factory.strategies.indexing.vector_embedding:Using embedding service: AsyncMock
INFO:rag_factory.strategies.indexing.vector_embedding:Starting document chunking...
DEBUG:rag_factory.strategies.indexing.vector_embedding:_chunk_documents called with 1 documents, chunk_size=512, overlap=50
DEBUG:rag_factory.strategies.indexing.vector_embedding:Processing document 1/1: doc_id='doc1', text_length=0
DEBUG:rag_factory.strategies.indexing.vector_embedding:Skipping empty document: doc1
DEBUG:rag_factory.strategies.indexing.vector_embedding:_chunk_documents complete: total 0 chunks created
INFO:rag_factory.strategies.indexing.vector_embedding:Document chunking complete: created 0 chunks from 1 documents
WARNING:rag_factory.strategies.indexing.vector_embedding:No chunks created from documents (all empty?), returning empty result
------------------------------ Captured log call -------------------------------
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:55 Starting VectorEmbeddingIndexing.process with 1 documents
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:61 Configuration: batch_size=2, chunk_size=512, overlap=50
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:67 Using embedding service: AsyncMock
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:70 Starting document chunking...
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:137 _chunk_documents called with 1 documents, chunk_size=512, overlap=50
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:146 Processing document 1/1: doc_id='doc1', text_length=0
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:149 Skipping empty document: doc1
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:220 _chunk_documents complete: total 0 chunks created
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:72 Document chunking complete: created 0 chunks from 1 documents
WARNING  rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:76 No chunks created from documents (all empty?), returning empty result
________________ TestVectorEmbeddingIndexing.test_service_error ________________
tests/integration/strategies/test_vector_embedding_indexing.py:141: in test_service_error
    with pytest.raises(Exception, match="Service failed"):
E   Failed: DID NOT RAISE <class 'Exception'>
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.strategies.indexing.vector_embedding:Starting VectorEmbeddingIndexing.process with 1 documents
DEBUG:rag_factory.strategies.indexing.vector_embedding:Configuration: batch_size=2, chunk_size=512, overlap=50
INFO:rag_factory.strategies.indexing.vector_embedding:Using embedding service: AsyncMock
INFO:rag_factory.strategies.indexing.vector_embedding:Starting document chunking...
DEBUG:rag_factory.strategies.indexing.vector_embedding:_chunk_documents called with 1 documents, chunk_size=512, overlap=50
DEBUG:rag_factory.strategies.indexing.vector_embedding:Processing document 1/1: doc_id='doc1', text_length=0
DEBUG:rag_factory.strategies.indexing.vector_embedding:Skipping empty document: doc1
DEBUG:rag_factory.strategies.indexing.vector_embedding:_chunk_documents complete: total 0 chunks created
INFO:rag_factory.strategies.indexing.vector_embedding:Document chunking complete: created 0 chunks from 1 documents
WARNING:rag_factory.strategies.indexing.vector_embedding:No chunks created from documents (all empty?), returning empty result
------------------------------ Captured log call -------------------------------
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:55 Starting VectorEmbeddingIndexing.process with 1 documents
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:61 Configuration: batch_size=2, chunk_size=512, overlap=50
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:67 Using embedding service: AsyncMock
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:70 Starting document chunking...
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:137 _chunk_documents called with 1 documents, chunk_size=512, overlap=50
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:146 Processing document 1/1: doc_id='doc1', text_length=0
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:149 Skipping empty document: doc1
DEBUG    rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:220 _chunk_documents complete: total 0 chunks created
INFO     rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:72 Document chunking complete: created 0 chunks from 1 documents
WARNING  rag_factory.strategies.indexing.vector_embedding:vector_embedding.py:76 No chunks created from documents (all empty?), returning empty result
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                               37      9    76%   100-101, 107-109, 121-122, 130-131
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               31     10    68%   25-28, 48-49, 76-78, 82
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          104     82    21%   40-72, 92-132, 147-195, 207-212, 226, 256-279
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     28    48%   144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/legacy_config.py                                         155     99    36%   134-139, 189-191, 216-232, 247-266, 275, 301-310, 327-335, 357-369, 388-395, 416-440, 449-452, 464-469, 479, 496-498, 506-508, 521-526, 536-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      0   100%
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      0   100%
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     46    47%   49, 99-103, 108-115, 140-162, 190-229, 250, 270, 290-291, 306, 315, 324, 333, 344-373, 394-396
rag_factory/observability/metrics/__init__.py                          2      0   100%
rag_factory/observability/metrics/collector.py                       143     96    33%   66-68, 77-79, 88-90, 99, 108, 117, 128-143, 193-198, 221-266, 284-290, 304, 335-340, 352-364, 372-404, 442-443, 457-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    118    24%   131-134, 160-167, 184-188, 205-209, 222-254, 277-312, 335-377, 402-406, 422-430, 444-450, 489-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               61     45    26%   47-54, 62-65, 70-73, 78-80, 88-104, 116-142, 152-189
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      5     0%   20-31
rag_factory/repositories/base.py                                      42     42     0%   7-164
rag_factory/repositories/chunk.py                                    206    206     0%   7-670
rag_factory/repositories/document.py                                  93     93     0%   7-312
rag_factory/repositories/exceptions.py                                18     18     0%   7-77
rag_factory/services/__init__.py                                       8      0   100%
rag_factory/services/api/__init__.py                                   4      0   100%
rag_factory/services/api/anthropic.py                                 27     18    33%   46-52, 76-94, 118-141
rag_factory/services/api/cohere.py                                    30     19    37%   14-15, 49-59, 82-113
rag_factory/services/api/openai.py                                    46     31    33%   45-51, 75-93, 117-140, 168-174, 189-199, 216-227, 235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    181    159    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-406, 414-415, 430-510, 516-517, 521-546
rag_factory/services/database/migration_validator.py                  85     63    26%   29-30, 61-69, 81-88, 108-120, 137-141, 152-181, 192-204, 215-222, 234, 246-256, 268-271
rag_factory/services/database/neo4j.py                                54     36    33%   14, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            141    112    21%   17-18, 26-27, 84-121, 131-145, 149-173, 186-219, 243-276, 290-305, 320-335, 367-385, 399-422, 427, 464-482, 491-503, 507, 511
rag_factory/services/dependencies.py                                  41     12    71%   99, 101, 103, 105, 107, 134-140, 179-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               121     97    20%   18-19, 24-25, 89-184, 200-257, 268-315, 326, 334, 342, 355
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     41    28%   50-62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   66     51    23%   32-39, 56-70, 93-129, 154-175, 186, 194-198, 215-216
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      0   100%
rag_factory/services/local/reranker.py                                32     22    31%   13-14, 45-52, 78-116
rag_factory/services/onnx/__init__.py                                  2      0   100%
rag_factory/services/onnx/embedding.py                                29     19    34%   54-68, 83-93, 110-121, 129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             173    152    12%   22-23, 28-29, 40-48, 81-197, 217-238, 264-310, 332-366, 383-404, 424-439, 452-470, 484-496
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      7     0%   8-20
rag_factory/strategies/agentic/agent.py                              151    151     0%   8-420
rag_factory/strategies/agentic/config.py                              12     12     0%   5-31
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     89     0%   8-278
rag_factory/strategies/agentic/strategy.py                            85     85     0%   8-282
rag_factory/strategies/agentic/tool_implementations.py               135    135     0%   11-511
rag_factory/strategies/agentic/tools.py                               40     40     0%   8-142
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15      4    73%   45-48
rag_factory/strategies/chunking/base.py                               91     35    62%   115-128, 146, 159, 171, 182-196, 207-217, 228-256
rag_factory/strategies/chunking/docling_chunker.py                    45     26    42%   18, 61-73, 89-101, 112, 131-136, 147-152, 163-168, 186-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     61    18%   8-9, 33-46, 58-111, 122, 145-159, 171-185, 196-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     58    17%   36-48, 63-132, 143, 157-160, 173-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    171    12%   9-10, 14-15, 45-71, 83-128, 139, 155-156, 172-177, 193-206, 218-227, 245-277, 293-328, 340-386, 397-423, 434-441, 459-473, 485-534
rag_factory/strategies/chunking/structural_chunker.py                147    128    13%   9-10, 37-50, 62-69, 80, 95, 107-144, 155-201, 222-288, 299-305, 317-366, 377-385, 399-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      7     0%   8-19
rag_factory/strategies/contextual/batch_processor.py                  91     91     0%   8-266
rag_factory/strategies/contextual/config.py                           46     46     0%   8-195
rag_factory/strategies/contextual/context_generator.py                84     84     0%   8-234
rag_factory/strategies/contextual/cost_tracker.py                     32     32     0%   8-126
rag_factory/strategies/contextual/prompts.py                          25     25     0%   8-119
rag_factory/strategies/contextual/storage.py                          44     44     0%   8-118
rag_factory/strategies/contextual/strategy.py                         73     73     0%   8-284
rag_factory/strategies/fine_tuned/__init__.py                          4      4     0%   1-5
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11     11     0%   1-30
rag_factory/strategies/fine_tuned/custom_loader.py                    40     40     0%   1-88
rag_factory/strategies/fine_tuned/model_registry.py                  126    126     0%   1-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       71     71     0%   9-292
rag_factory/strategies/indexing/__init__.py                            5      0   100%
rag_factory/strategies/indexing/context_aware.py                      97     79    19%   29, 40, 60-120, 141-142, 146-156, 168-174, 178-184, 194-223, 227-228
rag_factory/strategies/indexing/hierarchical.py                       83     68    18%   48, 60, 84-121, 143-172, 188-223, 240-265, 279-280
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   40     40     0%   8-155
rag_factory/strategies/indexing/vector_embedding.py                   98     57    42%   64-65, 85-116, 154-218
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    78     78     0%   8-254
rag_factory/strategies/late_chunking/__init__.py                       6      6     0%   8-21
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     27     0%   7-96
rag_factory/strategies/late_chunking/document_embedder.py            104    104     0%   8-318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    117     0%   7-300
rag_factory/strategies/late_chunking/models.py                        62     62     0%   8-100
rag_factory/strategies/late_chunking/strategy.py                      49     49     0%   8-143
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        66     66     0%   3-182
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           2      0   100%
rag_factory/strategies/retrieval/semantic_retriever.py                20      9    55%   23, 32, 61-81
rag_factory/strategies/self_reflective/__init__.py                     6      6     0%   3-16
rag_factory/strategies/self_reflective/config.py                      20     20     0%   3-42
rag_factory/strategies/self_reflective/grader.py                      80     80     0%   3-266
rag_factory/strategies/self_reflective/models.py                      48     48     0%   3-109
rag_factory/strategies/self_reflective/refiner.py                     69     69     0%   3-228
rag_factory/strategies/self_reflective/strategy.py                    89     89     0%   3-264
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              12116  10083    17%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_vector_embedding_indexing.py::TestVectorEmbeddingIndexing::test_capabilities_and_dependencies - assert {<IndexCapability.DATABASE: 10>, <IndexCapability.VECTORS: 1>, <IndexCapability.CHUNKS: 5>} == {<IndexCapability.DATABASE: 10>, <IndexCapability.VECTORS: 1>}
  
  Extra items in the left set:
  <IndexCapability.CHUNKS: 5>
  
  Full diff:
    {
        <IndexCapability.VECTORS: 1>,
  +     <IndexCapability.CHUNKS: 5>,
        <IndexCapability.DATABASE: 10>,
    }
FAILED tests/integration/strategies/test_vector_embedding_indexing.py::TestVectorEmbeddingIndexing::test_process_success - AssertionError: Expected 'get_chunks_for_documents' to be called once. Called 0 times.
FAILED tests/integration/strategies/test_vector_embedding_indexing.py::TestVectorEmbeddingIndexing::test_process_batching - AssertionError: assert 0 == 2
 +  where 0 = <AsyncMock name='mock.embed_batch' id='134244541542096'>.call_count
 +    where <AsyncMock name='mock.embed_batch' id='134244541542096'> = <AsyncMock spec='IEmbeddingService' id='134244541541616'>.embed_batch
FAILED tests/integration/strategies/test_vector_embedding_indexing.py::TestVectorEmbeddingIndexing::test_no_chunks_error - Failed: DID NOT RAISE <class 'ValueError'>
FAILED tests/integration/strategies/test_vector_embedding_indexing.py::TestVectorEmbeddingIndexing::test_service_error - Failed: DID NOT RAISE <class 'Exception'>
======================== 5 failed, 2 warnings in 5.05s =========================

