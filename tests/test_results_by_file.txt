[1/209] PASSED: tests/benchmarks/test_contextual_performance.py
  Tests: 6 (P:6 F:0 S:0)
[2/209] PASSED: tests/benchmarks/test_late_chunking_performance.py
  Tests: 8 (P:8 F:0 S:0)
[3/209] ALL_SKIPPED: tests/benchmarks/test_model_comparison_performance.py
  Tests: 6 (P:0 F:0 S:6)
[4/209] PASSED: tests/integration/cli/test_benchmark_integration.py
  Tests: 1 (P:1 F:0 S:0)
[5/209] PASSED: tests/integration/cli/test_config_validation_integration.py
  Tests: 2 (P:2 F:0 S:0)
[6/209] PASSED: tests/integration/cli/test_index_query_flow.py
  Tests: 11 (P:11 F:0 S:0)
[7/209] PASSED: tests/integration/config/test_config_integration.py
  Tests: 9 (P:9 F:0 S:0)
[8/209] PASSED: tests/integration/database/test_database_integration.py
  Tests: 14 (P:13 F:0 S:1)
[9/209] FAILED: tests/integration/database/test_migration_integration.py
  Tests: 8 (P:0 F:8 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 4 items

tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_real_migration_execution FAILED [ 25%]
tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_migration_with_existing_data FAILED [ 50%]
tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_rollback_functionality FAILED [ 75%]
tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_pgvector_extension_installed FAILED [100%]

=================================== FAILURES ===================================
____________ TestMigrationIntegration.test_real_migration_execution ____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_integration.py:29: in test_real_migration_execution
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
__________ TestMigrationIntegration.test_migration_with_existing_data __________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_integration.py:48: in test_migration_with_existing_data
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
_____________ TestMigrationIntegration.test_rollback_functionality _____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_integration.py:79: in test_rollback_functionality
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
__________ TestMigrationIntegration.test_pgvector_extension_installed __________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "keyword_chunks" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_integration.py:114: in test_pgvector_extension_installed
    command.upgrade(alembic_config, "head")
venv/lib/python3.12/site-packages/alembic/command.py:403: in upgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/09ff10071922_add_metadata_to_keyword_chunks.py:23: in upgrade
    op.add_column('keyword_chunks', sa.Column('metadata', sa.JSON(), nullable=True))
<string>:8: in add_column
    ???
<string>:3: in add_column
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:2142: in add_column
    return operations.invoke(op)
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:171: in add_column
    operations.impl.add_column(table_name, column, schema=schema, **kw)
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:334: in add_column
    self._exec(base.AddColumn(table_name, column, schema=schema))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist
E   
E   [SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade 463c87d677b1 -> 09ff10071922, add_metadata_to_keyword_chunks
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     18    53%   46-54, 66-77, 86-88, 118, 126, 139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    182    17%   17-18, 26-27, 84-128, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 555-578, 583, 594, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     68    19%   31-36, 45, 57, 66-90, 108-109, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135    135     0%   7-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     78    19%   38-53, 71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11269    18%
=========================== short test summary info ============================
FAILED tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_real_migration_execution - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_migration_with_existing_data - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_rollback_functionality - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_integration.py::TestMigrationIntegration::test_pgvector_extension_installed - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist

[SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
(Background on this error at: https://sqlalche.me/e/20/f405)
======================== 4 failed, 8 warnings in 11.73s ========================

[10/209] FAILED: tests/integration/database/test_migration_validator_integration.py
  Tests: 27 (P:3 F:24 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 15 items

tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_no_migrations FAILED [  6%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_partial_migrations FAILED [ 13%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_all_migrations FAILED [ 20%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_or_raise_success FAILED [ 26%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_or_raise_failure FAILED [ 33%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_get_current_revision FAILED [ 40%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_get_all_revisions PASSED [ 46%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_is_at_head FAILED [ 53%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_error_message_details FAILED [ 60%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_single_migration FAILED [ 66%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_nonexistent_migration FAILED [ 73%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_after_downgrade FAILED [ 80%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_multiple_validators_same_database FAILED [ 86%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validator_with_auto_discovered_config PASSED [ 93%]
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validate_empty_requirements PASSED [100%]

=================================== FAILURES ===================================
______ TestMigrationValidatorIntegration.test_validate_with_no_migrations ______
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:68: in test_validate_with_no_migrations
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
---------------------------- Captured stderr setup -----------------------------
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for localhost:5432/test_db
DEBUG:asyncio:Using selector: EpollSelector
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for localhost:5432/test_db
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
___ TestMigrationValidatorIntegration.test_validate_with_partial_migrations ____
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:85: in test_validate_with_partial_migrations
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
_____ TestMigrationValidatorIntegration.test_validate_with_all_migrations ______
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "keyword_chunks" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:105: in test_validate_with_all_migrations
    command.upgrade(alembic_config, "head")
venv/lib/python3.12/site-packages/alembic/command.py:403: in upgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/09ff10071922_add_metadata_to_keyword_chunks.py:23: in upgrade
    op.add_column('keyword_chunks', sa.Column('metadata', sa.JSON(), nullable=True))
<string>:8: in add_column
    ???
<string>:3: in add_column
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:2142: in add_column
    return operations.invoke(op)
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:171: in add_column
    operations.impl.add_column(table_name, column, schema=schema, **kw)
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:334: in add_column
    self._exec(base.AddColumn(table_name, column, schema=schema))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist
E   
E   [SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade 463c87d677b1 -> 09ff10071922, add_metadata_to_keyword_chunks
_______ TestMigrationValidatorIntegration.test_validate_or_raise_success _______
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "keyword_chunks" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:121: in test_validate_or_raise_success
    command.upgrade(alembic_config, "head")
venv/lib/python3.12/site-packages/alembic/command.py:403: in upgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/09ff10071922_add_metadata_to_keyword_chunks.py:23: in upgrade
    op.add_column('keyword_chunks', sa.Column('metadata', sa.JSON(), nullable=True))
<string>:8: in add_column
    ???
<string>:3: in add_column
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:2142: in add_column
    return operations.invoke(op)
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:171: in add_column
    operations.impl.add_column(table_name, column, schema=schema, **kw)
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:334: in add_column
    self._exec(base.AddColumn(table_name, column, schema=schema))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist
E   
E   [SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade 463c87d677b1 -> 09ff10071922, add_metadata_to_keyword_chunks
_______ TestMigrationValidatorIntegration.test_validate_or_raise_failure _______
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:134: in test_validate_or_raise_failure
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
_________ TestMigrationValidatorIntegration.test_get_current_revision __________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:153: in test_get_current_revision
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
______________ TestMigrationValidatorIntegration.test_is_at_head _______________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:193: in test_is_at_head
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
_________ TestMigrationValidatorIntegration.test_error_message_details _________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:214: in test_error_message_details
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
_______ TestMigrationValidatorIntegration.test_validate_single_migration _______
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "keyword_chunks" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:240: in test_validate_single_migration
    command.upgrade(alembic_config, "head")
venv/lib/python3.12/site-packages/alembic/command.py:403: in upgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/09ff10071922_add_metadata_to_keyword_chunks.py:23: in upgrade
    op.add_column('keyword_chunks', sa.Column('metadata', sa.JSON(), nullable=True))
<string>:8: in add_column
    ???
<string>:3: in add_column
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:2142: in add_column
    return operations.invoke(op)
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:171: in add_column
    operations.impl.add_column(table_name, column, schema=schema, **kw)
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:334: in add_column
    self._exec(base.AddColumn(table_name, column, schema=schema))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist
E   
E   [SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade 463c87d677b1 -> 09ff10071922, add_metadata_to_keyword_chunks
____ TestMigrationValidatorIntegration.test_validate_nonexistent_migration _____
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "keyword_chunks" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:256: in test_validate_nonexistent_migration
    command.upgrade(alembic_config, "head")
venv/lib/python3.12/site-packages/alembic/command.py:403: in upgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/09ff10071922_add_metadata_to_keyword_chunks.py:23: in upgrade
    op.add_column('keyword_chunks', sa.Column('metadata', sa.JSON(), nullable=True))
<string>:8: in add_column
    ???
<string>:3: in add_column
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:2142: in add_column
    return operations.invoke(op)
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:171: in add_column
    operations.impl.add_column(table_name, column, schema=schema, **kw)
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:334: in add_column
    self._exec(base.AddColumn(table_name, column, schema=schema))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist
E   
E   [SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade 463c87d677b1 -> 09ff10071922, add_metadata_to_keyword_chunks
_______ TestMigrationValidatorIntegration.test_validate_after_downgrade ________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "keyword_chunks" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:272: in test_validate_after_downgrade
    command.upgrade(alembic_config, "head")
venv/lib/python3.12/site-packages/alembic/command.py:403: in upgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/09ff10071922_add_metadata_to_keyword_chunks.py:23: in upgrade
    op.add_column('keyword_chunks', sa.Column('metadata', sa.JSON(), nullable=True))
<string>:8: in add_column
    ???
<string>:3: in add_column
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:2142: in add_column
    return operations.invoke(op)
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:171: in add_column
    operations.impl.add_column(table_name, column, schema=schema, **kw)
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:334: in add_column
    self._exec(base.AddColumn(table_name, column, schema=schema))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist
E   
E   [SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade 463c87d677b1 -> 09ff10071922, add_metadata_to_keyword_chunks
___ TestMigrationValidatorIntegration.test_multiple_validators_same_database ___
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: relation "keyword_chunks" does not exist

The above exception was the direct cause of the following exception:
tests/integration/database/test_migration_validator_integration.py:295: in test_multiple_validators_same_database
    command.upgrade(alembic_config, "head")
venv/lib/python3.12/site-packages/alembic/command.py:403: in upgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/09ff10071922_add_metadata_to_keyword_chunks.py:23: in upgrade
    op.add_column('keyword_chunks', sa.Column('metadata', sa.JSON(), nullable=True))
<string>:8: in add_column
    ???
<string>:3: in add_column
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:2142: in add_column
    return operations.invoke(op)
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:171: in add_column
    operations.impl.add_column(table_name, column, schema=schema, **kw)
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:334: in add_column
    self._exec(base.AddColumn(table_name, column, schema=schema))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist
E   
E   [SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade 463c87d677b1 -> 09ff10071922, add_metadata_to_keyword_chunks
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

tests/integration/database/test_migration_validator_integration.py: 13 warnings
  /mnt/MCPProyects/ragTools/tests/integration/database/test_migration_validator_integration.py:50: RuntimeWarning: coroutine 'PostgresqlDatabaseService.close' was never awaited
    service.close()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validator_with_auto_discovered_config
tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorEdgeCases::test_validate_empty_requirements
  /mnt/MCPProyects/ragTools/tests/integration/database/test_migration_validator_integration.py:336: RuntimeWarning: coroutine 'PostgresqlDatabaseService.close' was never awaited
    service.close()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     18    53%   46-54, 66-77, 86-88, 118, 126, 139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     38    60%   29-30, 88, 113, 119-121, 148-152, 163-192, 204-219, 249, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    159    27%   17-18, 26-27, 85, 91-103, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 556, 563-576, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     68    19%   31-36, 45, 57, 66-90, 108-109, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135    135     0%   7-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     78    19%   38-53, 71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11210    19%
=========================== short test summary info ============================
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_no_migrations - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_partial_migrations - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_with_all_migrations - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist

[SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_or_raise_success - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist

[SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_or_raise_failure - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_get_current_revision - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_is_at_head - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_error_message_details - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_single_migration - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist

[SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_nonexistent_migration - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist

[SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_validate_after_downgrade - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist

[SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/integration/database/test_migration_validator_integration.py::TestMigrationValidatorIntegration::test_multiple_validators_same_database - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "keyword_chunks" does not exist

[SQL: ALTER TABLE keyword_chunks ADD COLUMN metadata JSON]
(Background on this error at: https://sqlalche.me/e/20/f405)
================== 12 failed, 3 passed, 23 warnings in 23.20s ==================

[11/209] PASSED: tests/integration/database/test_multi_context_isolation.py
  Tests: 10 (P:2 F:0 S:8)
[12/209] ALL_SKIPPED: tests/integration/documentation/test_documentation_integration.py
  Tests: 6 (P:0 F:0 S:6)
[13/209] PASSED: tests/integration/evaluation/test_evaluation_integration.py
  Tests: 7 (P:7 F:0 S:0)
[14/209] TIMEOUT: tests/integration/gui/test_end_to_end_workflow.py
  Tests: 6 (P:5 F:1 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/integration/gui/test_end_to_end_workflow.py::TestGUILaunch::test_gui_launches_successfully PASSED [ 12%]
tests/integration/gui/test_end_to_end_workflow.py::TestGUILaunch::test_gui_initializes_components PASSED [ 25%]
tests/integration/gui/test_end_to_end_workflow.py::TestStrategyLoading::test_strategy_loading_workflow FAILED [ 37%]
tests/integration/gui/test_end_to_end_workflow.py::TestEndToEndWorkflow::test_indexing_workflow PASSED [ 50%]
tests/integration/gui/test_end_to_end_workflow.py::TestEndToEndWorkflow::test_retrieval_workflow PASSED [ 62%]
tests/integration/gui/test_end_to_end_workflow.py::TestThreadingSafety::test_concurrent_operations PASSED [ 75%]
tests/integration/gui/test_end_to_end_workflow.py::TestUtilityOperations::test_clear_data_workflow 
[15/209] TIMEOUT: tests/integration/gui/test_gui_launch.py
  Tests: 3 (P:2 F:1 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/integration/gui/test_gui_launch.py::TestGUILaunch::test_gui_launches_without_error PASSED [ 12%]
tests/integration/gui/test_gui_launch.py::TestGUILaunch::test_gui_window_properties FAILED [ 25%]
tests/integration/gui/test_gui_launch.py::TestGUILaunch::test_gui_loads_strategies PASSED [ 37%]
tests/integration/gui/test_gui_launch.py::TestGUILaunch::test_gui_handles_missing_strategies_dir 
[16/209] PASSED: tests/integration/models/test_fine_tuned_embeddings_integration.py
  Tests: 6 (P:6 F:0 S:0)
[17/209] PASSED: tests/integration/observability/test_monitoring_integration.py
  Tests: 11 (P:11 F:0 S:0)
[18/209] FAILED: tests/integration_real/test_database_real.py
  Tests: 9 (P:7 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/integration_real/test_database_real.py::test_postgres_connection PASSED [ 12%]
tests/integration_real/test_database_real.py::test_table_creation PASSED [ 25%]
tests/integration_real/test_database_real.py::test_store_and_retrieve_chunks PASSED [ 37%]
tests/integration_real/test_database_real.py::test_vector_similarity_search FAILED [ 50%]
tests/integration_real/test_database_real.py::test_batch_embedding_and_storage PASSED [ 62%]
tests/integration_real/test_database_real.py::test_chunk_metadata_persistence PASSED [ 75%]
tests/integration_real/test_database_real.py::test_database_context_table_mapping PASSED [ 87%]
tests/integration_real/test_database_real.py::test_connection_pooling PASSED [100%]

=================================== FAILURES ===================================
________________________ test_vector_similarity_search _________________________
tests/integration_real/test_database_real.py:114: in test_vector_similarity_search
    assert len(results) == 2
E   assert 0 == 2
E    +  where 0 = len([])
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
INFO:tests.integration_real.conftest:[FIXTURE] Creating PostgresqlDatabaseService
INFO:rag_factory.services.database.postgres:Initialized PostgreSQL service for 192.168.56.1:5432/rag_test
INFO:tests.integration_real.conftest:[FIXTURE] Getting pool for cleanup
INFO:rag_factory.services.database.postgres:[_ensure_table] Starting table setup for test_chunks_real
INFO:rag_factory.services.database.postgres:[_ensure_table] Acquiring connection from pool
INFO:rag_factory.services.database.postgres:[_ensure_table] Connection acquired, enabling pgvector extension
INFO:rag_factory.services.database.postgres:[_ensure_table] pgvector extension enabled
INFO:rag_factory.services.database.postgres:[_ensure_table] Creating table test_chunks_real
INFO:rag_factory.services.database.postgres:[_ensure_table] Table created/verified
INFO:rag_factory.services.database.postgres:[_ensure_table] Checking if embedding column exists
INFO:rag_factory.services.database.postgres:[_ensure_table] Embedding column exists: True
INFO:rag_factory.services.database.postgres:[_ensure_table] Creating ivfflat index
INFO:rag_factory.services.database.postgres:[_ensure_table] Index created/verified
INFO:rag_factory.services.database.postgres:Ensured table test_chunks_real exists
INFO:tests.integration_real.conftest:[FIXTURE] Pool acquired, truncating table
INFO:tests.integration_real.conftest:[FIXTURE] Table truncated successfully
INFO:tests.integration_real.conftest:[FIXTURE] Yielding service to test
INFO:rag_factory.services.embedding.providers.onnx_local:Loading ONNX model: Xenova/all-MiniLM-L6-v2
INFO:rag_factory.services.utils.onnx_utils:Using model from EMBEDDING_MODEL_NAME env: Xenova/all-MiniLM-L6-v2
INFO:rag_factory.services.utils.onnx_utils:Using cached ONNX model: models/embeddings/Xenova_all-MiniLM-L6-v2/onnx/model.onnx
INFO:rag_factory.services.utils.onnx_utils:Created ONNX session with providers: ['CPUExecutionProvider']
INFO:rag_factory.services.utils.onnx_utils:Model has 3 inputs and 1 outputs
DEBUG:rag_factory.services.utils.onnx_utils:  Input: input_ids, shape: ['batch_size', 'sequence_length'], type: tensor(int64)
DEBUG:rag_factory.services.utils.onnx_utils:  Input: attention_mask, shape: ['batch_size', 'sequence_length'], type: tensor(int64)
DEBUG:rag_factory.services.utils.onnx_utils:  Input: token_type_ids, shape: ['batch_size', 'sequence_length'], type: tensor(int64)
DEBUG:rag_factory.services.utils.onnx_utils:  Output: last_hidden_state, shape: ['batch_size', 'sequence_length', 384], type: tensor(float)
INFO:rag_factory.services.utils.onnx_utils:Model validation passed
INFO:rag_factory.services.embedding.providers.onnx_local:Loaded tokenizer from models/embeddings/Xenova_all-MiniLM-L6-v2/tokenizer.json
INFO:rag_factory.services.embedding.providers.onnx_local:Loaded ONNX model Xenova/all-MiniLM-L6-v2 with 384 dimensions
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
INFO     tests.integration_real.conftest:conftest.py:166 [FIXTURE] Creating PostgresqlDatabaseService
INFO     rag_factory.services.database.postgres:postgres.py:121 Initialized PostgreSQL service for 192.168.56.1:5432/rag_test
INFO     tests.integration_real.conftest:conftest.py:179 [FIXTURE] Getting pool for cleanup
INFO     rag_factory.services.database.postgres:postgres.py:200 [_ensure_table] Starting table setup for test_chunks_real
INFO     rag_factory.services.database.postgres:postgres.py:201 [_ensure_table] Acquiring connection from pool
INFO     rag_factory.services.database.postgres:postgres.py:203 [_ensure_table] Connection acquired, enabling pgvector extension
INFO     rag_factory.services.database.postgres:postgres.py:206 [_ensure_table] pgvector extension enabled
INFO     rag_factory.services.database.postgres:postgres.py:209 [_ensure_table] Creating table test_chunks_real
INFO     rag_factory.services.database.postgres:postgres.py:220 [_ensure_table] Table created/verified
INFO     rag_factory.services.database.postgres:postgres.py:223 [_ensure_table] Checking if embedding column exists
INFO     rag_factory.services.database.postgres:postgres.py:235 [_ensure_table] Embedding column exists: True
INFO     rag_factory.services.database.postgres:postgres.py:243 [_ensure_table] Creating ivfflat index
INFO     rag_factory.services.database.postgres:postgres.py:250 [_ensure_table] Index created/verified
INFO     rag_factory.services.database.postgres:postgres.py:252 Ensured table test_chunks_real exists
INFO     tests.integration_real.conftest:conftest.py:181 [FIXTURE] Pool acquired, truncating table
INFO     tests.integration_real.conftest:conftest.py:185 [FIXTURE] Table truncated successfully
INFO     tests.integration_real.conftest:conftest.py:192 [FIXTURE] Yielding service to test
INFO     rag_factory.services.embedding.providers.onnx_local:onnx_local.py:111 Loading ONNX model: Xenova/all-MiniLM-L6-v2
INFO     rag_factory.services.utils.onnx_utils:onnx_utils.py:90 Using model from EMBEDDING_MODEL_NAME env: Xenova/all-MiniLM-L6-v2
INFO     rag_factory.services.utils.onnx_utils:onnx_utils.py:113 Using cached ONNX model: models/embeddings/Xenova_all-MiniLM-L6-v2/onnx/model.onnx
INFO     rag_factory.services.utils.onnx_utils:onnx_utils.py:211 Created ONNX session with providers: ['CPUExecutionProvider']
INFO     rag_factory.services.utils.onnx_utils:onnx_utils.py:243 Model has 3 inputs and 1 outputs
DEBUG    rag_factory.services.utils.onnx_utils:onnx_utils.py:247   Input: input_ids, shape: ['batch_size', 'sequence_length'], type: tensor(int64)
DEBUG    rag_factory.services.utils.onnx_utils:onnx_utils.py:247   Input: attention_mask, shape: ['batch_size', 'sequence_length'], type: tensor(int64)
DEBUG    rag_factory.services.utils.onnx_utils:onnx_utils.py:247   Input: token_type_ids, shape: ['batch_size', 'sequence_length'], type: tensor(int64)
DEBUG    rag_factory.services.utils.onnx_utils:onnx_utils.py:251   Output: last_hidden_state, shape: ['batch_size', 'sequence_length', 384], type: tensor(float)
INFO     rag_factory.services.utils.onnx_utils:onnx_utils.py:273 Model validation passed
INFO     rag_factory.services.embedding.providers.onnx_local:onnx_local.py:168 Loaded tokenizer from models/embeddings/Xenova_all-MiniLM-L6-v2/tokenizer.json
INFO     rag_factory.services.embedding.providers.onnx_local:onnx_local.py:177 Loaded ONNX model Xenova/all-MiniLM-L6-v2 with 384 dimensions
----------------------------- Captured stderr call -----------------------------
DEBUG:rag_factory.services.database.postgres:Storing chunk similarity_test_0: embedding dims=384, first 3 values=[0.0343538336455822, 0.07440994679927826, 0.05604083091020584]
DEBUG:rag_factory.services.database.postgres:Storing chunk similarity_test_1: embedding dims=384, first 3 values=[0.0010620492976158857, 0.06840494275093079, 0.06369533389806747]
DEBUG:rag_factory.services.database.postgres:Storing chunk similarity_test_2: embedding dims=384, first 3 values=[0.027595646679401398, 0.1246952936053276, 0.04242276772856712]
DEBUG:rag_factory.services.database.postgres:Stored 3 chunks
DEBUG:rag_factory.services.database.postgres:Searching with embedding dims=384, first 3 values=[0.007651947438716888, 0.07867687195539474, 0.05970418080687523]
DEBUG:rag_factory.services.database.postgres:Found 3 chunks with embeddings in database
DEBUG:rag_factory.services.database.postgres:Found 0 similar chunks
------------------------------ Captured log call -------------------------------
DEBUG    rag_factory.services.database.postgres:postgres.py:302 Storing chunk similarity_test_0: embedding dims=384, first 3 values=[0.0343538336455822, 0.07440994679927826, 0.05604083091020584]
DEBUG    rag_factory.services.database.postgres:postgres.py:302 Storing chunk similarity_test_1: embedding dims=384, first 3 values=[0.0010620492976158857, 0.06840494275093079, 0.06369533389806747]
DEBUG    rag_factory.services.database.postgres:postgres.py:302 Storing chunk similarity_test_2: embedding dims=384, first 3 values=[0.027595646679401398, 0.1246952936053276, 0.04242276772856712]
DEBUG    rag_factory.services.database.postgres:postgres.py:320 Stored 3 chunks
DEBUG    rag_factory.services.database.postgres:postgres.py:349 Searching with embedding dims=384, first 3 values=[0.007651947438716888, 0.07867687195539474, 0.05970418080687523]
DEBUG    rag_factory.services.database.postgres:postgres.py:359 Found 3 chunks with embeddings in database
DEBUG    rag_factory.services.database.postgres:postgres.py:396 Found 0 similar chunks
--------------------------- Captured stderr teardown ---------------------------
INFO:tests.integration_real.conftest:[FIXTURE] Test completed, starting cleanup
INFO:tests.integration_real.conftest:[FIXTURE] Pool acquired for cleanup
INFO:tests.integration_real.conftest:[FIXTURE] Table dropped successfully
INFO:tests.integration_real.conftest:[FIXTURE] Closing service
INFO:rag_factory.services.database.postgres:Closed PostgreSQL async connection pool
DEBUG:rag_factory.services.database.postgres:Cleared DatabaseContext cache
INFO:tests.integration_real.conftest:[FIXTURE] Service closed
---------------------------- Captured log teardown -----------------------------
INFO     tests.integration_real.conftest:conftest.py:196 [FIXTURE] Test completed, starting cleanup
INFO     tests.integration_real.conftest:conftest.py:199 [FIXTURE] Pool acquired for cleanup
INFO     tests.integration_real.conftest:conftest.py:202 [FIXTURE] Table dropped successfully
INFO     tests.integration_real.conftest:conftest.py:207 [FIXTURE] Closing service
INFO     rag_factory.services.database.postgres:postgres.py:661 Closed PostgreSQL async connection pool
DEBUG    rag_factory.services.database.postgres:postgres.py:670 Cleared DatabaseContext cache
INFO     tests.integration_real.conftest:conftest.py:209 [FIXTURE] Service closed
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    238    14%   88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218     78    64%   17-18, 26-27, 85, 91-103, 140-151, 163-174, 238-240, 266, 276-279, 290, 292, 296-297, 378-381, 386-394, 411-426, 476-491, 523-541, 556, 583, 594, 647, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     38    67%   18-19, 90, 114, 139-147, 158, 170-175, 194, 248-250, 273, 289-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133     42    68%   22-23, 37, 77-84, 96-97, 117-123, 142-146, 175, 189-190, 194, 198-201, 216-218, 258, 265-268, 361-362, 376, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     68    19%   31-36, 45, 57, 66-90, 108-109, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135    135     0%   7-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     78    19%   38-53, 71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11052    20%
=========================== short test summary info ============================
FAILED tests/integration_real/test_database_real.py::test_vector_similarity_search - assert 0 == 2
 +  where 0 = len([])
=================== 1 failed, 7 passed, 8 warnings in 16.08s ===================

[19/209] PASSED: tests/integration_real/test_embedding_real.py
  Tests: 11 (P:8 F:0 S:3)
[20/209] PASSED: tests/integration_real/test_end_to_end_real.py
  Tests: 7 (P:7 F:0 S:0)
[21/209] PASSED: tests/integration_real/test_llm_real.py
  Tests: 10 (P:10 F:0 S:0)
[22/209] PASSED: tests/integration_real/test_neo4j_real.py
  Tests: 9 (P:9 F:0 S:0)
[23/209] PASSED: tests/integration/registry/test_registry_integration.py
  Tests: 16 (P:16 F:0 S:0)
[24/209] PASSED: tests/integration/repositories/test_repository_integration.py
  Tests: 19 (P:19 F:0 S:0)
[25/209] PASSED: tests/integration/services/test_embedding_integration.py
  Tests: 8 (P:6 F:0 S:2)
[26/209] PASSED: tests/integration/services/test_fine_tuned_onnx_integration.py
  Tests: 1 (P:1 F:0 S:0)
[27/209] PASSED: tests/integration/services/test_llm_integration.py
  Tests: 8 (P:1 F:0 S:7)
[28/209] PASSED: tests/integration/services/test_lm_studio_connection.py
  Tests: 2 (P:2 F:0 S:0)
[29/209] PASSED: tests/integration/services/test_onnx_embeddings_integration.py
  Tests: 10 (P:10 F:0 S:0)
[30/209] PASSED: tests/integration/services/test_service_implementations.py
  Tests: 19 (P:19 F:0 S:0)
[31/209] PASSED: tests/integration/services/test_service_integration.py
  Tests: 2 (P:2 F:0 S:0)
[32/209] PASSED: tests/integration/strategies/test_base_integration.py
  Tests: 5 (P:5 F:0 S:0)
[33/209] PASSED: tests/integration/strategies/test_chunking_integration.py
  Tests: 12 (P:12 F:0 S:0)
[34/209] PASSED: tests/integration/strategies/test_contextual_integration.py
  Tests: 6 (P:6 F:0 S:0)
[35/209] PASSED: tests/integration/strategies/test_hierarchical_indexing.py
  Tests: 14 (P:14 F:0 S:0)
[36/209] PASSED: tests/integration/strategies/test_hierarchical_integration.py
  Tests: 4 (P:4 F:0 S:0)
[37/209] PASSED: tests/integration/strategies/test_in_memory_indexing.py
  Tests: 12 (P:12 F:0 S:0)
[38/209] PASSED: tests/integration/strategies/test_keyword_indexing.py
  Tests: 6 (P:6 F:0 S:0)
[39/209] PASSED: tests/integration/strategies/test_knowledge_graph_integration.py
  Tests: 4 (P:4 F:0 S:0)
[40/209] PASSED: tests/integration/strategies/test_late_chunking_integration.py
  Tests: 9 (P:9 F:0 S:0)
[41/209] PASSED: tests/integration/strategies/test_multi_query_integration.py
  Tests: 9 (P:9 F:0 S:0)
[42/209] PASSED: tests/integration/strategies/test_query_expansion_integration.py
  Tests: 11 (P:11 F:0 S:0)
[43/209] PASSED: tests/integration/strategies/test_reranking_integration.py
  Tests: 9 (P:8 F:0 S:1)
[44/209] FAILED: tests/integration/strategies/test_self_reflective_integration.py
  Tests: 8 (P:0 F:8 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 4 items

tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_end_to_end_workflow FAILED [ 25%]
tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_retry_with_poor_results FAILED [ 50%]
tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_performance_within_limits FAILED [ 75%]
tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveWithLMStudio::test_with_real_llm FAILED [100%]

=================================== FAILURES ===================================
____________ TestSelfReflectiveIntegration.test_end_to_end_workflow ____________
tests/integration/strategies/test_self_reflective_integration.py:92: in test_end_to_end_workflow
    results = strategy.retrieve("What is machine learning?", top_k=3)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
__________ TestSelfReflectiveIntegration.test_retry_with_poor_results __________
tests/integration/strategies/test_self_reflective_integration.py:115: in test_retry_with_poor_results
    results = strategy.retrieve("test query", top_k=3)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
_________ TestSelfReflectiveIntegration.test_performance_within_limits _________
tests/integration/strategies/test_self_reflective_integration.py:139: in test_performance_within_limits
    results = strategy.retrieve("test query", top_k=3)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
______________ TestSelfReflectiveWithLMStudio.test_with_real_llm _______________
tests/integration/strategies/test_self_reflective_integration.py:173: in test_with_real_llm
    results = strategy.retrieve("test query", top_k=1)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    182    17%   17-18, 26-27, 84-128, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 555-578, 583, 594, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20      8    60%   32, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23      6    74%   46-48, 51-53
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     10    17%   10-22
rag_factory/services/llm/providers/anthropic.py                       57     42    26%   44-50, 64-97, 120-147, 171-172, 184-189, 197, 205
rag_factory/services/llm/providers/ollama.py                          55     42    24%   22-24, 37-67, 93-122, 142-143, 157, 165, 174, 185-196
rag_factory/services/llm/providers/openai.py                          57     35    39%   56, 62, 76-110, 133-158, 173, 186-194, 202, 210
rag_factory/services/llm/service.py                                   79     50    37%   69, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     17    37%   22-41, 56-57, 71-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     68    19%   31-36, 45, 57, 66-90, 108-109, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135    135     0%   7-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     60    25%   51-67, 83-109, 135-171, 187-258
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     53    23%   53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     69    28%   71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11188    19%
=========================== short test summary info ============================
FAILED tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_end_to_end_workflow - TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
FAILED tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_retry_with_poor_results - TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
FAILED tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveIntegration::test_performance_within_limits - TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
FAILED tests/integration/strategies/test_self_reflective_integration.py::TestSelfReflectiveWithLMStudio::test_with_real_llm - TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
======================== 4 failed, 8 warnings in 6.31s =========================

[45/209] PASSED: tests/integration/strategies/test_vector_embedding_indexing.py
  Tests: 5 (P:5 F:0 S:0)
[46/209] PASSED: tests/integration/test_agentic_rag_pair.py
  Tests: 1 (P:1 F:0 S:0)
[47/209] PASSED: tests/integration/test_config_integration.py
  Tests: 8 (P:8 F:0 S:0)
[48/209] PASSED: tests/integration/test_context_aware_chunking_pair.py
  Tests: 1 (P:1 F:0 S:0)
[49/209] PASSED: tests/integration/test_contextual_retrieval_pair.py
  Tests: 1 (P:1 F:0 S:0)
[50/209] PASSED: tests/integration/test_factory_consistency.py
  Tests: 8 (P:8 F:0 S:0)
[51/209] PASSED: tests/integration/test_factory_integration.py
  Tests: 11 (P:11 F:0 S:0)
[52/209] PASSED: tests/integration/test_fine_tuned_embeddings_pair.py
  Tests: 1 (P:1 F:0 S:0)
[53/209] PASSED: tests/integration/test_hierarchical_rag_pair.py
  Tests: 1 (P:1 F:0 S:0)
[54/209] PASSED: tests/integration/test_hybrid_search_pair.py
  Tests: 1 (P:1 F:0 S:0)
[55/209] PASSED: tests/integration/test_keyword_pair.py
  Tests: 1 (P:1 F:0 S:0)
[56/209] PASSED: tests/integration/test_knowledge_graph_pair.py
  Tests: 1 (P:1 F:0 S:0)
[57/209] PASSED: tests/integration/test_late_chunking_pair.py
  Tests: 1 (P:1 F:0 S:0)
[58/209] PASSED: tests/integration/test_multi_query_pair.py
  Tests: 1 (P:1 F:0 S:0)
[59/209] PASSED: tests/integration/test_package_integration.py
  Tests: 4 (P:3 F:0 S:1)
[60/209] PASSED: tests/integration/test_pipeline_integration.py
  Tests: 7 (P:7 F:0 S:0)
[61/209] PASSED: tests/integration/test_query_expansion_pair.py
  Tests: 1 (P:1 F:0 S:0)
[62/209] PASSED: tests/integration/test_reranking_pair.py
  Tests: 1 (P:1 F:0 S:0)
[63/209] PASSED: tests/integration/test_self_reflective_pair.py
  Tests: 1 (P:1 F:0 S:0)
[64/209] PASSED: tests/integration/test_semantic_api_pair.py
  Tests: 1 (P:1 F:0 S:0)
[65/209] PASSED: tests/integration/test_semantic_local_pair.py
  Tests: 1 (P:1 F:0 S:0)
[66/209] PASSED: tests/integration/test_tokenization_integration.py
  Tests: 16 (P:16 F:0 S:0)
[67/209] PASSED: tests/mocks/test_standalone.py
  Tests: 6 (P:6 F:0 S:0)
[68/209] FAILED: tests/test_mock_registry.py
  Tests: 0 (P:0 F:0 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 0 items

=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    182    17%   17-18, 26-27, 84-128, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 555-578, 583, 594, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     68    19%   31-36, 45, 57, 66-90, 108-109, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135    135     0%   7-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     78    19%   38-53, 71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11289    18%
============================= 8 warnings in 4.20s ==============================

[69/209] PASSED: tests/unit/cli/test_benchmark_command.py
  Tests: 5 (P:5 F:0 S:0)
[70/209] PASSED: tests/unit/cli/test_check_consistency_command.py
  Tests: 11 (P:11 F:0 S:0)
[71/209] PASSED: tests/unit/cli/test_config_validation_command.py
  Tests: 6 (P:6 F:0 S:0)
[72/209] PASSED: tests/unit/cli/test_consistency_formatter.py
  Tests: 10 (P:10 F:0 S:0)
[73/209] PASSED: tests/unit/cli/test_formatters.py
  Tests: 19 (P:19 F:0 S:0)
[74/209] PASSED: tests/unit/cli/test_index_command.py
  Tests: 5 (P:5 F:0 S:0)
[75/209] PASSED: tests/unit/cli/test_list_strategies_command.py
  Tests: 5 (P:5 F:0 S:0)
[76/209] PASSED: tests/unit/cli/test_query_command.py
  Tests: 5 (P:5 F:0 S:0)
[77/209] PASSED: tests/unit/cli/test_repl_command.py
  Tests: 4 (P:4 F:0 S:0)
[78/209] PASSED: tests/unit/cli/test_validate_pipeline_command.py
  Tests: 8 (P:8 F:0 S:0)
[79/209] PASSED: tests/unit/cli/test_validation_formatter.py
  Tests: 14 (P:14 F:0 S:0)
[80/209] PASSED: tests/unit/cli/test_validation.py
  Tests: 17 (P:17 F:0 S:0)
[81/209] PASSED: tests/unit/config/test_env_resolver.py
  Tests: 24 (P:24 F:0 S:0)
[82/209] PASSED: tests/unit/config/test_env_validator.py
  Tests: 19 (P:19 F:0 S:0)
[83/209] PASSED: tests/unit/config/test_schemas.py
  Tests: 18 (P:18 F:0 S:0)
[84/209] PASSED: tests/unit/config/test_strategy_loader.py
  Tests: 6 (P:6 F:0 S:0)
[85/209] PASSED: tests/unit/config/test_strategy_pair_manager.py
  Tests: 4 (P:4 F:0 S:0)
[86/209] PASSED: tests/unit/config/test_validator.py
  Tests: 23 (P:23 F:0 S:0)
[87/209] PASSED: tests/unit/core/test_capabilities.py
  Tests: 19 (P:19 F:0 S:0)
[88/209] PASSED: tests/unit/core/test_factory_validation.py
  Tests: 7 (P:7 F:0 S:0)
[89/209] PASSED: tests/unit/core/test_indexing_interface.py
  Tests: 27 (P:27 F:0 S:0)
[90/209] PASSED: tests/unit/core/test_pipeline.py
  Tests: 9 (P:9 F:0 S:0)
[91/209] PASSED: tests/unit/core/test_retrieval_interface.py
  Tests: 14 (P:14 F:0 S:0)
[92/209] PASSED: tests/unit/database/test_batch_operations.py
  Tests: 2 (P:2 F:0 S:0)
[93/209] PASSED: tests/unit/database/test_connection.py
  Tests: 14 (P:14 F:0 S:0)
[94/209] FAILED: tests/unit/database/test_migrations.py
  Tests: 13 (P:1 F:12 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 7 items

tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_upgrade_to_head FAILED [ 14%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_downgrade FAILED [ 28%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_history PASSED [ 42%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_idempotency FAILED [ 57%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_get_current_version FAILED [ 71%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_creates_tables FAILED [ 85%]
tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_creates_indexes FAILED [100%]

=================================== FAILURES ===================================
_____________ TestAlembicMigrations.test_migration_upgrade_to_head _____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/unit/database/test_migrations.py:39: in test_migration_upgrade_to_head
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
________________ TestAlembicMigrations.test_migration_downgrade ________________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/unit/database/test_migrations.py:60: in test_migration_downgrade
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
_______________ TestAlembicMigrations.test_migration_idempotency _______________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/unit/database/test_migrations.py:104: in test_migration_idempotency
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
________________ TestAlembicMigrations.test_get_current_version ________________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/unit/database/test_migrations.py:131: in test_get_current_version
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
_____________ TestAlembicMigrations.test_migration_creates_tables ______________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/unit/database/test_migrations.py:149: in test_migration_creates_tables
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
_____________ TestAlembicMigrations.test_migration_creates_indexes _____________
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UndefinedTable: table "context_aware_vectors" does not exist

The above exception was the direct cause of the following exception:
tests/unit/database/test_migrations.py:169: in test_migration_creates_indexes
    command.downgrade(alembic_config, "base")
venv/lib/python3.12/site-packages/alembic/command.py:449: in downgrade
    script.run_env()
venv/lib/python3.12/site-packages/alembic/script/base.py:583: in run_env
    util.load_python_file(self.dir, "env.py")
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:95: in load_python_file
    module = load_module_py(module_id, path)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/util/pyfiles.py:113: in load_module_py
    spec.loader.exec_module(module)  # type: ignore
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap_external>:995: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
migrations/env.py:93: in <module>
    run_migrations_online()
migrations/env.py:87: in run_migrations_online
    context.run_migrations()
<string>:8: in run_migrations
    ???
venv/lib/python3.12/site-packages/alembic/runtime/environment.py:948: in run_migrations
    self.get_context().run_migrations(**kw)
venv/lib/python3.12/site-packages/alembic/runtime/migration.py:627: in run_migrations
    step.migration_fn(**kw)
migrations/versions/context_aware_schema_context_aware_schema.py:74: in downgrade
    op.drop_table('context_aware_vectors')
<string>:8: in drop_table
    ???
<string>:3: in drop_table
    ???
venv/lib/python3.12/site-packages/alembic/operations/ops.py:1408: in drop_table
    operations.invoke(op)
venv/lib/python3.12/site-packages/alembic/operations/base.py:445: in invoke
    return fn(self, operation)
           ^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/alembic/operations/toimpl.py:82: in drop_table
    operations.impl.drop_table(
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:389: in drop_table
    self._exec(schema.DropTable(table))
venv/lib/python3.12/site-packages/alembic/ddl/impl.py:207: in _exec
    return conn.execute(construct, multiparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
venv/lib/python3.12/site-packages/sqlalchemy/sql/ddl.py:181: in _execute_on_connection
    return connection._execute_ddl(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1528: in _execute_ddl
    ret = self._execute_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist
E   
E   [SQL: 
E   DROP TABLE context_aware_vectors]
E   (Background on this error at: https://sqlalche.me/e/20/f405)
----------------------------- Captured stderr call -----------------------------
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running downgrade 463c87d677b1 -> context_aware_schema, contextual_schema, finetuned_schema, hierarchical_schema, keyword_schema, knowledge_graph_schema, late_chunking_schema, multi_query_schema, query_expansion_schema, reranking_schema, self_reflective_schema, semantic_api_schema, merge all strategy schema heads
INFO  [alembic.runtime.migration] Running downgrade context_aware_schema -> semantic_local_schema, context_aware_schema
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     18    53%   46-54, 66-77, 86-88, 118, 126, 139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    182    17%   17-18, 26-27, 84-128, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 555-578, 583, 594, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     68    19%   31-36, 45, 57, 66-90, 108-109, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135    135     0%   7-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     78    19%   38-53, 71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11269    18%
=========================== short test summary info ============================
FAILED tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_upgrade_to_head - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_downgrade - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_idempotency - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/unit/database/test_migrations.py::TestAlembicMigrations::test_get_current_version - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_creates_tables - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
FAILED tests/unit/database/test_migrations.py::TestAlembicMigrations::test_migration_creates_indexes - sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) table "context_aware_vectors" does not exist

[SQL: 
DROP TABLE context_aware_vectors]
(Background on this error at: https://sqlalche.me/e/20/f405)
=================== 6 failed, 1 passed, 8 warnings in 14.88s ===================

[95/209] PASSED: tests/unit/database/test_models.py
  Tests: 21 (P:21 F:0 S:0)
[96/209] PASSED: tests/unit/database/test_pgvector.py
  Tests: 3 (P:3 F:0 S:0)
[97/209] PASSED: tests/unit/database/test_vector_indexing.py
  Tests: 4 (P:4 F:0 S:0)
[98/209] PASSED: tests/unit/documentation/test_code_examples.py
  Tests: 5 (P:4 F:0 S:1)
[99/209] PASSED: tests/unit/documentation/test_documentation_completeness.py
  Tests: 8 (P:8 F:0 S:0)
[100/209] PASSED: tests/unit/documentation/test_links.py
  Tests: 4 (P:3 F:0 S:1)
[101/209] PASSED: tests/unit/evaluation/test_benchmark_suite.py
  Tests: 15 (P:15 F:0 S:0)
[102/209] PASSED: tests/unit/evaluation/test_comparison.py
  Tests: 14 (P:14 F:0 S:0)
[103/209] PASSED: tests/unit/evaluation/test_dataset_loader.py
  Tests: 14 (P:14 F:0 S:0)
[104/209] PASSED: tests/unit/evaluation/test_export.py
  Tests: 12 (P:12 F:0 S:0)
[105/209] PASSED: tests/unit/evaluation/test_retrieval_metrics.py
  Tests: 22 (P:22 F:0 S:0)
[106/209] PASSED: tests/unit/evaluation/test_statistical_testing.py
  Tests: 21 (P:21 F:0 S:0)
[107/209] PASSED: tests/unit/examples/test_examples_imports.py
  Tests: 7 (P:7 F:0 S:0)
[108/209] PASSED: tests/unit/examples/test_examples_syntax.py
  Tests: 8 (P:8 F:0 S:0)
[109/209] PASSED: tests/unit/examples/test_requirements.py
  Tests: 8 (P:8 F:0 S:0)
[110/209] PASSED: tests/unit/gui/test_backend_integration.py
  Tests: 10 (P:10 F:0 S:0)
[111/209] PASSED: tests/unit/gui/test_components.py
  Tests: 25 (P:25 F:0 S:0)
[112/209] PASSED: tests/unit/gui/test_indexing_operations.py
  Tests: 8 (P:8 F:0 S:0)
[113/209] PASSED: tests/unit/gui/test_main_window.py
  Tests: 26 (P:26 F:0 S:0)
[114/209] PASSED: tests/unit/gui/test_polish_and_ux.py
  Tests: 18 (P:18 F:0 S:0)
[115/209] PASSED: tests/unit/gui/test_retrieval_operations.py
  Tests: 16 (P:16 F:0 S:0)
[116/209] PASSED: tests/unit/gui/test_utility_operations.py
  Tests: 17 (P:17 F:0 S:0)
[117/209] PASSED: tests/unit/mocks/test_mock_builders.py
  Tests: 12 (P:12 F:0 S:0)
[118/209] PASSED: tests/unit/models/embedding/test_registry.py
  Tests: 22 (P:22 F:0 S:0)
[119/209] PASSED: tests/unit/models/evaluation/test_ab_testing.py
  Tests: 17 (P:17 F:0 S:0)
[120/209] PASSED: tests/unit/observability/test_cost_calculator.py
  Tests: 17 (P:17 F:0 S:0)
[121/209] PASSED: tests/unit/observability/test_filters.py
  Tests: 20 (P:20 F:0 S:0)
[122/209] PASSED: tests/unit/observability/test_logger.py
  Tests: 20 (P:20 F:0 S:0)
[123/209] PASSED: tests/unit/observability/test_metrics_collector.py
  Tests: 28 (P:28 F:0 S:0)
[124/209] PASSED: tests/unit/observability/test_performance_monitor.py
  Tests: 13 (P:13 F:0 S:0)
[125/209] PASSED: tests/unit/registry/test_exceptions.py
  Tests: 3 (P:3 F:0 S:0)
[126/209] PASSED: tests/unit/registry/test_service_factory.py
  Tests: 26 (P:26 F:0 S:0)
[127/209] PASSED: tests/unit/registry/test_service_registry.py
  Tests: 26 (P:26 F:0 S:0)
[128/209] PASSED: tests/unit/registry/test_threading.py
  Tests: 9 (P:9 F:0 S:0)
[129/209] PASSED: tests/unit/repositories/test_chunk_repository.py
  Tests: 32 (P:32 F:0 S:0)
[130/209] PASSED: tests/unit/repositories/test_document_repository.py
  Tests: 25 (P:25 F:0 S:0)
[131/209] PASSED: tests/unit/repositories/test_exceptions.py
  Tests: 12 (P:12 F:0 S:0)
[132/209] PASSED: tests/unit/services/database/test_database_context_crud.py
  Tests: 15 (P:15 F:0 S:0)
[133/209] PASSED: tests/unit/services/database/test_database_context.py
  Tests: 11 (P:11 F:0 S:0)
[134/209] PASSED: tests/unit/services/database/test_database_context_vector.py
  Tests: 8 (P:2 F:0 S:6)
[135/209] PASSED: tests/unit/services/database/test_migration_validator.py
  Tests: 23 (P:23 F:0 S:0)
[136/209] PASSED: tests/unit/services/database/test_postgres_service_context.py
  Tests: 17 (P:17 F:0 S:0)
[137/209] PASSED: tests/unit/services/embeddings/test_onnx_local.py
  Tests: 14 (P:14 F:0 S:0)
[138/209] PASSED: tests/unit/services/embedding/test_cache.py
  Tests: 10 (P:10 F:0 S:0)
[139/209] PASSED: tests/unit/services/embedding/test_onnx_local_provider.py
  Tests: 10 (P:10 F:0 S:0)
[140/209] PASSED: tests/unit/services/embedding/test_openai_provider.py
  Tests: 9 (P:9 F:0 S:0)
[141/209] PASSED: tests/unit/services/embedding/test_rate_limiter.py
  Tests: 7 (P:7 F:0 S:0)
[142/209] PASSED: tests/unit/services/embedding/test_service.py
  Tests: 14 (P:14 F:0 S:0)
[143/209] PASSED: tests/unit/services/llm/test_anthropic_provider.py
  Tests: 10 (P:10 F:0 S:0)
[144/209] PASSED: tests/unit/services/llm/test_ollama_provider.py
  Tests: 10 (P:10 F:0 S:0)
[145/209] PASSED: tests/unit/services/llm/test_openai_provider.py
  Tests: 10 (P:10 F:0 S:0)
[146/209] PASSED: tests/unit/services/llm/test_prompt_template.py
  Tests: 13 (P:13 F:0 S:0)
[147/209] PASSED: tests/unit/services/llm/test_service.py
  Tests: 14 (P:14 F:0 S:0)
[148/209] PASSED: tests/unit/services/test_consistency.py
  Tests: 16 (P:16 F:0 S:0)
[149/209] PASSED: tests/unit/services/test_database_service.py
  Tests: 10 (P:10 F:0 S:0)
[150/209] PASSED: tests/unit/services/test_dependencies.py
  Tests: 17 (P:17 F:0 S:0)
[151/209] PASSED: tests/unit/services/test_graph_interface.py
  Tests: 6 (P:6 F:0 S:0)
[152/209] PASSED: tests/unit/services/test_interfaces.py
  Tests: 21 (P:21 F:0 S:0)
[153/209] PASSED: tests/unit/services/test_reranking_interface.py
  Tests: 4 (P:4 F:0 S:0)
[154/209] PASSED: tests/unit/services/utils/test_onnx_utils.py
  Tests: 17 (P:17 F:0 S:0)
[155/209] FAILED: tests/unit/strategies/agentic/test_agent.py
  Tests: 27 (P:5 F:22 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 16 items

tests/unit/strategies/agentic/test_agent.py::test_agent_state_initialization PASSED [  6%]
tests/unit/strategies/agentic/test_agent.py::test_agent_state_add_tool_call PASSED [ 12%]
tests/unit/strategies/agentic/test_agent.py::test_agent_state_add_tool_result PASSED [ 18%]
tests/unit/strategies/agentic/test_agent.py::test_agent_state_should_continue_max_iterations PASSED [ 25%]
tests/unit/strategies/agentic/test_agent.py::test_agent_state_should_continue_sufficient_results PASSED [ 31%]
tests/unit/strategies/agentic/test_agent.py::test_agent_initialization FAILED [ 37%]
tests/unit/strategies/agentic/test_agent.py::test_agent_run_basic FAILED [ 43%]
tests/unit/strategies/agentic/test_agent.py::test_agent_planning_phase FAILED [ 50%]
tests/unit/strategies/agentic/test_agent.py::test_agent_tool_execution FAILED [ 56%]
tests/unit/strategies/agentic/test_agent.py::test_agent_tool_execution_not_found FAILED [ 62%]
tests/unit/strategies/agentic/test_agent.py::test_agent_synthesize_results FAILED [ 68%]
tests/unit/strategies/agentic/test_agent.py::test_agent_synthesize_results_ignores_failed FAILED [ 75%]
tests/unit/strategies/agentic/test_agent.py::test_agent_max_iterations FAILED [ 81%]
tests/unit/strategies/agentic/test_agent.py::test_agent_parse_tool_calls_structured FAILED [ 87%]
tests/unit/strategies/agentic/test_agent.py::test_agent_parse_tool_calls_done FAILED [ 93%]
tests/unit/strategies/agentic/test_agent.py::test_agent_parse_tool_calls_fallback FAILED [100%]

=================================== FAILURES ===================================
__________________________ test_agent_initialization ___________________________
tests/unit/strategies/agentic/test_agent.py:118: in test_agent_initialization
    assert len(agent.tool_definitions) == 1
               ^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SimpleAgent' object has no attribute 'tool_definitions'
_____________________________ test_agent_run_basic _____________________________
tests/unit/strategies/agentic/test_agent.py:126: in test_agent_run_basic
    with patch.object(agent, '_select_tools', side_effect=[
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <rag_factory.strategies.agentic.agent.SimpleAgent object at 0x7a77b538a510> does not have the attribute '_select_tools'
__________________________ test_agent_planning_phase ___________________________
tests/unit/strategies/agentic/test_agent.py:142: in test_agent_planning_phase
    plan = agent._plan_retrieval("test query")
           ^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SimpleAgent' object has no attribute '_plan_retrieval'
__________________________ test_agent_tool_execution ___________________________
tests/unit/strategies/agentic/test_agent.py:154: in test_agent_tool_execution
    result = agent._execute_tool(tool_call)
             ^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SimpleAgent' object has no attribute '_execute_tool'
_____________________ test_agent_tool_execution_not_found ______________________
tests/unit/strategies/agentic/test_agent.py:166: in test_agent_tool_execution_not_found
    result = agent._execute_tool(tool_call)
             ^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SimpleAgent' object has no attribute '_execute_tool'
________________________ test_agent_synthesize_results _________________________
tests/unit/strategies/agentic/test_agent.py:198: in test_agent_synthesize_results
    results = agent._synthesize_results(state)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/agentic/agent.py:238: in _synthesize_results
    for result in workflow_results:
E   TypeError: 'AgentState' object is not iterable
_________________ test_agent_synthesize_results_ignores_failed _________________
tests/unit/strategies/agentic/test_agent.py:228: in test_agent_synthesize_results_ignores_failed
    results = agent._synthesize_results(state)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
rag_factory/strategies/agentic/agent.py:238: in _synthesize_results
    for result in workflow_results:
E   TypeError: 'AgentState' object is not iterable
__________________________ test_agent_max_iterations ___________________________
tests/unit/strategies/agentic/test_agent.py:239: in test_agent_max_iterations
    with patch.object(agent, '_select_tools', return_value=[
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <rag_factory.strategies.agentic.agent.SimpleAgent object at 0x7a77b538a6f0> does not have the attribute '_select_tools'
____________________ test_agent_parse_tool_calls_structured ____________________
tests/unit/strategies/agentic/test_agent.py:254: in test_agent_parse_tool_calls_structured
    tool_calls = agent._parse_tool_calls(response, "test query")
                 ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SimpleAgent' object has no attribute '_parse_tool_calls'
_______________________ test_agent_parse_tool_calls_done _______________________
tests/unit/strategies/agentic/test_agent.py:266: in test_agent_parse_tool_calls_done
    tool_calls = agent._parse_tool_calls(response, "test query")
                 ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SimpleAgent' object has no attribute '_parse_tool_calls'
_____________________ test_agent_parse_tool_calls_fallback _____________________
tests/unit/strategies/agentic/test_agent.py:282: in test_agent_parse_tool_calls_fallback
    tool_calls = agent._parse_tool_calls(response, "test query")
                 ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'SimpleAgent' object has no attribute '_parse_tool_calls'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    182    17%   17-18, 26-27, 84-128, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 555-578, 583, 594, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     44    48%   77-78, 90, 121-172, 190-221, 239-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135    135     0%   7-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     78    19%   38-53, 71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11265    18%
=========================== short test summary info ============================
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_initialization - AttributeError: 'SimpleAgent' object has no attribute 'tool_definitions'
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_run_basic - AttributeError: <rag_factory.strategies.agentic.agent.SimpleAgent object at 0x7a77b538a510> does not have the attribute '_select_tools'
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_planning_phase - AttributeError: 'SimpleAgent' object has no attribute '_plan_retrieval'
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_tool_execution - AttributeError: 'SimpleAgent' object has no attribute '_execute_tool'
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_tool_execution_not_found - AttributeError: 'SimpleAgent' object has no attribute '_execute_tool'
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_synthesize_results - TypeError: 'AgentState' object is not iterable
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_synthesize_results_ignores_failed - TypeError: 'AgentState' object is not iterable
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_max_iterations - AttributeError: <rag_factory.strategies.agentic.agent.SimpleAgent object at 0x7a77b538a6f0> does not have the attribute '_select_tools'
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_parse_tool_calls_structured - AttributeError: 'SimpleAgent' object has no attribute '_parse_tool_calls'
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_parse_tool_calls_done - AttributeError: 'SimpleAgent' object has no attribute '_parse_tool_calls'
FAILED tests/unit/strategies/agentic/test_agent.py::test_agent_parse_tool_calls_fallback - AttributeError: 'SimpleAgent' object has no attribute '_parse_tool_calls'
=================== 11 failed, 5 passed, 8 warnings in 5.96s ===================

[156/209] PASSED: tests/unit/strategies/agentic/test_plan_selection.py
  Tests: 21 (P:21 F:0 S:0)
[157/209] PASSED: tests/unit/strategies/agentic/test_query_analyzer.py
  Tests: 16 (P:16 F:0 S:0)
[158/209] FAILED: tests/unit/strategies/agentic/test_strategy.py
  Tests: 15 (P:7 F:8 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 11 items

tests/unit/strategies/agentic/test_strategy.py::test_config_defaults PASSED [  9%]
tests/unit/strategies/agentic/test_strategy.py::test_config_custom_values PASSED [ 18%]
tests/unit/strategies/agentic/test_strategy.py::test_config_validation PASSED [ 27%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_initialization PASSED [ 36%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_initialization_with_config PASSED [ 45%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_retrieve FAILED [ 54%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_retrieve_with_query_analysis FAILED [ 63%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_fallback_on_error FAILED [ 72%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_no_fallback_raises_error PASSED [ 81%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_get_stats PASSED [ 90%]
tests/unit/strategies/agentic/test_strategy.py::test_strategy_top_k_limit FAILED [100%]

=================================== FAILURES ===================================
____________________________ test_strategy_retrieve ____________________________
tests/unit/strategies/agentic/test_strategy.py:171: in test_strategy_retrieve
    results = await strategy.retrieve("test query", top_k=5)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AgenticRAGStrategy.retrieve() missing 1 required positional argument: 'context'
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.strategies.agentic.strategy:Initialized 4 tools: ['semantic_search', 'metadata_search', 'hybrid_search', 'read_document']
------------------------------ Captured log call -------------------------------
INFO     rag_factory.strategies.agentic.strategy:strategy.py:131 Initialized 4 tools: ['semantic_search', 'metadata_search', 'hybrid_search', 'read_document']
__________________ test_strategy_retrieve_with_query_analysis __________________
tests/unit/strategies/agentic/test_strategy.py:203: in test_strategy_retrieve_with_query_analysis
    results = await strategy.retrieve("test query")
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AgenticRAGStrategy.retrieve() missing 1 required positional argument: 'context'
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.strategies.agentic.strategy:Initialized 4 tools: ['semantic_search', 'metadata_search', 'hybrid_search', 'read_document']
------------------------------ Captured log call -------------------------------
INFO     rag_factory.strategies.agentic.strategy:strategy.py:131 Initialized 4 tools: ['semantic_search', 'metadata_search', 'hybrid_search', 'read_document']
_______________________ test_strategy_fallback_on_error ________________________
tests/unit/strategies/agentic/test_strategy.py:227: in test_strategy_fallback_on_error
    results = await strategy.retrieve("test query", top_k=5)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AgenticRAGStrategy.retrieve() missing 1 required positional argument: 'context'
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.strategies.agentic.strategy:Initialized 4 tools: ['semantic_search', 'metadata_search', 'hybrid_search', 'read_document']
------------------------------ Captured log call -------------------------------
INFO     rag_factory.strategies.agentic.strategy:strategy.py:131 Initialized 4 tools: ['semantic_search', 'metadata_search', 'hybrid_search', 'read_document']
__________________________ test_strategy_top_k_limit ___________________________
tests/unit/strategies/agentic/test_strategy.py:303: in test_strategy_top_k_limit
    results = await strategy.retrieve("test query", top_k=5)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: AgenticRAGStrategy.retrieve() missing 1 required positional argument: 'context'
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.strategies.agentic.strategy:Initialized 4 tools: ['semantic_search', 'metadata_search', 'hybrid_search', 'read_document']
------------------------------ Captured log call -------------------------------
INFO     rag_factory.strategies.agentic.strategy:strategy.py:131 Initialized 4 tools: ['semantic_search', 'metadata_search', 'hybrid_search', 'read_document']
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

tests/unit/strategies/agentic/test_strategy.py::test_strategy_get_stats
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/strategy.py:292: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    "config": self.strategy_config.dict()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    182    17%   17-18, 26-27, 84-128, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 555-578, 583, 594, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     14    66%   99, 101, 103, 105, 107, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     66    21%   31-36, 45, 57, 66-90, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     64    28%   50-55, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     39    56%   144, 157, 170, 183-225, 237-261
rag_factory/strategies/agentic/tool_implementations.py               135     79    41%   45, 52, 86-129, 157, 164, 182-247, 275, 282, 329-373, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135    135     0%   7-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55      8    85%   80-85, 177-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     78    19%   38-53, 71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11240    18%
=========================== short test summary info ============================
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_retrieve - TypeError: AgenticRAGStrategy.retrieve() missing 1 required positional argument: 'context'
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_retrieve_with_query_analysis - TypeError: AgenticRAGStrategy.retrieve() missing 1 required positional argument: 'context'
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_fallback_on_error - TypeError: AgenticRAGStrategy.retrieve() missing 1 required positional argument: 'context'
FAILED tests/unit/strategies/agentic/test_strategy.py::test_strategy_top_k_limit - TypeError: AgenticRAGStrategy.retrieve() missing 1 required positional argument: 'context'
=================== 4 failed, 7 passed, 9 warnings in 4.75s ====================

[159/209] FAILED: tests/unit/strategies/agentic/test_tools.py
  Tests: 15 (P:7 F:8 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 11 items

tests/unit/strategies/agentic/test_tools.py::test_tool_parameter_creation PASSED [  9%]
tests/unit/strategies/agentic/test_tools.py::test_tool_result_creation PASSED [ 18%]
tests/unit/strategies/agentic/test_tools.py::test_tool_to_anthropic_format PASSED [ 27%]
tests/unit/strategies/agentic/test_tools.py::test_semantic_search_tool_definition PASSED [ 36%]
tests/unit/strategies/agentic/test_tools.py::test_semantic_search_tool_execute FAILED [ 45%]
tests/unit/strategies/agentic/test_tools.py::test_semantic_search_tool_error_handling FAILED [ 54%]
tests/unit/strategies/agentic/test_tools.py::test_document_reader_tool PASSED [ 63%]
tests/unit/strategies/agentic/test_tools.py::test_document_reader_tool_not_found PASSED [ 72%]
tests/unit/strategies/agentic/test_tools.py::test_document_reader_tool_invalid_id PASSED [ 81%]
tests/unit/strategies/agentic/test_tools.py::test_metadata_search_tool FAILED [ 90%]
tests/unit/strategies/agentic/test_tools.py::test_hybrid_search_tool FAILED [100%]

=================================== FAILURES ===================================
______________________ test_semantic_search_tool_execute _______________________
tests/unit/strategies/agentic/test_tools.py:185: in test_semantic_search_tool_execute
    assert result.success is True
           ^^^^^^^^^^^^^^
E   AttributeError: 'coroutine' object has no attribute 'success'
___________________ test_semantic_search_tool_error_handling ___________________
tests/unit/strategies/agentic/test_tools.py:202: in test_semantic_search_tool_error_handling
    assert result.success is False
           ^^^^^^^^^^^^^^
E   AttributeError: 'coroutine' object has no attribute 'success'
__________________________ test_metadata_search_tool ___________________________
tests/unit/strategies/agentic/test_tools.py:254: in test_metadata_search_tool
    assert result.success is True
           ^^^^^^^^^^^^^^
E   AttributeError: 'coroutine' object has no attribute 'success'
___________________________ test_hybrid_search_tool ____________________________
tests/unit/strategies/agentic/test_tools.py:267: in test_hybrid_search_tool
    assert result.success is True
           ^^^^^^^^^^^^^^
E   AttributeError: 'coroutine' object has no attribute 'success'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    182    17%   17-18, 26-27, 84-128, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 555-578, 583, 594, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     68    19%   31-36, 45, 57, 66-90, 108-109, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     63    53%   86-129, 157, 164, 244-247, 271, 275, 282, 329-373, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      8    80%   66, 79, 89, 101, 139-142
rag_factory/strategies/agentic/workflows.py                          135    135     0%   7-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     78    19%   38-53, 71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11260    18%
=========================== short test summary info ============================
FAILED tests/unit/strategies/agentic/test_tools.py::test_semantic_search_tool_execute - AttributeError: 'coroutine' object has no attribute 'success'
FAILED tests/unit/strategies/agentic/test_tools.py::test_semantic_search_tool_error_handling - AttributeError: 'coroutine' object has no attribute 'success'
FAILED tests/unit/strategies/agentic/test_tools.py::test_metadata_search_tool - AttributeError: 'coroutine' object has no attribute 'success'
FAILED tests/unit/strategies/agentic/test_tools.py::test_hybrid_search_tool - AttributeError: 'coroutine' object has no attribute 'success'
=================== 4 failed, 7 passed, 8 warnings in 4.61s ====================

[160/209] FAILED: tests/unit/strategies/agentic/test_workflow_definitions.py
  Tests: 18 (P:16 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 17 items

tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflowDefinitions::test_all_workflows_exist PASSED [  5%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflowDefinitions::test_workflow_structure PASSED [ 11%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflowDefinitions::test_workflow_steps_structure PASSED [ 17%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow1SimpleSemanticSearch::test_workflow_1_definition PASSED [ 23%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow1SimpleSemanticSearch::test_workflow_1_parameters PASSED [ 29%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow2MetadataFiltered::test_workflow_2_definition PASSED [ 35%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow2MetadataFiltered::test_workflow_2_parameters PASSED [ 41%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow3SearchThenRead::test_workflow_3_definition PASSED [ 47%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow3SearchThenRead::test_workflow_3_chaining FAILED [ 52%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow4HybridSearch::test_workflow_4_definition PASSED [ 58%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow4HybridSearch::test_workflow_4_parameters PASSED [ 64%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow5MultiStepRefinement::test_workflow_5_definition PASSED [ 70%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow5MultiStepRefinement::test_workflow_5_progression PASSED [ 76%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow6DirectDocumentAccess::test_workflow_6_definition PASSED [ 82%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow6DirectDocumentAccess::test_workflow_6_parameters PASSED [ 88%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflowParameterSubstitution::test_query_placeholder PASSED [ 94%]
tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflowParameterSubstitution::test_step_reference_placeholder PASSED [100%]

=================================== FAILURES ===================================
_____________ TestWorkflow3SearchThenRead.test_workflow_3_chaining _____________
tests/unit/strategies/agentic/test_workflow_definitions.py:107: in test_workflow_3_chaining
    assert "{from_step_1}" in str(step2["params"]["document_id"]) or \
E   AssertionError: assert ('{from_step_1}' in '{from_step_1.document_id}' or '{document_id}' in '{from_step_1.document_id}')
E    +  where '{from_step_1.document_id}' = str('{from_step_1.document_id}')
E    +  and   '{from_step_1.document_id}' = str('{from_step_1.document_id}')
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    182    17%   17-18, 26-27, 84-128, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 555-578, 583, 594, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     68    19%   31-36, 45, 57, 66-90, 108-109, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135    118    13%   155-212, 240-299, 315-336, 355-364, 386-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     78    19%   38-53, 71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11272    18%
=========================== short test summary info ============================
FAILED tests/unit/strategies/agentic/test_workflow_definitions.py::TestWorkflow3SearchThenRead::test_workflow_3_chaining - AssertionError: assert ('{from_step_1}' in '{from_step_1.document_id}' or '{document_id}' in '{from_step_1.document_id}')
 +  where '{from_step_1.document_id}' = str('{from_step_1.document_id}')
 +  and   '{from_step_1.document_id}' = str('{from_step_1.document_id}')
=================== 1 failed, 16 passed, 8 warnings in 5.10s ===================

[161/209] FAILED: tests/unit/strategies/agentic/test_workflow_execution.py
  Tests: 15 (P:13 F:2 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 14 items

tests/unit/strategies/agentic/test_workflow_execution.py::TestParameterSubstitution::test_substitute_query_placeholder PASSED [  7%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestParameterSubstitution::test_substitute_from_step_placeholder PASSED [ 14%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestParameterSubstitution::test_substitute_no_placeholders PASSED [ 21%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowExecution::test_execute_workflow_1_simple_search PASSED [ 28%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowExecution::test_execute_workflow_3_search_then_read PASSED [ 35%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowExecution::test_execute_workflow_stops_on_failure PASSED [ 42%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowExecution::test_execute_workflow_with_empty_results PASSED [ 50%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowExecution::test_execute_workflow_preserves_execution_order PASSED [ 57%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowExecution::test_execute_workflow_invalid_plan_number PASSED [ 64%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowExecution::test_execute_workflow_metadata_extraction PASSED [ 71%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowErrorHandling::test_tool_not_found FAILED [ 78%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowErrorHandling::test_tool_raises_exception PASSED [ 85%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowResultAggregation::test_results_contain_all_steps PASSED [ 92%]
tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowResultAggregation::test_results_preserve_metadata PASSED [100%]

=================================== FAILURES ===================================
________________ TestWorkflowErrorHandling.test_tool_not_found _________________
tests/unit/strategies/agentic/test_workflow_execution.py:213: in test_tool_not_found
    with pytest.raises(KeyError):
E   Failed: DID NOT RAISE <class 'KeyError'>
---------------------------- Captured stderr setup -----------------------------
DEBUG:asyncio:Using selector: EpollSelector
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
----------------------------- Captured stderr call -----------------------------
INFO:rag_factory.strategies.agentic.workflows:Executing workflow 3: Search Then Read Document
INFO:rag_factory.strategies.agentic.workflows:Executing step 1: semantic_search with params {'query': 'test', 'top_k': 1, 'min_score': 0.7}
DEBUG:rag_factory.strategies.agentic.workflows:Trying to extract document_id from step 1 result
DEBUG:rag_factory.strategies.agentic.workflows:Data item type: <class 'dict'>, keys: dict_keys(['chunk_id', 'document_id', 'text', 'score'])
INFO:rag_factory.strategies.agentic.workflows:Successfully substituted {from_step_1.document_id} with doc1
ERROR:rag_factory.strategies.agentic.workflows:Tool read_document not found
INFO:rag_factory.strategies.agentic.workflows:Workflow completed with 2 steps
------------------------------ Captured log call -------------------------------
INFO     rag_factory.strategies.agentic.workflows:workflows.py:389 Executing workflow 3: Search Then Read Document
INFO     rag_factory.strategies.agentic.workflows:workflows.py:415 Executing step 1: semantic_search with params {'query': 'test', 'top_k': 1, 'min_score': 0.7}
DEBUG    rag_factory.strategies.agentic.workflows:workflows.py:265 Trying to extract document_id from step 1 result
DEBUG    rag_factory.strategies.agentic.workflows:workflows.py:266 Data item type: <class 'dict'>, keys: dict_keys(['chunk_id', 'document_id', 'text', 'score'])
INFO     rag_factory.strategies.agentic.workflows:workflows.py:270 Successfully substituted {from_step_1.document_id} with doc1
ERROR    rag_factory.strategies.agentic.workflows:workflows.py:401 Tool read_document not found
INFO     rag_factory.strategies.agentic.workflows:workflows.py:435 Workflow completed with 2 steps
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    182    17%   17-18, 26-27, 84-128, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 555-578, 583, 594, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     68    19%   31-36, 45, 57, 66-90, 108-109, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135     52    61%   155-212, 273-282, 291-297, 333-334, 355-364
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     65    19%   29-35, 51-67, 83-109, 135-171, 187-258, 266
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     56    19%   28-30, 53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     78    19%   38-53, 71-187, 198-212, 235-265, 270, 275
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11206    19%
=========================== short test summary info ============================
FAILED tests/unit/strategies/agentic/test_workflow_execution.py::TestWorkflowErrorHandling::test_tool_not_found - Failed: DID NOT RAISE <class 'KeyError'>
=================== 1 failed, 13 passed, 8 warnings in 5.59s ===================

[162/209] PASSED: tests/unit/strategies/chunking/test_docling_chunker.py
  Tests: 6 (P:4 F:0 S:2)
[163/209] PASSED: tests/unit/strategies/chunking/test_fixed_size_chunker.py
  Tests: 13 (P:13 F:0 S:0)
[164/209] PASSED: tests/unit/strategies/chunking/test_hybrid_chunker.py
  Tests: 12 (P:12 F:0 S:0)
[165/209] PASSED: tests/unit/strategies/chunking/test_semantic_chunker.py
  Tests: 14 (P:14 F:0 S:0)
[166/209] PASSED: tests/unit/strategies/chunking/test_structural_chunker.py
  Tests: 15 (P:15 F:0 S:0)
[167/209] PASSED: tests/unit/strategies/contextual/test_batch_processor.py
  Tests: 7 (P:7 F:0 S:0)
[168/209] PASSED: tests/unit/strategies/contextual/test_context_generator.py
  Tests: 9 (P:9 F:0 S:0)
[169/209] PASSED: tests/unit/strategies/contextual/test_cost_tracker.py
  Tests: 9 (P:9 F:0 S:0)
[170/209] PASSED: tests/unit/strategies/contextual/test_storage.py
  Tests: 8 (P:8 F:0 S:0)
[171/209] PASSED: tests/unit/strategies/fine_tuned/test_ab_testing.py
  Tests: 3 (P:3 F:0 S:0)
[172/209] PASSED: tests/unit/strategies/fine_tuned/test_custom_loader.py
  Tests: 3 (P:3 F:0 S:0)
[173/209] PASSED: tests/unit/strategies/fine_tuned/test_model_registry.py
  Tests: 5 (P:5 F:0 S:0)
[174/209] PASSED: tests/unit/strategies/hierarchical/test_hierarchy_builder.py
  Tests: 14 (P:14 F:0 S:0)
[175/209] PASSED: tests/unit/strategies/hierarchical/test_parent_retriever.py
  Tests: 8 (P:8 F:0 S:0)
[176/209] PASSED: tests/unit/strategies/indexing/test_context_aware.py
  Tests: 9 (P:9 F:0 S:0)
[177/209] PASSED: tests/unit/strategies/knowledge_graph/test_entity_extractor.py
  Tests: 6 (P:6 F:0 S:0)
[178/209] PASSED: tests/unit/strategies/knowledge_graph/test_hybrid_retriever.py
  Tests: 7 (P:7 F:0 S:0)
[179/209] PASSED: tests/unit/strategies/knowledge_graph/test_memory_graph_store.py
  Tests: 8 (P:8 F:0 S:0)
[180/209] PASSED: tests/unit/strategies/late_chunking/test_coherence_analyzer.py
  Tests: 7 (P:7 F:0 S:0)
[181/209] PASSED: tests/unit/strategies/late_chunking/test_document_embedder.py
  Tests: 13 (P:13 F:0 S:0)
[182/209] PASSED: tests/unit/strategies/late_chunking/test_embedding_chunker.py
  Tests: 12 (P:12 F:0 S:0)
[183/209] PASSED: tests/unit/strategies/multi_query/test_deduplicator.py
  Tests: 7 (P:7 F:0 S:0)
[184/209] PASSED: tests/unit/strategies/multi_query/test_parallel_executor.py
  Tests: 6 (P:6 F:0 S:0)
[185/209] PASSED: tests/unit/strategies/multi_query/test_ranker.py
  Tests: 7 (P:7 F:0 S:0)
[186/209] PASSED: tests/unit/strategies/multi_query/test_variant_generator.py
  Tests: 7 (P:7 F:0 S:0)
[187/209] PASSED: tests/unit/strategies/query_expansion/test_base.py
  Tests: 13 (P:13 F:0 S:0)
[188/209] PASSED: tests/unit/strategies/query_expansion/test_expander_service.py
  Tests: 15 (P:15 F:0 S:0)
[189/209] PASSED: tests/unit/strategies/query_expansion/test_llm_expander.py
  Tests: 11 (P:11 F:0 S:0)
[190/209] PASSED: tests/unit/strategies/query_expansion/test_prompts.py
  Tests: 12 (P:12 F:0 S:0)
[191/209] PASSED: tests/unit/strategies/reranking/test_base.py
  Tests: 14 (P:14 F:0 S:0)
[192/209] PASSED: tests/unit/strategies/reranking/test_cache.py
  Tests: 13 (P:13 F:0 S:0)
[193/209] PASSED: tests/unit/strategies/reranking/test_cosine_reranker.py
  Tests: 17 (P:17 F:0 S:0)
[194/209] PASSED: tests/unit/strategies/reranking/test_cross_encoder_reranker.py
  Tests: 10 (P:1 F:0 S:9)
[195/209] PASSED: tests/unit/strategies/reranking/test_metrics.py
  Tests: 36 (P:36 F:0 S:0)
[196/209] PASSED: tests/unit/strategies/reranking/test_reranker_selector.py
  Tests: 21 (P:21 F:0 S:0)
[197/209] PASSED: tests/unit/strategies/reranking/test_reranker_service.py
  Tests: 16 (P:16 F:0 S:0)
[198/209] PASSED: tests/unit/strategies/self_reflective/test_grader.py
  Tests: 8 (P:8 F:0 S:0)
[199/209] PASSED: tests/unit/strategies/self_reflective/test_refiner.py
  Tests: 8 (P:8 F:0 S:0)
[200/209] FAILED: tests/unit/strategies/self_reflective/test_strategy.py
  Tests: 13 (P:3 F:10 S:0)
----------------------------------------
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.1, pluggy-1.6.0 -- /mnt/MCPProyects/ragTools/venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/MCPProyects/ragTools
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.0, cov-7.0.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 8 items

tests/unit/strategies/self_reflective/test_strategy.py::test_retrieve_good_results_no_retry FAILED [ 12%]
tests/unit/strategies/self_reflective/test_strategy.py::test_retrieve_poor_results_triggers_retry FAILED [ 25%]
tests/unit/strategies/self_reflective/test_strategy.py::test_max_retries_enforced FAILED [ 37%]
tests/unit/strategies/self_reflective/test_strategy.py::test_result_aggregation PASSED [ 50%]
tests/unit/strategies/self_reflective/test_strategy.py::test_timeout_protection FAILED [ 62%]
tests/unit/strategies/self_reflective/test_strategy.py::test_same_query_prevention FAILED [ 75%]
tests/unit/strategies/self_reflective/test_strategy.py::test_normalize_results PASSED [ 87%]
tests/unit/strategies/self_reflective/test_strategy.py::test_strategy_properties PASSED [100%]

=================================== FAILURES ===================================
_____________________ test_retrieve_good_results_no_retry ______________________
tests/unit/strategies/self_reflective/test_strategy.py:57: in test_retrieve_good_results_no_retry
    results = self_reflective_strategy.retrieve("test query", top_k=5)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
__________________ test_retrieve_poor_results_triggers_retry ___________________
tests/unit/strategies/self_reflective/test_strategy.py:86: in test_retrieve_poor_results_triggers_retry
    results = self_reflective_strategy.retrieve("test query", top_k=5)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
__________________________ test_max_retries_enforced ___________________________
tests/unit/strategies/self_reflective/test_strategy.py:114: in test_max_retries_enforced
    results = self_reflective_strategy.retrieve("test query", top_k=5)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
___________________________ test_timeout_protection ____________________________
tests/unit/strategies/self_reflective/test_strategy.py:196: in test_timeout_protection
    results = strategy.retrieve("test query", top_k=5)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
__________________________ test_same_query_prevention __________________________
tests/unit/strategies/self_reflective/test_strategy.py:222: in test_same_query_prevention
    results = self_reflective_strategy.retrieve("test query", top_k=5)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
=============================== warnings summary ===============================
rag_factory/services/llm/config.py:8
  /mnt/MCPProyects/ragTools/rag_factory/services/llm/config.py:8: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class LLMServiceConfig(BaseModel):

rag_factory/database/config.py:12
  /mnt/MCPProyects/ragTools/rag_factory/database/config.py:12: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DatabaseConfig(BaseSettings):

rag_factory/strategies/agentic/config.py:9
  /mnt/MCPProyects/ragTools/rag_factory/strategies/agentic/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AgenticStrategyConfig(BaseModel):

rag_factory/strategies/late_chunking/models.py:21
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:21: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:34
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:34: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentEmbedding(BaseModel):

rag_factory/strategies/late_chunking/models.py:49
  /mnt/MCPProyects/ragTools/rag_factory/strategies/late_chunking/models.py:49: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EmbeddingChunk(BaseModel):

rag_factory/strategies/contextual/config.py:31
  /mnt/MCPProyects/ragTools/rag_factory/strategies/contextual/config.py:31: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ContextualRetrievalConfig(BaseModel):

rag_factory/strategies/fine_tuned/config.py:6
  /mnt/MCPProyects/ragTools/rag_factory/strategies/fine_tuned/config.py:6: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FineTunedConfig(BaseSettings):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
rag_factory/__init__.py                                                7      2    71%   18-19
rag_factory/__version__.py                                             1      0   100%
rag_factory/cli/__init__.py                                            2      0   100%
rag_factory/cli/commands/__init__.py                                   1      0   100%
rag_factory/cli/commands/benchmark.py                                 96     81    16%   40-53, 64-84, 148-263
rag_factory/cli/commands/check_consistency.py                         43     33    23%   64-120
rag_factory/cli/commands/config.py                                    78     68    13%   26-64, 102-188
rag_factory/cli/commands/gui.py                                       25     17    32%   61-91
rag_factory/cli/commands/index.py                                     65     52    20%   29-39, 93-185
rag_factory/cli/commands/query.py                                     47     36    23%   73-149
rag_factory/cli/commands/repl.py                                     152    130    14%   29-56, 63-108, 112-120, 124-133, 137-155, 159-172, 176-186, 190-207, 211-220, 253-260
rag_factory/cli/commands/strategies.py                                45     36    20%   48-120
rag_factory/cli/commands/validate_e2e.py                              91     69    24%   37-38, 42-142, 145-156
rag_factory/cli/commands/validate_pipeline.py                         70     57    19%   57-156
rag_factory/cli/formatters/__init__.py                                 4      0   100%
rag_factory/cli/formatters/consistency.py                             61     55    10%   21-69, 79-103, 108-138
rag_factory/cli/formatters/output.py                                  20      9    55%   23-24, 43-44, 63-64, 74, 79, 84
rag_factory/cli/formatters/results.py                                 71     62    13%   28-55, 72-99, 116-144, 157-181
rag_factory/cli/formatters/validation.py                              63     53    16%   25-43, 48-56, 65-77, 86-98, 103-129, 134-137
rag_factory/cli/main.py                                               32     10    69%   25-28, 48-49, 79-81, 85
rag_factory/cli/utils/__init__.py                                      3      0   100%
rag_factory/cli/utils/progress.py                                     14      8    43%   34-47, 73-76
rag_factory/cli/utils/validation.py                                   53     42    21%   30-41, 57-77, 93-118, 135
rag_factory/config/__init__.py                                         4      0   100%
rag_factory/config/env_resolver.py                                    52     37    29%   47-54, 70-90, 110, 129-147
rag_factory/config/schemas/__init__.py                                 2      0   100%
rag_factory/config/schemas/version.py                                 10      6    40%   29-38
rag_factory/config/strategy_loader.py                                 54     36    33%   32-41, 45-60, 75-89, 101-104
rag_factory/config/strategy_pair_manager.py                          105     83    21%   40-72, 92-132, 148-198, 210-215, 229, 259-282
rag_factory/config/validator.py                                       93     76    18%   27-30, 34-39, 53-58, 62-74, 111-132, 177-198, 215-235, 247-249, 271-295, 333-354
rag_factory/core/__init__.py                                           4      4     0%   7-23
rag_factory/core/capabilities.py                                      61     16    74%   129, 155, 173-174, 239-253
rag_factory/core/indexing_interface.py                                54     35    35%   55-57, 118-123, 144, 164, 208, 260, 272, 292-313, 341-364
rag_factory/core/pipeline.py                                          49     35    29%   22-24, 33-40, 55-77, 95-96, 105-108, 117-120, 137-146
rag_factory/core/retrieval_interface.py                               38     20    47%   56-58, 112-117, 138, 158, 196, 247, 259, 285-309
rag_factory/database/__init__.py                                       4      0   100%
rag_factory/database/config.py                                        17      0   100%
rag_factory/database/connection.py                                    80     54    32%   40-48, 61-86, 96, 107, 126-137, 150-157, 165-170, 178-183, 196-197, 209-214, 218, 222
rag_factory/database/env_validator.py                                 38     38     0%   7-139
rag_factory/database/models.py                                        85     32    62%   31-34, 37-45, 48-54, 66-69, 72-77, 80-85, 181, 323-325
rag_factory/database/vector_indexing.py                               38     38     0%   7-114
rag_factory/evaluation/__init__.py                                     4      4     0%   29-41
rag_factory/evaluation/analysis/__init__.py                            3      3     0%   8-11
rag_factory/evaluation/analysis/comparison.py                        135    135     0%   8-323
rag_factory/evaluation/analysis/statistics.py                         81     81     0%   8-320
rag_factory/evaluation/benchmarks/__init__.py                          3      3     0%   8-14
rag_factory/evaluation/benchmarks/config.py                           25     25     0%   7-64
rag_factory/evaluation/benchmarks/runner.py                          155    155     0%   8-423
rag_factory/evaluation/datasets/__init__.py                            3      3     0%   8-14
rag_factory/evaluation/datasets/loader.py                             88     88     0%   8-281
rag_factory/evaluation/datasets/schema.py                             52     52     0%   8-160
rag_factory/evaluation/datasets/statistics.py                         65     65     0%   8-226
rag_factory/evaluation/exporters/__init__.py                           4      4     0%   8-12
rag_factory/evaluation/exporters/csv_exporter.py                      52     52     0%   3-124
rag_factory/evaluation/exporters/html_exporter.py                     47     47     0%   3-293
rag_factory/evaluation/exporters/json_exporter.py                     19     19     0%   3-68
rag_factory/evaluation/metrics/__init__.py                             3      3     0%   12-25
rag_factory/evaluation/metrics/base.py                                31     31     0%   8-115
rag_factory/evaluation/metrics/cost.py                                65     65     0%   8-313
rag_factory/evaluation/metrics/performance.py                         42     42     0%   8-202
rag_factory/evaluation/metrics/quality.py                             84     84     0%   8-377
rag_factory/evaluation/metrics/retrieval.py                           77     77     0%   9-401
rag_factory/exceptions.py                                             13      0   100%
rag_factory/factory.py                                               187    137    27%   109-116, 144, 165-170, 202-230, 256-270, 300-324, 347-348, 365, 384, 401, 418, 435, 451-460, 480-502, 528-545, 568-611, 644-699, 703-715
rag_factory/gui/__init__.py                                            2      0   100%
rag_factory/gui/components/__init__.py                                 3      0   100%
rag_factory/gui/components/scrolled_text.py                           64     52    19%   53-62, 80-114, 122, 131-142, 151-164, 168, 176, 184-199
rag_factory/gui/components/status_bar.py                              62     49    21%   40-59, 64-113, 122-137, 146-152, 161, 168, 172-184, 192-196
rag_factory/gui/main_window.py                                       712    651     9%   64-109, 113-128, 137-164, 168-194, 205-263, 268-293, 297-339, 348-408, 416-440, 453-487, 500-518, 531-569, 582-620, 633-691, 704-708, 712-750, 754-756, 764-807, 824-835, 844-876, 880-897, 903-913, 917-988, 992-1080, 1090-1092, 1100-1102, 1106-1182, 1195-1252, 1262-1264, 1272-1276, 1280-1337, 1342-1389, 1393-1412, 1416, 1429-1505, 1509-1567, 1572-1589, 1593-1600, 1605-1618, 1623-1632, 1636
rag_factory/gui/utils/__init__.py                                      3      0   100%
rag_factory/gui/utils/formatters.py                                   57     49    14%   27-30, 50-90, 110-118, 134-137, 155-165
rag_factory/gui/utils/threading.py                                    32     25    22%   44-73, 96-99, 124-129
rag_factory/legacy_config.py                                         155    155     0%   22-542
rag_factory/models/__init__.py                                         6      6     0%   3-14
rag_factory/models/embedding/__init__.py                               4      4     0%   3-12
rag_factory/models/embedding/loader.py                               179    179     0%   3-367
rag_factory/models/embedding/models.py                                47     47     0%   3-106
rag_factory/models/embedding/registry.py                             128    128     0%   3-282
rag_factory/models/evaluation/__init__.py                              3      3     0%   3-6
rag_factory/models/evaluation/ab_testing.py                           98     98     0%   3-281
rag_factory/models/evaluation/models.py                               29     29     0%   3-74
rag_factory/observability/__init__.py                                  3      3     0%   3-10
rag_factory/observability/integrations/__init__.py                     1      1     0%   3
rag_factory/observability/integrations/prometheus.py                  47     47     0%   3-229
rag_factory/observability/logging/__init__.py                          2      2     0%   3-5
rag_factory/observability/logging/config.py                           16     16     0%   3-37
rag_factory/observability/logging/filters.py                          41     41     0%   3-103
rag_factory/observability/logging/logger.py                           86     86     0%   3-396
rag_factory/observability/metrics/__init__.py                          2      2     0%   3-9
rag_factory/observability/metrics/collector.py                       143    143     0%   3-459
rag_factory/observability/metrics/cost.py                             39     39     0%   3-221
rag_factory/observability/metrics/performance.py                      64     64     0%   3-196
rag_factory/observability/monitoring/__init__.py                       1      1     0%   3
rag_factory/observability/monitoring/api.py                          101    101     0%   3-328
rag_factory/pipeline.py                                              156    156     0%   34-507
rag_factory/registry/__init__.py                                       4      0   100%
rag_factory/registry/exceptions.py                                     6      0   100%
rag_factory/registry/service_factory.py                               84     69    18%   45-54, 62-65, 70-73, 78-80, 84-86, 95-127, 136-165, 176-215, 229-255
rag_factory/registry/service_registry.py                              91     71    22%   43-51, 55-85, 103-156, 164, 178-203, 210-223, 227, 231-232
rag_factory/repositories/__init__.py                                   5      0   100%
rag_factory/repositories/base.py                                      42     21    50%   38, 53, 70, 87, 103, 114-118, 125, 136-139, 159-164
rag_factory/repositories/chunk.py                                    242    212    12%   43-45, 56, 70-75, 98-106, 120-125, 150-163, 185-201, 217-232, 251-261, 280-291, 317-398, 425-476, 502-564, 579-589, 603-611, 627-633, 647-653, 667-677, 694-716, 729-760
rag_factory/repositories/document.py                                  96     76    21%   39-40, 54-59, 76-81, 111-131, 153-169, 185-200, 219, 236-246, 260-268, 285-292, 303-306, 320-325
rag_factory/repositories/exceptions.py                                18      7    61%   34-36, 56-59
rag_factory/services/__init__.py                                       4      0   100%
rag_factory/services/api/__init__.py                                   4      4     0%   7-11
rag_factory/services/api/anthropic.py                                 27     27     0%   7-141
rag_factory/services/api/cohere.py                                    30     30     0%   7-113
rag_factory/services/api/openai.py                                    46     46     0%   7-235
rag_factory/services/consistency.py                                   32     24    25%   80-113, 144-170
rag_factory/services/database/__init__.py                              5      0   100%
rag_factory/services/database/database_context.py                    276    244    12%   58-64, 88-106, 123, 140-150, 179-200, 223-240, 256-266, 305-330, 338-339, 343-416, 424-425, 440-520, 526-527, 531-556, 564-565, 569-591, 595-596, 600-620, 624-625, 629-660, 665-682, 687-699
rag_factory/services/database/database_context_additions.py           51     51     0%   3-79
rag_factory/services/database/migration_validator.py                  96     74    23%   29-30, 61-69, 81-88, 109-131, 148-152, 163-192, 204-219, 230-237, 249, 261-271, 283-286
rag_factory/services/database/neo4j.py                                54     38    30%   15-17, 60-71, 79-84, 103-114, 134-150, 172-181, 188-191, 195, 199
rag_factory/services/database/postgres.py                            218    182    17%   17-18, 26-27, 84-128, 140-151, 163-174, 182-196, 200-252, 265-320, 343-397, 411-426, 441-465, 476-491, 523-541, 555-578, 583, 594, 631-649, 658-670, 674, 678
rag_factory/services/dependencies.py                                  41     21    49%   96-109, 134-140, 176-180
rag_factory/services/embedding/__init__.py                             4      0   100%
rag_factory/services/embedding/base.py                                31      6    81%   44, 59, 68, 77, 86, 98
rag_factory/services/embedding/cache.py                               43     33    23%   26-32, 43-58, 67-76, 80-82, 90-94
rag_factory/services/embedding/config.py                              29     13    55%   37-43, 50-68, 80
rag_factory/services/embedding/providers/__init__.py                   5      0   100%
rag_factory/services/embedding/providers/cohere.py                    53     36    32%   10-20, 55-75, 90-117, 125, 133, 141, 152-153
rag_factory/services/embedding/providers/local.py                     43     27    37%   8-9, 46-67, 83-109, 117, 125, 133, 146
rag_factory/services/embedding/providers/onnx_local.py               114     93    18%   18-19, 87-177, 193-250, 261-308, 319, 327, 335, 348
rag_factory/services/embedding/providers/openai.py                    51     34    33%   10-20, 53-72, 87-108, 116, 124, 132, 143-144
rag_factory/services/embedding/rate_limiter.py                        20     14    30%   27-37, 45-53
rag_factory/services/embedding/service.py                            100     83    17%   50-62, 79-93, 117-198, 220-222, 233-239, 248-266, 273-275
rag_factory/services/interfaces.py                                    35      0   100%
rag_factory/services/llm/__init__.py                                   5      0   100%
rag_factory/services/llm/base.py                                      43      0   100%
rag_factory/services/llm/config.py                                    23     11    52%   42-57
rag_factory/services/llm/prompt_template.py                           43     24    44%   47-82, 97-100, 111-115
rag_factory/services/llm/providers/__init__.py                        12     12     0%   5-22
rag_factory/services/llm/providers/anthropic.py                       57     57     0%   3-205
rag_factory/services/llm/providers/ollama.py                          55     55     0%   3-196
rag_factory/services/llm/providers/openai.py                          57     57     0%   3-210
rag_factory/services/llm/service.py                                   79     61    23%   33-40, 57-71, 94-130, 155-176, 187, 195-199, 216-217, 232-246, 259-272
rag_factory/services/llm/token_counter.py                             27     27     0%   3-72
rag_factory/services/local/__init__.py                                 2      2     0%   7-9
rag_factory/services/local/reranker.py                                32     32     0%   7-116
rag_factory/services/onnx/__init__.py                                  2      2     0%   7-9
rag_factory/services/onnx/embedding.py                                29     29     0%   7-129
rag_factory/services/utils/__init__.py                                 2      0   100%
rag_factory/services/utils/model_converter.py                        104    104     0%   8-291
rag_factory/services/utils/onnx_utils.py                             133    114    14%   22-23, 36-37, 67-123, 142-146, 172-218, 240-274, 291-312, 332-347, 360-378, 392-404
rag_factory/services/utils/reranker_selector.py                       68     68     0%   8-249
rag_factory/strategies/__init__.py                                     2      0   100%
rag_factory/strategies/agentic/__init__.py                             7      0   100%
rag_factory/strategies/agentic/agent.py                               84     68    19%   31-36, 45, 57, 66-90, 108-109, 121-172, 190-221, 235-256
rag_factory/strategies/agentic/config.py                              12      0   100%
rag_factory/strategies/agentic/frameworks/__init__.py                  1      1     0%   9
rag_factory/strategies/agentic/query_analyzer.py                      89     65    27%   50-55, 67, 79-90, 109-125, 137-147, 159-178, 196-214, 225-260, 278
rag_factory/strategies/agentic/strategy.py                            88     61    31%   50-63, 76, 84, 94-132, 144, 157, 170, 183-225, 237-261, 270, 279, 287
rag_factory/strategies/agentic/tool_implementations.py               135     91    33%   36-37, 41, 45, 52, 86-129, 148-149, 153, 157, 164, 182-247, 266-267, 271, 275, 282, 329-373, 392-393, 397, 401, 407, 446-511
rag_factory/strategies/agentic/tools.py                               40      9    78%   66, 79, 89, 101, 112, 139-142
rag_factory/strategies/agentic/workflows.py                          135    135     0%   7-436
rag_factory/strategies/auto_register.py                               66     20    70%   13-14, 18-19, 23-24, 28-29, 33-34, 39-40, 46-47, 52-53, 58-59, 79-80
rag_factory/strategies/base.py                                        55     13    76%   80-85, 169-178
rag_factory/strategies/chunking/__init__.py                           15     15     0%   28-67
rag_factory/strategies/chunking/base.py                               91     91     0%   3-256
rag_factory/strategies/chunking/docling_chunker.py                    45     45     0%   13-188
rag_factory/strategies/chunking/fixed_size_chunker.py                 74     74     0%   3-204
rag_factory/strategies/chunking/hybrid_chunker.py                     70     70     0%   3-192
rag_factory/strategies/chunking/semantic_chunker.py                  195    195     0%   3-534
rag_factory/strategies/chunking/structural_chunker.py                147    147     0%   3-425
rag_factory/strategies/chunking/utils.py                              89     89     0%   3-264
rag_factory/strategies/contextual/__init__.py                          7      0   100%
rag_factory/strategies/contextual/batch_processor.py                  91     76    16%   41-43, 60-72, 84-90, 108-128, 145-161, 178-201, 218-266
rag_factory/strategies/contextual/config.py                           46      0   100%
rag_factory/strategies/contextual/context_generator.py                84     70    17%   35-36, 59-99, 112-135, 152-194, 209, 224-234
rag_factory/strategies/contextual/cost_tracker.py                     32     21    34%   31-35, 48-51, 69-82, 94-99, 111-114, 126
rag_factory/strategies/contextual/prompts.py                          25     17    32%   85-106, 119
rag_factory/strategies/contextual/storage.py                          44     35    20%   32-33, 42-45, 54-81, 98-118
rag_factory/strategies/contextual/strategy.py                         78     49    37%   54-67, 75, 83, 107-156, 173, 186, 207-215, 231-262, 278, 284, 289, 298
rag_factory/strategies/fine_tuned/__init__.py                          4      0   100%
rag_factory/strategies/fine_tuned/ab_testing.py                       78     78     0%   1-134
rag_factory/strategies/fine_tuned/config.py                           11      0   100%
rag_factory/strategies/fine_tuned/custom_loader.py                    40     28    30%   17-19, 36-73, 77, 84-88
rag_factory/strategies/fine_tuned/model_registry.py                  126     96    24%   39-50, 80-112, 132-149, 166-178, 182-196, 200-223, 227-240, 249-270, 274-287, 291-303
rag_factory/strategies/hierarchical/__init__.py                        5      5     0%   8-21
rag_factory/strategies/hierarchical/hierarchy_builder.py              79     79     0%   8-335
rag_factory/strategies/hierarchical/models.py                         58     58     0%   8-137
rag_factory/strategies/hierarchical/parent_retriever.py               89     89     0%   8-278
rag_factory/strategies/hierarchical/strategy.py                       76     76     0%   9-301
rag_factory/strategies/indexing/__init__.py                            6      0   100%
rag_factory/strategies/indexing/context_aware.py                     111     91    18%   31, 43, 63-140, 161-162, 166-176, 188-194, 198-204, 214-243, 247-248
rag_factory/strategies/indexing/hierarchical.py                       97     80    18%   50, 63, 88-145, 167-196, 212-247, 264-289, 303-304
rag_factory/strategies/indexing/in_memory.py                          41     25    39%   54, 65, 93-121, 143, 160, 173, 194-200
rag_factory/strategies/indexing/keyword_indexing.py                   66     54    18%   42, 53, 77-169, 190-212
rag_factory/strategies/indexing/knowledge_graph_indexing.py           46     33    28%   18, 27, 48-89, 108-130
rag_factory/strategies/indexing/vector_embedding.py                   98     85    13%   25, 35, 55-116, 137-222
rag_factory/strategies/knowledge_graph/__init__.py                     4      4     0%   8-19
rag_factory/strategies/knowledge_graph/config.py                      21     21     0%   8-129
rag_factory/strategies/knowledge_graph/entity_extractor.py            70     70     0%   7-205
rag_factory/strategies/knowledge_graph/graph_store.py                 31     31     0%   8-124
rag_factory/strategies/knowledge_graph/hybrid_retriever.py            56     56     0%   8-164
rag_factory/strategies/knowledge_graph/memory_graph_store.py          97     97     0%   8-196
rag_factory/strategies/knowledge_graph/models.py                      53     53     0%   8-122
rag_factory/strategies/knowledge_graph/relationship_extractor.py      62     62     0%   8-189
rag_factory/strategies/knowledge_graph/strategy.py                    80     80     0%   8-256
rag_factory/strategies/late_chunking/__init__.py                       6      0   100%
rag_factory/strategies/late_chunking/coherence_analyzer.py            27     17    37%   20-21, 36-45, 57-65, 82-96
rag_factory/strategies/late_chunking/document_embedder.py            104     89    14%   29-74, 94-184, 202-215, 227-235, 256-279, 296-303, 318
rag_factory/strategies/late_chunking/embedding_chunker.py            117    102    13%   26, 41-61, 68-98, 105-155, 162-182, 191-192, 199-254, 265-289, 293-300
rag_factory/strategies/late_chunking/models.py                        62      0   100%
rag_factory/strategies/late_chunking/strategy.py                      73     49    33%   48-69, 77, 88, 107-122, 140-185, 204-213, 218, 223
rag_factory/strategies/multi_query/__init__.py                         7      7     0%   8-19
rag_factory/strategies/multi_query/config.py                          36     36     0%   3-138
rag_factory/strategies/multi_query/deduplicator.py                    87     87     0%   3-197
rag_factory/strategies/multi_query/parallel_executor.py               52     52     0%   3-163
rag_factory/strategies/multi_query/prompts.py                         10     10     0%   3-84
rag_factory/strategies/multi_query/ranker.py                          80     80     0%   3-201
rag_factory/strategies/multi_query/strategy.py                        68     68     0%   3-184
rag_factory/strategies/multi_query/variant_generator.py               62     62     0%   3-187
rag_factory/strategies/query_expansion/__init__.py                     8      0   100%
rag_factory/strategies/query_expansion/base.py                        66     10    85%   90, 103, 114-118, 130-133
rag_factory/strategies/query_expansion/cache.py                       52     40    23%   20-22, 38-55, 64-66, 70-73, 81-97, 105-112
rag_factory/strategies/query_expansion/expander_service.py            92     71    23%   36-40, 55-58, 75-148, 159-180, 204-215, 233-234, 242-246, 254, 265-273, 283-284
rag_factory/strategies/query_expansion/hyde_expander.py               19     12    37%   25-27, 41-65
rag_factory/strategies/query_expansion/llm_expander.py                25     16    36%   23-25, 39-71, 99
rag_factory/strategies/query_expansion/metrics.py                     66     30    55%   44-45, 53-57, 76-109, 130, 134, 146-152, 160
rag_factory/strategies/query_expansion/prompts.py                     13      7    46%   16, 28-56, 68-107
rag_factory/strategies/reranking/__init__.py                           7      0   100%
rag_factory/strategies/reranking/base.py                              68     16    76%   81, 101, 106, 110-119, 123-130
rag_factory/strategies/reranking/bge_reranker.py                      51     37    27%   14, 53-81, 103-147, 151
rag_factory/strategies/reranking/cache.py                             48     34    29%   32-34, 51-66, 76-77, 81, 90-101, 110-113, 121, 136-138
rag_factory/strategies/reranking/cohere_reranker.py                   34     20    41%   15-16, 55-71, 94-115, 119
rag_factory/strategies/reranking/cosine_reranker.py                   62     47    24%   54-72, 97-139, 158-171, 188, 209-215, 227-230, 242-245, 249
rag_factory/strategies/reranking/cross_encoder_reranker.py            40     27    32%   13-14, 53-76, 98-120, 124
rag_factory/strategies/reranking/metrics.py                           67     67     0%   8-264
rag_factory/strategies/reranking/reranker_service.py                 115     88    23%   56-67, 71-96, 113-225, 235-255, 269, 282-283, 287-292, 296-300, 308-310
rag_factory/strategies/retrieval/__init__.py                           6      0   100%
rag_factory/strategies/retrieval/hybrid_retriever.py                  51     37    27%   32, 39, 51-102, 110-144
rag_factory/strategies/retrieval/keyword_retriever.py                 56     41    27%   41, 52, 71-113, 126-133, 153-172
rag_factory/strategies/retrieval/knowledge_graph_retriever.py         22      9    59%   19, 27, 48-70
rag_factory/strategies/retrieval/multi_query_retriever.py             22      9    59%   19, 26, 44-66
rag_factory/strategies/retrieval/query_expansion_retriever.py         24      9    62%   20, 27, 45-67
rag_factory/strategies/retrieval/semantic_retriever.py                23     12    48%   23, 32, 61-94
rag_factory/strategies/self_reflective/__init__.py                     6      0   100%
rag_factory/strategies/self_reflective/config.py                      20      8    60%   29-42
rag_factory/strategies/self_reflective/grader.py                      80     60    25%   51-67, 83-109, 135-171, 187-258
rag_factory/strategies/self_reflective/models.py                      48      0   100%
rag_factory/strategies/self_reflective/refiner.py                     69     53    23%   53-96, 113-143, 161-193, 208-228
rag_factory/strategies/self_reflective/strategy.py                    96     47    51%   71-187
rag_factory/utils/__init__.py                                          3      0   100%
rag_factory/utils/token_counter.py                                    45     30    33%   36-40, 52-62, 74-82, 86, 90, 105-106, 124-135, 153-158
rag_factory/utils/tokenization.py                                     95     73    23%   36-40, 53-64, 87-114, 126-129, 141-144, 156, 175-190, 209-228, 241-243, 251-252, 270-271, 292-293, 314-315
------------------------------------------------------------------------------------------------
TOTAL                                                              13771  11250    18%
=========================== short test summary info ============================
FAILED tests/unit/strategies/self_reflective/test_strategy.py::test_retrieve_good_results_no_retry - TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
FAILED tests/unit/strategies/self_reflective/test_strategy.py::test_retrieve_poor_results_triggers_retry - TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
FAILED tests/unit/strategies/self_reflective/test_strategy.py::test_max_retries_enforced - TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
FAILED tests/unit/strategies/self_reflective/test_strategy.py::test_timeout_protection - TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
FAILED tests/unit/strategies/self_reflective/test_strategy.py::test_same_query_prevention - TypeError: SelfReflectiveRAGStrategy.retrieve() missing 1 required positional argument: 'context'
=================== 5 failed, 3 passed, 8 warnings in 5.03s ====================

[201/209] PASSED: tests/unit/strategies/test_base.py
  Tests: 16 (P:16 F:0 S:0)
[202/209] PASSED: tests/unit/strategies/test_base_strategy_di.py
  Tests: 10 (P:10 F:0 S:0)
[203/209] PASSED: tests/unit/test_config.py
  Tests: 38 (P:38 F:0 S:0)
[204/209] PASSED: tests/unit/test_factory_di.py
  Tests: 22 (P:22 F:0 S:0)
[205/209] PASSED: tests/unit/test_factory.py
  Tests: 29 (P:29 F:0 S:0)
[206/209] PASSED: tests/unit/test_package.py
  Tests: 12 (P:12 F:0 S:0)
[207/209] PASSED: tests/unit/test_pipeline.py
  Tests: 24 (P:24 F:0 S:0)
[208/209] PASSED: tests/unit/utils/test_token_counter.py
  Tests: 21 (P:21 F:0 S:0)
[209/209] PASSED: tests/unit/utils/test_tokenization.py
  Tests: 25 (P:25 F:0 S:0)
